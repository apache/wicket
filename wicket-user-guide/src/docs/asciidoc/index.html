<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.4">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }
audio, canvas, video { display: inline-block; }
audio:not([controls]) { display: none; height: 0; }
[hidden] { display: none; }
html { background: #fff; color: #000; font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; }
body { margin: 0; }
a:focus { outline: thin dotted; }
a:active, a:hover { outline: 0; }
h1 { font-size: 2em; margin: 0.67em 0; }
abbr[title] { border-bottom: 1px dotted; }
b, strong { font-weight: bold; }
dfn { font-style: italic; }
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }
mark { background: #ff0; color: #000; }
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }
pre { white-space: pre-wrap; }
q { quotes: "\201C" "\201D" "\2018" "\2019"; }
small { font-size: 80%; }
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
img { border: 0; }
svg:not(:root) { overflow: hidden; }
figure { margin: 0; }
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }
legend { border: 0; padding: 0; }
button, input, select, textarea { font-family: inherit; font-size: 100%; margin: 0; }
button, input { line-height: normal; }
button, select { text-transform: none; }
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; cursor: pointer; }
button[disabled], html input[disabled] { cursor: default; }
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; padding: 0; }
input[type="search"] { -webkit-appearance: textfield; -moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box; }
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }
textarea { overflow: auto; vertical-align: top; }
table { border-collapse: collapse; border-spacing: 0; }
*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
html, body { font-size: 100%; }
body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }
a:hover { cursor: pointer; }
a:focus { outline: none; }
img, object, embed { max-width: 100%; height: auto; }
object, embed { height: 100%; }
img { -ms-interpolation-mode: bicubic; }
#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }
.left { float: left !important; }
.right { float: right !important; }
.text-left { text-align: left !important; }
.text-right { text-align: right !important; }
.text-center { text-align: center !important; }
.text-justify { text-align: justify !important; }
.hide { display: none; }
.antialiased, body { -webkit-font-smoothing: antialiased; }
img { display: inline-block; vertical-align: middle; }
textarea { height: auto; min-height: 50px; }
select { width: 100%; }
p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }
.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #7a2518; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
a { color: #005498; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #00467f; }
a img { border: none; }
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Georgia, "URW Bookman L", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }
h1 { font-size: 2.125em; }
h2 { font-size: 1.6875em; }
h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }
h4 { font-size: 1.125em; }
h5 { font-size: 1.125em; }
h6 { font-size: 1em; }
hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }
em, i { font-style: italic; line-height: inherit; }
strong, b { font-weight: bold; line-height: inherit; }
small { font-size: 60%; line-height: inherit; }
code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; color: #6d180b; }
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }
ul, ol { margin-left: 1.5em; }
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }
abbr { text-transform: none; }
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: inherit; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }
blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }
.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }
@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
.print-only { display: none !important; }
@media print { * { background: transparent !important; color: #000 !important; box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }
.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }
*:not(pre) > code { font-size: 0.9375em; padding: 1px 3px 0; white-space: nowrap; background-color: #f2f2f2; border: 1px solid #cccccc; -webkit-border-radius: 4px; border-radius: 4px; text-shadow: none; }
pre, pre > code { line-height: 1.4; color: inherit; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }
kbd.keyseq { color: #555555; }
kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }
kbd kbd:first-child { margin-left: 0; }
kbd kbd:last-child { margin-right: 0; }
.menuseq, .menu { color: #090909; }
p a > code:hover { color: #561309; }
#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }
#header { margin-bottom: 2.5em; }
#header > h1 { color: black; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }
#toc { border-bottom: 3px double #ebebeb; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }
#toctitle { color: #7a2518; }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #ebebeb; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul { font-size: .95em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #ebebeb; left: auto; right: 0; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }
#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }
#footer-text { color: #dddddd; line-height: 1.44; }
.sect1 { padding-bottom: 1.25em; }
.sect1 + .sect1 { border-top: 3px double #ebebeb; }
#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }
.imageblock, .literalblock, .listingblock, .verseblock, .videoblock { margin-bottom: 1.25em; }
.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }
.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }
.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }
.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }
.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; line-height: 1.6; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }
.literalblock > .content pre, .listingblock > .content pre { background: none; border-width: 1px 0; border-style: dotted; border-color: #bfbfbf; -webkit-border-radius: 4px; border-radius: 4px; padding: 0.75em 0.75em 0.5em 0.75em; word-wrap: break-word; }
.literalblock > .content pre.nowrap, .listingblock > .content pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content pre > code, .listingblock > .content pre > code { display: block; }
@media only screen { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.8em; } }
@media only screen and (min-width: 768px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.9em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 1em; } }
.listingblock > .content { position: relative; }
.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }
.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }
.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }
.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }
table.pyhltable { border: 0; margin-bottom: 0; }
table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }
table.pyhltable td.code { padding-left: .75em; padding-right: 0; }
.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }
.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }
table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }
.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: inherit; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }
table thead th, table tfoot th { font-weight: bold; }
table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 4px; border-radius: 4px; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }
table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }
table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }
table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }
th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }
th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }
th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }
th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }
th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }
th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }
p.tableblock.header { color: #222222; font-weight: bold; }
td > div.verse { white-space: pre; }
ol { margin-left: 1.75em; }
ul li ol { margin-left: 1.5em; }
dl dd { margin-left: 1.125em; }
dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }
ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }
ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }
ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }
ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }
ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }
ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }
.unstyled dl dt { font-weight: normal; font-style: normal; }
ol.arabic { list-style-type: decimal; }
ol.decimal { list-style-type: decimal-leading-zero; }
ol.loweralpha { list-style-type: lower-alpha; }
ol.upperalpha { list-style-type: upper-alpha; }
ol.lowerroman { list-style-type: lower-roman; }
ol.upperroman { list-style-type: upper-roman; }
ol.lowergreek { list-style-type: lower-greek; }
.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }
td.hdlist1 { padding-right: .8em; font-weight: bold; }
td.hdlist1, td.hdlist2 { vertical-align: top; }
.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }
.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }
.qanda > ol > li > p > em:only-child { color: #00467f; }
.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }
.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }
a.image { text-decoration: none; }
span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }
.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }
div.unbreakable { page-break-inside: avoid; }
.big { font-size: larger; }
.small { font-size: smaller; }
.underline { text-decoration: underline; }
.overline { text-decoration: overline; }
.line-through { text-decoration: line-through; }
.aqua { color: #00bfbf; }
.aqua-background { background-color: #00fafa; }
.black { color: black; }
.black-background { background-color: black; }
.blue { color: #0000bf; }
.blue-background { background-color: #0000fa; }
.fuchsia { color: #bf00bf; }
.fuchsia-background { background-color: #fa00fa; }
.gray { color: #606060; }
.gray-background { background-color: #7d7d7d; }
.green { color: #006000; }
.green-background { background-color: #007d00; }
.lime { color: #00bf00; }
.lime-background { background-color: #00fa00; }
.maroon { color: #600000; }
.maroon-background { background-color: #7d0000; }
.navy { color: #000060; }
.navy-background { background-color: #00007d; }
.olive { color: #606000; }
.olive-background { background-color: #7d7d00; }
.purple { color: #600060; }
.purple-background { background-color: #7d007d; }
.red { color: #bf0000; }
.red-background { background-color: #fa0000; }
.silver { color: #909090; }
.silver-background { background-color: #bcbcbc; }
.teal { color: #006060; }
.teal-background { background-color: #007d7d; }
.white { color: #bfbfbf; }
.white-background { background-color: #fafafa; }
.yellow { color: #bfbf00; }
.yellow-background { background-color: #fafa00; }
span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }
.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #005498; color: #003f72; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 0; border-radius: 0; }

</style>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css">
<style>
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #ffffff; }
.highlight .tok-c { color: #888888 } /* Comment */
.highlight .tok-err { color: #a61717; background-color: #e3d2d2 } /* Error */
.highlight .tok-k { color: #008800; font-weight: bold } /* Keyword */
.highlight .tok-cm { color: #888888 } /* Comment.Multiline */
.highlight .tok-cp { color: #cc0000; font-weight: bold } /* Comment.Preproc */
.highlight .tok-c1 { color: #888888 } /* Comment.Single */
.highlight .tok-cs { color: #cc0000; font-weight: bold; background-color: #fff0f0 } /* Comment.Special */
.highlight .tok-gd { color: #000000; background-color: #ffdddd } /* Generic.Deleted */
.highlight .tok-ge { font-style: italic } /* Generic.Emph */
.highlight .tok-gr { color: #aa0000 } /* Generic.Error */
.highlight .tok-gh { color: #333333 } /* Generic.Heading */
.highlight .tok-gi { color: #000000; background-color: #ddffdd } /* Generic.Inserted */
.highlight .tok-go { color: #888888 } /* Generic.Output */
.highlight .tok-gp { color: #555555 } /* Generic.Prompt */
.highlight .tok-gs { font-weight: bold } /* Generic.Strong */
.highlight .tok-gu { color: #666666 } /* Generic.Subheading */
.highlight .tok-gt { color: #aa0000 } /* Generic.Traceback */
.highlight .tok-kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .tok-kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .tok-kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .tok-kp { color: #008800 } /* Keyword.Pseudo */
.highlight .tok-kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .tok-kt { color: #888888; font-weight: bold } /* Keyword.Type */
.highlight .tok-m { color: #0000DD; font-weight: bold } /* Literal.Number */
.highlight .tok-s { color: #dd2200; background-color: #fff0f0 } /* Literal.String */
.highlight .tok-na { color: #336699 } /* Name.Attribute */
.highlight .tok-nb { color: #003388 } /* Name.Builtin */
.highlight .tok-nc { color: #bb0066; font-weight: bold } /* Name.Class */
.highlight .tok-no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .tok-nd { color: #555555 } /* Name.Decorator */
.highlight .tok-ne { color: #bb0066; font-weight: bold } /* Name.Exception */
.highlight .tok-nf { color: #0066bb; font-weight: bold } /* Name.Function */
.highlight .tok-nl { color: #336699; font-style: italic } /* Name.Label */
.highlight .tok-nn { color: #bb0066; font-weight: bold } /* Name.Namespace */
.highlight .tok-py { color: #336699; font-weight: bold } /* Name.Property */
.highlight .tok-nt { color: #bb0066; font-weight: bold } /* Name.Tag */
.highlight .tok-nv { color: #336699 } /* Name.Variable */
.highlight .tok-ow { color: #008800 } /* Operator.Word */
.highlight .tok-w { color: #bbbbbb } /* Text.Whitespace */
.highlight .tok-mb { color: #0000DD; font-weight: bold } /* Literal.Number.Bin */
.highlight .tok-mf { color: #0000DD; font-weight: bold } /* Literal.Number.Float */
.highlight .tok-mh { color: #0000DD; font-weight: bold } /* Literal.Number.Hex */
.highlight .tok-mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .tok-mo { color: #0000DD; font-weight: bold } /* Literal.Number.Oct */
.highlight .tok-sb { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .tok-sc { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Char */
.highlight .tok-sd { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Doc */
.highlight .tok-s2 { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Double */
.highlight .tok-se { color: #0044dd; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .tok-sh { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .tok-si { color: #3333bb; background-color: #fff0f0 } /* Literal.String.Interpol */
.highlight .tok-sx { color: #22bb22; background-color: #f0fff0 } /* Literal.String.Other */
.highlight .tok-sr { color: #008800; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .tok-s1 { color: #dd2200; background-color: #fff0f0 } /* Literal.String.Single */
.highlight .tok-ss { color: #aa6600; background-color: #fff0f0 } /* Literal.String.Symbol */
.highlight .tok-bp { color: #003388 } /* Name.Builtin.Pseudo */
.highlight .tok-vc { color: #336699 } /* Name.Variable.Class */
.highlight .tok-vg { color: #dd7700 } /* Name.Variable.Global */
.highlight .tok-vi { color: #3333bb } /* Name.Variable.Instance */
.highlight .tok-il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-right">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">Introduction</a></li>
<li><a href="#_how_to_use_the_example_code">How to use the example code</a></li>
<li><a href="#_why_should_i_learn_wicket">Why should I learn Wicket?</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_we_all_like_spaghetti">We all like spaghetti :-) &#8230;</a></li>
<li><a href="#_component_oriented_frameworks_an_overview">Component oriented frameworks - an overview</a></li>
<li><a href="#_benefits_of_component_oriented_frameworks_for_web_development">Benefits of component oriented frameworks for web development</a></li>
<li><a href="#_wicket_vs_the_other_component_oriented_frameworks">Wicket vs the other component oriented frameworks</a></li>
</ul>
</li>
<li><a href="#_wicket_says_hello_world">Wicket says “Hello world!”</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_wicket_distribution_and_modules">Wicket distribution and modules</a></li>
<li><a href="#_configuration_of_wicket_applications">Configuration of Wicket applications</a></li>
<li><a href="#_wicket_application_structure">Wicket application structure</a></li>
<li><a href="#_the_application_class">The application class</a></li>
<li><a href="#_the_homepage_class">The HomePage class</a></li>
<li><a href="#_wicket_links">Wicket Links</a></li>
<li><a href="#_summary">Summary</a></li>
</ul>
</li>
<li><a href="#_wicket_as_page_layout_manager">Wicket as page layout manager</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_header_footer_left_menu_content_etc">Header, footer, left menu, content, etc&#8230;</a></li>
<li><a href="#_here_comes_the_inheritance">Here comes the inheritance!</a></li>
<li><a href="#_markup_inheritance">Markup inheritance</a></li>
<li><a href="#_panel_class">Panel class</a></li>
<li><a href="#_divide_et_impera">Divide et impera!</a></li>
<li><a href="#_panels_and_layout_areas">Panels and layout areas</a></li>
<li><a href="#_template_page">Template page</a></li>
<li><a href="#_final_example">Final example</a></li>
<li><a href="#_markup_inheritance_with_the_wicket_extend_tag">Markup inheritance with the wicket:extend tag</a></li>
<li><a href="#_our_example_revisited">Our example revisited</a></li>
<li><a href="#_summary_2">Summary</a></li>
</ul>
</li>
<li><a href="#_keeping_control_over_html">Keeping control over HTML</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_hiding_or_disabling_a_component">Hiding or disabling a component</a></li>
<li><a href="#_modifing_tag_attributes">Modifing tag attributes</a></li>
<li><a href="#_generating_tag_attribute_em_id_em">Generating tag attribute <em>id</em></a></li>
<li><a href="#_creating_in_line_panels_with_webmarkupcontainer">Creating in-line panels with WebMarkupContainer</a></li>
<li><a href="#_working_with_markup_fragments">Working with markup fragments</a></li>
<li><a href="#_adding_header_contents_to_the_final_page">Adding header contents to the final page</a></li>
<li><a href="#_using_stub_markup_in_our_pages_panels">Using stub markup in our pages/panels</a></li>
<li><a href="#_how_to_render_component_body_only">How to render component body only</a></li>
<li><a href="#_hiding_decorating_elements_with_the_wicket_enclosure_tag">Hiding decorating elements with the wicket:enclosure tag</a></li>
<li><a href="#_surrounding_existing_markup_with_border">Surrounding existing markup with Border</a></li>
<li><a href="#_summary_3">Summary</a></li>
</ul>
</li>
<li><a href="#_components_lifecycle">Components lifecycle</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_lifecycle_stages_of_a_component">Lifecycle stages of a component</a></li>
<li><a href="#_hook_methods_for_component_lifecycle">Hook methods for component lifecycle</a></li>
<li><a href="#_initialization_stage">Initialization stage</a></li>
<li><a href="#_rendering_stage">Rendering stage</a></li>
<li><a href="#_method_onconfigure">Method onConfigure</a></li>
<li><a href="#_method_onbeforerender">Method onBeforeRender</a></li>
<li><a href="#_method_oncomponenttag">Method onComponentTag</a></li>
<li><a href="#_methods_oncomponenttagbody">Methods onComponentTagBody</a></li>
<li><a href="#_removing_stage">Removing stage</a></li>
<li><a href="#_summary_4">Summary</a></li>
</ul>
</li>
<li><a href="#_page_versioning_and_caching">Page versioning and caching</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_stateful_pages_vs_stateless">Stateful pages vs stateless</a></li>
<li><a href="#_stateful_pages">Stateful pages</a></li>
<li><a href="#_using_a_specific_page_version_with_pagereference">Using a specific page version with PageReference</a></li>
<li><a href="#_turning_off_page_versioning">Turning off page versioning</a></li>
<li><a href="#_pluggable_serialization">Pluggable serialization</a></li>
<li><a href="#_page_caching">Page caching</a></li>
<li><a href="#_page_expiration">Page expiration</a></li>
<li><a href="#_stateless_pages">Stateless pages</a></li>
<li><a href="#_summary_5">Summary</a></li>
</ul>
</li>
<li><a href="#_under_the_hood_of_the_request_processing">Under the hood of the request processing</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_class_application_and_request_processing">Class Application and request processing</a></li>
<li><a href="#_request_and_response_classes">Request and Response classes</a></li>
<li><a href="#_the_director_of_request_processing_requestcycle">The “director” of request processing - RequestCycle</a></li>
<li><a href="#_requestcycle_and_request_processing">RequestCycle and request processing</a></li>
<li><a href="#_generating_url_with_the_urlfor_and_mapurlfor_methods">Generating URL with the urlFor and mapUrlFor methods</a></li>
<li><a href="#_method_setresponsepage">Method setResponsePage</a></li>
<li><a href="#_requestcycle_s_hook_methods_and_listeners">RequestCycle&#8217;s hook methods and listeners</a></li>
<li><a href="#_session_class">Session Class</a></li>
<li><a href="#_session_and_listeners">Session and listeners</a></li>
<li><a href="#_handling_session_attributes">Handling session attributes</a></li>
<li><a href="#_accessing_to_the_http_session">Accessing to the HTTP session</a></li>
<li><a href="#_temporary_and_permanent_sessions">Temporary and permanent sessions</a></li>
<li><a href="#_discarding_session_data">Discarding session data</a></li>
<li><a href="#_storing_arbitrary_objects_with_metadata">Storing arbitrary objects with metadata</a></li>
<li><a href="#_exception_handling">Exception handling</a></li>
<li><a href="#_ajax_requests">Ajax requests</a></li>
<li><a href="#_summary_6">Summary</a></li>
</ul>
</li>
<li><a href="#_wicket_links_and_url_generation">Wicket Links and URL generation</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_pageparameters">PageParameters</a></li>
<li><a href="#_pageparameters_and_bookmarkable_pages">PageParameters and bookmarkable pages</a></li>
<li><a href="#_indexed_parameters">Indexed parameters</a></li>
<li><a href="#_bookmarkable_links">Bookmarkable links</a></li>
<li><a href="#_automatically_creating_bookmarkable_links_with_tag_wicket_link">Automatically creating bookmarkable links with tag wicket:link</a></li>
<li><a href="#_external_links">External links</a></li>
<li><a href="#_stateless_links">Stateless links</a></li>
<li><a href="#_generating_structured_and_clear_urls">Generating structured and clear URLs</a></li>
<li><a href="#_mounting_a_single_page">Mounting a single page</a></li>
<li><a href="#_using_parameter_placeholders_with_mounted_pages">Using parameter placeholders with mounted pages</a></li>
<li><a href="#_mounting_a_package">Mounting a package</a></li>
<li><a href="#_providing_custom_mapper_context_to_request_mappers">Providing custom mapper context to request mappers</a></li>
<li><a href="#_controlling_how_page_parameters_are_encoded_with_ipageparametersencoder">Controlling how page parameters are encoded with IPageParametersEncoder</a></li>
<li><a href="#_encrypting_page_urls">Encrypting page URLs</a></li>
<li><a href="#_summary_7">Summary</a></li>
</ul>
</li>
<li><a href="#_wicket_models_and_forms">Wicket models and forms</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_what_is_a_model">What is a model?</a></li>
<li><a href="#_models_and_javabeans">Models and JavaBeans</a></li>
<li><a href="#_propertymodel">PropertyModel</a></li>
<li><a href="#_compoundpropertymodel_and_model_inheritance">CompoundPropertyModel and model inheritance</a></li>
<li><a href="#_wicket_forms">Wicket forms</a></li>
<li><a href="#_form_and_models">Form and models</a></li>
<li><a href="#_login_form">Login form</a></li>
<li><a href="#_component_dropdownchoice">Component DropDownChoice</a></li>
<li><a href="#_model_chaining">Model chaining</a></li>
<li><a href="#_detachable_models">Detachable models</a></li>
<li><a href="#_using_more_than_one_model_in_a_component">Using more than one model in a component</a></li>
<li><a href="#_use_models">Use models!</a></li>
<li><a href="#_summary_8">Summary</a></li>
</ul>
</li>
<li><a href="#_wicket_forms_in_detail">Wicket forms in detail</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_default_form_processing">Default form processing</a></li>
<li><a href="#_form_validation_and_feedback_messages">Form validation and feedback messages</a></li>
<li><a href="#_feedback_messages_and_localization">Feedback messages and localization</a></li>
<li><a href="#_displaying_feedback_messages_and_filtering_them">Displaying feedback messages and filtering them</a></li>
<li><a href="#_built_in_validators">Built-in validators</a></li>
<li><a href="#_overriding_standard_feedback_messages_with_custom_bundles">Overriding standard feedback messages with custom bundles</a></li>
<li><a href="#_creating_custom_validators">Creating custom validators</a></li>
<li><a href="#_using_flash_messages">Using flash messages</a></li>
<li><a href="#_input_value_conversion">Input value conversion</a></li>
<li><a href="#_creating_custom_application_scoped_converters">Creating custom application-scoped converters</a></li>
<li><a href="#_validation_with_jsr_303">Validation with JSR 303</a></li>
<li><a href="#_submit_form_with_an_iformsubmittingcomponent">Submit form with an IFormSubmittingComponent</a></li>
<li><a href="#_components_button_and_submitlink">Components Button and SubmitLink</a></li>
<li><a href="#_disabling_default_form_processing">Disabling default form processing</a></li>
<li><a href="#_nested_forms">Nested forms</a></li>
<li><a href="#_multi_line_text_input">Multi-line text input</a></li>
<li><a href="#_file_upload">File upload</a></li>
<li><a href="#_upload_multiple_files">Upload multiple files</a></li>
<li><a href="#_creating_complex_form_components_with_formcomponentpanel">Creating complex form components with FormComponentPanel</a></li>
<li><a href="#_stateless_form">Stateless form</a></li>
<li><a href="#_working_with_radio_buttons_and_checkboxes">Working with radio buttons and checkboxes</a></li>
<li><a href="#_working_with_grouped_checkboxes">Working with grouped checkboxes</a></li>
<li><a href="#_how_to_implement_a_lect_guide_modelsforms_5">How to implement a  lect[guide:modelsforms_5]</a></li>
<li><a href="#_working_with_grouped_radio_buttons">Working with grouped radio buttons</a></li>
<li><a href="#_selecting_multiple_values_with_listmultiplechoices_and_palette">Selecting multiple values with ListMultipleChoices and Palette</a></li>
<li><a href="#_component_palette">Component Palette</a></li>
<li><a href="#_summary_9">Summary</a></li>
</ul>
</li>
<li><a href="#_displaying_multiple_items_with_repeaters">Displaying multiple items with repeaters</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_the_repeatingview_component">The RepeatingView Component</a></li>
<li><a href="#_the_listview_component">The ListView Component</a></li>
<li><a href="#_listview_and_form">ListView and Form</a></li>
<li><a href="#_the_refreshingview_component">The RefreshingView Component</a></li>
<li><a href="#_item_reuse_strategy">Item reuse strategy</a></li>
<li><a href="#_pageable_repeaters">Pageable repeaters</a></li>
<li><a href="#_component_dataview">Component DataView</a></li>
<li><a href="#_data_paging">Data paging</a></li>
<li><a href="#_summary_10">Summary</a></li>
</ul>
</li>
<li><a href="#_component_queueing">Component queueing</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_markup_hierarchy_and_code">Markup hierarchy and code</a></li>
<li><a href="#_markup_id_ambiguities">Markup Id Ambiguities</a></li>
<li><a href="#_inheriting_state_from_parents">Inheriting State From Parents</a></li>
<li><a href="#_pain_points_of_the_java_side_hierarchy">Pain Points of the Java-Side Hierarchy</a></li>
<li><a href="#_component_queueing_to_the_rescue">Component Queueing To The Rescue</a></li>
<li><a href="#_improved_auto_components">Improved auto components</a></li>
<li><a href="#_when_are_components_dequeued">When are components dequeued?</a></li>
<li><a href="#_restrictions_of_queueing">Restrictions of queueing</a></li>
<li><a href="#_ancestors">Ancestors</a></li>
<li><a href="#_regions">Regions</a></li>
<li><a href="#_summary_11">Summary</a></li>
</ul>
</li>
<li><a href="#_internationalization_with_wicket">Internationalization with Wicket</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_localization">Localization</a></li>
<li><a href="#_class_locale_and_resourcebundle">Class Locale and ResourceBundle</a></li>
<li><a href="#_localization_in_wicket">Localization in Wicket</a></li>
<li><a href="#_style_and_variation_parameters_for_bundles">Style and variation parameters for bundles</a></li>
<li><a href="#_using_utf_8_for_resource_bundles">Using UTF-8 for resource bundles</a></li>
<li><a href="#_using_xml_files_as_resource_bundles">Using XML files as resource bundles</a></li>
<li><a href="#_reading_bundles_from_code">Reading bundles from code</a></li>
<li><a href="#_localization_of_bundles_in_wicket">Localization of bundles in Wicket</a></li>
<li><a href="#_localization_of_markup_files">Localization of markup files</a></li>
<li><a href="#_reading_bundles_with_tag_wicket_message">Reading bundles with tag &lt;wicket:message&gt;</a></li>
<li><a href="#_bundles_lookup_algorithm">Bundles lookup algorithm</a></li>
<li><a href="#_localizing_pages_and_panels">Localizing pages and panels</a></li>
<li><a href="#_component_specific_resources">Component-specific resources</a></li>
<li><a href="#_package_bundles">Package bundles</a></li>
<li><a href="#_bundles_for_feedback_messages">Bundles for feedback messages</a></li>
<li><a href="#_extending_the_default_lookup_algorithm">Extending the default lookup algorithm</a></li>
<li><a href="#_localization_of_component_s_choices">Localization of component&#8217;s choices</a></li>
<li><a href="#_internationalization_and_models">Internationalization and Models</a></li>
<li><a href="#_resourcemodel">ResourceModel</a></li>
<li><a href="#_stringresourcemodel">StringResourceModel</a></li>
<li><a href="#_summary_12">Summary</a></li>
</ul>
</li>
<li><a href="#_resource_management_with_wicket">Resource management with Wicket</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_static_vs_dynamic_resources">Static vs dynamic resources</a></li>
<li><a href="#_resource_references">Resource references</a></li>
<li><a href="#_package_resources">Package resources</a></li>
<li><a href="#_responsive_images_multiple_resource_references_use_in_one_component">Responsive images - multiple resource references use in one component</a></li>
<li><a href="#_inline_image_embedded_resource_reference_content">Inline Image - embedded resource reference content</a></li>
<li><a href="#_media_tags_resource_references_with_content_range_support">Media tags - resource references with content range support</a></li>
<li><a href="#_using_package_resources_with_tag_wicket_link">Using package resources with tag &lt;wicket:link&gt;</a></li>
<li><a href="#_adding_resources_to_page_header_section">Adding resources to page header section</a></li>
<li><a href="#_context_relative_resources">Context-relative resources</a></li>
<li><a href="#_picture_files">Picture files</a></li>
<li><a href="#_resource_dependencies">Resource dependencies</a></li>
<li><a href="#_aggregate_multiple_resources_with_resource_bundles">Aggregate multiple resources with resource bundles</a></li>
<li><a href="#_put_javascript_inside_page_body">Put JavaScript inside page body</a></li>
<li><a href="#_header_contributors_positioning">Header contributors positioning</a></li>
<li><a href="#_custom_resources">Custom resources</a></li>
<li><a href="#_mounting_resources">Mounting resources</a></li>
<li><a href="#_shared_resources">Shared resources</a></li>
<li><a href="#_customizing_resource_loading">Customizing resource loading</a></li>
<li><a href="#_cssheaderitem_and_javascriptheaderitem_compression">CssHeaderItem and JavaScriptHeaderItem compression</a></li>
<li><a href="#_summary_13">Summary</a></li>
</ul>
</li>
<li><a href="#_an_example_of_integration_with_javascript">An example of integration with JavaScript</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_what_we_want_to_do">What we want to do&#8230;</a></li>
<li><a href="#_what_features_we_want_to_implement">What features we want to implement</a></li>
<li><a href="#__and_how_we_will_do_it">&#8230;and how we will do it</a></li>
<li><a href="#_component_package_resources">Component package resources</a></li>
<li><a href="#_initialization_code">Initialization code</a></li>
<li><a href="#_header_contributor_code">Header contributor code</a></li>
<li><a href="#_summary_14">Summary</a></li>
</ul>
</li>
<li><a href="#_wicket_advanced_topics">Wicket advanced topics</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_enriching_components_with_behaviors">Enriching components with behaviors</a></li>
<li><a href="#_generating_callback_urls_with_irequestlistener">Generating callback URLs with IRequestListener</a></li>
<li><a href="#_wicket_events_infrastructure">Wicket events infrastructure</a></li>
<li><a href="#_initializers">Initializers</a></li>
<li><a href="#_using_jmx_with_wicket">Using JMX with Wicket</a></li>
<li><a href="#_generating_html_markup_from_code">Generating HTML markup from code</a></li>
<li><a href="#_avoiding_markup_caching">Avoiding markup caching</a></li>
<li><a href="#_summary_15">Summary</a></li>
</ul>
</li>
<li><a href="#_working_with_ajax">Working with AJAX</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_how_to_use_ajax_components_and_behaviors">How to use AJAX components and behaviors</a></li>
<li><a href="#_build_in_ajax_components">Build-in AJAX components</a></li>
<li><a href="#_links_and_buttons">Links and buttons</a></li>
<li><a href="#_fallback_components">Fallback components</a></li>
<li><a href="#_ajax_checkbox">AJAX Checkbox</a></li>
<li><a href="#_ajax_editable_labels">AJAX editable labels</a></li>
<li><a href="#_autocomplete_text_field">Autocomplete text field</a></li>
<li><a href="#_modal_window">Modal window</a></li>
<li><a href="#_tree_repeaters">Tree repeaters</a></li>
<li><a href="#_working_with_hidden_components">Working with hidden components</a></li>
<li><a href="#_built_in_ajax_behaviors">Built-in AJAX behaviors</a></li>
<li><a href="#_ajaxeventbehavior">AjaxEventBehavior</a></li>
<li><a href="#_ajaxformsubmitbehavior">AjaxFormSubmitBehavior</a></li>
<li><a href="#_ajaxformcomponentupdatingbehavior">AjaxFormComponentUpdatingBehavior</a></li>
<li><a href="#_abstractajaxtimerbehavior">AbstractAjaxTimerBehavior</a></li>
<li><a href="#_using_an_activity_indicator">Using an activity indicator</a></li>
<li><a href="#_ajax_request_attributes_and_call_listeners">AJAX request attributes and call listeners</a></li>
<li><a href="#_creating_custom_ajax_call_listener">Creating custom AJAX call listener</a></li>
<li><a href="#_what_we_want_for_our_listener">What we want for our listener</a></li>
<li><a href="#_how_to_implement_the_listener">How to implement the listener</a></li>
<li><a href="#_javascript_code">JavaScript code</a></li>
<li><a href="#_java_class_code">Java class code</a></li>
<li><a href="#_global_listeners">Global listeners</a></li>
<li><a href="#_summary_16">Summary</a></li>
</ul>
</li>
<li><a href="#_integration_with_enterprise_containers">Integration with enterprise containers</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_integrating_wicket_with_ejb">Integrating Wicket with EJB</a></li>
<li><a href="#_integrating_wicket_with_spring">Integrating Wicket with Spring</a></li>
<li><a href="#_jsr_330_annotations">JSR-330 annotations</a></li>
<li><a href="#_summary_17">Summary</a></li>
</ul>
</li>
<li><a href="#_native_websockets">Native WebSockets</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_how_does_it_work">How does it work ?</a></li>
<li><a href="#_how_to_use">How to use</a></li>
<li><a href="#_client_side_apis">Client-side APIs</a></li>
<li><a href="#_testing">Testing</a></li>
<li><a href="#_differences_with_wicket_atmosphere_module">Differences with Wicket-Atmosphere module.</a></li>
<li><a href="#_faq">FAQ</a></li>
</ul>
</li>
<li><a href="#_security_with_wicket">Security with Wicket</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_authentication">Authentication</a></li>
<li><a href="#_authenticatedwebsession">AuthenticatedWebSession</a></li>
<li><a href="#_authenticatedwebapplication">AuthenticatedWebApplication</a></li>
<li><a href="#_a_basic_example_of_authentication">A basic example of authentication</a></li>
<li><a href="#_redirecting_user_to_an_intermediate_page">Redirecting user to an intermediate page</a></li>
<li><a href="#_authorizations">Authorizations</a></li>
<li><a href="#_simplepageauthorizationstrategy">SimplePageAuthorizationStrategy</a></li>
<li><a href="#_role_based_strategies">Role-based strategies</a></li>
<li><a href="#_catching_an_unauthorized_component_instantiation">Catching an unauthorized component instantiation</a></li>
<li><a href="#_strategy_roleauthorizationstrategy">Strategy RoleAuthorizationStrategy</a></li>
<li><a href="#_using_https_protocol">Using HTTPS protocol</a></li>
<li><a href="#_urls_encryption_in_detail">URLs encryption in detail</a></li>
<li><a href="#_package_resource_guard">Package Resource Guard</a></li>
<li><a href="#_summary_18">Summary</a></li>
</ul>
</li>
<li><a href="#_test_driven_development_with_wicket">Test Driven Development with Wicket</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_utility_class_wickettester">Utility class WicketTester</a></li>
<li><a href="#_testing_links">Testing links</a></li>
<li><a href="#_testing_component_status">Testing component status</a></li>
<li><a href="#_testing_components_in_isolation">Testing components in isolation</a></li>
<li><a href="#_testing_the_response">Testing the response</a></li>
<li><a href="#_testing_urls">Testing URLs</a></li>
<li><a href="#_testing_ajax_components">Testing AJAX components</a></li>
<li><a href="#_testing_ajax_events">Testing AJAX events</a></li>
<li><a href="#_testing_ajax_behaviors">Testing AJAX behaviors</a></li>
<li><a href="#_using_a_custom_servlet_context">Using a custom servlet context</a></li>
<li><a href="#_testing_wicket_forms">Testing Wicket forms</a></li>
<li><a href="#_setting_form_components_input">Setting form components input</a></li>
<li><a href="#_testing_feedback_messages">Testing feedback messages</a></li>
<li><a href="#_testing_models">Testing models</a></li>
<li><a href="#_testing_markup_with_tagtester">Testing markup with TagTester</a></li>
<li><a href="#_summary_19">Summary</a></li>
</ul>
</li>
<li><a href="#_test_driven_development_with_wicket_and_spring">Test Driven Development with Wicket and Spring</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_configuration_of_the_runtime_environment">Configuration of the runtime environment</a></li>
<li><a href="#_configuration_of_the_junit_based_integration_test_environment">Configuration of the JUnit based integration test environment</a></li>
<li><a href="#_summary_20">Summary</a></li>
</ul>
</li>
<li><a href="#_wicket_best_practices">Wicket Best Practices</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_encapsulate_components_correctly">Encapsulate components correctly</a></li>
<li><a href="#_put_models_and_page_data_in_fields">Put models and page data in fields</a></li>
<li><a href="#_correct_naming_for_wicket_ids">Correct naming for Wicket IDs</a></li>
<li><a href="#_avoid_changes_at_the_component_tree">Avoid changes at the component tree</a></li>
<li><a href="#_implement_visibilities_of_components_correctly">Implement visibilities of components correctly</a></li>
<li><a href="#_always_use_models">Always use models</a></li>
<li><a href="#_do_not_unwrap_models_within_the_constructor_hierarchy">Do not unwrap models within the constructor hierarchy</a></li>
<li><a href="#_pass_models_extended_components">Pass models extended components</a></li>
<li><a href="#_validators_must_not_change_any_data_or_models">Validators must not change any data or models</a></li>
<li><a href="#_do_not_pass_components_to_constructors">Do not pass components to constructors</a></li>
<li><a href="#_use_the_wicket_session_only_for_global_data">Use the Wicket session only for global data</a></li>
<li><a href="#_do_not_use_factories_for_components">Do not use factories for components</a></li>
<li><a href="#_every_page_and_component_must_be_tested">Every page and component must be tested</a></li>
<li><a href="#_avoid_interactions_with_other_servlet_filters">Avoid interactions with other servlet filters</a></li>
<li><a href="#_cut_small_classes_and_methods">Cut small classes and methods</a></li>
<li><a href="#_the_argument_bad_documentation">The argument "Bad documentation"</a></li>
<li><a href="#_summary_21">Summary</a></li>
</ul>
</li>
<li><a href="#_wicket_internals">Wicket Internals</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_page_storing">Page storing</a></li>
<li><a href="#_ipagemanager">IPageManager</a></li>
<li><a href="#_ipagestore">IPageStore</a></li>
<li><a href="#_idatastore">IDataStore</a></li>
<li><a href="#_asynchronousdatastore">AsynchronousDataStore</a></li>
<li><a href="#_debugdiskdatastore">DebugDiskDataStore</a></li>
<li><a href="#_httpsessiondatastore">HttpSessionDataStore</a></li>
<li><a href="#_debugbar">DebugBar</a></li>
</ul>
</li>
<li><a href="#_working_with_maven_appendix">Working with Maven (Appendix)</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_switching_wicket_to_deployment_mode">Switching Wicket to DEPLOYMENT mode</a></li>
<li><a href="#_creating_a_wicket_project_from_scratch_and_importing_it_into_our_favourite_ide">Creating a Wicket project from scratch and importing it into our favourite IDE</a></li>
<li><a href="#_from_maven_to_our_ide">From Maven to our IDE</a></li>
<li><a href="#_importing_a_maven_project_into_our_ide">Importing a Maven project into our IDE</a></li>
<li><a href="#_speeding_up_development_with_plugins">Speeding up development with plugins.</a></li>
</ul>
</li>
<li><a href="#_project_wicketstuff_appendix">Project WicketStuff (Appendix)</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#_what_is_project_wicketstuff">What is project WicketStuff</a></li>
<li><a href="#_module_tinymce">Module tinymce</a></li>
<li><a href="#_module_wicketstuff_gmap3">Module wicketstuff-gmap3</a></li>
<li><a href="#_module_wicketstuff_googlecharts">Module wicketstuff-googlecharts</a></li>
<li><a href="#_module_wicketstuff_inmethod_grid">Module wicketstuff-inmethod-grid</a></li>
<li><a href="#_module_wicketstuff_rest_annotations">Module wicketstuff-rest-annotations</a></li>
<li><a href="#_module_stateless">Module stateless</a></li>
</ul>
</li>
<li><a href="#_lost_in_redirection_with_apache_wicket_appendix">Lost In Redirection With Apache Wicket (Appendix)</a></li>
<li><a href="#_contributing_to_this_guide_appendix">Contributing to this guide (Appendix)</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">Introduction</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Wicket has been around since 2004 and it has been an Apache project since 2007. During these years it has proved to be a solid and valuable solution for building enterprise web applications.</p>
</div>
<div class="paragraph">
<p>Wicket core developers have done a wonderful job with this framework and they continue to improve it release after release.
However Wicket never provided a freely available documentation and even if you can find on Internet many live examples and many technical articles on it (most of them at  cket[] ibrary ttp://www.wicket-library.com/[] nd at  cket[] n Action ttp://wicketinaction.com[] , the lack of an organized and freely available documentation has always been a sore point for this framework.</p>
</div>
<div class="paragraph">
<p>That&#8217;s quite an issue because many other popular frameworks (like Spring, Hibernate or Struts) offer a vast and very good documentation which substantially contributed to their success.</p>
</div>
<div class="paragraph">
<p>This document is not intended to be a complete reference for Wicket but it simply aims to be a straightforward introduction to the framework that should significantly reduce its learning curve. What you will find here reflects my experience with Wicket and it&#8217;s strictly focused on the framework.
The various Wicket-related topics are gradually introduced using pragmatic examples of code that you can find in  e[] ccording repository on Github. e[] s://github.com/bitstorm/Wicket-tutorial-examples</p>
</div>
<div class="paragraph">
<p>However remember that Wicket is a vast and powerful tool, so you should feel confident with the topics exposed in this document before starting to code your real applications!</p>
</div>
<div class="paragraph">
<p>For those who need further documentation on Wicket, there are  ttps://github.com/bitstorm/Wicket-tutorial-examples
many[] able for this framework.</p>
</div>
<div class="paragraph">
<p>Hope you&#8217;ll find this guide helpful. Have fun with Wicket!</p>
</div>
<div class="paragraph">
<p><strong>Andrea Del Bene, adelbene&#8217;apache.org</strong></p>
</div>
<div class="paragraph">
<p><strong>PS</strong>: this guide is based on Wicket 6. However if you are using an older version you should find this guide useful as well, but it&#8217;s likely that the code and the snippets won&#8217;t work with your version.</p>
</div>
<div class="paragraph">
<p><strong>PPS</strong>: although I&#8217;ve tried to do my best working on this tutorial, this document is a work in progress and may contain errors and/or omissions. That&#8217;s why any feedback of any kind is REALLY appreciated!</p>
</div>
<div class="paragraph">
<p>Project started by  ttps://github.com/bitstorm/Wicket-tutorial-examples
many[!comsysto-logo.png!]</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_how_to_use_the_example_code">How to use the example code</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Most of the code you will find in this document is available as a  t[] epository ttps://github.com/bitstorm/Wicket-tutorial-examples[] nd is licensed under the ASF 2.0. To get a local copy of the repository you can run the clone command from shell:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">git</span> <span class="tok-n">clone</span> <span class="tok-n">https</span><span class="tok-o">:</span><span class="tok-c1">//github.com/bitstorm/Wicket-tutorial-examples.git</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you aren&#8217;t used to Git, you can simply download the whole source as a zip archive:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="gitRepo.png" alt="gitRepo">
</div>
</div>
<div class="paragraph">
<p>The repository contains a multi-module Maven project. Every subproject is contained in the relative folder of the repository:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="gitMavenPrj.png" alt="gitMavenPrj">
</div>
</div>
<div class="paragraph">
<p>When the example code is used in the document, you will find the name of the subproject it belongs to. If you don&#8217;t have any experience with Maven, you can read Appendix A where you can learn the basic commands needed to work with the example projects and to import them into your favourite IDE (NetBeans, IDEA or Eclipse).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_why_should_i_learn_wicket">Why should I learn Wicket?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Software development is a challenging activity and developers must keep their skills up-to-date with new technologies.</p>
</div>
<div class="paragraph">
<p>But before starting to learn the last “coolest” framework we should always ask ourself if it is the right tool for us and how it can improve our everyday job.
Java&#8217;s ecosystem is already full of many well-known web frameworks, so why should we spend our time learning Wicket?</p>
</div>
<div class="paragraph">
<p>This chapter will show you how Wicket is different from other web frameworks you may know and it will explain also how it can improve your life as web developer.</p>
</div>
<div class="sect2">
<h3 id="_we_all_like_spaghetti">We all like spaghetti :-) &#8230;</h3>
<div class="paragraph">
<p>&#8230;but we all hate spaghetti code! That&#8217;s why in the first half of the 2000s we have seen the birth of so many web frameworks. Their mission was to separate our business code from presentation layer (like JSP pages).</p>
</div>
<div class="paragraph">
<p>Some of theme (like Struts, Spring MVC, Velocity, etc&#8230;) have become widely adopted and they made the MVC pattern very popular among developers.
However, none of these frameworks offers a real object-oriented (OO) abstraction for web pages and we still have to take care of web-related tasks such as HTTP request/response handling, URLs mapping, storing data into user session and so on.</p>
</div>
<div class="paragraph">
<p>The biggest limit of MVC frameworks is that they don&#8217;t do much to overcome the impedance mismatch between the stateless nature of HTTP protocol and the need of our web applications of handling a (very complex) state.</p>
</div>
<div class="paragraph">
<p>To overcome these limits developers have started to adopt a new generation of component oriented web frameworks designed to provide a completely different approach to web development.</p>
</div>
</div>
<div class="sect2">
<h3 id="_component_oriented_frameworks_an_overview">Component oriented frameworks - an overview</h3>
<div class="paragraph">
<p>Component oriented frameworks differ from classic web frameworks in that they build a model of requested page on the server side and the HTML sent back to the client is generated according to this model. You can think of the model as if it was an “inverse” JavaScript DOM, meaning that:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>is built on server-side</p>
</li>
<li>
<p>is built before HTML is sent to client</p>
</li>
<li>
<p>HTML code is generated using this model and not vice versa.</p>
<div class="literalblock">
<div class="content">
<pre>image::requesthandling-general.png[]</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>_General schema of page request handling for a component oriented framework_</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>With this kind of framework our web pages and their HTML components (forms, input controls, links, etc&#8230;), are pure class instances.
Since pages are class instances they live inside the JVM heap and we can handle them as we do with any other Java class.
This approach is very similar to what GUI frameworks (like Swing or SWT) do with desktop windows and their components. Wicket and the other component oriented frameworks bring to web development the same kind of abstraction that GUI frameworks offer when we build a desktop application. Most of those kind of frameworks hide the details of the HTTP protocol and naturally solve the problem of its stateless nature.</p>
</div>
</div>
<div class="sect2">
<h3 id="_benefits_of_component_oriented_frameworks_for_web_development">Benefits of component oriented frameworks for web development</h3>
<div class="paragraph">
<p>At this point some people may still wonder why OOP is so important also for web development and what benefits it can bring to developers.
Let&#8217;s quickly review the main advantages that this paradigm can offer us:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Web pages are objects</strong>: web pages are not just text files sent back to the client. They are object instances and we can harness OOP to design web pages and their components. With Wicket we can also apply inheritance to HTML markup in order to build a consistent graphic layout for our applications (we will see markup inheritance in  <a href="#guide:layout_2">chapter 4.2</a>
).</p>
</li>
<li>
<p><strong>We don&#8217;t have to worry about application&#8217;s state</strong>: pages and components can be considered stateful entities. They are Java objects and they can keep a state inside them and reference other objects. We can stop worrying about keeping track of user data stored inside the <em>HttpSession</em> and we can start managing them in a natural and transparent way.</p>
</li>
<li>
<p><strong>Testing web applications is much easier</strong>: since pages and components are pure objects, you can use JUnit to test their behavior and to ensure that they render as expected. Wicket has a set of utility classes for unit testing that simulate user interaction with web pages, hence we can write acceptance tests using just JUnit without any other test framework (unit testing is covered in  <a href="#guide:testing">chapter 23</a>
).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_wicket_vs_the_other_component_oriented_frameworks">Wicket vs the other component oriented frameworks</h3>
<div class="paragraph">
<p>Wicket is not the only component oriented framework available in the Java ecosystem. Among its competitors we can find GWT (from Google), JSF (from Oracle), Vaadin (from Vaadin Ltd.), etc&#8230; Even if Wicket and all those other frameworks have their pros and cons, there are good reasons to prefer Wicket over them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Wicket is 100% open source</strong>: Wicket is a top Apache project and it doesn&#8217;t depend on any private company. You don&#8217;t have to worry about future licensing changes, Wicket will always be released under Apache license 2.0 and freely available.</p>
</li>
<li>
<p><strong>Wicket is a community driven project</strong>: The Wicket team supports and promotes the dialogue with the framework&#8217;s users through two mailing lists  ne[] or users and another one for framework developers) ttp://wicket.apache.org/help/email.html[] nd an  ache[] IRA ttps://issues.apache.org/jira/browse/WICKET[] the issue tracking system). Moreover, as any other Apache project, Wicket is developed paying great attention to user feedbacks and to suggested features.</p>
</li>
<li>
<p><strong>Wicket is just about Java and good old HTML</strong>: almost all web frameworks force users to adopt special tags or to use server side code inside HTML markup. This is clearly in contrast with the concept of separation between presentation and business logic and it leads to a more confusing code in our pages. In Wicket we don&#8217;t have to take care of generating HTML inside the page itself, and we won&#8217;t need to use any tag other than standard HTML tags. All we have to do is to attach our components (Java instances) to the HTML tags using a simple tag attribute called <em>wicket:id</em> (we will shortly see how to use it).</p>
</li>
<li>
<p><strong>With Wicket we can easily use JavaBeans and  <a href="http://en.wikipedia.org/wiki/Plain_Old_Java_Object">POJO</a> n our web tier</strong>: one of the most annoying and error-prone task in web development is collecting user input through a form and keeping form fields updated with previously inserted values. This usually requires a huge amount of code to extract input from request parameters (which are strings), parse them to Java types and store them into some kind of variable. And this is just half of the work we have to do as we must implement the inverse path (load data from Java to the web form).Moreover, most of the times our forms will use a JavaBean or a POJO as backing object, meaning that we must manually map form fields with the corresponding object fields and vice versa. Wicket comes with an intuitive and flexible mechanism that does this mapping for us without any configuration overhead (using a convention over configuration approach) and in a transparent way.  <a href="#guide:modelsforms">Chapter 10</a>
will introduce the concept of Wicket model and we will learn how to harness this entity with forms.</p>
</li>
<li>
<p><strong>No complex XML needed</strong>: Wicket was designed to minimize the amount of configuration files needed to run our applications. No XML file is required except for the standard deployment descriptor web.xml (unless you are using Servlet 3 or a later version. See  <a href="#guide:whyLearn_2">Chapter 4</a>
for more details).</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wicket_says_hello_world">Wicket says “Hello world!”</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Wicket allows us to design our web pages in terms of components and containers, just like AWT does with desktop windows.
Both frameworks share the same component-based architecture: in AWT we have a <em>Windows</em> instance which represents the physical windows containing GUI components (like text fields, radio buttons, drawing areas, etc&#8230;), in Wicket we have a <em>WebPage</em> instance which represents the physical web page containing HTML components (pictures, buttons, forms, etc&#8230; ) .</p>
</div>
<div class="imageblock">
<div class="content">
<img src="uml-component.png" alt="uml component">
</div>
</div>
<div class="paragraph">
<p>In both frameworks we find a base class for GUI components called <em>Component</em>. Wicket pages can be composed (and usually are) by many components, just like AWT windows are composed by Swing/AWT components. Both frameworks promote the reuse of presentation code and GUI elements building custom components. Even if Wicket already comes with a rich set of ready-to-use components, building custom components is a common practice when working with this framework. We&#8217;ll learn more about custom components in the next chapters.</p>
</div>
<div class="sect2">
<h3 id="_wicket_distribution_and_modules">Wicket distribution and modules</h3>
<div class="paragraph">
<p>Wicket is available as a binary package on the main site  <a href="http://wicket.apache.org">http://wicket.apache.org</a>  Inside this archive we can find the distribution jars of the framework. Each jar corresponds to a sub-module of the framework. The following table reports these modules along with a short description of their purpose and with the related dependencies:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Module&#8217;sname</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Dependencies</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-core</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains the main classes of the framework, like class <em>Component</em> and <em>Application</em>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-request, wicket-util</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-request</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This module contains the classes involved into web request processing.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-util</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-util</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains general-purpose utility classes for functional areas such as I/O, lang, string manipulation, security, etc&#8230;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-datetime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains special purpose components designed to work with date and time.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-bean-validation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides support for JSR 303 standard validation.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-devutils</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains utility classes and components to help developers with tasks such as debugging, class inspection and so on.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-core, wicket-extensions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-extensions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Contains a vast set of built-in components to build a rich UI for our web application (Ajax support is part of this module).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-auth-roles</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides support for role-based authorization.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-ioc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This module provides common classes to support Inversion Of Control. It&#8217;s used by both Spring and Guice integration module.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-guice</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This module provides integration with the dependency injection framework developed by Google.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-core, wicket-ioc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-spring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This module provides integration with Spring framework.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-core, wicket-ioc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-velocity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This module provides panels and utility class to integrate Wicket with Velocity template engine.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-jmx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This module provides panels and utility class to integrate Wicket with Java Management Extensions.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-core</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-objectsizeof-agent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Provides integration with Java agent libraries and instrumentation tools.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">wicket-core</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Please note that the core module depends on the utility and request modules, hence it cannot be used without them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_of_wicket_applications">Configuration of Wicket applications</h3>
<div class="paragraph">
<p>In this chapter we will see a classic Hello World! example implemented using a Wicket page with a built-in component called <em>Label</em> (the code is from project the HelloWorldExample). Since this is the first example of the guide, before looking at Java code we will go through the common artifacts needed to build a Wicket application from scratch.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
All the example projects presented in this document have been generated using Maven and the utility page at  <a href="http://wicket.apache.org/start/quickstart.html">http://wicket.apache.org/start/quickstart.html</a>  <strong>Appendix A</strong> contains the instructions needed to use these projects and build a quickstart application using Apache Maven. All the artifacts used in the next example (files web.xml, HomePage.class and HomePage.html) are automatically generated by Maven.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_wicket_application_structure">Wicket application structure</h3>
<div class="paragraph">
<p>A Wicket application is a standard Java EE web application, hence it is deployed through a web.xml file placed inside folder WEB-INF:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="webinf.png" alt="webinf">
</div>
</div>
<div class="paragraph">
<p><em>Illustration : The standard directory structure of a Wicket application</em></p>
</div>
<div class="paragraph">
<p>The content of web.xml declares a servlet filter (class <em>org.apache.wicket.Protocol.http.WicketFilter</em>) which dispatches web requests to our Wicket application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="xml language-xml"><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;web-app&gt;</span>
    <span class="tok-nt">&lt;display-name&gt;</span>Wicket Test<span class="tok-nt">&lt;/display-name&gt;</span>
    <span class="tok-nt">&lt;filter&gt;</span>
        <span class="tok-nt">&lt;filter-name&gt;</span>TestApplication<span class="tok-nt">&lt;/filter-name&gt;</span>
        <span class="tok-nt">&lt;filter-class&gt;</span>org.apache.wicket.protocol.http.WicketFilter<span class="tok-nt">&lt;/filter-class&gt;</span>
        <span class="tok-nt">&lt;init-param&gt;</span>
          <span class="tok-nt">&lt;param-name&gt;</span>applicationClassName<span class="tok-nt">&lt;/param-name&gt;</span>
          <span class="tok-nt">&lt;param-value&gt;</span>org.wicketTutorial.WicketApplication<span class="tok-nt">&lt;/param-value&gt;</span>
        <span class="tok-nt">&lt;/init-param&gt;</span>
    <span class="tok-nt">&lt;/filter&gt;</span>
    <span class="tok-nt">&lt;filter-mapping&gt;</span>
        <span class="tok-nt">&lt;filter-name&gt;</span>TestApplication<span class="tok-nt">&lt;/filter-name&gt;</span>
        <span class="tok-nt">&lt;url-pattern&gt;</span>/*<span class="tok-nt">&lt;/url-pattern&gt;</span>
    <span class="tok-nt">&lt;/filter-mapping&gt;</span>
<span class="tok-nt">&lt;/web-app&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since this is a standard servlet filter we must map it to a specific set of URLs through the <em>&lt;filter-mapping&gt;</em> tag). In the xml above we have mapped every URL to our Wicket filter.</p>
</div>
<div class="paragraph">
<p>If we are using Servlet 3 or a later version, we can of course use a class in place of web.xml to configure our application. The following example uses annotation 'WebFilter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@WebFilter</span><span class="tok-o">(</span><span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-s">&quot;/*&quot;</span><span class="tok-o">,</span> <span class="tok-n">initParams</span> <span class="tok-o">=</span> <span class="tok-o">{</span> <span class="tok-nd">@WebInitParam</span><span class="tok-o">(</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-s">&quot;applicationClassName&quot;</span><span class="tok-o">,</span> <span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-s">&quot;com.mycompany.WicketApplication&quot;</span><span class="tok-o">),</span>
				<span class="tok-nd">@WebInitParam</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;filterMappingUrlPattern&quot;</span><span class="tok-o">,</span> <span class="tok-n">value</span><span class="tok-o">=</span><span class="tok-s">&quot;/*&quot;</span><span class="tok-o">)</span> <span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ProjectFilter</span> <span class="tok-kd">extends</span> <span class="tok-n">WicketFilter</span> <span class="tok-o">{</span>

<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Wicket can be started in two modes named respectively DEVELOPMENT and DEPLOYMENT. The first mode activates some extra features which help application development, like resources monitoring and reloading, full stack trace rendering of exceptions, an AJAX debugger window, etc&#8230; The DEPLOYMENT mode turns off all these features optimizing performances and resource consumption. In our example projects we will use the default mode which is DEVELOPMENT.  <a href="#guide:maven_1">Chapter 24.1</a>
 contains the chapter “Switching Wicket to DEPLOYMENT mode“ where we can find further details about these two modes as well as the possible ways we have to set the desired one. In any case, DO NOT deploy your applications in a production environment without switching to DEPLOYMENT mode!
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_the_application_class">The application class</h3>
<div class="paragraph">
<p>If we look back at web.xml we can see that we have provided the Wicket filter with a parameter called  <em>applicationClassName</em>. This value must be the fully qualified class name of a subclass of <em>org.apache.wicket.Application</em>. This subclass represents our web application built upon Wicket and it&#8217;s responsible for configuring it when the server is starting up. Most of the times our custom application class won&#8217;t inherit directly from class <em>Application</em>, but rather from class <em>org.apache.wicket.protocol.http.WebApplication</em> which provides a closer integration with servlet infrastructure.
Class <em>Application</em> comes with a set of configuration methods that we can override to customize our application&#8217;s settings. One of these methods is <em>getHomePage()</em> that must be overridden as it is declared abstract:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">abstract</span> <span class="tok-n">Class</span><span class="tok-o">&lt;?</span> <span class="tok-kd">extends</span> <span class="tok-n">Page</span><span class="tok-o">&gt;</span> <span class="tok-nf">getHomePage</span><span class="tok-o">()</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you may guess from its name, this method specifies which page to use as homepage for our application.
Another important method is <em>init()</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>This method is called when our application is loaded by the web server (Tomcat, Jetty, etc&#8230;) and is the ideal place to put our configuration code. The <em>Application</em> class exposes its settings grouping them into interfaces (you can find them in package <em>org.apache.wicket.settings</em>). We can access these interfaces through getter methods that will be gradually introduced in the next chapters when we will cover the related settings.</p>
</div>
<div class="paragraph">
<p>The current application&#8217;s instance can be retrieved at any time calling static method <em>Application.get()</em> in our code. We will give more details about this method in  <a href="#guide:requestProcessing_3">chapter 9.3</a>
. The content of the application class from project HelloWorldExample is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">WicketApplication</span> <span class="tok-kd">extends</span> <span class="tok-n">WebApplication</span>
<span class="tok-o">{</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-n">Class</span><span class="tok-o">&lt;?</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span><span class="tok-o">&gt;</span> <span class="tok-nf">getHomePage</span><span class="tok-o">()</span>
	<span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
	<span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
		<span class="tok-c1">// add your configuration here</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since this is a very basic example of a Wicket application, we don&#8217;t need to specify anything inside the <em>init</em> method. The home page of the application is the <em>HomePage</em> class. In the next paragraph we will see how this page is implemented and which conventions we have to follow to create a page in Wicket.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Declaring a <em>WicketFilter</em> inside web.xml descriptor is not the only way we have to kickstart our application.
If we prefer to use a servlet instead of a filter, we can use class <em>org.apache.wicket.protocol.http.WicketServlet</em>. See the JavaDoc for further details.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_the_homepage_class">The HomePage class</h3>
<div class="paragraph">
<p>To complete our first Wicket application we must explore the home page class that is returned by the <em>Application</em>'s method <em>getHomePage()</em> seen above.
In Wicket a web page is a subclass of <em>org.apache.wicket.WebPage</em>. This subclass must have a corresponding HTML file which will be used by the framework as template to generate its HTML markup. This file is a regular plain HTML file (its extension must be html).</p>
</div>
<div class="paragraph">
<p>By default this HTML file must have the same name of the related page class and must be in the same package:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="samepackage.png" alt="samepackage">
</div>
</div>
<div class="paragraph">
<p><em>Illustration :Page class and its related HTML file</em></p>
</div>
<div class="paragraph">
<p>If you don&#8217;t like to put class and html side by side (let&#8217;s say you want all your HTML files in a separated folder) you can use Wicket settings to specify where HTML files can be found. We will cover this topic later in  <a href="#guide:resources_9">chapter 16.9</a>
.</p>
</div>
<div class="paragraph">
<p>The Java code for the <em>HomePage</em> class is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kn">package</span> <span class="tok-nn">org.wicketTutorial</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.apache.wicket.request.mapper.parameter.PageParameters</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.wicket.markup.html.basic.Label</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.wicket.markup.html.WebPage</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;helloMessage&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Hello WicketWorld!&quot;</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Apart from subclassing <em>WebPage</em>, <em>HomePage</em> defines a constructor that adds a <em>Label</em> component to  itself.
Method <em>add(Component component)</em> is inherited from ancestor class <em>org.apache.wicket.MarkupContainer</em> and is used to add children components to a web page. We&#8217;ll see more about <em>MarkupContainer</em> later in  <a href="#guide:layout_2">chapter 5.2</a>
.
Class <em>org.apache.wicket.markup.html.basic.Label</em> is the simplest component shipped with Wicket. It just inserts a string (the second argument of its constructor) inside the corresponding HTML tag.
Just like any other Wicket component, <em>Label</em> needs a textual id (<em>'helloMessage</em>' in our example) to be instantiated. At runtime Wicket will use this value to find the HTML tag we want to bind to the component. This tag must have a special attribute called <em>wicket:id</em> and its value must be identical to the component id (comparison is case-sensitive!).</p>
</div>
<div class="paragraph">
<p>Here is the HTML markup for <em>HomePage</em> (file HomePage.html):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html&gt;</span>
	<span class="tok-nt">&lt;head&gt;</span>
		<span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;title&gt;</span>Apache Wicket HelloWorld<span class="tok-nt">&lt;/title&gt;</span>
	<span class="tok-nt">&lt;/head&gt;</span>
	<span class="tok-nt">&lt;body&gt;</span>

		<span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;helloMessage&quot;</span><span class="tok-nt">&gt;</span>
		[Label&#39;s message goes here]
		<span class="tok-nt">&lt;/div&gt;</span>
	<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can see that the <em>wicket:id</em> attribute is set according to the value of the component id. If we run this example we will see the text <em>Hello WicketWorld!</em> Inside a <em>&lt;div&gt;</em> tag.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<em>Label</em> replaces the original content of its tag (in our example ' <a href="Label&.html#8217;s message goes here">[Label&#8217;s message goes here]</a>
<em>) with the string passed as value ('Hello WicketWorld!</em> in our example).
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
If we specify a <em>wicket:id</em> attribute for a tag without adding the corresponding component in our Java code, Wicket will throw a <em>ComponentNotFound</em> Exception.  On the contrary if we add a component in our Java code without specifying a corresponding <em>wicket:id</em> attribute in our markup, Wicket will throw a <em>WicketRuntimeException</em>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_wicket_links">Wicket Links</h3>
<div class="paragraph">
<p>The basic form of interaction offered by web applications is to navigate through pages using links. In HTML a link is basically a pointer to another resource that most of the time is another page. Wicket implements links with component <em>org.apache.wicket.markup.html.link.Link</em>, but due to the component-oriented nature of the framework, this component is quite different from classic HTML links.
Following the analogy with GUI frameworks, we can consider Wicket link as a “click” event handler: its purpose is to perform some actions (on server side!) when the user clicks on it.</p>
</div>
<div class="paragraph">
<p>That said, you shouldn&#8217;t be surprised to find an abstract method called <em>onClick()</em> inside the <em>Link</em> class. In the following example we have a page with a <em>Link</em> containing an empty implementation of <em>onClick</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
	<span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(){</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Link</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">){</span>
			<span class="tok-nd">@Override</span>
			<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">()</span> <span class="tok-o">{</span>
				<span class="tok-c1">//link code goes here</span>
		    <span class="tok-o">}</span>
		<span class="tok-o">});</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default after <em>onClick</em> has been executed, Wicket will send back to the current page to the client web browser. If we want to navigate to another page we must use method <em>setResponsePage</em> of class <em>Component</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
	<span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(){</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Link</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">){</span>
			<span class="tok-nd">@Override</span>
			<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">()</span> <span class="tok-o">{</span>
                         <span class="tok-c1">//we redirect browser to another page.</span>
                         <span class="tok-n">setResponsePage</span><span class="tok-o">(</span><span class="tok-n">AnotherPage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
			<span class="tok-o">}</span>
		<span class="tok-o">});</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above we used a version of <em>setResponsePage</em> which takes as input the class of the target page. In this way a new instance of <em>AnotherPage</em> will be created each time we click on the link. The other version of <em>setResponsePage</em> takes in input a page instance instead of a page class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	<span class="tok-c1">//we redirect browser to another page.</span>
	<span class="tok-n">AnotherPage</span> <span class="tok-n">anotherPage</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AnotherPage</span><span class="tok-o">();</span>
	<span class="tok-n">setResponsePage</span><span class="tok-o">(</span><span class="tok-n">anotherPage</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The difference between using the first version of <em>setResponsePage</em> rather than the second one will be illustrated in  <a href="#guide:versioningCaching">chapter 8</a>
, when we will introduce the topic of stateful and stateless pages. For now, we can consider them as equivalent.</p>
</div>
<div class="paragraph">
<p>Wicket comes with a rich set of link components suited for every need (links to static URL, Ajax-enhanced links, links to a file to download, links to external pages and so on). We will see them in  <a href="#guide:urls">chapter 10</a>
.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
We can specify the content of a link (i.e. the text of the picture inside it) with its method <em>setBody</em>. This method takes in input a generic Wicket model, which will be the topic of  <a href="#guide:modelsforms">chapter 11</a>
.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_summary">Summary</h3>
<div class="paragraph">
<p>In this chapter we have seen the basic elements that compose a Wicket application. We have started preparing the configuration artifacts needed for our applications. As promised in  <a href="#guide:helloWorld_4">chapter 2.4</a>
, we needed to put in place just a minimal amount of XML with an application class and a home page.
Then we have continued our “first contact” with Wicket learning how to build a simple page with a label component as child. This example page has shown us how Wicket maps components to HTML tags and how it uses both of them to generate the final HTML markup.
In the last paragraph we had a first taste of Wicket links and we have seen how they can be considered as a “click” event listener and how they can be used to navigate from a page to another.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wicket_as_page_layout_manager">Wicket as page layout manager</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before going ahead with more advanced topics, we will see how to maintain a consistent layout across our site using Wicket and its component-oriented features. Probably this is not the most interesting use we can get out of Wicket, but it is surely the simplest one so it&#8217;s the best way to get our hands dirty with some code.</p>
</div>
<div class="sect2">
<h3 id="_header_footer_left_menu_content_etc">Header, footer, left menu, content, etc&#8230;</h3>
<div class="paragraph">
<p>There was a time in the 90s when Internet was just a buzzword and watching a plain HTML page being rendered by a browser was a new and amazing experience. In those days we used to organize our page layout using the <em>&lt;frame&gt;</em> HTML tag. Over the years this tag has almost disappeared from our code and it survives only in few specific domains. For example is still being used by JavaDoc.</p>
</div>
<div class="paragraph">
<p>With the adoption of server side technologies like JSP, ASP or PHP the tag <em>&lt;frame&gt;</em> has been replaced by a template-based approach where we divide our page layout into some common areas that will be present in each page of our web application. Then, we manually insert these areas in every page including the appropriate markup fragments.</p>
</div>
<div class="paragraph">
<p>In this chapter we will see how to use Wicket to build a site layout. The sample layout we will use is a typical page layout consisting of the following areas:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>a header</strong> which could contain site title, some logos, a navigation bar, etc&#8230;</p>
</li>
<li>
<p><strong>a left</strong> menu with a bunch of links to different areas/functionalities of the site.</p>
</li>
<li>
<p><strong>a footer</strong> with generic informations like web master&#8217;s email, the company address, etc&#8230;</p>
</li>
<li>
<p><strong>a content</strong> area which usually contains the functional part of the page.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following picture summarises the layout structure:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="layout.png" alt="layout">
</div>
</div>
<div class="paragraph">
<p>Once we have chosen a page layout, our web designer can start building up the site theme. The result is a beautiful mock of our future web pages. Over this mock we can map the original layout areas:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="layout-mock.png" alt="layout mock">
</div>
</div>
<div class="paragraph">
<p>Now in order to have a consistent layout across all the site, we must ensure that each page will include the layout areas seen above. With an old template-based approach we must manually put them inside every page. If we were using JSP we would probably end up using <em>include</em> directive to add layout areas in our pages. We would have one <em>include</em> for each of the areas (except for the content):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="layout-include.png" alt="layout include">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
For the sake of simplicity we can consider each included area as a static HTML fragment.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now let&#8217;s see how we can handle the layout of our web application using Wicket.</p>
</div>
</div>
<div class="sect2">
<h3 id="_here_comes_the_inheritance">Here comes the inheritance!</h3>
<div class="paragraph">
<p>The need of ensuring a consistent layout across our pages unveiled a serious limit of the HTML: the inability to apply inheritance to web pages and their markup. Wouldn&#8217;t be great if we could write our layout once in a page and then inherit it in the other pages of our application?
One of the goals of Wicket is to overcome this kind of limit.</p>
</div>
</div>
<div class="sect2">
<h3 id="_markup_inheritance">Markup inheritance</h3>
<div class="paragraph">
<p>As we have seen in the previous chapter, Wicket pages are pure Java classes, so we can easily write a page which is a subclass of another parent page. But in Wicket inheritance is not limited to the classic object-oriented code inheritance. When a class subclasses a <em>WebPage</em> it also inherits the HTML file of the parent class. This type of inheritance is called markup inheritance.
To better illustrate this concept let&#8217;s consider the following example where we have a page class called <em>GenericSitePage</em> with the corresponding HTML file GenericSitePage.html. Now let&#8217;s create a specific page called <em>OrderCheckOutPage</em> where users can check out their orders on our web site. This class extends <em>GenericSitePage</em> but we don&#8217;t provide it with any corresponding HTML file.
In this scenario <em>OrderCheckOutPage</em> will use GenericSitePage.html as markup file:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="markup-inheritance.png" alt="markup inheritance">
</div>
</div>
<div class="paragraph">
<p>Markup inheritance comes in handy for page layout management as it helps us avoid the burden of checking that each page conforms to the site layout. However to fully take advantage of markup inheritance we must first learn how to use another important component of the framework that supports this feature: the panel.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
If no markup is found (nor directly assigned to the class, neither inherited from an ancestor) a <em>MarkupNotFoundException</em> is thrown.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_panel_class">Panel class</h3>
<div class="paragraph">
<p>Class <em>org.apache.wicket.markup.html.panel.Panel</em> is a special component which lets us reuse GUI code and HTML markup across different pages and different web applications. It shares a common ancestor class with WebPage class, which is <em>org.apache.wicket.MarkupContainer</em>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="page-panel-hierarchy.png" alt="page panel hierarchy">
</div>
</div>
<div class="paragraph">
<p><em>Illustration: Hierarchy of WebPage and Panel classes</em></p>
</div>
<div class="paragraph">
<p>Subclasses of <em>MarkupContainer</em> can contain children components that can be added with method <em>add(Component&#8230;)</em> (seen in  <a href="#guide:whyLearn_3">chapter 3.3</a>
). <em>MarkupContainer</em> implements a full set of methods to manage children components. The basic operations we can do on them are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add one or more children components (with method <em>add</em>).</p>
</li>
<li>
<p>remove a specific child component (with method <em>remove</em>).</p>
</li>
<li>
<p>retrieve a specific child component with method <em>get(String)</em>. The string parameter is the id of the component or its relative path if the component is nested inside other 'MarkupContainer&#8217;s. This path is a colon-separated string containing also the ids of the intermediate containers traversed to get to the child component. To illustrate an example of component path, let&#8217;s consider the code of the following page:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">MyPanel</span> <span class="tok-n">myPanel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MyPanel</span> <span class="tok-o">(</span><span class="tok-s">&quot;innerContainer&quot;</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">myPanel</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Component <em>MyPanel</em> is a custom panel containing only a label having ' [name] s id. Under those conditions we could retrieve this label from the container page using the following path expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Label</span> <span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Label</span><span class="tok-o">)</span><span class="tok-n">get</span><span class="tok-o">(</span><span class="tok-s">&quot;innerContainer:name&quot;</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>replace a specific child component with a new component having the same id (with method <em>replace</em>).</p>
</li>
<li>
<p>iterate thought children components with the iterator returned by method <em>iterator</em> or using visitor pattern1 with methods <em>visitChildren</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Both <em>Panel</em> and <em>WebPage</em> have their own associated markup file which is used to render the corresponding component. If such file is not provided, Wicket will apply markup inheritance looking for a markup file through their ancestor classes. When a panel is attached to a container, the content of its markup file is inserted into its related tag.</p>
</div>
<div class="paragraph">
<p>While panels and pages have much in common, there are some notable differences between these two components that we should keep in mind. The main difference between them is that pages can be rendered as standalone entities while panels must be placed inside a page to be rendered. Another important difference is the content of their markup file: for both <em>WebPage</em> and <em>Panel</em> this is a standard HTML file, but <em>Panel</em> uses a special tag to indicate which part of the whole file will be considered as markup source. This tag is <em>&lt;wicket:panel&gt;</em>. A markup file for a panel will typically look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
<span class="tok-nt">&lt;meta</span> <span class="tok-na">http-equiv=</span><span class="tok-s">&quot;Content-Type&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;text/html; charset=UTF-8&quot;</span><span class="tok-nt">&gt;</span>
...
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
   <span class="tok-nt">&lt;wicket:panel&gt;</span>
      <span class="tok-c">&lt;!-- Your markup goes here --&gt;</span>
       <span class="tok-nt">&lt;/wicket:panel&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The HTML outside tag <em>&lt;wicket:panel&gt;</em> will be removed during rendering phase. The space outside this tag can be used by both web developers and web designers to place some mock HTML to show how the final panel should look like.</p>
</div>
</div>
<div class="sect2">
<h3 id="_divide_et_impera">Divide et impera!</h3>
<div class="paragraph">
<p>Let&#8217;s go back to our layout example. In  <a href="#guide:layout_1">chapter 5.1</a>
 we have divided our layout in common areas that must be part of every page. Now we will build a reusable template page for our web application combining pages and panels. The code examples are from project MarkupInheritanceExample.</p>
</div>
</div>
<div class="sect2">
<h3 id="_panels_and_layout_areas">Panels and layout areas</h3>
<div class="paragraph">
<p>First, let&#8217;s build a custom panel for each layout area (except for <em>content</em> area). For example given the  header area</p>
</div>
<div class="imageblock">
<div class="content">
<img src="header-area.png" alt="header area">
</div>
</div>
<div class="paragraph">
<p>we can build a panel called <em>HeaderPanel</em> with a related markup file called HeaderPanel.html containing the HTML for this area:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
<span class="tok-nt">&lt;meta</span> <span class="tok-na">http-equiv=</span><span class="tok-s">&quot;Content-Type&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;text/html; charset=UTF-8&quot;</span><span class="tok-nt">&gt;</span>
...
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
   <span class="tok-nt">&lt;wicket:panel&gt;</span>
      <span class="tok-nt">&lt;table</span> <span class="tok-na">width=</span><span class="tok-s">&quot;100%&quot;</span> <span class="tok-na">style=</span><span class="tok-s">&quot;border: 0px none;&quot;</span><span class="tok-nt">&gt;</span>
      <span class="tok-nt">&lt;tbody&gt;</span>
    <span class="tok-nt">&lt;tr&gt;</span>
    <span class="tok-nt">&lt;td&gt;</span>
       <span class="tok-nt">&lt;img</span> <span class="tok-na">alt=</span><span class="tok-s">&quot;Jug4Tenda&quot;</span> <span class="tok-na">src=</span><span class="tok-s">&quot;wicketLayout_files/logo_jug4tenda.gif&quot;</span><span class="tok-nt">&gt;</span>
     <span class="tok-nt">&lt;/td&gt;</span>
      <span class="tok-nt">&lt;td&gt;</span>
    <span class="tok-nt">&lt;h1&gt;</span>Gestione Anagrafica<span class="tok-nt">&lt;/h1&gt;</span>
   <span class="tok-nt">&lt;/td&gt;</span>
      <span class="tok-nt">&lt;/tr&gt;</span>
      <span class="tok-nt">&lt;/tbody&gt;</span>
      <span class="tok-nt">&lt;/table&gt;</span>
   <span class="tok-nt">&lt;/wicket:panel&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class for this panel simply extends base class <em>Panel</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kn">package</span> <span class="tok-nn">helloWorld.layoutTenda</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.apache.wicket.markup.html.panel.Panel</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HeaderPanel</span> <span class="tok-kd">extends</span> <span class="tok-n">Panel</span> <span class="tok-o">{</span>

	<span class="tok-kd">public</span> <span class="tok-nf">HeaderPanel</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>For each layout area we will build a panel like the one above that holds the appropriate HTML markup. In the end we will have the following set of panels:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HeaderPanel</p>
</li>
<li>
<p>FooterPanel</p>
</li>
<li>
<p>MenuPanel</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Content area will change from page to page, so we don&#8217;t need a reusable panel for it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_template_page">Template page</h3>
<div class="paragraph">
<p>Now we can build a generic template page using our brand new panels. Its markup is quite straightforward :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
<span class="tok-nt">&lt;meta</span> <span class="tok-na">http-equiv=</span><span class="tok-s">&quot;Content-Type&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;text/html; charset=UTF-8&quot;</span><span class="tok-nt">&gt;</span>
...
<span class="tok-c">&lt;!--Include CSS--&gt;</span>
...
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;header&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;headerPanel&quot;</span><span class="tok-nt">&gt;</span>header<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;body&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;menu&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;menuPanel&quot;</span><span class="tok-nt">&gt;</span>menu<span class="tok-nt">&lt;/div&gt;</span>
	<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;content&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;contentComponent&quot;</span><span class="tok-nt">&gt;</span>content<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;footer&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;footerPanel&quot;</span><span class="tok-nt">&gt;</span>footer<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The HTML code for this page implements the generic left-menu layout of our site. You can note the 4 <em>&lt;div&gt;</em> tags used as containers for the corresponding areas.
The page class contains the code to physically assemble the page and panels:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kn">package</span> <span class="tok-nn">helloWorld.layoutTenda</span><span class="tok-o">;</span>

<span class="tok-kn">import</span> <span class="tok-nn">org.apache.wicket.markup.html.WebPage</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.wicket.Component</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.wicket.markup.html.basic.Label</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">JugTemplate</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">CONTENT_ID</span> <span class="tok-o">=</span> <span class="tok-s">&quot;contentComponent&quot;</span><span class="tok-o">;</span>

	<span class="tok-kd">private</span> <span class="tok-n">Component</span> <span class="tok-n">headerPanel</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">Component</span> <span class="tok-n">menuPanel</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">Component</span> <span class="tok-n">footerPanel</span><span class="tok-o">;</span>

              <span class="tok-kd">public</span> <span class="tok-nf">JugTemplate</span><span class="tok-o">(){</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">headerPanel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">HeaderPanel</span><span class="tok-o">(</span><span class="tok-s">&quot;headerPanel&quot;</span><span class="tok-o">));</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">menuPanel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MenuPanel</span><span class="tok-o">(</span><span class="tok-s">&quot;menuPanel&quot;</span><span class="tok-o">));</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">footerPanel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">FooterPanel</span><span class="tok-o">(</span><span class="tok-s">&quot;footerPanel&quot;</span><span class="tok-o">));</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-n">CONTENT_ID</span><span class="tok-o">,</span> <span class="tok-s">&quot;Put your content here&quot;</span><span class="tok-o">));</span>
	<span class="tok-o">}</span>

             <span class="tok-c1">//getters for layout areas</span>
       <span class="tok-c1">//...</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Done! Our template page is ready to be used. Now all the pages of our site will be subclasses of this parent page and they will inherit the layout and the HTML markup. They will only substitute the <em>Label</em> inserted as content area with their custom content.</p>
</div>
</div>
<div class="sect2">
<h3 id="_final_example">Final example</h3>
<div class="paragraph">
<p>As final example we will build the login page for our site. We will call it <em>SimpleLoginPage</em>. First, we need a panel containing the login form. This will be the content area of our page. We will call it <em>LoginPanel</em> and the markup is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
   <span class="tok-nt">&lt;wicket:panel&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;margin: auto; width: 40%;&quot;</span><span class="tok-nt">&gt;</span>
       <span class="tok-nt">&lt;form</span>  <span class="tok-na">id=</span><span class="tok-s">&quot;loginForm&quot;</span> <span class="tok-na">method=</span><span class="tok-s">&quot;get&quot;</span><span class="tok-nt">&gt;</span>
         <span class="tok-nt">&lt;fieldset</span> <span class="tok-na">id=</span><span class="tok-s">&quot;login&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;center&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;legend</span> <span class="tok-nt">&gt;</span>Login<span class="tok-nt">&lt;/legend&gt;</span>
            <span class="tok-nt">&lt;span</span> <span class="tok-nt">&gt;</span>Username: <span class="tok-nt">&lt;/span&gt;&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;username&quot;</span><span class="tok-nt">/&gt;&lt;br/&gt;</span>
            <span class="tok-nt">&lt;span</span> <span class="tok-nt">&gt;</span>Password: <span class="tok-nt">&lt;/span&gt;&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;p&gt;</span>
               <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;login&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;login&quot;</span><span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;/p&gt;</span>
         <span class="tok-nt">&lt;/fieldset&gt;</span>
      <span class="tok-nt">&lt;/form&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
   <span class="tok-nt">&lt;/wicket:panel&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The class for this panel just extends <em>Panel</em> class so we won&#8217;t see the relative code. The form of this panel is for illustrative purpose only. We will see how to work with Wicket forms in chapters  <a href="#guide:modelsforms">11</a>
 and  <a href="#guide:forms2">12</a>
. Since this is a login page we don&#8217;t want it to display the left menu area. That&#8217;s not a big deal as <em>Component</em> class exposes a method called <em>setVisible</em> which sets whether the component and its children should be displayed.</p>
</div>
<div class="paragraph">
<p>The resulting Java code for the login page is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kn">package</span> <span class="tok-nn">helloWorld.layoutTenda</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">helloWorld.LoginPanel</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.wicket.event.Broadcast</span><span class="tok-o">;</span>
<span class="tok-kn">import</span> <span class="tok-nn">org.apache.wicket.event.IEventSink</span><span class="tok-o">;</span>

<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SimpleLoginPage</span> <span class="tok-kd">extends</span> <span class="tok-n">JugTemplate</span> <span class="tok-o">{</span>
	<span class="tok-kd">public</span> <span class="tok-nf">SimpleLoginPage</span><span class="tok-o">(){</span>
		<span class="tok-kd">super</span><span class="tok-o">();</span>
		<span class="tok-n">replace</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">LoginPanel</span><span class="tok-o">(</span><span class="tok-n">CONTENT_ID</span><span class="tok-o">));</span>
		<span class="tok-n">getMenuPanel</span><span class="tok-o">().</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Obviously this page doesn&#8217;t come with a related markup file. You can see the final page in the following picture:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="final-login-page.png" alt="final login page">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_markup_inheritance_with_the_wicket_extend_tag">Markup inheritance with the wicket:extend tag</h3>
<div class="paragraph">
<p>With Wicket we can apply markup inheritance using another approach based on the tag <em>&lt;wicket:child&gt;</em>. This tag is used inside the parent&#8217;s markup to define where the children pages/panels can “inject” their custom markup extending the markup inherited from the parent component.
An example of a parent page using the tag <em>&lt;wicket:child&gt;</em> is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
	<span class="tok-nt">&lt;meta</span> <span class="tok-na">http-equiv=</span><span class="tok-s">&quot;Content-Type&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;text/html; charset=UTF-8&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
	This is parent body!
	<span class="tok-nt">&lt;wicket:child/&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The markup of a child page/panel must be placed inside the tag <em>&lt;wicket:extend&gt;</em>. Only the markup inside <em>&lt;wicket:extend&gt;</em> will be included in final markup. Here is an example of child page markup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">&lt;</span><span class="tok-n">html</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;</span><span class="tok-n">head</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;</span><span class="tok-n">meta</span> <span class="tok-n">http</span><span class="tok-o">-</span><span class="tok-n">equiv</span><span class="tok-o">=</span><span class="tok-s">&quot;Content-Type&quot;</span> <span class="tok-n">content</span><span class="tok-o">=</span><span class="tok-s">&quot;text/html; charset=UTF-8&quot;</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-n">head</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;</span><span class="tok-n">body</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-n">wicket</span><span class="tok-o">:</span><span class="tok-n">extend</span><span class="tok-o">&gt;</span>
          <span class="tok-n">This</span> <span class="tok-n">is</span> <span class="tok-n">child</span> <span class="tok-n">body</span><span class="tok-o">!</span>
	<span class="tok-o">&lt;/</span><span class="tok-n">wicket</span><span class="tok-o">:</span><span class="tok-n">extend</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-n">body</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-n">html</span><span class="tok-o">&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Considering the two pages seen above, the final markup generated for child page will be the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
	<span class="tok-nt">&lt;meta</span> <span class="tok-na">http-equiv=</span><span class="tok-s">&quot;Content-Type&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;text/html; charset=UTF-8&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
	This is parent body!
	<span class="tok-nt">&lt;wicket:child&gt;</span>
       <span class="tok-nt">&lt;wicket:extend&gt;</span>
           This is child body!
	   <span class="tok-nt">&lt;/wicket:extend&gt;</span>
    <span class="tok-nt">&lt;/wicket:child&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_our_example_revisited">Our example revisited</h3>
<div class="paragraph">
<p>Applying <em>&lt;wicket:child&gt;</em> tag to our layout example, we obtain the following markup for the main template page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
	<span class="tok-nt">&lt;meta</span> <span class="tok-na">http-equiv=</span><span class="tok-s">&quot;Content-Type&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;text/html; charset=UTF-8&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;header&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;headerPanel&quot;</span><span class="tok-nt">&gt;</span>header<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;body&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;menu&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;menuPanel&quot;</span><span class="tok-nt">&gt;</span>menu<span class="tok-nt">&lt;/div&gt;</span>
	<span class="tok-nt">&lt;wicket:child/&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;footer&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;footerPanel&quot;</span><span class="tok-nt">&gt;</span>footer<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>We have replaced the <em>&lt;div&gt;</em> tag of the content area with the tag <em>&lt;wicket:child&gt;</em>. Going forward with our example we can build a login page creating class <em>SimpleLoginPage</em> which extends the <em>JugTemplate</em> page, but with a related markup file like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
   <span class="tok-nt">&lt;wicket:extend&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;margin: auto; width: 40%;&quot;</span><span class="tok-nt">&gt;</span>
       <span class="tok-nt">&lt;form</span>  <span class="tok-na">id=</span><span class="tok-s">&quot;loginForm&quot;</span> <span class="tok-na">method=</span><span class="tok-s">&quot;get&quot;</span><span class="tok-nt">&gt;</span>
         <span class="tok-nt">&lt;fieldset</span> <span class="tok-na">id=</span><span class="tok-s">&quot;login&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;center&quot;</span><span class="tok-nt">&gt;</span>
            <span class="tok-nt">&lt;legend</span> <span class="tok-nt">&gt;</span>Login<span class="tok-nt">&lt;/legend&gt;</span>
            <span class="tok-nt">&lt;span</span> <span class="tok-nt">&gt;</span>Username: <span class="tok-nt">&lt;/span&gt;&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;username&quot;</span><span class="tok-nt">/&gt;&lt;br/&gt;</span>
            <span class="tok-nt">&lt;span</span> <span class="tok-nt">&gt;</span>Password: <span class="tok-nt">&lt;/span&gt;&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;p&gt;</span>
               <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;login&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;login&quot;</span><span class="tok-nt">/&gt;</span>
            <span class="tok-nt">&lt;/p&gt;</span>
         <span class="tok-nt">&lt;/fieldset&gt;</span>
      <span class="tok-nt">&lt;/form&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
   <span class="tok-nt">&lt;/wicket:extend&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can see this approach doesn&#8217;t require to create custom panels to use as content area and it can be useful if we don&#8217;t have to handle a GUI with a high degree of complexity.</p>
</div>
</div>
<div class="sect2">
<h3 id="_summary_2">Summary</h3>
<div class="paragraph">
<p>Wicket applies inheritance also to HTML markup making layout management much easier and less error-prone. Defining a master template page to use as base class for the other pages is a great way to build a consistent layout and use it across all the pages on the web site. During the chapter we have also introduced the <em>Panel</em> component, a very important Wicket class that is primarily designed to let us divide our pages in smaller and reusable UI components.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_keeping_control_over_html">Keeping control over HTML</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Many Wicket newbies are initially scared by its approach to web development because they have the impression that the component-oriented nature of the framework prevents them from having direct control over the generated markup. This is due to the fact that many developers come from other server-side technologies like JSP where we physically implement the logic that controls how the final HTML is generated.</p>
</div>
<div class="paragraph">
<p>This chapter will prevent you from having any initial misleading feeling about Wicket showing you how to control and manipulate the generated HTML with the built-in tools shipped with the framework.</p>
</div>
<div class="sect2">
<h3 id="_hiding_or_disabling_a_component">Hiding or disabling a component</h3>
<div class="paragraph">
<p>At the end of the previous chapter we have seen how to hide a component calling its method <em>setVisible</em>. In a similar fashion, we can also decide to disable a component using method <em>setEnabled</em>. When a component is disabled all the links inside it will be in turn disabled (they will be rendered as <em>&lt;span&gt;</em>) and it can not fire JavaScript events.</p>
</div>
<div class="paragraph">
<p>Class <em>Component</em> provides two getter methods to determinate if a component is visible or enabled: <em>isVisible</em> and <em>isEnabled</em>.</p>
</div>
<div class="paragraph">
<p>Even if nothing prevents us from overriding these two methods to implement a custom logic to determinate the state of a component, we should keep in mind that methods <em>isVisible</em> and <em>isEnabled</em> are called multiple times before a component is fully rendered. Hence, if we place non-trivial code inside these two methods, we can sensibly deteriorate the responsiveness of our pages.</p>
</div>
<div class="paragraph">
<p>As we will see in the next chapter, class <em>Component</em> provides method <em>onConfigure</em> which is more suited to contain code that contributes to determinate component states because it is called just once during rendering phase.</p>
</div>
</div>
<div class="sect2">
<h3 id="_modifing_tag_attributes">Modifing tag attributes</h3>
<div class="paragraph">
<p>To modify tag attributes we can use class <em>org.apache.wicket.AttributeModifier</em>. This class extends <em>org.apache.wicket.behavior.Behavior</em> and can be added to any component via the <em>Component</em>'s <em>add</em> method. Class <em>Behavior</em> is used to expand component functionalities and it can also modify component markup. We will see this class in detail later in  <a href="#guide:advanced_1">chapter 19.1</a>
.</p>
</div>
<div class="paragraph">
<p>As first example of attribute manipulation let&#8217;s consider a <em>Label</em> component bound to the following markup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;span</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;simpleLabel&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Suppose we want to add some style to label content making it red and bolded. We can add to the label an <em>AttributeModifier</em> which creates the tag attribute <em>style</em> with value ' [color:red;font-weight:bold] :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">AttributeModifier</span><span class="tok-o">(</span><span class="tok-s">&quot;style&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;color:red;font-weight:bold&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If attribute <em>style</em> already exists in the original markup, it will be replaced with the value specified by <em>AttributeModifier</em>. If we don&#8217;t want to overwrite the existing value of an attribute we can use subclass <em>AttributeAppender</em> which will append its value to the existing one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">AttributeAppender</span><span class="tok-o">(</span><span class="tok-s">&quot;style&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;color:red;font-weight:bold&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also create attribute modifiers using factory methods provided by class <em>AttributeModifier</em> and it&#8217;s also possible to prepend a given value to an existing attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//replaces existing value with the given one</span>
<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">AttributeModifier</span><span class="tok-o">.</span><span class="tok-na">replace</span><span class="tok-o">(</span><span class="tok-s">&quot;style&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;color:red;font-weight:bold&quot;</span><span class="tok-o">));</span>

<span class="tok-c1">//appends the given value to the existing one</span>
<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">AttributeModifier</span><span class="tok-o">.</span><span class="tok-na">append</span><span class="tok-o">(</span><span class="tok-s">&quot;style&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;color:red;font-weight:bold&quot;</span><span class="tok-o">));</span>

<span class="tok-c1">//prepends the given value to the existing one</span>
<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">AttributeModifier</span><span class="tok-o">.</span><span class="tok-na">prepend</span><span class="tok-o">(</span><span class="tok-s">&quot;style&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;color:red;font-weight:bold&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_generating_tag_attribute_em_id_em">Generating tag attribute <em>id</em></h3>
<div class="paragraph">
<p>Tag attribute <em>id</em> plays a crucial role in web development as it allows JavaScript to identify a DOM element. That&#8217;s why class <em>Component</em> provides two dedicated methods to set this attribute. With method <em>setOutputMarkupId(boolean output)</em> we can decide if the <em>id</em> attribute will be rendered or not in the final markup (by default is not rendered). The value of this attribute will be automatically generated by Wicket and it will be unique for the entire page.
If we need to specify this value by hand, we can use method <em>setMarkupId(String id)</em>. The value of the id can be retrieved with method <em>getMarkupId()</em>.</p>
</div>
<div class="paragraph">
<p>Wicket generates markup ids using an instance of interface <em>org.apache.wicket.IMarkupIdGenerator</em>. The default implementation is <em>org.apache.wicket.DefaultMarkupIdGenerator</em> and it uses a session-scoped counter to generate the final id. A different generator can be set with the markup settings class <em>org.apache.wicket.settings.MarkupSettings</em> available in the application class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
	<span class="tok-c1">//wrap disabled links with &lt;b&gt; tag</span>
	<span class="tok-n">getMarkupSettings</span><span class="tok-o">().</span><span class="tok-na">setMarkupIdGenerator</span><span class="tok-o">(</span><span class="tok-n">myGenerator</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_in_line_panels_with_webmarkupcontainer">Creating in-line panels with WebMarkupContainer</h3>
<div class="paragraph">
<p>Create custom panels is a great way to handle complex user interfaces. However, sometimes we may need to create a panel which is used only by a specific page and only for a specific task.</p>
</div>
<div class="paragraph">
<p>In situations like these component <em>org.apache.wicket.markup.html.WebMarkupContainer</em> is better suited than custom panels because it can be directly attached to a tag in the parent markup without needing a corresponding html file (hence it is less reusable). Let&#8217;s consider for example the main page of a mail service where users can see a list of received mails. Suppose that this page shows a notification box where user can see if new messages have arrived. This box must be hidden if there are no messages to display and it would be nice if we could handle it as if it was a Wicket component.</p>
</div>
<div class="paragraph">
<p>Suppose also that this information box is a <em>&lt;div&gt;</em> tag like this inside the page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;informationBox&quot;</span><span class="tok-nt">&gt;</span>
   //here&#39;s the body
   You&#39;ve got <span class="tok-nt">&lt;span</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;messagesNumber&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span> new messages.
<span class="tok-nt">&lt;/div&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Under those conditions we can consider using a <em>WebMarkupContainer</em> component rather than implementing a new panel. The code needed to handle the information box inside the page could be the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//Page initialization code</span>
<span class="tok-n">WebMarkupContainer</span> <span class="tok-n">informationBox</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">WebMarkupContainer</span> <span class="tok-o">(</span><span class="tok-s">&quot;informationBox&quot;</span><span class="tok-o">);</span>
<span class="tok-n">informationBox</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;messagesNumber&quot;</span><span class="tok-o">,</span> <span class="tok-n">messagesNumber</span><span class="tok-o">));</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">informationBox</span><span class="tok-o">);</span>

<span class="tok-c1">//If there are no new messages, hide informationBox</span>
<span class="tok-n">informationBox</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see in the snippet above we can handle our information box from Java code as we do with any other Wicket component.</p>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_markup_fragments">Working with markup fragments</h3>
<div class="paragraph">
<p>Another circumstance in which we may prefer to avoid the creation of custom panels is when we want to conditionally display in a page small fragments of markup. In this case if we decided to use panels, we would end up having a huge number of small panel classes with their related markup file.</p>
</div>
<div class="paragraph">
<p>To better cope with situations like this, Wicket defines component <em>Fragment</em> in package <em>org.apache.wicket.markup.html.panel</em>. Just like its parent component <em>WebMarkupContainer</em>, Fragment doesn&#8217;t have its own markup file but it uses a markup fragment defined in the markup file of its parent container, which can be a page or a panel. The fragment must be delimited with tag <em>&lt;wicket:fragment&gt;</em> and must be identified by a <em>wicket:id</em> attribute. In addition to the component id, <em>Fragment</em>'s constructor takes as input also the id of the fragment and a reference to its container.</p>
</div>
<div class="paragraph">
<p>In the following  example we have defined a fragment in a page and we used it as content area:</p>
</div>
<div class="paragraph">
<p><strong>Page markup:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
  ...
<span class="tok-nt">&lt;body&gt;</span>
...
	<span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;contentArea&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
	<span class="tok-nt">&lt;wicket:fragment</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;fragmentId&quot;</span><span class="tok-nt">&gt;</span>
	   <span class="tok-c">&lt;!-- Fragment markup goes here --&gt;</span>
	<span class="tok-nt">&lt;/wicket:fragment&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Fragment</span> <span class="tok-n">fragment</span> <span class="tok-o">=</span> <span class="tok-k">new</span>  <span class="tok-n">Fragment</span> <span class="tok-o">(</span><span class="tok-s">&quot;contentArea&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;fragmentId&quot;</span><span class="tok-o">,</span> <span class="tok-k">this</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">fragment</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Fragments can be very helpful with complex pages or components. For example let&#8217;s say that we  have a page where users can register to our forum. This page should first display a form where user must insert his/her personal data (name, username, password, email and so on), then, once the user has submitted the form, the page should display a message like “Your registration is complete! Please check your mail to activate your user profile.”.</p>
</div>
<div class="paragraph">
<p>Instead of displaying this message with a new component or in a new page, we can define two fragments: one for the initial form and one to display the confirmation message. The second fragment will replace the first one after the form has been submitted:</p>
</div>
<div class="paragraph">
<p><strong>Page markup:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
	<span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;contentArea&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
	<span class="tok-nt">&lt;wicket:fragment</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;formFrag&quot;</span><span class="tok-nt">&gt;</span>
	   <span class="tok-c">&lt;!-- Form markup goes here --&gt;</span>
	<span class="tok-nt">&lt;/wicket:fragment&gt;</span>
	<span class="tok-nt">&lt;wicket:fragment</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;messageFrag&quot;</span><span class="tok-nt">&gt;</span>
	   <span class="tok-c">&lt;!-- Message markup goes here --&gt;</span>
	<span class="tok-nt">&lt;/wicket:fragment&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Fragment</span> <span class="tok-n">fragment</span> <span class="tok-o">=</span> <span class="tok-k">new</span>  <span class="tok-n">Fragment</span> <span class="tok-o">(</span><span class="tok-s">&quot;contentArea&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;formFrag&quot;</span><span class="tok-o">,</span> <span class="tok-k">this</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">fragment</span><span class="tok-o">);</span>

<span class="tok-c1">//form has been submitted</span>
<span class="tok-n">Fragment</span> <span class="tok-n">fragment</span> <span class="tok-o">=</span> <span class="tok-k">new</span>  <span class="tok-n">Fragment</span> <span class="tok-o">(</span><span class="tok-s">&quot;contentArea&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;messageFrag&quot;</span><span class="tok-o">,</span> <span class="tok-k">this</span><span class="tok-o">);</span>
<span class="tok-n">replace</span><span class="tok-o">(</span><span class="tok-n">fragment</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_adding_header_contents_to_the_final_page">Adding header contents to the final page</h3>
<div class="paragraph">
<p>Panel&#8217;s markup can also contain HTML tags which must go inside header section of the final page, like tags <em>&lt;script&gt;</em> or <em>&lt;style&gt;</em>. To tell Wicket to put these tags inside page <em>&lt;head&gt;</em>, we must surround them with the <em>&lt;wicket:head&gt;</em> tag.</p>
</div>
<div class="paragraph">
<p>Considering the markup of a generic panel, we can use <em>&lt;wicket:head&gt;</em> tag in this way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;wicket:head&gt;</span>
	<span class="tok-nt">&lt;script </span><span class="tok-na">type=</span><span class="tok-s">&quot;text/javascript&quot;</span><span class="tok-nt">&gt;</span>
	  	<span class="tok-kd">function</span> <span class="tok-nx">myPanelFunction</span><span class="tok-p">(){</span>
	  	<span class="tok-p">}</span>
	  <span class="tok-nt">&lt;/script&gt;</span>

	<span class="tok-nt">&lt;style&gt;</span>
        <span class="tok-nc">.myPanelClass</span><span class="tok-p">{</span>
	  	<span class="tok-k">font-weight</span><span class="tok-o">:</span> <span class="tok-k">bold</span><span class="tok-p">;</span>
	  	<span class="tok-k">color</span><span class="tok-o">:</span> <span class="tok-nb">red</span><span class="tok-p">;</span>
	  <span class="tok-p">}</span>
       <span class="tok-nt">&lt;/style&gt;</span>
<span class="tok-nt">&lt;/wicket:head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
	<span class="tok-nt">&lt;wicket:panel&gt;</span>

	<span class="tok-nt">&lt;/wicket:panel&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wicket will take care of placing the content of <em>&lt;wicket:head&gt;</em> inside the <em>&lt;head&gt;</em> tag of the final page.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The <em>&lt;wicket:head&gt;</em> tag can also be used with children pages/panels which extend parent markup using tag <em>&lt;wicket:extend&gt;</em>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The content of the <em>&lt;wicket:head&gt;</em> tag is added to the header section once per component class. In other words, if we add multiple instances of the same panel to a page, the <em>&lt;head&gt;</em> tag will be populated just once with the content of <em>&lt;wicket:head&gt;</em>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
The <em>&lt;wicket:head&gt;</em> tag is ideal if we want to define small in-line blocks of CSS or JavaScript. However Wicket provides also a more sophisticated technique to let components contribute to header section with in-line blocks and resource files like CSS or JavaScript files. We will see this technique later in  <a href="#guide:resources">chapter 16</a>
.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_using_stub_markup_in_our_pages_panels">Using stub markup in our pages/panels</h3>
<div class="paragraph">
<p>Wicket&#8217;s <em>&lt;wicket:remove&gt;</em> tag can be very useful when our web designer needs to show us how a page or a panel should look like. The markup inside this tag will be stripped out in the final page, so it&#8217;s the ideal place for web designers to put their stub markup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>

<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
	<span class="tok-nt">&lt;wicket:remove&gt;</span>
	   <span class="tok-c">&lt;!-- Stub markup goes here --&gt;</span>
	<span class="tok-nt">&lt;/wicket:remove&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_render_component_body_only">How to render component body only</h3>
<div class="paragraph">
<p>When we bind a component to its corresponding tag we can choose to get rid of this outer tag in the final markup. If we call method <em>setRenderBodyOnly(true)</em> on a component Wicket will remove the surrounding tag.</p>
</div>
<div class="paragraph">
<p>For example given the following markup and code:</p>
</div>
<div class="paragraph">
<p><strong>HTML markup:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
  <span class="tok-nt">&lt;title&gt;</span>Hello world page<span class="tok-nt">&lt;/title&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;helloWorld&quot;</span><span class="tok-nt">&gt;</span>[helloWorld]<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Label</span> <span class="tok-n">label</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;helloWorld&quot;</span><span class="tok-o">,</span> <span class="tok-err">“</span><span class="tok-n">Hello</span> <span class="tok-n">World</span><span class="tok-o">!</span><span class="tok-err">”</span><span class="tok-o">);</span>
<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setRenderBodyOnly</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>the output will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
  <span class="tok-nt">&lt;title&gt;</span>Hello world page<span class="tok-nt">&lt;/title&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
 Hello World!
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see the <em>&lt;div&gt;</em> tag used for component <em>Label</em> is not present in the final markup.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hiding_decorating_elements_with_the_wicket_enclosure_tag">Hiding decorating elements with the wicket:enclosure tag</h3>
<div class="paragraph">
<p>Our data are rarely displayed alone without a caption or other graphic elements that make clear the meaning of their value. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;label&gt;</span>Total amount: <span class="tok-nt">&lt;/label&gt;&lt;span</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;totalAmount&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wicket comes with a nice utility tag called <em>&lt;wicket:enclosure&gt;</em> that automatically hides those decorating elements if the related data value is not visible. All we have to do is to put the involved markup inside this tag. Applying <em>&lt;wicket:enclosure&gt;</em> to the previous example we get the following markup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;wicket:enclosure&gt;</span>
    <span class="tok-nt">&lt;label&gt;</span>Total amount: <span class="tok-nt">&lt;/label&gt;&lt;span</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;totalAmount&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span>
<span class="tok-nt">&lt;/wicket:enclosure&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if component <em>totalAmount</em> is not visible, its description (<em>Total amount:</em>) will be automatically hidden. If we have more than a Wicket component inside <em>&lt;wicket:enclosure&gt;</em> we can use <em>child</em> attribute to specify which component will control the overall visibility:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;wicket:enclosure</span> <span class="tok-na">child=</span><span class="tok-s">&quot;totalAmount&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;label&gt;</span>Total amount: <span class="tok-nt">&lt;/label&gt;&lt;span</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;totalAmount&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;&lt;br/&gt;</span>
	<span class="tok-nt">&lt;label&gt;</span>Expected delivery date: <span class="tok-nt">&lt;/label&gt;&lt;span</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;delivDate&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span>
<span class="tok-nt">&lt;/wicket:enclosure&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>child</em> attribute supports also nested components with a colon-separated path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;wicket:enclosure</span> <span class="tok-na">child=</span><span class="tok-s">&quot;totalAmountContainer:totalAmount&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;totalAmountContainer&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;label&gt;</span>Total amount: <span class="tok-nt">&lt;/label&gt;&lt;span</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;totalAmount&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
    <span class="tok-nt">&lt;label&gt;</span>Expected delivery date: <span class="tok-nt">&lt;/label&gt;&lt;span</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;delivDate&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span>
<span class="tok-nt">&lt;/wicket:enclosure&gt;</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_surrounding_existing_markup_with_border">Surrounding existing markup with Border</h3>
<div class="paragraph">
<p>Component <em>org.apache.wicket.markup.html.border.Border</em> is a special purpose container created to enclose its tag body with its related markup. Just like panels and pages, borders also have their own markup file which is defined following the same rules seen for panels and pages. In this file <em>&lt;wicket:border&gt;</em> tag is used to indicate which part of the content is to be considered as border markup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="tok-na">xmlns:wicket=</span><span class="tok-s">&quot;http://wicket.apache.org&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
    <span class="tok-c">&lt;!--  everything above &lt;wicket:border&gt; tag will be discarded...--&gt;</span>
    <span class="tok-nt">&lt;wicket:border&gt;</span>
	 <span class="tok-nt">&lt;div&gt;</span>
	    foo<span class="tok-nt">&lt;br</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;wicket:body/&gt;&lt;br</span> <span class="tok-nt">/&gt;</span>
           buz <span class="tok-nt">&lt;br</span> <span class="tok-nt">/&gt;</span>

  <span class="tok-nt">&lt;/div&gt;</span>
    <span class="tok-nt">&lt;/wicket:border&gt;</span>
    <span class="tok-c">&lt;!--  everything below &lt;/wicket:border&gt; tag will be discarded...--&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>&lt;wicket:body/&gt;</em> tag used in the example above is used to indicate where the body of the tag will be placed inside border markup. Now if we attached this border to the following tag</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;span</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;myBorder&quot;</span><span class="tok-nt">&gt;</span>
  bar
<span class="tok-nt">&lt;/span&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>we would obtain the following resulting HTML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;span</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;myBorder&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;div&gt;</span>
  		foo<span class="tok-nt">&lt;br</span> <span class="tok-nt">/&gt;</span>
  		bar<span class="tok-nt">&lt;br</span> <span class="tok-nt">/&gt;</span>
  		buz <span class="tok-nt">&lt;br</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/span&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>Border</em> can also contain children components which can be placed either inside its markup file or inside its corresponding HTML tag. In the first case children must be added to the border component with method <em>addToBorder(Component&#8230;)</em>, while in the second case we must use the <em>add(Component&#8230;)</em> method.</p>
</div>
<div class="paragraph">
<p>The following example illustrates both use cases:</p>
</div>
<div class="paragraph">
<p>Border class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyBorder</span> <span class="tok-kd">extends</span> <span class="tok-n">Border</span> <span class="tok-o">{</span>

	<span class="tok-kd">public</span> <span class="tok-nf">MyBorder</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Border Markup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">xmlns=</span><span class="tok-s">&quot;http://www.w3.org/1999/xhtml&quot;</span> <span class="tok-na">xmlns:wicket=</span><span class="tok-s">&quot;http://wicket.apache.org&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
    <span class="tok-nt">&lt;wicket:border&gt;</span>
	 <span class="tok-nt">&lt;div&gt;</span>
	    <span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;childMarkup&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
    <span class="tok-nt">&lt;wicket:body/&gt;&lt;br</span> <span class="tok-nt">/&gt;</span>
         <span class="tok-nt">&lt;/div&gt;</span>
    <span class="tok-nt">&lt;/wicket:border&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Border tag:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;myBorder&quot;</span><span class="tok-nt">&gt;</span>
  <span class="tok-nt">&lt;span</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;childTag&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Initialization code for border:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">MyBorder</span> <span class="tok-n">myBorder</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MyBorder</span><span class="tok-o">(</span><span class="tok-s">&quot;myBorder&quot;</span><span class="tok-o">);</span>

<span class="tok-n">myBorder</span><span class="tok-o">.</span><span class="tok-na">addToBorder</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;childMarkup&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Child inside markup.&quot;</span><span class="tok-o">));</span>
<span class="tok-n">myBorder</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;childTag&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Child inside tag.&quot;</span><span class="tok-o">));</span>

<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">myBorder</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_3">Summary</h3>
<div class="paragraph">
<p>In this chapter we have seen the tools provided by Wicket to gain complete control over the generated HTML. However we didn&#8217;t see yet how we can repeat a portion of HTML with Wicket. With classic server-side technologies like PHP or JSP we use loops (like <em>while</em> or <em>for</em>) inside our pages to achieve this result.
To perform this task Wicket provides a special-purpose family of components called repeaters and designed to repeat their markup body to display a set of items.</p>
</div>
<div class="paragraph">
<p>But to fully understand how these components work, we must first learn more of Wicket&#8217;s basics. That&#8217;s why repeaters will be introduced later in  <a href="#guide:repeaters">chapter 13</a>
.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_components_lifecycle">Components lifecycle</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Just like applets and servlets, also Wicket components follow a lifecycle during their existence. In this chapter we will analyze each stage of this cycle and we will learn how to make the most of the hook methods that are triggered when a component moves from one stage to another.</p>
</div>
<div class="sect2">
<h3 id="_lifecycle_stages_of_a_component">Lifecycle stages of a component</h3>
<div class="paragraph">
<p>During its life a Wicket component goes through three basic stages:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Initialization:</strong> a component is instantiated by Wicket and prepared for the rendering phase.</p>
</li>
<li>
<p><strong>Rendering:</strong> in this stage Wicket generates component markup. If a component contains children (i.e. is a subclass of <em>MarkupContainer</em>) it must first wait for them to be rendered before starting its own rendering.</p>
</li>
<li>
<p><strong>Removing:</strong> this stage is triggered when a component is explicitly removed from its component hierarchy, i.e. when its parent invokes <em>remove(component)</em> on it. This stage is facultative and is never triggered for pages.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The following picture shows the state diagram of component lifecycle:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="component-lifecycle.png" alt="component lifecycle">
</div>
</div>
<div class="paragraph">
<p>Once a component has been removed it can be added again to a container, but the initialization stage won&#8217;t be executed again.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
If you read the JavaDoc of class <em>Component</em> you will find a more detailed description of component lifecycle.
However this description introduces some advanced topics we didn&#8217;t covered yet hence, to avoid confusion, in this chapter some details have been omitted and they will be covered later in the next chapters.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For now you can consider just the simplified version of the lifecycle described above.</p>
</div>
</div>
<div class="sect2">
<h3 id="_hook_methods_for_component_lifecycle">Hook methods for component lifecycle</h3>
<div class="paragraph">
<p>Class <em>Component</em> comes with a number of hook methods that can be overridden in order to customize component behavior during its lifecycle.
In the following table these methods are grouped according to the stage in which they are invoked (and they are sorted by execution order):</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Cycle stage</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Involved methods</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initialization</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">onInitialize</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rendering</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">onConfigure, onBeforeRender, onRender, onComponentTag, onComponentTagBody, onAfterRenderChildren, onAfterRender</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Removing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">onRemove</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>Now let&#8217;s take a closer look at each stage and to at hook methods.</p>
</div>
</div>
<div class="sect2">
<h3 id="_initialization_stage">Initialization stage</h3>
<div class="paragraph">
<p>This stage is performed at the beginning of the component lifecycle. During initialization, the component has already been inserted into its component hierarchy so we can safely access to its parent container or to its page with methods <em>getParent()</em> or <em>getPage()</em>. The only method triggered during this stage is <em>onInitialize()</em>. This method is a sort of “special” constructor where we can execute a custom initialization of our component.</p>
</div>
<div class="paragraph">
<p>Since <em>onInitialize</em> is similar to a regular constructor, when we override this method we have to call <em>super.onInitialize</em> inside its body, usually as first instruction.</p>
</div>
</div>
<div class="sect2">
<h3 id="_rendering_stage">Rendering stage</h3>
<div class="paragraph">
<p>This stage is triggered each time a component is rendered by Wicket, typically when its page is requested or when it is refreshed via AJAX.</p>
</div>
</div>
<div class="sect2">
<h3 id="_method_onconfigure">Method onConfigure</h3>
<div class="paragraph">
<p>Method <em>onConfigure()</em> has been introduced in order to provide a good point to manage the component states such as its visibility or enabled state. This method is called before the render phase starts. As stated in  <a href="#guide:keepControl_1">chapter 6.1</a>
, <em>isVisible</em> and <em>isEnabled</em> are called multiple times when a page or a component is rendered, so it&#8217;s highly recommended not to directly override these method, but rather to use <em>onConfigure</em> to change component states. On the contrary method <em>onBeforeRender</em> (see the next paragraph) is not indicated for this task because it will not be invoked if component visibility is set to false.</p>
</div>
</div>
<div class="sect2">
<h3 id="_method_onbeforerender">Method onBeforeRender</h3>
<div class="paragraph">
<p>The most important hook method of this stage is probably <em>onBeforeRender()</em>. This method is called before a component starts its rendering phase and it is our last chance to change its children hierarchy.</p>
</div>
<div class="paragraph">
<p>If we want add/remove children components this is the right place to do it. In the next example (project LifeCycleStages) we will create a page which alternately displays two different labels, swapping between them each time it is rendered:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span>
<span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-n">Label</span> <span class="tok-n">firstLabel</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">Label</span> <span class="tok-n">secondLabel</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(){</span>
		<span class="tok-n">firstLabel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;label&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;First label&quot;</span><span class="tok-o">);</span>
		<span class="tok-n">secondLabel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;label&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Second label&quot;</span><span class="tok-o">);</span>

		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">firstLabel</span><span class="tok-o">);</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Link</span><span class="tok-o">(</span><span class="tok-s">&quot;reload&quot;</span><span class="tok-o">){</span>
			<span class="tok-nd">@Override</span>
			<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">()</span> <span class="tok-o">{</span>
			<span class="tok-o">}</span>
		<span class="tok-o">});</span>
	<span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onBeforeRender</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">contains</span><span class="tok-o">(</span><span class="tok-n">firstLabel</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">))</span>
			<span class="tok-n">replace</span><span class="tok-o">(</span><span class="tok-n">secondLabel</span><span class="tok-o">);</span>
		<span class="tok-k">else</span>
			<span class="tok-n">replace</span><span class="tok-o">(</span><span class="tok-n">firstLabel</span><span class="tok-o">);</span>

		<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onBeforeRender</span><span class="tok-o">();</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code inside <em>onBeforeRender()</em> is quite trivial as it just checks which label among <em>firstLabel</em> and <em>secondLabel</em> is currently inserted into the component hierarchy and it replaces the inserted label with the other one.</p>
</div>
<div class="paragraph">
<p>This method is also responsible for invoking children <em>onBeforeRender()</em> so if we decide to override it we have to call <em>super.onBeforeRender()</em>. However, unlike <em>onInitialize()</em>, the call to superclass method should be placed at the end of method&#8217;s body in order to affect children&#8217;s rendering with our custom code.</p>
</div>
<div class="paragraph">
<p>Please note that in the example above we can trigger the rendering stage pressing F5 key or clicking on link “reload”.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
If we forget to call superclass version of methods <em>onInitialize()</em> or <em>onBeforeRender()</em>, Wicket will throw an <em>IllegalStateException</em> with the following message:
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><em>java.lang.IllegalStateException: 'org.apache.wicket.Component</em> has not been properly initialized. Something in the hierarchy of &lt;page class name&gt; has not called super.onInitialize()/onBeforeRender() in the override of onInitialize()/ onBeforeRender() method'</p>
</div>
</div>
<div class="sect2">
<h3 id="_method_oncomponenttag">Method onComponentTag</h3>
<div class="paragraph">
<p>Method <em>onComponentTag(ComponentTag)</em> is called to process component tag, which can be freely manipulated through its argument of type <em>org.apache.wicket.markup.ComponentTag</em>. For example we can add/remove tag attributes with methods <em>put(String key, String value)</em> and <em>remove(String key)</em>, or we can even decide to change the tag or rename it with method <em>setName(String)</em> (the following code is taken from project OnComponentTagExample):</p>
</div>
<div class="paragraph">
<p><strong>Markup code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;head&gt;</span>
  <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;title&gt;&lt;/title&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
  <span class="tok-nt">&lt;h1</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;helloMessage&quot;</span><span class="tok-nt">&gt;&lt;/h1&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
   <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;helloMessage&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Hello World&quot;</span><span class="tok-o">){</span>
         <span class="tok-nd">@Override</span>
         <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onComponentTag</span><span class="tok-o">(</span><span class="tok-n">ComponentTag</span> <span class="tok-n">tag</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onComponentTag</span><span class="tok-o">(</span><span class="tok-n">tag</span><span class="tok-o">);</span>
            <span class="tok-c1">//Turn the h1 tag to a span</span>
            <span class="tok-n">tag</span><span class="tok-o">.</span><span class="tok-na">setName</span><span class="tok-o">(</span><span class="tok-s">&quot;span&quot;</span><span class="tok-o">);</span>
            <span class="tok-c1">//Add formatting style</span>
            <span class="tok-n">tag</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;style&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;font-weight:bold&quot;</span><span class="tok-o">);</span>
         <span class="tok-o">}</span>
      <span class="tok-o">});</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Generated markup:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;head&gt;</span>
  <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span> <span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;title&gt;&lt;/title&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
  <span class="tok-nt">&lt;span</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;helloMessage&quot;</span> <span class="tok-na">style=</span><span class="tok-s">&quot;font-weight:bold&quot;</span><span class="tok-nt">&gt;</span>Hello World<span class="tok-nt">&lt;/span&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just like we do with <em>onInitialize</em>, if we decide to override <em>onComponentTag</em> we must remember to call the same method of the super class because also this class may also customize the tag. Overriding <em>onComponentTag</em> is perfectly fine if we have to customize the tag of a specific component, but if we wanted to reuse the code across different components we should consider to use a behavior in place of this hook method.</p>
</div>
<div class="paragraph">
<p>We have already seen in  <a href="#guide:keepControl_2">chapter 6.2</a>
 how to use behavior <em>AttributeModifier</em> to manipulate the tag&#8217;s attribute. In  <a href="#guide:advanced_1">chapter 19.1</a>
 we will see that base class <em>Behavior</em> offers also a callback method named <em>onComponentTag(ComponentTag, Component)</em> that can be used in place of the hook method <em>onComponentTag(ComponentTag)</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_methods_oncomponenttagbody">Methods onComponentTagBody</h3>
<div class="paragraph">
<p>Method <em>onComponentTagBody(MarkupStream, ComponentTag)</em> is called to process the component tag&#8217;s body. Just like <em>onComponentTag</em> it takes as input a <em>ComponentTag</em> parameter representing the component tag. In addition, we also find a <em>MarkupStream</em> parameter which represents the page markup stream that will be sent back to the client as response.</p>
</div>
<div class="paragraph">
<p><em>onComponentTagBody</em> can be used in combination with the <em>Component</em>'s method <em>replaceComponentTagBody</em> to render a custom body under specific conditions. For example (taken from project OnComponentTagExample) we can display a brief description instead of the body if the label component is disabled:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
   <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">()</span> <span class="tok-o">{</span>

      <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;helloMessage&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Hello World&quot;</span><span class="tok-o">){</span>
         <span class="tok-nd">@Override</span>
         <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onComponentTagBody</span><span class="tok-o">(</span><span class="tok-n">MarkupStream</span> <span class="tok-n">markupStream</span><span class="tok-o">,</span> <span class="tok-n">ComponentTag</span> <span class="tok-n">tag</span><span class="tok-o">)</span> <span class="tok-o">{</span>

           <span class="tok-k">if</span><span class="tok-o">(!</span><span class="tok-n">isEnabled</span><span class="tok-o">())</span>
               <span class="tok-n">replaceComponentTagBody</span><span class="tok-o">(</span><span class="tok-n">markupStream</span><span class="tok-o">,</span> <span class="tok-n">tag</span><span class="tok-o">,</span> <span class="tok-s">&quot;(the component is disabled)&quot;</span><span class="tok-o">);</span>
          <span class="tok-k">else</span>
               <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onComponentTagBody</span><span class="tok-o">(</span><span class="tok-n">markupStream</span><span class="tok-o">,</span> <span class="tok-n">tag</span><span class="tok-o">);</span>
         <span class="tok-o">}</span>
      <span class="tok-o">});</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that the original version of <em>onComponentTagBody</em> is invoked only when we want to preserve the standard rendering mechanism for the tag&#8217;s body (in our example this happens when the component is enabled).</p>
</div>
</div>
<div class="sect2">
<h3 id="_removing_stage">Removing stage</h3>
<div class="paragraph">
<p>This stage is triggered when a component is removed from its container hierarchy. The only hook method for this phase is <em>onRemove()</em>. If our component still holds some resources needed during rendering phase, we can override this method to release them.</p>
</div>
<div class="paragraph">
<p>Once a component has been removed we are free to add it again to the same container or to a different one. Starting from version 6.18.0 Wicket added a further hook method called <em>onReAdd()</em> which is triggered every time a previously removed component is re-added to a cointainer.
Please note that while <em>onInitialize</em> is called only the very first time a component is added, <em>onReAdd</em> is called every time it is re-added after having been removed.</p>
</div>
</div>
<div class="sect2">
<h3 id="_summary_4">Summary</h3>
<div class="paragraph">
<p>In this chapter we have seen which stages compose the lifecycle of Wicket components and which hook methods they provide. Overriding these methods we can dynamically modify the component hierarchy and we can enrich the behavior of our custom components.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_page_versioning_and_caching">Page versioning and caching</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This chapter explains how Wicket manages page instances, underlining the difference between stateful and stateless pages. The chapter also introduces some advanced topics like Java Serialization and multi-level cache. However, to understand what you will read you are not required to be familiar with these concepts.</p>
</div>
<div class="sect2">
<h3 id="_stateful_pages_vs_stateless">Stateful pages vs stateless</h3>
<div class="paragraph">
<p>Wicket pages can be divided into two categories: stateful and stateless pages. Stateful pages are those which rely on user session to store their internal state and to keep track of user interaction.
On the contrary stateless pages are those which don&#8217;t change their internal state during their lifecycle and they don&#8217;t need to occupy space into user session.</p>
</div>
<div class="paragraph">
<p>From Wicket&#8217;s point of view the biggest difference between these two types of page is that stateful pages are versioned, meaning that they will be saved into user session every time their internal state has changed. Wicket automatically assigns a session to the user the first time a stateful page is requested. Page versions are stored into user session using Java Serialization mechanism.
Stateless pages are never versioned and that&#8217;s why they don&#8217;t require a valid user session. If we want to know whether a page is stateless or not, we can call the isPageStateless() method of class Page.</p>
</div>
<div class="paragraph">
<p>In order to build a stateless page we must comply with some rules to ensure that the page won&#8217;t need to use user session. These rules are illustrated in paragraph 8.3 but before talking about stateless pages we must first understand how stateful pages are handled and why they are versioned.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stateful_pages">Stateful pages</h3>
<div class="paragraph">
<p>Stateful pages are versioned in order to support browser&#8217;s back button: when this button is pressed Wicket must respond by rendering the same page instance previously used.</p>
</div>
<div class="paragraph">
<p>A new page version is created when a stateful page is requested for the first time or when an existing instance is modified (for example changing its component hierarchy). To identify each page version Wicket uses a session-relative identifier called page id. This is a unique number and it is increased every time a new page version is created.</p>
</div>
<div class="paragraph">
<p>In the final example of the previous chapter (project LifeCycleStages), you may have noticed the number appended at the end of URL. This number is the page id we are talking about:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="page-id.png" alt="page id">
</div>
</div>
<div class="paragraph">
<p>In this chapter we will use a revised version of this example project where the component hierarchy is modified inside the Link&#8217;s onClick()method. This is necessary because Wicket creates a new page version only if the page is modified before its method onBeforeRender() is invoked. The code of the new home page is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span>
<span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-kt">long</span> <span class="tok-n">serialVersionUID</span> <span class="tok-o">=</span> <span class="tok-mi">1L</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">Label</span> <span class="tok-n">firstLabel</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">Label</span> <span class="tok-n">secondLabel</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(){</span>
		<span class="tok-n">firstLabel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;label&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;First label&quot;</span><span class="tok-o">);</span>
		<span class="tok-n">secondLabel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;label&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Second label&quot;</span><span class="tok-o">);</span>

		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">firstLabel</span><span class="tok-o">);</span>

		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Link</span><span class="tok-o">(</span><span class="tok-s">&quot;reload&quot;</span><span class="tok-o">){</span>
			<span class="tok-nd">@Override</span>
			<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">()</span> <span class="tok-o">{</span>
				<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">getPage</span><span class="tok-o">().</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-n">firstLabel</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">))</span>
					<span class="tok-n">getPage</span><span class="tok-o">().</span><span class="tok-na">replace</span><span class="tok-o">(</span><span class="tok-n">secondLabel</span><span class="tok-o">);</span>
				<span class="tok-k">else</span>
					<span class="tok-n">getPage</span><span class="tok-o">().</span><span class="tok-na">replace</span><span class="tok-o">(</span><span class="tok-n">firstLabel</span><span class="tok-o">);</span>
			<span class="tok-o">}</span>
		<span class="tok-o">});</span>

	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now if we run the new example (project LifeCycleStagesRevisited) and we click on the “Reload” button, a new page version is created and the page id is increased by one:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="reload-page.png" alt="reload page">
</div>
</div>
<div class="paragraph">
<p>If we press the back button the page version previously rendered (and serialized) will be retrieved (i.e. deserialized) and it will be used again to respond to our request (and page id is decremented):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="browser-back.png" alt="browser back">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
For more details about page storing you can take a look at paragraph  ge[] toring [] rom chapter  cket[] nternals [] he content of this paragraph is from wiki page <a href="https://cwiki.apache.org/confluence/display/WICKET/Page+Storage">https://cwiki.apache.org/confluence/display/WICKET/Page+Storage</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As we have stated at the beginning of this chapter, page versions are stored using Java serialization, therefore every object referenced inside a page must be serializable. In  <a href="#guide:modelsforms_6">paragraph 11.6</a>
 we will see how to overcome this limit and work with non-serializable objects in our components using detachable Wicket models.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_a_specific_page_version_with_pagereference">Using a specific page version with PageReference</h3>
<div class="paragraph">
<p>To retrieve a specific page version in our code we can use class <em>org.apache.wicket.PageReference</em> by providing its constructor with the corresponding page id:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//load page version with page id = 3</span>
<span class="tok-n">PageReference</span> <span class="tok-n">pageReference</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PageReference</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">);</span>
<span class="tok-c1">//load the related page instance</span>
<span class="tok-n">Page</span> <span class="tok-n">page</span> <span class="tok-o">=</span> <span class="tok-n">pageReference</span><span class="tok-o">.</span><span class="tok-na">getPage</span><span class="tok-o">();</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To get the related page instance we must use the method getPage.</p>
</div>
</div>
<div class="sect2">
<h3 id="_turning_off_page_versioning">Turning off page versioning</h3>
<div class="paragraph">
<p>If for any reason we need to switch off versioning for a given page, we can call its method setVersioned(false).</p>
</div>
</div>
<div class="sect2">
<h3 id="_pluggable_serialization">Pluggable serialization</h3>
<div class="paragraph">
<p>Starting from version 1.5 it is possible to choose which implementation of Java serialization will be used by Wicket to store page versions. Wicket serializes pages using an implementation of interface <em>org.apache.wicket.serialize.ISerializer</em>. The default implementation is <em>org.apache.wicket.serialize.java.JavaSerializer</em> and it uses the standard Java serialization mechanism based on classes ObjectOutputStream and ObjectInputStream. However on Internet we can find other interesting serialization libraries like <a href="https://github.com/EsotericSoftware/kryo">Kryo</a></p>
</div>
<div class="paragraph">
<p>We can access this class inside the method <em>init</em> of the class Application using the getFrameworkSettings() method :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
	<span class="tok-n">getFrameworkSettings</span><span class="tok-o">().</span><span class="tok-na">setSerializer</span><span class="tok-o">(</span><span class="tok-n">yourSerializer</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>A serializer based on Kryo library and another one based on Fast are provided by the WicketStuff project. You can find more information on this project, as well as the instructions to use its modules, in Appendix B.</p>
</div>
</div>
<div class="sect2">
<h3 id="_page_caching">Page caching</h3>
<div class="paragraph">
<p>By default Wicket persists versions of pages into a session-relative file on disk, but it uses a two-levels cache to speed up this process. The first level of the cache uses a http session attribute called “wicket:persistentPageManagerData-&lt;APPLICATION_NAME&gt;” to store pages. The second level cache stores pages into application-scoped variables which are identified by a session id and a page id.</p>
</div>
<div class="paragraph">
<p>The following picture is an overview of these two caching levels:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="wicket-cache.png" alt="wicket cache">
</div>
</div>
<div class="paragraph">
<p>The session-scoped cache is faster then the other memory levels but it contains only the pages used to serve the last request. Wicket allows us to set the maximum amount of memory allowed for the application-scoped cache and for the page store file. Both parameters can be configured via setting class <em>org.apache.wicket.settings.StoreSettings</em>.</p>
</div>
<div class="paragraph">
<p>This interface provides the setMaxSizePerSession(Bytes bytes) method to set the size for page store file. The Bytes parameter is the maximum size allowed for this file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
	<span class="tok-n">getStoreSettings</span><span class="tok-o">().</span><span class="tok-na">setMaxSizePerSession</span><span class="tok-o">(</span><span class="tok-n">Bytes</span><span class="tok-o">.</span><span class="tok-na">kilobytes</span><span class="tok-o">(</span><span class="tok-mi">500</span><span class="tok-o">));</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Class <em>org.apache.wicket.util.lang.Bytes</em> is an utility class provided by Wicket to express size in bytes (for further details refer to the JavaDoc).
For the second level cache we can use the setInmemoryCacheSize(int inmemoryCacheSize) method. The integer parameter is the maximum number of page instances that will be saved into application-scoped cache:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
	<span class="tok-n">getStoreSettings</span><span class="tok-o">().</span><span class="tok-na">setInmemoryCacheSize</span><span class="tok-o">(</span><span class="tok-mi">50</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_page_expiration">Page expiration</h3>
<div class="paragraph">
<p>Page instances are not kept in the user session forever. They can be discarded when the limit set with the setMaxSizePerSession method is reached or (more often) when user session expires. When we ask Wicket for a page id corresponding to a page instance removed from the session, we bump into a  PageExpiredException and we get the following default error page:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="page-expired.png" alt="page expired">
</div>
</div>
<div class="paragraph">
<p>This error page can be customized with the <em>setPageExpiredErrorPage</em> method of class <em>org.apache.wicket.settings.ApplicationSettings</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
	<span class="tok-n">getApplicationSettings</span><span class="tok-o">().</span><span class="tok-na">setPageExpiredErrorPage</span><span class="tok-o">(</span>
				<span class="tok-n">CustomExpiredErrorPage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The page class provided as custom error page must have a public constructor with no argument or a constructor that takes as input a single PageParameters argument (the page must be bookmarkable as described in  <a href="#guide:urls_1">paragraph 10.1.1</a>
).</p>
</div>
</div>
<div class="sect2">
<h3 id="_stateless_pages">Stateless pages</h3>
<div class="paragraph">
<p>Wicket makes it very easy to build stateful pages, but sometimes we might want to use an “old school” stateless page that doesn&#8217;t keep memory of its state in the user session. For example consider the public area of a site or a login page: in those cases a stateful page would be a waste of resources or even a security threat, as we will see in paragraph  <a href="#guide:forms2_10">paragraph 12.10</a>
.</p>
</div>
<div class="paragraph">
<p>In Wicket a page can be stateless only if it satisfies the following requirements:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>it has been instantiated by Wicket (i.e. we don&#8217;t create it with operator new) using a constructor with no argument or a constructor that takes as input a single PageParameters argument (class PageParameters will be covered in  <a href="#guide:urls_1">chapter 10.1</a>
).</p>
</li>
<li>
<p>All its children components (and behaviors) are in turn stateless, which means that their method isStateless must return true.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The first requirement implies that, rather than creating a page by hand, we should rely on Wicket&#8217;s capability of resolving page instances, like we do when we use method setResponsePage(Class page).</p>
</div>
<div class="paragraph">
<p>In order to comply with the second requirement it could be helpful to check if all children components of a page are stateless. To do this we can leverage method visitChildren and the visitor pattern to iterate over components and test if their method isStateless actually returns true:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onInitialize</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onInitialize</span><span class="tok-o">();</span>

		<span class="tok-n">visitChildren</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">IVisitor</span><span class="tok-o">&lt;</span><span class="tok-n">Component</span><span class="tok-o">,</span> <span class="tok-n">Void</span><span class="tok-o">&gt;()</span> <span class="tok-o">{</span>
			<span class="tok-nd">@Override</span>
			<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">component</span><span class="tok-o">(</span><span class="tok-n">Component</span> <span class="tok-n">component</span><span class="tok-o">,</span> <span class="tok-n">IVisit</span><span class="tok-o">&lt;</span><span class="tok-n">Void</span><span class="tok-o">&gt;</span> <span class="tok-n">arg1</span><span class="tok-o">)</span> <span class="tok-o">{</span>
				<span class="tok-k">if</span><span class="tok-o">(!</span><span class="tok-n">component</span><span class="tok-o">.</span><span class="tok-na">isStateless</span><span class="tok-o">())</span>
		  			<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Component &quot;</span> <span class="tok-o">+</span> <span class="tok-n">component</span><span class="tok-o">.</span><span class="tok-na">getId</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot; is not stateless&quot;</span><span class="tok-o">);</span>
			<span class="tok-o">}</span>
		<span class="tok-o">});</span>
	<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively, we could use the <em>StatelessComponent</em> utility annotation along with the <em>StatelessChecker</em> class (they are both in package <em>org.apache.wicket.devutils.stateless</em>). <em>StatelessChecker</em> will throw an <em>IllegalArgumentException</em> if a component annotated with <em>StatelessComponent</em> doesn&#8217;t respect the requirements for being stateless. To use <em>StatelessComponent</em> annotation we must first add the <em>StatelessChecker</em> to our application as a component render listener:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
	<span class="tok-n">getComponentPostOnBeforeRenderListeners</span><span class="tok-o">().</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">StatelessChecker</span><span class="tok-o">());</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Most of the Wicket&#8217;s built-in components are stateful, hence they can not be used with a stateless page. However some of them have also a stateless version which can be adopted when we need to keep a page stateless. In the rest of the guide we will point out when a built-in component comes also with a stateless version.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A page can be also explicitly declared as stateless setting the appropriate flag to true with the setStatelessHint(true) method. This method will not prevent us from violating the requirements for a stateless page, but if we do so we will get the following warning log message:</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
Page <em>&lt;page class&gt;</em> is not stateless because of component with path <em>&lt;component path&gt;</em>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_summary_5">Summary</h3>
<div class="paragraph">
<p>In this chapter we have seen how page instances are managed by Wicket. We have learnt that pages can be divided into two families: stateless and stateful pages. Knowing the difference between the two types of pages is important to build the right page for a given task.</p>
</div>
<div class="paragraph">
<p>However, to complete the discussion about stateless pages we still have to deal with two topics we have just outlined in this chapter: class PageParameters and bookmarkable pages. The first part of  <a href="#guide:urls">chapter 10</a>
 will cover these missing topics.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_under_the_hood_of_the_request_processing">Under the hood of the request processing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Although Wicket was born to provide a reliable and comprehensive object oriented abstraction for web development, sometimes we might need to work directly with “raw” web entities such as user session, web request, query parameters, and so on. For example this is necessary if we want to store an arbitrary parameter in the user session.</p>
</div>
<div class="paragraph">
<p>Wicket provides wrapper classes that allow us to easily access to web entities without the burden of using the low-level APIs of Java Servlet Specification. However it will always be possible to access standard classes (like HttpSession, HttpServletRequest, etc&#8230;) that lay under our Wicket application.
This chapter will introduce these wrapper classes and it will explain how Wicket uses them to handle the web requests initiated by the user&#8217;s browser.</p>
</div>
<div class="sect2">
<h3 id="_class_application_and_request_processing">Class Application and request processing</h3>
<div class="paragraph">
<p>Beside configuring and initializing our application, the Application class is responsible for creating the internal entities used by Wicket to process a request. These entities are instances of the following classes: RequestCycle, Request, Response and Session.</p>
</div>
<div class="paragraph">
<p>The next paragraphs will illustrate each of these classes, explaining how they are involved into request processing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_request_and_response_classes">Request and Response classes</h3>
<div class="paragraph">
<p>The <em>Request</em> and <em>Response</em> classes are located in package <em>org.apache.wicket.request</em> and they provide an abstraction of the concrete request and response used by our web application.</p>
</div>
<div class="paragraph">
<p>Both classes are declared as abstract but if our application class inherits from <em>WebApplication</em> it will use their sub classes <em>ServletWebRequest</em> and <em>ServletWebResponse</em>, both of them located inside the package <em>org.apache.wicket.protocol.http.servlet.ServletWebRequest</em> and <em>ServletWebResponse</em> wrap respectively a <em>HttpServletRequest</em> and a <em>HttpServletResponse</em> object. If we need to access to these low-level objects we can call <em>Request</em>'s method <em>getContainerRequest()</em> and <em>Response</em>'s method <em>getContainerResponse()</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_director_of_request_processing_requestcycle">The “director” of request processing - RequestCycle</h3>
<div class="paragraph">
<p>Class <em>org.apache.wicket.request.cycle.RequestCycle</em> is the entity in charge of serving a web request. Our application class creates a new <em>RequestCycle</em> on every request with its method <em>createRequestCycle(request, response)</em>.</p>
</div>
<div class="paragraph">
<p>Method <em>createRequestCycle</em> is declared as final, so we can&#8217;t override it to return a custom subclass of <em>RequestCycle</em>. Instead, we must build a request cycle provider implementing interface <em>org.apache.wicket.IRequestCycleProvider</em>, and then we must tell our application class to use it via the <em>setRequestCycleProvider</em> method.</p>
</div>
<div class="paragraph">
<p>The current running request cycle can be retrieved at any time by calling its static method <em>RequestCycle.get()</em>. Strictly speaking this method returns the request cycle associated with the current (or local) thread, which is the thread that is serving the current request. A similar <em>get()</em> method is also implemented in classes <em>org.apache.wicket.Application</em> (as we have seen in  <a href="#guide:helloWorld_2">paragraph 4.2.2</a>
) and <em>org.apache.wicket.Session</em> in order to get the application and the session in use by the current thread.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The implementation of the get method takes advantage of the standard class <em>java.lang.ThreadLocal</em>. See its JavaDoc for an introduction to local-thread variables.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Class <em>org.apache.wicket.Component</em> provides the <em>getRequestCycle()</em> method which is a convenience method that internally invokes <em>RequestCycle.get()</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">final</span> <span class="tok-n">RequestCycle</span> <span class="tok-nf">getRequestCycle</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	<span class="tok-k">return</span> <span class="tok-n">RequestCycle</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_requestcycle_and_request_processing">RequestCycle and request processing</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
This paragraph will provide just the basic informations about what happens behind the scenes of request processing. When you work with Wicket it&#8217;s unlikely to have a need for customizing this process, so we won&#8217;t cover this topic in detail.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to process a request, <em>RequestCycle</em> delegates the task to another entity which implements interface <em>org.apache.wicket.request.IRequestHandler</em>. There are different implementations of this interface, each suited for a particular type of requested resource (a page to render, an AJAX request, an URL to an external page, etc.).</p>
</div>
<div class="paragraph">
<p>To resolve the right handler for a given HTTP request, the <em>RequestCycle</em> uses a set of objects implementing the <em>org.apache.wicket.request.IRequestMapper</em> interface. The mapping interface defines the <em>getCompatibilityScore(Request request)</em> method which returns a score indicating how compatible the request mapper is for the current request. <em>RequestCycle</em> will choose the mapper with the highest score and it will call its <em>mapRequest(Request request)</em> method to get the proper handler for the given request. Once <em>RequestCycle</em> has resolved a request handler, it invokes its method <em>respond(IRequestCycle requestCycle)</em> to start request processing.</p>
</div>
<div class="paragraph">
<p>The following sequence diagram recaps how a request handler is resolved by the <em>RequestCycle</em>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="request-cycle-handler.png" alt="request cycle handler">
</div>
</div>
<div class="paragraph">
<p>Developers can create additional implementations of IRequestMapper and add them to their application via the mount(IRequestMapper mapper) method of the WebApplication class. In paragraph 10.6 we will see how Wicket uses this method to add built-in mappers for mounted pages.</p>
</div>
</div>
<div class="sect2">
<h3 id="_generating_url_with_the_urlfor_and_mapurlfor_methods">Generating URL with the urlFor and mapUrlFor methods</h3>
<div class="paragraph">
<p>The RequestCycle is also responsible for generating the URL value (as CharSequence) for the following entities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a page class, via the <em>urlFor(Class&lt;C&gt; pageClass, PageParameters parameters)</em> method</p>
</li>
<li>
<p>an IRequestHandler via the <em>urlFor(IRequestHandler handler)</em> method</p>
</li>
<li>
<p>a ResourceReference via the <em>urlFor(ResourceReference reference, PageParameters params)</em> method (resource entities will be introduced in  <a href="#guide:resources">chapter 19</a>
).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The overloaded <em>urlFor</em> method from above also has a corresponding version that returns an instance of <em>org.apache.wicket.request.Url</em> instead of a <em>CharSequence</em>. This version has the prefix <em>map</em> in its name (i.e. it has <em>mapUrlFor</em> as full name).</p>
</div>
</div>
<div class="sect2">
<h3 id="_method_setresponsepage">Method setResponsePage</h3>
<div class="paragraph">
<p>The <em>RequestCycle</em> class contains the implementation of the <em>setResponsePage</em> method we use to redirect a user to a specific page (see  <a href="#guide:helloWorld_4">paragraph 4.4</a>
). The namesake method of class <em>org.apache.wicket.Component</em> is just a convenience method that internally invokes the actual implementation on current request cycle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">final</span> <span class="tok-kt">void</span> <span class="tok-nf">setResponsePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">Page</span> <span class="tok-n">page</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-n">getRequestCycle</span><span class="tok-o">().</span><span class="tok-na">setResponsePage</span><span class="tok-o">(</span><span class="tok-n">page</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_requestcycle_s_hook_methods_and_listeners">RequestCycle&#8217;s hook methods and listeners</h3>
<div class="paragraph">
<p>The RequestCycle comes with some hook methods which can be overridden to perform custom actions when request handling reaches a specific stage. These methods are:
* <strong>onBeginRequest():</strong> called when the RequestCycle is about to start handling the request.
* <strong>onEndRequest():</strong> called when the RequestCycle has finished to handle the request
* <strong>onDetach():</strong> called after the request handling has completed and the RequestCycle is about to be detached from its thread. The default implementation of this method invokes detach() on the current session (the Session class will be shortly discussed in paragraph 9.4).</p>
</div>
<div class="paragraph">
<p>Methods onBeforeRequest and onEndRequest can be used if we need to execute custom actions before and after business code is executed, such as opening a Hibernate/JPA session and closing it when code has terminated.</p>
</div>
<div class="paragraph">
<p>A more flexible way to interact with the request processing is to use the listener interface <em>org.apache.wicket.request.cycle.IRequestCycleListener</em>. In addition to the three methods already seen for RequestCycle, this interface offers further hooks into request processing:
* <strong>onBeginRequest(RequestCycle cycle):</strong> (see the description above)
* <strong>onEndRequest(RequestCycle cycle):</strong> (see the description above)
* <strong>onDetach(RequestCycle cycle):</strong> (see the description above)
* <strong>onRequestHandlerResolved(RequestCycle cycle, IRequestHandler handler):</strong> called when an IRequestHandler has been resolved.
* <strong>onRequestHandlerScheduled(RequestCycle cycle, IRequestHandler handler):</strong> called when an IRequestHandler has been scheduled for execution.
* <strong>onRequestHandlerExecuted(RequestCycle cycle, IRequestHandler handler):</strong> called when an IRequestHandler has been executed.
* <strong>onException(RequestCycle cycle, Exception ex):</strong> called when an exception has been thrown during request processing.
* <strong>onExceptionRequestHandlerResolved(RequestCycle rc, IRequestHandler rh, Exception ex):</strong> called when an IRequestHandler has been resolved and will be used to handle an exception.
* <strong>onUrlMapped(RequestCycle cycle, IRequestHandler handler, Url url):</strong> called when an URL has been generated for an IRequestHandler object.</p>
</div>
<div class="paragraph">
<p>To use the request cycle listeners we must add them to our application which in turn will pass them to the new <em>RequestCycle</em>'s instances created with <em>createRequestCycle</em> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span> <span class="tok-o">{</span>

	<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>

	<span class="tok-n">IRequestCycleListener</span> <span class="tok-n">myListener</span><span class="tok-o">;</span>
	<span class="tok-c1">//listener initialization...</span>
	<span class="tok-n">getRequestCycleListeners</span><span class="tok-o">().</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">myListener</span><span class="tok-o">)</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>getRequestCycleListeners</em> method returns an instance of class <em>org.apache.wicket.request.cycle.RequestCycleListenerCollection</em>. This class is a sort of typed collection for <em>IRequestCycleListener</em> and it also implements the  mposite[guide:helloWorld_4] wikipedia.org/wiki/Composite_pattern .</p>
</div>
</div>
<div class="sect2">
<h3 id="_session_class">Session Class</h3>
<div class="paragraph">
<p>In Wicket we use class <em>org.apache.wicket.Session</em> to handle session-relative informations such as client informations, session attributes, session-level cache (seen in paragraph 8.2), etc&#8230;</p>
</div>
<div class="paragraph">
<p>In addition, we know from paragraph 8.1 that Wicket creates a user session to store versions of stateful pages. Similarly to what happens with RequestCycle, the new Session&#8217;s instances are generated by the <em>Application</em> class with the <em>newSession(Request request, Response response)</em> method. This method is not declared as final, hence it can be overridden if we need to use a custom implementation of the Session class.</p>
</div>
<div class="paragraph">
<p>By default if our custom application class is a subclass of WebApplication, method newSession will return an instance of class <em>org.apache.wicket.protocol.http.WebSession</em>. As we have mentioned talking about <em>RequestCycle</em>, also class Session provides a static <em>get()</em> method which returns the session associated to the current thread.</p>
</div>
</div>
<div class="sect2">
<h3 id="_session_and_listeners">Session and listeners</h3>
<div class="paragraph">
<p>Similar to the <em>RequestCycle</em>, class <em>org.apache.wicket.Session</em> also offers support for listener entities. With Session these entities must implement the callback interface <em>org.apache.wicket.ISessionListener</em> which exposes only the <em>onCreated(Session session)</em> method. As you might guess from its name, this method is called when a new session is created. Session listeners must be added to our application using a typed collection, just like we have done before with request cycle listeners:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">(){</span>

	<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>

	<span class="tok-c1">//listener initialization...</span>
	<span class="tok-n">ISessionListener</span> <span class="tok-n">myListener</span><span class="tok-o">;</span>
	<span class="tok-c1">//add a custom session listener</span>
	<span class="tok-n">getSessionListeners</span><span class="tok-o">().</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">myListener</span><span class="tok-o">)</span>

<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_handling_session_attributes">Handling session attributes</h3>
<div class="paragraph">
<p>The Session class handles session attributes in much the same way as the standard interface javax.servlet.http.HttpSession. The following methods are provided to create, read and remove session attributes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>setAttribute(String name, Serializable value):</strong> creates an attribute identified by the given name. If the session already contains an attribute with the same name, the new value will replace the existing one. The value must be a serializable object.</p>
</li>
<li>
<p><strong>getAttribute(String name):</strong> returns the value of the attribute identified by the given name, or null if the name does not correspond to any attribute.</p>
</li>
<li>
<p><strong>removeAttribute(String name):</strong> removes the attribute identified by the given name.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>By default class WebSession will use the underlying HTTP session to store attributes. Wicket will automatically add a prefix to the name of the attributes. This prefix is returned by the WebApplication&#8217;s method getSessionAttributePrefix().</p>
</div>
</div>
<div class="sect2">
<h3 id="_accessing_to_the_http_session">Accessing to the HTTP session</h3>
<div class="paragraph">
<p>If for any reason we need to directly access to the underlying HttpSession object, we can retrieve it from the current request with the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">HttpSession</span> <span class="tok-n">session</span> <span class="tok-o">=</span> <span class="tok-o">((</span><span class="tok-n">ServletWebRequest</span><span class="tok-o">)</span><span class="tok-n">RequestCycle</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">()</span>
		<span class="tok-o">.</span><span class="tok-na">getRequest</span><span class="tok-o">()).</span><span class="tok-na">getContainerRequest</span><span class="tok-o">().</span><span class="tok-na">getSession</span><span class="tok-o">();</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using the raw session object might be necessary if we have to set a session attribute with a particular name without the prefix added by Wicket. Let&#8217;s say for example that we are working with Tomcat as web server. One of the administrative tools provided by Tomcat is a page listing all the active user sessions of a given web application:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="tomcat-admin-sessions.png" alt="tomcat admin sessions">
</div>
</div>
<div class="paragraph">
<p>Tomcat allows us to set the values that will be displayed in columns “Guessed locale” and “Guessed User name”. One possible way to do this is to use session attributes named “Locale” and “userName” but we can&#8217;t create them via Wicket&#8217;s Session class because they would not have exactly the name required by Tomcat. Instead, we must use the raw HttpSession and set our attributes on it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">HttpSession</span> <span class="tok-n">session</span> <span class="tok-o">=</span> <span class="tok-o">((</span><span class="tok-n">ServletWebRequest</span><span class="tok-o">)</span><span class="tok-n">RequestCycle</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span>
		<span class="tok-n">getRequest</span><span class="tok-o">()).</span><span class="tok-na">getContainerRequest</span><span class="tok-o">().</span><span class="tok-na">getSession</span><span class="tok-o">();</span>

<span class="tok-n">session</span><span class="tok-o">.</span><span class="tok-na">setAttribute</span><span class="tok-o">(</span><span class="tok-s">&quot;Locale&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;ENGLISH&quot;</span><span class="tok-o">);</span>
<span class="tok-n">session</span><span class="tok-o">.</span><span class="tok-na">setAttribute</span><span class="tok-o">(</span><span class="tok-s">&quot;userName&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Mr BadGuy&quot;</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_temporary_and_permanent_sessions">Temporary and permanent sessions</h3>
<div class="paragraph">
<p>Wicket doesn&#8217;t need to store data into user session as long as the user visits only stateless pages. Nonetheless, even under these conditions, a temporary session object is created to process each request but it is discarded at the end of the current request. To know if the current session is temporary, we can use the isTemporary() method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Session</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">isTemporary</span><span class="tok-o">();</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a session is not temporary (i.e. it is permanent), it&#8217;s identified by an unique id which can be read calling the getId() method. This value will be null if the session is temporary.</p>
</div>
<div class="paragraph">
<p>Although Wicket is able to automatically recognize when it needs to replace a temporary session with a permanent one, sometimes we may need to manually control this process to make our initially temporary session permanent.</p>
</div>
<div class="paragraph">
<p>To illustrate this possible scenario let&#8217;s consider project BindSessionExample where we have a stateless home page which sets a session attribute inside its constructor and then it redirects the user to another page which displays with a label the session attribute previously created. The code of the two pages is as follows:</p>
</div>
<div class="paragraph">
<p>Home page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    	<span class="tok-n">Session</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">setAttribute</span><span class="tok-o">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;tommy&quot;</span><span class="tok-o">);</span>
	<span class="tok-n">Session</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">bind</span><span class="tok-o">();</span>

	<span class="tok-n">setResponsePage</span><span class="tok-o">(</span><span class="tok-n">DisplaySessionParameter</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Target page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">DisplaySessionParameter</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>

	<span class="tok-kd">public</span> <span class="tok-nf">DisplaySessionParameter</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	   <span class="tok-kd">super</span><span class="tok-o">();</span>
	   <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-o">,</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span> <span class="tok-n">Session</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">getAttribute</span><span class="tok-o">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-o">)));</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Again, we kept page logic very simple to not over-bloat the example with unnecessary code. In the snippet above we have also bolded Session&#8217;s bind() method which converts temporary session into a permanent one. If the home page has not invoked this method, the session with its attribute would have been discarded at the end of the request and the page DisplaySessionParameter would have displayed an empty value in its label.</p>
</div>
</div>
<div class="sect2">
<h3 id="_discarding_session_data">Discarding session data</h3>
<div class="paragraph">
<p>Once a user has finished using our web application, she must be able to log out and clean any session data. To be sure that a permanent session will be discarded at the end of the current request, class Session provides the invalidate() method. If we want to immediately invalidate a given session without waiting for the current request to complete, we can invoke the invalidateNow() method.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
Remember that invalidateNow() will immediately remove any instance of components (and pages) from the session, meaning that once we have called this method we won&#8217;t be able to work with them for the rest of the request process.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_storing_arbitrary_objects_with_metadata">Storing arbitrary objects with metadata</h3>
<div class="paragraph">
<p>JavaServer Pages Specification1 defines 4 scopes in which a page can create and access a variable. These scopes are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>request:</strong> variables declared in this scope can be seen only by pages processing the same request. The lifespan of these variables is (at most) equal to the one of the related request. They are discarded when the full response has been generated or when the request is forwarded somewhere else.</p>
</li>
<li>
<p><strong>page:</strong> variables declared in this scope can be seen only by the page that has created them.</p>
</li>
<li>
<p><strong>session:</strong> variables in session scope can be created and accessed by every page used in the same session where they are defined.</p>
</li>
<li>
<p><strong>application:</strong> this is the widest scope. Variables declared in this scope can be used by any page of a given web application.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Although Wicket doesn&#8217;t implement the JSP Specification (it is rather an alternative to it), it offers a feature called metadata which resembles scoped variables but is much more powerful. Metadata is quite similar to a Java Map in that it stores pairs of key-value objects where the key must be unique. In Wicket each of the following classes has its own metadata store: RequestCycle, Session, Application and Component.</p>
</div>
<div class="paragraph">
<p>The key used for metadata is an instance of class <em>org.apache.wicket.MetaDataKey&lt;T&gt;</em>. To put an arbitrary object into metadata we must use the setMetaData method which takes two parameters as input: the key used to store the value and the value itself. If we are using metadata with classes Session or Component, data object must be serializable because Wicket serializes both session and component instances. This constraint is not applied to metadata of classes Application and RequestCycle which can contain a generic object. In any case, the type of data object must be compatible with the type parameter T specified by the key.</p>
</div>
<div class="paragraph">
<p>To retrieve a previously inserted object we must use the <em>getMetaData(MetaDataKey&lt;T&gt; key)</em> method. In the following example we set a <em>java.sql.Connection</em> object in the application&#8217;s metadata so it can be used by any page of the application:</p>
</div>
<div class="paragraph">
<p>Application class code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">MetaDataApp</span> <span class="tok-kd">extends</span> <span class="tok-n">WebApplication</span><span class="tok-o">{</span>
	<span class="tok-c1">//Do some stuff...</span>
	<span class="tok-cm">/**</span>
<span class="tok-cm">	* Metadata key definition</span>
<span class="tok-cm">	*/</span>
	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">MetaDataKey</span><span class="tok-o">&lt;</span><span class="tok-n">Connection</span><span class="tok-o">&gt;</span> <span class="tok-n">connectionKey</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">MetaDataKey</span><span class="tok-o">&lt;</span><span class="tok-n">Connection</span><span class="tok-o">&gt;</span> <span class="tok-o">(){};</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Application&#39;s initialization</span>
<span class="tok-cm">	 */</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">(){</span>

		<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
		<span class="tok-n">Connection</span> <span class="tok-n">connection</span><span class="tok-o">;</span>
		<span class="tok-c1">//connection initialization...</span>
		<span class="tok-n">setMetaData</span><span class="tok-o">(</span><span class="tok-n">connectionKey</span><span class="tok-o">,</span> <span class="tok-n">connection</span><span class="tok-o">);</span>
		<span class="tok-c1">//Do some other stuff..</span>

	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Code to get the object from the metadata:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Connection</span> <span class="tok-n">connection</span> <span class="tok-o">=</span> <span class="tok-n">Application</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">getMetaData</span><span class="tok-o">(</span><span class="tok-n">MetaDataApp</span><span class="tok-o">.</span><span class="tok-na">connectionKey</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since MetaDataKey&lt;T&gt; class is declared as abstract, we must implement it with a subclass or with an anonymous class (like we did in the example above).</p>
</div>
</div>
<div class="sect2">
<h3 id="_exception_handling">Exception handling</h3>
<div class="paragraph">
<p>Wicket uses a number of custom exceptions during the regular running of an application. We have already seen <em>PageExpiredException</em> raised when a page version is expired. Other examples of such exceptions are <em>AuthorizationException</em> and <em>RestartResponseException</em>. We will see them later in the next chapters.
All the other exceptions raised during rendering phase are handled by an implementation of <em>org.apache.wicket.request.IExceptionMapper</em> which by default is class <em>org.apache.wicket.DefaultExceptionMapper</em>. If we are working in DEVELOPMENT mode this mapper will redirect us to a page that shows the exception stacktrace (page <em>ExceptionErrorPage</em>). On the contrary, if application is running in DEPLOYMENT mode <em>DefaultExceptionMapper</em> will display an internal error page which by default is <em>org.apache.wicket.markup.html.pages.InternalErrorPage</em>.
To use a custom internal error page we can change application settings like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">getApplicationSettings</span><span class="tok-o">().</span><span class="tok-na">setInternalErrorPage</span><span class="tok-o">(</span><span class="tok-n">MyInternalErrorPage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also manually set if Wicket should display the exception with <em>ExceptionErrorPage</em> or if we want to use the internal error page or if we don&#8217;t want to display anything at all when an unexpected exception is thrown:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//show default developer page</span>
<span class="tok-n">getExceptionSettings</span><span class="tok-o">().</span><span class="tok-na">setUnexpectedExceptionDisplay</span><span class="tok-o">(</span> <span class="tok-n">ExceptionSettings</span><span class="tok-o">.</span><span class="tok-na">SHOW_EXCEPTION_PAGE</span> <span class="tok-o">);</span>
<span class="tok-c1">//show internal error page</span>
<span class="tok-n">getExceptionSettings</span><span class="tok-o">().</span><span class="tok-na">setUnexpectedExceptionDisplay</span><span class="tok-o">(</span> <span class="tok-n">ExceptionSettings</span><span class="tok-o">.</span><span class="tok-na">SHOW_INTERNAL_ERROR_PAGE</span> <span class="tok-o">);</span>
<span class="tok-c1">//show no exception page when an unexpected exception is thrown</span>
<span class="tok-n">getExceptionSettings</span><span class="tok-o">().</span><span class="tok-na">setUnexpectedExceptionDisplay</span><span class="tok-o">(</span> <span class="tok-n">ExceptionSettings</span><span class="tok-o">.</span><span class="tok-na">SHOW_NO_EXCEPTION_PAGE</span> <span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Developers can also decide to use a custom exception mapper instead of <em>DefaultExceptionMapper</em>. To do this we must override <em>Application</em>'s method <em>getExceptionMapperProvider</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-n">IProvider</span><span class="tok-o">&lt;</span><span class="tok-n">IExceptionMapper</span><span class="tok-o">&gt;</span> <span class="tok-nf">getExceptionMapperProvider</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
    <span class="tok-c1">//...</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The method returns an instance of <em>org.apache.wicket.util.IProvider</em> that should return our custom exception mapper.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ajax_requests">Ajax requests</h3>
<div class="paragraph">
<p>To control the behavior in Ajax requests the application may use <em>org.apache.wicket.settings.ExceptionSettings1.  setAjaxErrorHandlingStrategy(ExceptionSettings.AjaxErrorStrategy)</em>. By default if an error occurs during the
processing of an Ajax request Wicket will render the configured error page. By configuring <em>org.apache.wicket.settings.ExceptionSettings.  AjaxErrorStrategy1.INVOKE_FAILURE_HANDLER</em> as the default strategy the application will call the JavaScript <em>onFailure</em> callback(s) instead.</p>
</div>
</div>
<div class="sect2">
<h3 id="_summary_6">Summary</h3>
<div class="paragraph">
<p>In this chapter we had a look at how Wicket internally handles a web request. Even if most of the time  we won&#8217;t need to customize this internal process, knowing how it works is essential to use the framework at 100%.</p>
</div>
<div class="paragraph">
<p>Entities like Application and Session will come in handy again when we will tackle the topic of security in  <a href="#guide:security">chapter 23</a>
.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wicket_links_and_url_generation">Wicket Links and URL generation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Up to now we used component Link to move from a page to another and we have seen that it is quiet similar to a “click” event handler (see  <a href="#guide:helloWorld_4">paragraph 4.4</a>
).</p>
</div>
<div class="paragraph">
<p>However this component alone is not enough to build all possible kinds of links we may need in our pages. Therefore, Wicket offers other link components suited for those tasks which can not be accomplished with a basic Link.</p>
</div>
<div class="paragraph">
<p>Besides learning new link components, in this chapter we will also see how to customize the page URL generated by Wicket using the encoding facility provided by the framework and the page parameters that can be passed to a target page.</p>
</div>
<div class="sect2">
<h3 id="_pageparameters">PageParameters</h3>
<div class="paragraph">
<p>A common practice in web development is to pass data to a page using query string parameters (like ?paramName1=paramValu1&amp;paramName2=paramValue2&#8230;). Wicket offers a more flexible and object oriented way to do this with models (we will see them in the next chapter). However, even if we are using Wicket, we still need to use query string parameters to exchange data with other Internet-based services. Consider for example a classic confirmation page which is linked inside an email to let users confirm important actions like password changing or the subscription to a mailing list. This kind of page usually expects to receive a query string parameter containing the id of the action to confirm.</p>
</div>
<div class="paragraph">
<p>Query string parameters can also be referred to as named parameters. In Wicket they are handled with class <em>org.apache.wicket.request.mapper.parameter.PageParameters</em>. Since named parameters are basically name-value pairs, PageParameters works in much the same way as Java Map providing two methods to create/modify a parameter (add(String name, Object value) and set(String name, Object value)),  one method to remove an existing parameter (remove(String name)) and one to retrieve the value of a given parameter (get(String name)) . Here is a snippet to illustrate the usage of PageParameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">PageParameters</span> <span class="tok-n">pageParameters</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PageParameters</span><span class="tok-o">();</span>
<span class="tok-c1">//add a couple of parameters</span>
<span class="tok-n">pageParameters</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;name&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;John&quot;</span><span class="tok-o">);</span>
<span class="tok-n">pageParameters</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;age&quot;</span><span class="tok-o">,</span> <span class="tok-mi">28</span><span class="tok-o">);</span>
<span class="tok-c1">//retrieve the value of &#39;age&#39; parameter</span>
<span class="tok-n">pageParameters</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s">&quot;age&quot;</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we have seen how to work with page parameters, let&#8217;s see how to use them with our pages.</p>
</div>
</div>
<div class="sect2">
<h3 id="_pageparameters_and_bookmarkable_pages">PageParameters and bookmarkable pages</h3>
<div class="paragraph">
<p>Base class Page comes with a constructor which takes as input a PageParameters instance. If we use this superclass constructor in our page, PageParameters will be used to build the page URL and it can be retrieved at a later time with the Page&#8217;s getPageParameters() method.</p>
</div>
<div class="paragraph">
<p>In the following example taken from the PageParametersExample project we have a home page with a link to a second page that uses a version of setResponsePage method that takes as input also a PageParameters to build the target page (named PageWithParameters). The code for the link and for the target page is the following:</p>
</div>
<div class="paragraph">
<p>Link code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Link</span><span class="tok-o">(</span><span class="tok-s">&quot;pageWithIndexParam&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">()</span> <span class="tok-o">{</span>

		<span class="tok-n">PageParameters</span> <span class="tok-n">pageParameters</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PageParameters</span><span class="tok-o">();</span>
		<span class="tok-n">pageParameters</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;foo&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;foo&quot;</span><span class="tok-o">);</span>
		<span class="tok-n">pageParameters</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;bar&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;bar&quot;</span><span class="tok-o">);</span>

		<span class="tok-n">setResponsePage</span><span class="tok-o">(</span><span class="tok-n">PageWithParameters</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">pageParameters</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

<span class="tok-o">});</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Target page code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PageWithParameters</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
	<span class="tok-c1">//Override superclass constructor</span>
	<span class="tok-kd">public</span> <span class="tok-nf">PageWithParameters</span><span class="tok-o">(</span><span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">parameters</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
 <span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code is quite straightforward and it’s more interesting to look at the URL generated for the target page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;app</span> <span class="tok-na">root</span><span class="tok-nt">&gt;</span>/PageParametersExample/wicket/bookmarkable/
		org.wicketTutorial.PageWithParameters?foo=foo<span class="tok-err">&amp;</span>bar=bar
</code></pre>
</div>
</div>
<div class="paragraph">
<p>At first glance the URL above could seem a little weird, except for the last part which contains the two named parameters used to build the target page.</p>
</div>
<div class="paragraph">
<p>The reason for this “strange” URL is that, as we explained in paragraph 8.3, when a page is instantiated using a constructor with no argument or using a constructor that accepts only a PageParameters, Wicket will try to generate a static URL for it, with no session-relative informations. This kind of URL is called bookmarkable because it can be saved by the users as a bookmark and accessed at a later time.</p>
</div>
<div class="paragraph">
<p>A bookmarkable URL is composed by a fixed prefix (which by default is bookmarkable) and the qualified name of the page class (org.wicketTutorial.PageWithParameters in our example). Segment wicket is another fixed prefix added by default during URL generation. In paragraph 10.6 we will see how to customize fixed prefixes with a custom implementation of IMapperContext interface.</p>
</div>
</div>
<div class="sect2">
<h3 id="_indexed_parameters">Indexed parameters</h3>
<div class="paragraph">
<p>Besides named parameters, Wicket also supports indexed parameters. These kinds of parameters are rendered as URL segments placed before named parameters. Let&#8217;s consider for example the following URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;application</span> <span class="tok-na">path</span><span class="tok-nt">&gt;</span>/foo/bar?1<span class="tok-err">&amp;</span>baz=baz
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The URL above contains two indexed parameters (foo and bar) and a query string consisting of the page id and a named parameter (baz). Just like named parameters also indexed parameters are handled by the PageParameters class. The methods provided by PageParameters for indexed parameters are set(int index, Object object) (to add/modify a parameter), remove(int index)(to remove a parameter) and get(int index) (to read a parameter).</p>
</div>
<div class="paragraph">
<p>As their name suggests, indexed parameters are identified by a numeric index and they are rendered following the order in which they have been added to the PageParameters. The following is an example of indexed parameters:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">PageParameters</span> <span class="tok-n">pageParameters</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PageParameters</span><span class="tok-o">();</span>
<span class="tok-c1">//add a couple of parameters</span>
<span class="tok-n">pageParameters</span><span class="tok-o">.</span><span class="tok-na">set</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-s">&quot;foo&quot;</span><span class="tok-o">);</span>
<span class="tok-n">pageParameters</span><span class="tok-o">.</span><span class="tok-na">set</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-s">&quot;bar&quot;</span><span class="tok-o">);</span>
<span class="tok-c1">//retrieve the value of the second parameter (&quot;bar&quot;)</span>
<span class="tok-n">pageParameters</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Project PageParametersExample comes also with a link to a page with both indexed parameters and a named parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Link</span><span class="tok-o">(</span><span class="tok-s">&quot;pageWithNamedIndexParam&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>

	<span class="tok-nd">@Override</span>
 	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">()</span> <span class="tok-o">{</span>

		<span class="tok-n">PageParameters</span> <span class="tok-n">pageParameters</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PageParameters</span><span class="tok-o">();</span>
		<span class="tok-n">pageParameters</span><span class="tok-o">.</span><span class="tok-na">set</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">,</span> <span class="tok-s">&quot;foo&quot;</span><span class="tok-o">);</span>
		<span class="tok-n">pageParameters</span><span class="tok-o">.</span><span class="tok-na">set</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">,</span> <span class="tok-s">&quot;bar&quot;</span><span class="tok-o">);</span>
		<span class="tok-n">pageParameters</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;baz&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;baz&quot;</span><span class="tok-o">);</span>

		<span class="tok-n">setResponsePage</span><span class="tok-o">(</span><span class="tok-n">PageWithParameters</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">pageParameters</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

<span class="tok-o">});</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The URL generated for the linked page (PageWithParameters) is the one seen at the beginning of the paragraph.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bookmarkable_links">Bookmarkable links</h3>
<div class="paragraph">
<p>A link to a bookmarkable page can be built with the link component <em>org.apache.wicket.markup.html.link.BookmarkablePageLink</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">BookmarkablePageLink</span> <span class="tok-n">bpl</span><span class="tok-o">=</span><span class="tok-k">new</span> <span class="tok-n">BookmarkablePageLink</span><span class="tok-o">(</span><span class="tok-n">PageWithParameters</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">pageParameters</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The specific purpose of this component is to provide an anchor to a bookmarkable page, hence we don&#8217;t have to implement any abstract method like we do with Link component.</p>
</div>
</div>
<div class="sect2">
<h3 id="_automatically_creating_bookmarkable_links_with_tag_wicket_link">Automatically creating bookmarkable links with tag wicket:link</h3>
<div class="paragraph">
<p>Bookmarkable pages can be linked directly inside markup files without writing any Java code. Using &lt;wicket:link&gt; tag we ask Wicket to automatically add bookmarkable links for the anchors wrapped inside it. Here is an example of usage of &lt;wicket:link&gt; tag taken from the home page of the project BookmarkablePageAutoLink:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">xmlns:wicket=</span><span class="tok-s">&quot;http://wicket.apache.org&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;head&gt;</span>
		<span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;title&gt;</span>Apache Wicket Quickstart<span class="tok-nt">&lt;/title&gt;</span>
	<span class="tok-nt">&lt;/head&gt;</span>
	<span class="tok-nt">&lt;body&gt;</span>
	   <span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;bd&quot;</span><span class="tok-nt">&gt;</span>
	      <span class="tok-nt">&lt;wicket:link&gt;</span>
			<span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;HomePage.html&quot;</span><span class="tok-nt">&gt;</span>HomePage<span class="tok-nt">&lt;/a&gt;&lt;br/&gt;</span>
			<span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;anotherPackage/SubPackagePage.html&quot;</span><span class="tok-nt">&gt;</span>SubPackagePage<span class="tok-nt">&lt;/a&gt;</span>
	      <span class="tok-nt">&lt;/wicket:link&gt;</span>
	   <span class="tok-nt">&lt;/div&gt;</span>
	<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The key part of the markup above is the href attribute which must contain the package-relative path to a page. The home page is inside package org.wicketTutorial which in turns contains the sub package anotherPackage. This package hierarchy is reflected by the href attributes: in the first anchor we have a link to the home page itself while the second anchor points to page SubPackagePage which is placed into sub package anotherPackage. Absolute paths are supported as well and we can use them if we want to specify the full package of a given page. For example the link to SubPackagePage could have been written in the following (more verbose) way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;/org/wicketTutorial/anotherPackage/SubPackagePage.html&quot;</span><span class="tok-nt">&gt;</span> SubPackagePage<span class="tok-nt">&lt;/a&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we take a look also at the markup of SubPackagePage we can see that it contains a link to the home page which uses the parent directory selector (relative path):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-cp">&lt;!DOCTYPE html&gt;</span>
<span class="tok-nt">&lt;html</span> <span class="tok-na">xmlns:wicket=</span><span class="tok-s">&quot;http://wicket.apache.org&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;head&gt;</span>
		<span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;title&gt;</span>Apache Wicket Quickstart<span class="tok-nt">&lt;/title&gt;</span>
	<span class="tok-nt">&lt;/head&gt;</span>
	<span class="tok-nt">&lt;body&gt;</span>
		<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;bd&quot;</span><span class="tok-nt">&gt;</span>
			<span class="tok-nt">&lt;wicket:link&gt;</span>
				<span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;../HomePage.html&quot;</span><span class="tok-nt">&gt;</span>HomePage<span class="tok-nt">&lt;/a&gt;&lt;br/&gt;</span>
				<span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;SubPackagePage.html&quot;</span><span class="tok-nt">&gt;</span>SubPackagePage<span class="tok-nt">&lt;/a&gt;</span>
			<span class="tok-nt">&lt;/wicket:link&gt;</span>
		<span class="tok-nt">&lt;/div&gt;</span>
	<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that any link to the current page (aka self link) is disabled. For example in the home page the self link is rendered like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;span&gt;&lt;em&gt;</span>HomePage<span class="tok-nt">&lt;/em&gt;&lt;/span&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The markup used to render disabled links can be customized using the markup settings (class org.apache.wicket.settings.MarkupSettings) available in the application class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
	<span class="tok-c1">//wrap disabled links with &lt;b&gt; tag</span>
	<span class="tok-n">getMarkupSettings</span><span class="tok-o">().</span><span class="tok-na">setDefaultBeforeDisabledLink</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;b&gt;&quot;</span><span class="tok-o">);</span>
	<span class="tok-n">getMarkupSettings</span><span class="tok-o">().</span><span class="tok-na">setDefaultAfterDisabledLink</span><span class="tok-o">(</span><span class="tok-s">&quot;&lt;/b&gt;&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The purpose of &lt;wicket:link&gt; tag is not limited to just simplifying the usage of bookmarkable pages. As we will see in chapter 13, this tag can also be adopted to manage web resources like pictures, CSS files, JavaScript files and so on.</p>
</div>
</div>
<div class="sect2">
<h3 id="_external_links">External links</h3>
<div class="paragraph">
<p>Since Wicket uses plain HTML markup files as templates, we can place an anchor to an external page directly inside the markup file. When we need to dynamically generate external anchors, we can use link component <em>org.apache.wicket.markup.html.link.ExternalLink</em>. In order to build an external link we must specify the value of the href attribute using a model or a plain string. In the next snippet, given an instance of Person, we generate a Google search query for its full name:</p>
</div>
<div class="paragraph">
<p>Html:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;a</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;externalSite&quot;</span><span class="tok-nt">&gt;</span>Search me on Google!<span class="tok-nt">&lt;/a&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Person</span> <span class="tok-n">person</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;John&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Smith&quot;</span><span class="tok-o">);</span>
<span class="tok-n">String</span> <span class="tok-n">fullName</span> <span class="tok-o">=</span> <span class="tok-n">person</span><span class="tok-o">.</span><span class="tok-na">getFullName</span><span class="tok-o">();</span>
<span class="tok-c1">//Space characters must be replaced by character &#39;+&#39;</span>
<span class="tok-n">String</span> <span class="tok-n">googleQuery</span> <span class="tok-o">=</span> <span class="tok-s">&quot;http://www.google.com/search?q=&quot;</span> <span class="tok-o">+</span> <span class="tok-n">fullName</span><span class="tok-o">.</span><span class="tok-na">replace</span><span class="tok-o">(</span><span class="tok-s">&quot; &quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;+&quot;</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ExternalLink</span><span class="tok-o">(</span><span class="tok-s">&quot;externalSite&quot;</span><span class="tok-o">,</span> <span class="tok-n">googleQuery</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generated anchor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;http://www.google.com/search?q=John+Smith&quot;</span><span class="tok-nt">&gt;</span>Search me on Google!<span class="tok-nt">&lt;/a&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we need to specify a dynamic value for the text inside the anchor, we can pass it as an additional constructor parameter:</p>
</div>
<div class="paragraph">
<p>Html:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;a</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;externalSite&quot;</span><span class="tok-nt">&gt;</span>Label goes here...<span class="tok-nt">&lt;/a&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Person</span> <span class="tok-n">person</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;John&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Smith&quot;</span><span class="tok-o">);</span>
<span class="tok-n">String</span> <span class="tok-n">fullName</span> <span class="tok-o">=</span> <span class="tok-n">person</span><span class="tok-o">.</span><span class="tok-na">getFullName</span><span class="tok-o">();</span>
<span class="tok-n">String</span> <span class="tok-n">googleQuery</span> <span class="tok-o">=</span> <span class="tok-s">&quot;http://www.google.com/search?q=&quot;</span> <span class="tok-o">+</span> <span class="tok-n">fullName</span><span class="tok-o">.</span><span class="tok-na">replace</span><span class="tok-o">(</span><span class="tok-s">&quot; &quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;+&quot;</span><span class="tok-o">);</span>
<span class="tok-n">String</span> <span class="tok-n">linkLabel</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Search &#39;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">fullName</span> <span class="tok-o">+</span> <span class="tok-s">&quot;&#39; on Google.&quot;</span><span class="tok-o">;</span>

<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ExternalLink</span><span class="tok-o">(</span><span class="tok-s">&quot;externalSite&quot;</span><span class="tok-o">,</span> <span class="tok-n">googleQuery</span><span class="tok-o">,</span> <span class="tok-n">linkLabel</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generated anchor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;a</span> <span class="tok-na">href=</span><span class="tok-s">&quot;http://www.google.com/search?q=John+Smith&quot;</span><span class="tok-nt">&gt;</span>Search &#39;John Smith&#39; on Google.<span class="tok-nt">&lt;/a&gt;</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stateless_links">Stateless links</h3>
<div class="paragraph">
<p>Component Link has a stateful nature, hence it cannot be used with stateless pages. To use links with these kinds of pages Wicket provides the convenience <em>org.apache.wicket.markup.html.link.StatelessLink</em> component which is basically a subtype of Link with the stateless hint set to true.</p>
</div>
<div class="paragraph">
<p>Please keep in mind that Wicket generates a new instance of a stateless page also to serve stateless links, so the code inside the onClick() method can not depend on instance variables. To illustrate this potential issue let&#8217;s consider the following code (from the project StatelessPage) where the value of the variable index is used inside onclick():</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">StatelessPage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">index</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-nf">StatelessPage</span><span class="tok-o">(</span><span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">parameters</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onInitialize</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onInitialize</span><span class="tok-o">();</span>
		<span class="tok-n">setStatelessHint</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>

		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">StatelessLink</span><span class="tok-o">(</span><span class="tok-s">&quot;statelessLink&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>

			<span class="tok-nd">@Override</span>
			<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">()</span> <span class="tok-o">{</span>
				<span class="tok-c1">//It will always print zero</span>
				<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-n">index</span><span class="tok-o">++);</span>
			<span class="tok-o">}</span>

		<span class="tok-o">});</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The printed value will always be zero because a new instance of the page is used every time the user clicks on the statelessLink link.</p>
</div>
</div>
<div class="sect2">
<h3 id="_generating_structured_and_clear_urls">Generating structured and clear URLs</h3>
<div class="paragraph">
<p>Having structured URLs in our site is a basic requirement if we want to build an efficient SEO strategy, but it also contributes to improve user experience with more intuitive URLs. Wicket provides two different ways to control URL generation. The first (and simplest) is to “mount” one or more pages to an arbitrary path, while a more powerful technique is to use custom implementations of IMapperContext and IPageParametersEncoder interfaces. In the next paragraphs we will learn both of these two techniques.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mounting_a_single_page">Mounting a single page</h3>
<div class="paragraph">
<p>With Wicket we can mount a page to a given path in much the same way as we map a servlet filter to a desired path inside file web.xml (see  <a href="#guide:helloWorld_2">paragraph 4.2</a>
). Using mountPage(String path, Class &lt;T&gt; pageClass) method of the WepApplication class we tell Wicket to respond with a new instance of pageClass whenever a user navigates to the given path. In the application class of the project MountedPagesExample we mount MountedPage to the  [/pageMount] ath:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
	<span class="tok-n">mountPage</span><span class="tok-o">(</span><span class="tok-s">&quot;/pageMount&quot;</span><span class="tok-o">,</span> <span class="tok-n">MountedPage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
	<span class="tok-c1">//Other initialization code...</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The path provided to mountPage will be used to generate the URL for any page of the specified class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//it will return &quot;/pageMount&quot;</span>
<span class="tok-n">RequestCycle</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">urlFor</span><span class="tok-o">(</span><span class="tok-n">MountedPage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Under the hood the mountPage method mounts an instance of the request mapper <em>org.apache.wicket.request.mapper.MountedMapper</em> configured for the given path:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">final</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span> <span class="tok-kd">extends</span> <span class="tok-n">Page</span><span class="tok-o">&gt;</span> <span class="tok-kt">void</span> <span class="tok-nf">mountPage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">path</span><span class="tok-o">,</span><span class="tok-kd">final</span> <span class="tok-n">Class</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">pageClass</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-n">mount</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">MountedMapper</span><span class="tok-o">(</span><span class="tok-n">path</span><span class="tok-o">,</span> <span class="tok-n">pageClass</span><span class="tok-o">));</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Request mappers and the Application&#8217;s method mount have been introduced in the previous chapter ( <a href="#guide:requestProcessing_3">paragraph 9.3</a>
).</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_parameter_placeholders_with_mounted_pages">Using parameter placeholders with mounted pages</h3>
<div class="paragraph">
<p>The path specified for mounted pages can contain dynamic segments which are populated with the values of the named parameters used to build the page. These segments are declared using special segments called parameter placeholders. Consider the path used in the following example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">mountPage</span><span class="tok-o">(</span><span class="tok-s">&quot;/pageMount/${foo}/otherSegm&quot;</span><span class="tok-o">,</span> <span class="tok-n">MountedPageWithPlaceholder</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The path used above is composed by three segments: the first and the last are fixed while the second will be replaced by the value of the named parameter foo that must be provided when the page  MountedPageWithPlaceholder is instantiated:</p>
</div>
<div class="paragraph">
<p>Java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">PageParameters</span> <span class="tok-n">pageParameters</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PageParameters</span><span class="tok-o">();</span>
<span class="tok-n">pageParameters</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;foo&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;foo&quot;</span><span class="tok-o">);</span>

<span class="tok-n">setResponsePage</span><span class="tok-o">(</span><span class="tok-n">MountedPageWithPlaceholder</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">pageParameters</span><span class="tok-o">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generated URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;Application</span> <span class="tok-na">path</span><span class="tok-nt">&gt;</span>/pageMount/foo/otherSegm
</code></pre>
</div>
</div>
<div class="paragraph">
<p>On the contrary if we manually insert an URL like <em>&lt;web app path&gt;/pageMount/bar/otherSegm</em>, we can read value <em>bar</em> retrieving the named parameter foo inside our page.</p>
</div>
<div class="paragraph">
<p>Place holders can be declared as optional using the <em>1.</em> character in place of <em>$</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">mountPage</span><span class="tok-o">(</span><span class="tok-s">&quot;/pageMount/#{foo}/otherSegm&quot;</span><span class="tok-o">,</span> <span class="tok-n">MountedPageOptionalPlaceholder</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the named parameter for an optional placeholder is missing, the corresponding segment is removed from the final URL:</p>
</div>
<div class="paragraph">
<p>Java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">PageParameters</span> <span class="tok-n">pageParameters</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PageParameters</span><span class="tok-o">();</span>
<span class="tok-n">setResponsePage</span><span class="tok-o">(</span><span class="tok-n">MountedPageWithPlaceholder</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">pageParameters</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generated URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;Application</span> <span class="tok-na">path</span><span class="tok-nt">&gt;</span>/pageMount/otherSegm
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mounting_a_package">Mounting a package</h3>
<div class="paragraph">
<p>In addition to mounting a single page, Wicket allows to mount all of the pages inside a package to a given path. Method mountPackage(String path, Class&lt;T&gt; pageClass) of class WepApplication will mount every page inside pageClass&#8217;s package to the specified path.</p>
</div>
<div class="paragraph">
<p>The resulting URL for package-mounted pages will have the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;Application</span> <span class="tok-na">path</span><span class="tok-nt">&gt;</span>/mountedPath/<span class="tok-nt">&lt;PageClassName&gt;</span>[optional query string]
</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example in the MountedPagesExample project we have mounted all pages inside the subpackage org.tutorialWicket.subPackage with this line of code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">mountPackage</span><span class="tok-o">(</span><span class="tok-s">&quot;/mountPackage&quot;</span><span class="tok-o">,</span> <span class="tok-n">StatefulPackageMount</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>StatefulPackageMount is one of the pages placed into the desired package and its URL will be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;Application</span> <span class="tok-na">path</span><span class="tok-nt">&gt;</span>/mountPackage/StatefulPackageMount?1
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Similarly to what is done by the mountPage method, the implementation of the mountPackage method mounts an instance of <em>org.apache.wicket.request.mapper.PackageMapper</em> to the given path.</p>
</div>
</div>
<div class="sect2">
<h3 id="_providing_custom_mapper_context_to_request_mappers">Providing custom mapper context to request mappers</h3>
<div class="paragraph">
<p>Interface <em>org.apache.wicket.request.mapper.IMapperContext</em> is used by request mappers to create new page instances and to retrieve static URL segments used to build and parse page URLs. Here is the list of these segments:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Namespace: it&#8217;s the first URL segment of non-mounted pages. By default its value is wicket.</p>
</li>
<li>
<p>Identifier for non-bookmarkable URLs: it&#8217;s the segment that identifies non bookmarkable pages. By default its value is page.</p>
</li>
<li>
<p>Identifier for bookmarkable URLs: it&#8217;s the segment that identifies bookmarkable pages. By default its value is bookmarkable (as we have seen before in  <a href="#guide:urls_1">paragraph 10.1.1</a>
).</p>
</li>
<li>
<p>Identifier for resources: it&#8217;s the segment that identifies Wicket resources. Its default value is resources. The topic of resource management will be covered in  <a href="#guide:resources">chapter 16</a>
.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>IMapperContext provides a getter method for any segment listed above. By default Wicket uses class <em>org.apache.wicket.DefaultMapperContext</em> as mapper context.</p>
</div>
<div class="paragraph">
<p>Project CustomMapperContext is an example of customization of mapper context where we use index as identifier for non-bookmarkable pages and staticURL as identifier for bookmarkable pages. In this project, instead of implementing our mapper context from scratch, we used DefaultMapperContext as base class overriding just the two methods we need to achieve the desired result (getBookmarkableIdentifier() and getPageIdentifier()).  The final implementation is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CustomMapperContext</span> <span class="tok-kd">extends</span> <span class="tok-n">DefaultMapperContext</span><span class="tok-o">{</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getBookmarkableIdentifier</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-s">&quot;staticURL&quot;</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getPageIdentifier</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-s">&quot;index&quot;</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now to use a custom mapper context in our application we must override the newMapperContext() method declared in the Application class and make it return our custom implementation of IMapperContext:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">protected</span> <span class="tok-n">IMapperContext</span> <span class="tok-nf">newMapperContext</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	<span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">CustomMapperContext</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_controlling_how_page_parameters_are_encoded_with_ipageparametersencoder">Controlling how page parameters are encoded with IPageParametersEncoder</h3>
<div class="paragraph">
<p>Some request mappers (like MountedMapper and PackageMapper) can delegate page parameters encoding/decoding to interface <em>org.apache.wicket.request.mapper.parameter.IPage ParametersEncoder</em>. This entity exposes two methods: encodePageParameters() and decodePageParameters(): the first  one is invoked to encode page parameters into an URL while the second one extracts parameters from the URL.</p>
</div>
<div class="paragraph">
<p>Wicket comes with a built-in implementation of this interface which encodes named page parameters as URL segments using the following pattern: /paramName1/paramValue1/paramName2/param Value2&#8230;</p>
</div>
<div class="paragraph">
<p>This built-in encoder is <em>org.apache.wicket.request.mapper.parameter.UrlPathPageParametersEncoder</em> class. In the <em>PageParametersEncoderExample</em> project we have manually mounted a <em>MountedMapper</em> that takes as input also an <em>UrlPathPageParametersEncoder</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
	<span class="tok-n">mount</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">MountedMapper</span><span class="tok-o">(</span><span class="tok-s">&quot;/mountedPath&quot;</span><span class="tok-o">,</span> <span class="tok-n">MountedPage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">UrlPathPageParametersEncoder</span><span class="tok-o">()));</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The home page of the project contains just a link to the MountedPage web page. The code of the link and the resulting page URL are:</p>
</div>
<div class="paragraph">
<p>Link code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Link</span><span class="tok-o">(</span><span class="tok-s">&quot;mountedPage&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">()</span> <span class="tok-o">{</span>

		<span class="tok-n">PageParameters</span> <span class="tok-n">pageParameters</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PageParameters</span><span class="tok-o">();</span>
		<span class="tok-n">pageParameters</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;foo&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;foo&quot;</span><span class="tok-o">);</span>
		<span class="tok-n">pageParameters</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;bar&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;bar&quot;</span><span class="tok-o">);</span>

		<span class="tok-n">setResponsePage</span><span class="tok-o">(</span><span class="tok-n">MountedPage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">pageParameters</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
<span class="tok-o">});</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Generated URL:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;Application</span> <span class="tok-na">path</span><span class="tok-nt">&gt;</span>/mountedPath/foo/foo/bar/bar?1
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_encrypting_page_urls">Encrypting page URLs</h3>
<div class="paragraph">
<p>Sometimes URLs are a double–edged sword for our site because they can expose too many details about the internal structure of our web application making it more vulnerable to malicious users.</p>
</div>
<div class="paragraph">
<p>To avoid this kind of security threat we can use the <em>CryptoMapper</em> request mapper which wraps an existing mapper and encrypts the original URL producing a single encrypted segment:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="url-encrypted.png" alt="url encrypted">
</div>
</div>
<div class="paragraph">
<p>Typically, <em>CryptoMapper</em> is registered into a Wicket application as the root request mapper wrapping the default one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
	<span class="tok-n">setRootRequestMapper</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">CryptoMapper</span><span class="tok-o">(</span><span class="tok-n">getRootRequestMapper</span><span class="tok-o">(),</span> <span class="tok-k">this</span><span class="tok-o">));</span>
	<span class="tok-c1">//pages and resources must be mounted after we have set CryptoMapper</span>
	<span class="tok-n">mountPage</span><span class="tok-o">(</span><span class="tok-s">&quot;/foo/&quot;</span><span class="tok-o">,</span> <span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As pointed out in the code above, pages and resources must be mounted after having set <em>CryptoMapper</em> as root mapper, otherwise the mounted paths will not work.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
By default <em>CryptoMapper</em> encrypts page URLs with a cipher that might not be strong enough for production environment. Paragraph 21.4 will provide a more detailed description of how Wicket encrypts page URLs and we will see how to use stronger ciphers.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_summary_7">Summary</h3>
<div class="paragraph">
<p>Links and URLs are not trivial topics as they may seem and in Wicket they are strictly interconnected. Developers must choose the right trade-off between producing structured URLs and avoiding to make them verbose and vulnerable.</p>
</div>
<div class="paragraph">
<p>In this chapter we have explored the tools provided by Wicket to control how URLs are generated. We have started with static URLs for bookmarkable pages and we have seen how to pass parameters to target pages with PageParameters. In the second part of the chapter we focused on mounting pages to a specific path and on controlling how parameters are encoded by Wicket. Finally, we have also seen how to encrypt URLs to prevent security vulnerabilities.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wicket_models_and_forms">Wicket models and forms</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Wicket the concept of “model” is probably the most important topic of the entire framework and it is strictly related to the usage of its components. In addition, models are also an important element for  internationalization, as we will see in paragraph 12.6. However, despite their fundamental role, in Wicket models are not difficult to understand but the best way to learn how they work is to use them with forms. That&#8217;s why we haven&#8217;t talked about models so far, and why this chapter discusses these two topics together.</p>
</div>
<div class="sect2">
<h3 id="_what_is_a_model">What is a model?</h3>
<div class="paragraph">
<p>Model is essentially a  <a href="http://en.wikipedia.org/wiki/Facade_pattern">facade</a> nterface which allows components to access and modify their data without knowing any detail about how they are managed or persisted. Every component has at most one related model, while a model can be shared among different components. In Wicket a model is any implementation of the interface <em>org.apache.wicket.model.IModel</em>:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="uml-imodel.png" alt="uml imodel">
</div>
</div>
<div class="paragraph">
<p>The IModel interface defines just the methods needed to get and set a data object (getObject() and setObject()), decoupling components from concrete details about the persistence strategy adopted for data. In addition, the level of indirection introduced by models allows access data object only when it is really needed (for example during the rendering phase) and not earlier when it may not be ready to be used.</p>
</div>
<div class="paragraph">
<p>Any component can get/set its model as well as its data object using the 4 public shortcut methods listed in the class diagram above. The two methods onModelChanged() and onModelChanging() are triggered by Wicket each time a model is modified: the first one is called after the model has been changed, the second one just before the change occurs. In the examples seen so far we have worked with Label component using its constructor which takes as input two string parameters, the component id and the text to display:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;helloMessage&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Hello WicketWorld!&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>This constructor internally builds a model which wraps the second string parameter. That&#8217;s why we didn&#8217;t mention label model in the previous examples. Here is the code of this constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-nf">Label</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">label</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-k">this</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Model</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;(</span><span class="tok-n">label</span><span class="tok-o">));</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Class <em>org.apache.wicket.model.Model</em> is a basic implementation of <em>IModel</em>. It can wrap any object that implements the interface java.io.Serializable. The reason of this constraint over data object is that this model is stored in the web session, and we know from chapter 6 that data are stored into session using serialization.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
In general, Wicket models support a detaching capability that allows us to work also with non-serializable objects as data model. We will see the detaching mechanism later in this chapter.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Just like any other Wicket components, Label provides a constructor that takes as input the component id and the model to use with the component. Using this constructor the previous example becomes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;helloMessage&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Model</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;Hello WicketWorld!&quot;</span><span class="tok-o">)));</span>
</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The Model class comes with a bunch of factory methods that makes it easier to build new model instances. For example the of(T object) method creates a new instance of Model which wraps any Object instance inside it. So instead of writing
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>	new Model&lt;String&gt;( llo[facade] orld! llo[facade]
we can write</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>	Model.of( Hello[facade] ld! Hello[facade]
If the data object is a List, a Map or a Set we can use similar methods called ofList, ofMap and ofSet.
From now on we will use these factory methods in our examples.</pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s quite clear that if our Label must display a static text it doesn&#8217;t make much sense to build a model by hand like we did in the last code example.
However is not unusual to have a Label that must display a dynamic value, like the input provided by a user or a value read from a database. Wicket models are designed to solve these kinds of problems.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s say we need a label to display the current time stamp each time a page is rendered. We can implement a custom model which returns a new Date instance when the getObject() method is called:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">IModel</span> <span class="tok-n">timeStampModel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Model</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;(){</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getObject</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">().</span><span class="tok-na">toString</span><span class="tok-o">();</span>
	<span class="tok-o">}</span>
<span class="tok-o">};</span>

<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;timeStamp&quot;</span><span class="tok-o">,</span> <span class="tok-n">timeStampModel</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even if sometimes writing a custom model could be a good choice to solve a specific problem, Wicket already provides a set of IModel implementations which should fit most of our needs. In the next paragraph we will see a couple of models that allow us to easily integrate JavaBeans with our web applications and in particular with our forms.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
By default the class Component escapes HTML sensitive characters (like <em>&lt;</em>, <em>&gt;</em> or <em>&amp;</em>) from the textual representation of its model object. The term <em>escape</em> means that these characters will be replaced with their corresponding HTML  <a href="http://en.wikipedia.org/wiki/Character_entity_reference">)
entity</a> r example <em>&lt;</em> becomes '&lt; '). This is done for security reasons as a malicious user could attempt to inject markup or JavaScript into our pages. If we want to display the raw content stored inside a model, we can tell the Component class not to escape characters by calling the setEscapeModelStrings(false) method.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_models_and_javabeans">Models and JavaBeans</h3>
<div class="paragraph">
<p>One of the main goals of Wicket is to use JavaBeans and POJO as data model, overcoming the impedance mismatch between web technologies and OO paradigm. In order to make this task as easy as possible, Wicket offers two special model classes: <em>org.apache.wicket.model.PropertyModel</em> and <em>org.apache.wicket.model.CompoundPropertyModel</em>. We will see how to use them in the next two examples, using the following JavaBean as the data object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Person</span> <span class="tok-kd">implements</span> <span class="tok-n">Serializable</span> <span class="tok-o">{</span>

	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">surname</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">address</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">email</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">passportCode</span><span class="tok-o">;</span>

	<span class="tok-kd">private</span> <span class="tok-n">Person</span> <span class="tok-n">spouse</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">children</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-nf">Person</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">surname</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">name</span> <span class="tok-o">=</span> <span class="tok-n">name</span><span class="tok-o">;</span>
		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">surname</span> <span class="tok-o">=</span> <span class="tok-n">surname</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getFullName</span><span class="tok-o">(){</span>
   		<span class="tok-k">return</span> <span class="tok-n">name</span> <span class="tok-o">+</span> <span class="tok-s">&quot; &quot;</span> <span class="tok-o">+</span> <span class="tok-n">surname</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-cm">/*</span>
<span class="tok-cm">	 * Getters and setters for private fields</span>
<span class="tok-cm">     */</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_propertymodel">PropertyModel</h3>
<div class="paragraph">
<p>Let&#8217;s say we want to display the name field of a Person instance with a label. We could, of course, use the Model class like we did in the previous example, obtaining something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Person</span> <span class="tok-n">person</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">();</span>
<span class="tok-c1">//load person&#39;s data...</span>

<span class="tok-n">Label</span> <span class="tok-n">label</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;name&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Model</span><span class="tok-o">(</span><span class="tok-n">person</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">()));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>However this solution has a huge drawback: the text displayed by the label will be static and if we change the value of the field, the label won&#8217;t update its content. Instead, to always display the current value of a class field, we should use the <em>org.apache.wicket.model.PropertyModel</em> model class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Person</span> <span class="tok-n">person</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">();</span>
<span class="tok-c1">//load person&#39;s data...</span>

<span class="tok-n">Label</span> <span class="tok-n">label</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;name&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">PropertyModel</span><span class="tok-o">(</span><span class="tok-n">person</span><span class="tok-o">,</span> <span class="tok-s">&quot;name&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>PropertyModel has just one constructor with two parameters: the model object (person in our example) and the name of the property we want to read/write ( [name] n our example). This last parameter is called property expression. Internally, methods getObject/setObject use property expression to get/set property&#8217;s value. To resolve class properties PropertyModel uses class <em>org.apache.wicket.util.lang.Property</em> Resolver which can access any kind of property, private fields included.</p>
</div>
<div class="paragraph">
<p>Just like the Java language, property expressions support dotted notation to select sub properties. So if we want to display the name of the Person&#8217;s spouse we can write:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Label</span> <span class="tok-n">label</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;spouseName&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">PropertyModel</span><span class="tok-o">(</span><span class="tok-n">person</span><span class="tok-o">,</span> <span class="tok-s">&quot;spouse.name&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
PropertyModel is null-safe, which means we don&#8217;t have to worry if property expression includes a null value in its path. If such a value is encountered, an empty string will be returned.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If property is an array or a List, we can specify an index after its name. For example, to display the name of the first child of a Person we can write the following property expression:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Label</span> <span class="tok-n">label</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;firstChildName&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">PropertyModel</span><span class="tok-o">(</span><span class="tok-n">person</span><span class="tok-o">,</span> <span class="tok-s">&quot;children.0.name&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Indexes and map keys can be also specified using squared brackets:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">children</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">].</span><span class="tok-na">name</span> <span class="tok-o">...</span>
<span class="tok-n">mapField</span><span class="tok-o">[</span><span class="tok-n">key</span><span class="tok-o">].</span><span class="tok-na">subfield</span> <span class="tok-o">...</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_compoundpropertymodel_and_model_inheritance">CompoundPropertyModel and model inheritance</h3>
<div class="paragraph">
<p>Class <em>org.apache.wicket.model.CompoundPropertyModel</em> is a particular kind of model which is usually used in conjunction with another Wicket feature called model inheritance. With this feature, when a component needs to use a model but none has been assigned to it, it will search through the whole container hierarchy for a parent with an inheritable model. Inheritable models are those which implement interface <em>org.apache.wicket.model.IComponentInheritedModel</em> and <em>CompoundPropertyModel</em> is one of them. Once a <em>CompoundPropertyModel</em> has been inherited by a component, it will behave just like a PropertyModel using the id of the component as property expression. As a consequence, to make the most of CompoundPropertyModel we must assign it to one of the containers of a given component, rather than directly to the component itself.</p>
</div>
<div class="paragraph">
<p>For example if we use CompoundPropertyModel with the previous example (display spouse&#8217;s name), the code would become like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//set CompoundPropertyModel as model for the container of the label</span>
<span class="tok-n">setDefaultModel</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">CompoundPropertyModel</span><span class="tok-o">(</span><span class="tok-n">person</span><span class="tok-o">));</span>

<span class="tok-n">Label</span> <span class="tok-n">label</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;spouse.name&quot;</span><span class="tok-o">);</span>

<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that now the id of the label is equal to the property expression previously used with PropertyModel. Now as a further example let&#8217;s say we want to extend the code above to display all of the main informations of a person (name, surname, address and email). All we have to do is to add one label for every additional information using the relative property expression as component id:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//Create a person named &#39;John Smith&#39;</span>
<span class="tok-n">Person</span> <span class="tok-n">person</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;John&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Smith&quot;</span><span class="tok-o">);</span>
<span class="tok-n">setDefaultModel</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">CompoundPropertyModel</span><span class="tok-o">(</span><span class="tok-n">person</span><span class="tok-o">));</span>

<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;name&quot;</span><span class="tok-o">));</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;surname&quot;</span><span class="tok-o">));</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;address&quot;</span><span class="tok-o">));</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;email&quot;</span><span class="tok-o">));</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;spouse.name&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>CompoundPropertyModel can save us a lot of boring coding if we choose the id of components according to properties name. However it&#8217;s also possible to use this type of model even if the id of a component does not correspond to a valid property expression. The method bind(String property) allows to create a property model from a given CompoundPropertyModel using the provided parameter as property expression. For example if we want to display the spouse&#8217;s name in a label having  [xyz] s id, we can write the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//Create a person named &#39;John Smith&#39;</span>
<span class="tok-n">Person</span> <span class="tok-n">person</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;John&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Smith&quot;</span><span class="tok-o">);</span>
<span class="tok-n">CompoundPropertyModel</span> <span class="tok-n">compoundModel</span><span class="tok-o">;</span>
<span class="tok-n">setDefaultModel</span><span class="tok-o">(</span><span class="tok-n">compoundModel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">CompoundPropertyModel</span><span class="tok-o">(</span><span class="tok-n">person</span><span class="tok-o">));</span>

<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;xyz&quot;</span><span class="tok-o">,</span> <span class="tok-n">compoundModel</span><span class="tok-o">.</span><span class="tok-na">bind</span><span class="tok-o">(</span><span class="tok-s">&quot;spouse.name&quot;</span><span class="tok-o">)));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>CompoundPropertyModel are particularly useful when used in combination with Wicket forms, as we will see in the next paragraph.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Model is referred to as static model because the result of its method getObject is fixed and it is not dynamically evaluated each time the method is called. In contrast, models like PropertyModel and CompoundProperty Model are called dynamic models.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_wicket_forms">Wicket forms</h3>
<div class="paragraph">
<p>Web applications use HTML forms to collect user input and send it to the server. Wicket provides <em>org.apache.wicket.markup.html.form.Form</em> class to handle web forms. This component must be bound to &lt;form&gt; tag. The following snippet shows how to create a very basic Wicket form in a page:</p>
</div>
<div class="paragraph">
<p>Html:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;form&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;submit&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/form&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Form</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">){</span>
    <span class="tok-nd">@Override</span>
    <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onSubmit</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    	<span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">out</span><span class="tok-o">.</span><span class="tok-na">println</span><span class="tok-o">(</span><span class="tok-s">&quot;Form submitted.&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">};</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Method onSubmit is called whenever a form has been submitted and it can be overridden to perform custom actions. Please note that a Wicket form can be submitted using a standard HTML submit button which is not mapped to any component (i.e. it does not have a wicket:id attribute).
In the next chapter we will continue to explore Wicket forms and we will see how to submit forms using special components which implement interface <em>org.apache.wicket.markup.html.form.IFormSubmitter</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_form_and_models">Form and models</h3>
<div class="paragraph">
<p>A form should contain some input fields (like text fields, check boxes, radio buttons, drop-down lists, text areas, etc.) to interact with users. Wicket provides an abstraction for all these kinds of elements with component org.apache.wicket.markup.html.form.FormComponent:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="uml-form-component.png" alt="uml form component">
</div>
</div>
<div class="paragraph">
<p>The purpose of FormComponent is to store the corresponding user input into its model when the form is submitted. The form is responsible for mapping input values to the corresponding components, avoiding us the burden of manually synchronizing models with input fields and vice versa.</p>
</div>
</div>
<div class="sect2">
<h3 id="_login_form">Login form</h3>
<div class="paragraph">
<p>As first example of interaction between the form and its models, we will build a classic login form which asks for username and password (project LoginForm).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
The topic of security will be discussed later in chapter 22. The following form is for example purposes only and is not suited for a real application.
If you need to use a login form you should consider to use component <em>org.apache.wicket.authroles.authentication.panel.SignInPanel</em> shipped with Wicket.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This form needs two text fields, one of which must be a password field. We should also use a label to display the result of login process1. For the sake of simplicity, the login logic is all inside onSubmit and is quite trivial.</p>
</div>
<div class="paragraph">
<p>The following is a possible implementation of our form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LoginForm</span> <span class="tok-kd">extends</span> <span class="tok-n">Form</span> <span class="tok-o">{</span>

	<span class="tok-kd">private</span> <span class="tok-n">TextField</span> <span class="tok-n">usernameField</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">PasswordTextField</span> <span class="tok-n">passwordField</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">Label</span> <span class="tok-n">loginStatus</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-nf">LoginForm</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span>

		<span class="tok-n">usernameField</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">));</span>
		<span class="tok-n">passwordField</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PasswordTextField</span><span class="tok-o">(</span><span class="tok-s">&quot;password&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">));</span>
		<span class="tok-n">loginStatus</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;loginStatus&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">));</span>

		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">usernameField</span><span class="tok-o">);</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">passwordField</span><span class="tok-o">);</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">loginStatus</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kd">final</span> <span class="tok-kt">void</span> <span class="tok-nf">onSubmit</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-n">String</span> <span class="tok-n">username</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span><span class="tok-n">usernameField</span><span class="tok-o">.</span><span class="tok-na">getDefaultModelObject</span><span class="tok-o">();</span>
		<span class="tok-n">String</span> <span class="tok-n">password</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">String</span><span class="tok-o">)</span><span class="tok-n">passwordField</span><span class="tok-o">.</span><span class="tok-na">getDefaultModelObject</span><span class="tok-o">();</span>

		<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">username</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;test&quot;</span><span class="tok-o">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">password</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;test&quot;</span><span class="tok-o">))</span>
			<span class="tok-n">loginStatus</span><span class="tok-o">.</span><span class="tok-na">setDefaultModelObject</span><span class="tok-o">(</span><span class="tok-s">&quot;Congratulations!&quot;</span><span class="tok-o">);</span>
		<span class="tok-k">else</span>
			<span class="tok-n">loginStatus</span><span class="tok-o">.</span><span class="tok-na">setDefaultModelObject</span><span class="tok-o">(</span><span class="tok-s">&quot;Wrong username or password!&quot;</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside form&#8217;s constructor we build the three components used in the form and we assign them a model containing an empty string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">usernameField</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">));</span>
<span class="tok-n">passwordField</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PasswordTextField</span><span class="tok-o">(</span><span class="tok-s">&quot;password&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">));</span>
<span class="tok-n">loginStatus</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;loginStatus&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we don&#8217;t provide a model to a form component, we will get the following exception on form submission:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">IllegalStateException</span><span class="tok-o">:</span> <span class="tok-n">Attempt</span> <span class="tok-n">to</span> <span class="tok-n">set</span> <span class="tok-n">model</span> <span class="tok-n">object</span> <span class="tok-n">on</span> <span class="tok-kc">null</span> <span class="tok-n">model</span> <span class="tok-n">of</span> <span class="tok-n">component</span><span class="tok-o">:</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Component TextField corresponds to the standard text field, without any particular behavior or restriction on the allowed values. We must bind this component to the &lt;input&gt; tag with the attribute type set to  [text] asswordTextField is a subtype of TextFiled and it must be used with an &lt;input&gt; tag with the attribute type set to [password] or security reasons component PasswordTextField cleans its value at each request, so it wil be always empty after the form has been rendered. By default PasswordTextField fields are required, meaning that if we left them empty, the form won&#8217;t be submitted (i.e. onSubmit won&#8217;t be called). Class FormComponent provides method setRequired(boolean required) to change this behavior. Inside onSubmit, to get/set model objects we have used shortcut methods setDefaultModelObject and getDefaultModelObject. Both methods are defined in class Component (see class diagram from Illustration 9.1).</p>
</div>
<div class="paragraph">
<p>The following are the possible markup and code for the login page:</p>
</div>
<div class="paragraph">
<p>Html:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
	<span class="tok-nt">&lt;head&gt;</span>
  		<span class="tok-nt">&lt;title&gt;</span>Login page<span class="tok-nt">&lt;/title&gt;</span>
	<span class="tok-nt">&lt;/head&gt;</span>
	<span class="tok-nt">&lt;body&gt;</span>
		<span class="tok-nt">&lt;form</span> <span class="tok-na">id=</span><span class="tok-s">&quot;loginForm&quot;</span> <span class="tok-na">method=</span><span class="tok-s">&quot;get&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;loginForm&quot;</span><span class="tok-nt">&gt;</span>
  			<span class="tok-nt">&lt;fieldset&gt;</span>
    			<span class="tok-nt">&lt;legend</span> <span class="tok-na">style=</span><span class="tok-s">&quot;color: #F90&quot;</span><span class="tok-nt">&gt;</span>Login<span class="tok-nt">&lt;/legend&gt;</span>
    				<span class="tok-nt">&lt;p</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;loginStatus&quot;</span><span class="tok-nt">&gt;&lt;/p&gt;</span>
    				<span class="tok-nt">&lt;span&gt;</span>Username: <span class="tok-nt">&lt;/span&gt;&lt;input</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;username&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;username&quot;</span> <span class="tok-nt">/&gt;&lt;br/&gt;</span>
    				<span class="tok-nt">&lt;span&gt;</span>Password: <span class="tok-nt">&lt;/span&gt;&lt;input</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-nt">/&gt;</span>
    				<span class="tok-nt">&lt;p&gt;</span>
    					<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;Login&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Login&quot;</span><span class="tok-nt">/&gt;</span>
    				<span class="tok-nt">&lt;/p&gt;</span>
  	   	    <span class="tok-nt">&lt;/fieldset&gt;</span>
		<span class="tok-nt">&lt;/form&gt;</span>
	<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>

   <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>

		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">parameters</span><span class="tok-o">);</span>
    	<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">LoginForm</span><span class="tok-o">(</span><span class="tok-s">&quot;loginForm&quot;</span><span class="tok-o">));</span>

    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The example shows how Wicket form components can be used to store user input inside their model. However we can dramatically improve the form code using CompoundPropertyModel and its ability to access the properties of its model object. The revisited code is the following (the LoginFormRevisited project):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LoginForm</span> <span class="tok-kd">extends</span> <span class="tok-n">Form</span><span class="tok-o">{</span>

		<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">username</span><span class="tok-o">;</span>
		<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">password</span><span class="tok-o">;</span>
		<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">loginStatus</span><span class="tok-o">;</span>

		<span class="tok-kd">public</span> <span class="tok-nf">LoginForm</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span>
			<span class="tok-n">setDefaultModel</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">CompoundPropertyModel</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">));</span>

			<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-o">));</span>
			<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">PasswordTextField</span><span class="tok-o">(</span><span class="tok-s">&quot;password&quot;</span><span class="tok-o">));</span>
			<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;loginStatus&quot;</span><span class="tok-o">));</span>
		<span class="tok-o">}</span>

		<span class="tok-kd">public</span> <span class="tok-kd">final</span> <span class="tok-kt">void</span> <span class="tok-nf">onSubmit</span><span class="tok-o">()</span> <span class="tok-o">{</span>
			<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">username</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;test&quot;</span><span class="tok-o">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">password</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;test&quot;</span><span class="tok-o">))</span>
				<span class="tok-n">loginStatus</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Congratulations!&quot;</span><span class="tok-o">;</span>
			<span class="tok-k">else</span>
				<span class="tok-n">loginStatus</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Wrong username or password !&quot;</span><span class="tok-o">;</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this version the form itself is used as model object for its CompoundPropertyModel. This allows children components to have direct access to form fields and use them as backing objects, without explicitly creating a model for themselves.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Keep in mind that when CompoundPropertyModel is inherited, it does not consider the ids of traversed containers for the final property expression, but it will always use the id of the visited child. To understand this potential pitfall, let&#8217;s consider the following initialization code of a page:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//Create a person named &#39;John Smith&#39;</span>
<span class="tok-n">Person</span> <span class="tok-n">person</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;John&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Smith&quot;</span><span class="tok-o">);</span>
<span class="tok-c1">//Create a person named &#39;Jill Smith&#39;</span>
<span class="tok-n">Person</span> <span class="tok-n">spouse</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Jill&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Smith&quot;</span><span class="tok-o">);</span>
<span class="tok-c1">//Set Jill as John&#39;s spouse</span>
<span class="tok-n">person</span><span class="tok-o">.</span><span class="tok-na">setSpouse</span><span class="tok-o">(</span><span class="tok-n">spouse</span><span class="tok-o">);</span>

<span class="tok-n">setDefaultModel</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">CompoundPropertyModel</span><span class="tok-o">(</span><span class="tok-n">person</span><span class="tok-o">));</span>
<span class="tok-n">WebMarkupContainer</span> <span class="tok-n">spouse</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">WebMarkupContainer</span><span class="tok-o">(</span><span class="tok-s">&quot;spouse&quot;</span><span class="tok-o">);</span>
<span class="tok-n">Label</span> <span class="tok-n">name</span><span class="tok-o">;</span>
<span class="tok-n">spouse</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">name</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;name&quot;</span><span class="tok-o">));</span>

<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">spouse</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The value displayed by label  [name] ill be  [John] nd not the spouse&#8217;s name   [Jill] s you may expect. In this example the label doesn&#8217;t own a model, so it must search up its container hierarchy for an inheritable model. However, its container (WebMarkup Container with id <em>spouse</em>) doesn&#8217;t own a model, hence the request for a model is forwarded to the parent container, which in this case is the page. In the end the label inherits CompoundPropertyModel from page but only its own id is used for the property expression. The containers in between are never taken into account for the final property expression.</p>
</div>
</div>
<div class="sect2">
<h3 id="_component_dropdownchoice">Component DropDownChoice</h3>
<div class="paragraph">
<p>Class <em>org.apache.wicket.markup.html.form.DropDownChoice</em> is the form component needed to display a list of possible options as a drop-down list where users can select one of the proposed options. This component must be used with &lt;select&gt; tag:</p>
</div>
<div class="paragraph">
<p>Html:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;form&quot;</span><span class="tok-nt">&gt;</span>
	Select a fruit: <span class="tok-nt">&lt;select</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;fruits&quot;</span><span class="tok-nt">&gt;&lt;/select&gt;</span>
<span class="tok-nt">&lt;div&gt;&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;submit&quot;</span><span class="tok-nt">/&gt;&lt;/div&gt;</span>
<span class="tok-nt">&lt;/form&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">fruits</span> <span class="tok-o">=</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span><span class="tok-s">&quot;apple&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;strawberry&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;watermelon&quot;</span><span class="tok-o">);</span>
<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">DropDownChoice</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;fruits&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Model</span><span class="tok-o">(),</span> <span class="tok-n">fruits</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Screenshot of generated page:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="dropdown-choice.png" alt="dropdown choice">
</div>
</div>
<div class="paragraph">
<p>In addition to the component id, in order to build a DropDownChoice we need to provide to its constructor two further parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a model containing the current selected item. This parameter is not required if we are going to inherit a CompoundPropertyModel for this component.</p>
</li>
<li>
<p>a list of options to display which can be supplied as a model or as a regular java.util.List.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the example above the possible options are provided as a list of String objects. Now let&#8217;s take a look at the markup generated for them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;select</span> <span class="tok-na">name=</span><span class="tok-s">&quot;fruits&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;fruits&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;option</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-na">selected=</span><span class="tok-s">&quot;selected&quot;</span><span class="tok-nt">&gt;</span>Choose One<span class="tok-nt">&lt;/option&gt;</span>
	<span class="tok-nt">&lt;option</span> <span class="tok-na">value=</span><span class="tok-s">&quot;0&quot;</span><span class="tok-nt">&gt;</span>apple<span class="tok-nt">&lt;/option&gt;</span>
	<span class="tok-nt">&lt;option</span> <span class="tok-na">value=</span><span class="tok-s">&quot;1&quot;</span><span class="tok-nt">&gt;</span>strawberry<span class="tok-nt">&lt;/option&gt;</span>
	<span class="tok-nt">&lt;option</span> <span class="tok-na">value=</span><span class="tok-s">&quot;2&quot;</span><span class="tok-nt">&gt;</span>watermelon<span class="tok-nt">&lt;/option&gt;</span>
<span class="tok-nt">&lt;/select&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first option is a placeholder item corresponding to a null model value. By default DropDownChoice cannot have a null value so users are forced to select a not-null option. If we want to change this behavior we can set the nullValid flag to true via the setNullValid method. Please note that the placeholder text (“Chose one”) can be localized, as we will see in chapter 15. The other options are identified by the attribute value. By default the value of this attribute is the index of the single option inside the provided list of choices, while the text displayed to the user is obtained by  calling toString()on the choice object. This default behavior works fine as long as our options are simple objects like strings, but when we move to more complex objects we may need to implement a more sophisticated algorithm to generate the value to use as the option id and the one to display to user. Wicket has solved this problem with <em>org.apache.wicket.markup.html.form.IChoiceRender</em> interface. This interface defines method getDisplayValue(T object) that is called to generate the value to display for the given choice object, and method getIdValue(T object, int index) that is called to generate the option id. The built-in implementation of this interface is class <em>org.apache.wicket.markup.html.form.ChoiceRenderer</em> which renders the two values using property expressions.</p>
</div>
<div class="paragraph">
<p>In the following code we want to show a list of Person objects using their full name as value to display and using their passport code as option id:</p>
</div>
<div class="paragraph">
<p>Java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">persons</span><span class="tok-o">;</span>
<span class="tok-c1">//Initialize the list of persons here...</span>
<span class="tok-n">ChoiceRenderer</span> <span class="tok-n">personRenderer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ChoiceRenderer</span><span class="tok-o">(</span><span class="tok-s">&quot;fullName&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;passportCode&quot;</span><span class="tok-o">);</span>
<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">DropDownChoice</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;persons&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Model</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;(),</span> <span class="tok-n">persons</span><span class="tok-o">,</span> <span class="tok-n">personRenderer</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The choice renderer can be assigned to the DropDownChoice using one of its constructor that accepts this type of parameter (like we did in the example above) or after its creation invoking setChoiceRenderer method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_model_chaining">Model chaining</h3>
<div class="paragraph">
<p>Models that implement the interface <em>org.apache.wicket.model.IChainingModel</em> can be used to build a chain of models. These kinds of models are able to recognize whether their model object is itself an implementation of IModel and if so, they will call getObject on the wrapped model and the returned value will be the actual model object. In this way we can combine the action of an arbitrary number of models, making exactly a chain of models. Chaining models allows to combine different data persistence strategies, similarly to what we do with chains of  O[] treams. ttp://java.sun.com/developer/technicalArticles/Streams/ProgIOStreams[] o see model chaining in action we will build a page that implements the List/Detail View pattern, where we have a drop-down list of Person objects and a form to display and edit the data of the current selected Person.</p>
</div>
<div class="paragraph">
<p>The example page will look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="model-chaining.png" alt="model chaining">
</div>
</div>
<div class="paragraph">
<p>What we want to do in this example is to chain the model of the DropDownChoice (which contains the selected Person) with the model of the Form. In this way the Form will work with the selected Person as backing object. The DropDownChoice component can be configured to automatically update its model each time we change the selected item on the client side. All we have to do is to override method wantOnSelectionChangedNotifications to make it return true. In practice, when this method returns true, DropDownChoice will submit its value every time JavaScript event onChange occurs, and its model will be consequently updated. To leverage this functionality, DropDownChoice doesn&#8217;t need to be inside a form.</p>
</div>
<div class="paragraph">
<p>The following is the resulting markup of the example page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html">...
<span class="tok-nt">&lt;body&gt;</span>
	List of persons <span class="tok-nt">&lt;select</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;persons&quot;</span><span class="tok-nt">&gt;&lt;/select&gt;</span> <span class="tok-nt">&lt;br/&gt;</span>
	<span class="tok-nt">&lt;br/&gt;</span>
	<span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;form&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table;&quot;</span><span class="tok-nt">&gt;</span>
			<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-row;&quot;</span><span class="tok-nt">&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>Name: <span class="tok-nt">&lt;/div&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>
					<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;name&quot;</span><span class="tok-nt">/&gt;</span>
				<span class="tok-nt">&lt;/div&gt;</span>
			<span class="tok-nt">&lt;/div&gt;</span>
			<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-row;&quot;</span><span class="tok-nt">&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>Surname: <span class="tok-nt">&lt;/div&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>
									<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;surname&quot;</span><span class="tok-nt">/&gt;</span>
								<span class="tok-nt">&lt;/div&gt;</span>
							<span class="tok-nt">&lt;/div&gt;</span>
							<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-row;&quot;</span><span class="tok-nt">&gt;</span>
								<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>Address: <span class="tok-nt">&lt;/div&gt;</span>
								<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>
									<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;address&quot;</span><span class="tok-nt">/&gt;</span>
								<span class="tok-nt">&lt;/div&gt;</span>
							<span class="tok-nt">&lt;/div&gt;</span>
							<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-row;&quot;</span><span class="tok-nt">&gt;</span>
								<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>Email: <span class="tok-nt">&lt;/div&gt;</span>
								<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>
									<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;email&quot;</span><span class="tok-nt">/&gt;</span>
								<span class="tok-nt">&lt;/div&gt;</span>
							<span class="tok-nt">&lt;/div&gt;</span>
						<span class="tok-nt">&lt;/div&gt;</span>
						<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Save&quot;</span><span class="tok-nt">/&gt;</span>
					<span class="tok-nt">&lt;/form&gt;</span>
				<span class="tok-nt">&lt;/body&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The initialization code for DropDownChoice is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Model</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">listModel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Model</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;();</span>
<span class="tok-n">ChoiceRenderer</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">personRender</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ChoiceRenderer</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;fullName&quot;</span><span class="tok-o">);</span>
<span class="tok-n">personsList</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DropDownChoice</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;persons&quot;</span><span class="tok-o">,</span> <span class="tok-n">listModel</span><span class="tok-o">,</span> <span class="tok-n">loadPersons</span><span class="tok-o">(),</span> <span class="tok-n">personRender</span><span class="tok-o">){</span>

		<span class="tok-nd">@Override</span>
		<span class="tok-kd">protected</span> <span class="tok-kt">boolean</span> <span class="tok-nf">wantOnSelectionChangedNotifications</span><span class="tok-o">()</span> <span class="tok-o">{</span>
			<span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
		<span class="tok-o">}</span>

<span class="tok-o">};</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As choice render we have used the basic implementation provided with the org.apache.wicket .markup.html.form.ChoiceRenderer class that we have seen in the previous paragraph. loadPersons() is just an utility method which generates a list of Person instances. The model for DropDownChoice is a simple instance of the Model class.</p>
</div>
<div class="paragraph">
<p>Here is the whole code of the page (except for the loadPersons() method):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">PersonListDetails</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
  <span class="tok-kd">private</span> <span class="tok-n">Form</span> <span class="tok-n">form</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">DropDownChoice</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">personsList</span><span class="tok-o">;</span>

  <span class="tok-kd">public</span> <span class="tok-nf">PersonListDetails</span><span class="tok-o">(){</span>
    <span class="tok-n">Model</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">listModel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Model</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;();</span>
    <span class="tok-n">ChoiceRenderer</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">personRender</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ChoiceRenderer</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;fullName&quot;</span><span class="tok-o">);</span>

    <span class="tok-n">personsList</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DropDownChoice</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;persons&quot;</span><span class="tok-o">,</span> <span class="tok-n">listModel</span><span class="tok-o">,</span> <span class="tok-n">loadPersons</span><span class="tok-o">(),</span>
                                                         <span class="tok-n">personRender</span><span class="tok-o">){</span>
      <span class="tok-nd">@Override</span>
      <span class="tok-kd">protected</span> <span class="tok-kt">boolean</span> <span class="tok-nf">wantOnSelectionChangedNotifications</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
      <span class="tok-o">}</span>
	    <span class="tok-o">};</span>

	    <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">personsList</span><span class="tok-o">);</span>

	    <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">CompoundPropertyModel</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;(</span><span class="tok-n">listModel</span><span class="tok-o">));</span>
	    <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;name&quot;</span><span class="tok-o">));</span>
	    <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;surname&quot;</span><span class="tok-o">));</span>
	    <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;address&quot;</span><span class="tok-o">));</span>
	    <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;email&quot;</span><span class="tok-o">));</span>

	    <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>
	  <span class="tok-o">}</span>
	       <span class="tok-c1">//loadPersons()</span>
	       <span class="tok-c1">//...</span>
	<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The two models work together as a pipeline where the output of method getObject of Model is the model object of CompoundPropertyModel. As we have seen, model chaining allows us to combine the actions of two or more models without creating new custom implementations.</p>
</div>
</div>
<div class="sect2">
<h3 id="_detachable_models">Detachable models</h3>
<div class="paragraph">
<p>In chapter 6 we have seen how Wicket uses serialization to store page instances. When an object is serialized, all its referenced objects are recursively serialized. For a page this means that all its children components, their related models as well as the model objects inside them will be serialized.
For model objects this could be a serious issue for (at least) two main reasons:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The model object could be a very large instance, hence serialization would become very expensive in terms of time and memory.</p>
</li>
<li>
<p>We simply may not be able to use a serializable object as model object. In paragraphs 1.4 and 9.2 we stated that Wicket allows us to use a POJO as backing object, but  <a href="http://en.wikipedia.org/wiki/Plain_Old_Java_Object#Definition">POJOs</a> re ordinary objects with no prespecified interface, annotation or superclass, hence they are not required to implement the standard Serializable interface.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To cope with these problems IModel extends another interface called IDetachable.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="detachable-models.png" alt="detachable models">
</div>
</div>
<div class="paragraph">
<p>This interface provides a method called detach() which is invoked by Wicket at the end of web request processing when data model is no more needed but before serialization occurs. Overriding this method we can clean any reference to data object keeping just the information needed to retrieve it later (for example the id of the table row where our data are stored). In this way we can avoid the serialization of the object wrapped into the model overcoming both the problem with non-serializable objects and the one with large data objects.</p>
</div>
<div class="paragraph">
<p>Since IModel inherits from IDetachable, every model of Wicket is “detachable”, although not all of them implement a detaching policy (like the Model class).
Usually detaching operations are strictly dependent on the persistence technology adopted for model objects (like a relational db, a NoSQL db, a queue, etc), so it&#8217;s not unusual to write a custom detachable model suited for the persistence technology chosen for a given project. To ease this task Wicket provides abstract model LoadableDetachableModel. This class internally holds a transient reference to a model object which is initialized the first time getObject()is called to precess a request. The concrete data loading is delegated to abstract method T load(). The reference to a model object is automatically set to null at the end of the request by the detach() method.</p>
</div>
<div class="paragraph">
<p>The following class diagram summarizes the methods defined inside LoadableDetachableModel.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="loadable-detachable-model.png" alt="loadable detachable model">
</div>
</div>
<div class="paragraph">
<p>onDetach and onAttach can be overridden in order to obtain further control over the detaching procedure.</p>
</div>
<div class="paragraph">
<p>Now as example of a possible use of LoadableDetachableModel, we will build a model designed to work with entities managed via  <a href="http://en.wikipedia.org/wiki/Java_Persistence_API">JPA.</a> o understand the following code a basic knowledge of JPA is required even if we won&#8217;t go into the detail of this standard.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
The following model is provided for example purposes only and is not intended to be used in production environment. Important aspects such as transaction management are not taken into account and you should rework the code before considering to use it.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">JpaLoadableModel</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-kd">extends</span> <span class="tok-n">LoadableDetachableModel</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>

  <span class="tok-kd">private</span> <span class="tok-n">EntityManagerFactory</span> <span class="tok-n">entityManagerFactory</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">Class</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">entityClass</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">Serializable</span> <span class="tok-n">identifier</span><span class="tok-o">;</span>
  <span class="tok-kd">private</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Object</span><span class="tok-o">&gt;</span> <span class="tok-n">constructorParams</span><span class="tok-o">;</span>

  <span class="tok-kd">public</span> <span class="tok-nf">JpaLoadableModel</span><span class="tok-o">(</span><span class="tok-n">EntityManagerFactory</span> <span class="tok-n">entityManagerFactory</span><span class="tok-o">,</span> <span class="tok-n">T</span> <span class="tok-n">entity</span><span class="tok-o">)</span> <span class="tok-o">{</span>

	<span class="tok-kd">super</span><span class="tok-o">();</span>

	<span class="tok-n">PersistenceUnitUtil</span> <span class="tok-n">util</span> <span class="tok-o">=</span> <span class="tok-n">entityManagerFactory</span><span class="tok-o">.</span><span class="tok-na">getPersistenceUnitUtil</span><span class="tok-o">();</span>

		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">entityManagerFactory</span> <span class="tok-o">=</span> <span class="tok-n">entityManagerFactory</span><span class="tok-o">;</span>
	    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">entityClass</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Class</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;)</span> <span class="tok-n">entity</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">();</span>
	    <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">identifier</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Serializable</span><span class="tok-o">)</span> <span class="tok-n">util</span><span class="tok-o">.</span><span class="tok-na">getIdentifier</span><span class="tok-o">(</span><span class="tok-n">entity</span><span class="tok-o">);</span>

	    <span class="tok-n">setObject</span><span class="tok-o">(</span><span class="tok-n">entity</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-n">T</span> <span class="tok-nf">load</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	   <span class="tok-n">T</span> <span class="tok-n">entity</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>

	   <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">identifier</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	       <span class="tok-n">EntityManager</span> <span class="tok-n">entityManager</span> <span class="tok-o">=</span> <span class="tok-n">entityManagerFactory</span><span class="tok-o">.</span><span class="tok-na">createEntityManager</span><span class="tok-o">();</span>
	       <span class="tok-n">entity</span> <span class="tok-o">=</span> <span class="tok-n">entityManager</span><span class="tok-o">.</span><span class="tok-na">find</span><span class="tok-o">(</span><span class="tok-n">entityClass</span><span class="tok-o">,</span> <span class="tok-n">identifier</span><span class="tok-o">);</span>
	     <span class="tok-o">}</span>
	     <span class="tok-k">return</span> <span class="tok-n">entity</span><span class="tok-o">;</span>
	   <span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onDetach</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	   <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onDetach</span><span class="tok-o">();</span>

	     <span class="tok-n">T</span> <span class="tok-n">entity</span> <span class="tok-o">=</span> <span class="tok-n">getObject</span><span class="tok-o">();</span>
	     <span class="tok-n">PersistenceUnitUtil</span> <span class="tok-n">persistenceUtil</span> <span class="tok-o">=</span> <span class="tok-n">entityManagerFactory</span><span class="tok-o">.</span><span class="tok-na">getPersistenceUnitUtil</span><span class="tok-o">();</span>

	     <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">entity</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-k">return</span><span class="tok-o">;</span>

	     <span class="tok-n">identifier</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Serializable</span><span class="tok-o">)</span> <span class="tok-n">persistenceUtil</span><span class="tok-o">.</span><span class="tok-na">getIdentifier</span><span class="tok-o">(</span><span class="tok-n">entity</span><span class="tok-o">);</span>
	  <span class="tok-o">}</span>
	<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The constructor of the model takes as input two parameters: an implementation of the JPA interface  javax.persistence.EntityManagerFactory to manage JPA entities and the entity that must be handled by this model. Inside its constructor the model saves the class of the entity and its id (which could be null if the entity has not been persisted yet). These two informations are required to retrieve the entity at a later time and are used by the load method.</p>
</div>
<div class="paragraph">
<p>onDetach is responsible for updating the entity id before detachment occurs. The id can change the first time an entity is persisted (JPA generates a new id and assigns it to the entity). Please note that this model is not responsible for saving any changes occurred to the entity object before it is detached. If we don&#8217;t want to loose these changes we must explicitly persist the entity before the detaching phase occurs.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
Since the model of this example holds a reference to the EntityManager Factory, the implementation in use must be serializable.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_using_more_than_one_model_in_a_component">Using more than one model in a component</h3>
<div class="paragraph">
<p>Sometimes our custom components may need to use more than a single model to work properly. In such a case we must manually detach the additional models used by our components. In order to do this we can overwrite the Component&#8217;s onDetach method that is called at the end of the current request. The following is the generic code of a component that uses two models:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-cm">/**</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> * fooModel is used as main model while beeModel must be manually detached</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">ComponetTwoModels</span> <span class="tok-kd">extends</span> <span class="tok-n">Component</span><span class="tok-o">{</span>

	<span class="tok-kd">private</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Bee</span><span class="tok-o">&gt;</span> <span class="tok-n">beeModel</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-nf">ComponetTwoModels</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Foo</span><span class="tok-o">&gt;</span> <span class="tok-n">fooModel</span><span class="tok-o">,</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Bee</span><span class="tok-o">&gt;</span> <span class="tok-n">beeModel</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">fooModel</span><span class="tok-o">);</span>
		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">beeModel</span> <span class="tok-o">=</span> <span class="tok-n">beeModel</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onDetach</span><span class="tok-o">()</span> <span class="tok-o">{</span>
               <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">beeModel</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span>
	   <span class="tok-n">beeModel</span><span class="tok-o">.</span><span class="tok-na">detach</span><span class="tok-o">();</span>

              <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onDetach</span><span class="tok-o">();</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>When we overwrite onDetach we must call the super class implementation of this method, usually as last line in our custom implementation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_models">Use models!</h3>
<div class="paragraph">
<p>Like many people new to Wicket, you may need a little time to fully understand the power and the advantages of using models. Taking your first steps with Wicket you may be tempted to pass row objects to your components instead of using models:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-cm">/**</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> * NOT TO DO: passing row objects to components instead of using models!</span>
<span class="tok-cm"> *</span>
<span class="tok-cm"> */</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CustomComponent</span> <span class="tok-kd">extends</span> <span class="tok-n">Component</span><span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-n">FooBean</span> <span class="tok-n">fooBean</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-nf">CustomComponent</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">FooBean</span> <span class="tok-n">fooBean</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span>
		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">fooBean</span> <span class="tok-o">=</span> <span class="tok-n">fooBean</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>
	<span class="tok-c1">//...some other ugly code :)...</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s a bad practice and you must avoid it. Using models we do not only decouple our components from the data source, but we can also relay on them (if they are dynamic) to work with the most up-to-date version of our model object. If we decide to bypass models we lose all these advantages and we force model objects to be serialized.</p>
</div>
</div>
<div class="sect2">
<h3 id="_summary_8">Summary</h3>
<div class="paragraph">
<p>Models are at the core of Wicket and they are the basic ingredient needed to taste the real power of the framework. In this chapter we have seen how to use models to bring data to our components without littering their code with technical details about their persistence strategy.
We have also introduced Wicket forms as complementary topic. With forms and models we are able to bring our applications to life allowing them to interact with users. But what we have seen in this chapter about Wicket forms is just the tip of the iceberg. That&#8217;s why the next chapter is entirely dedicated to them.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wicket_forms_in_detail">Wicket forms in detail</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the previous chapter we have only scratched the surface of Wicket forms. The Form component was not only designed to collect user input but also to extend the semantic of the classic HTML forms with new features.</p>
</div>
<div class="paragraph">
<p>One of such features is the ability to work with nested forms (they will be discussed in  <a href="#guide:forms2_6">paragraph 12.6</a>
).</p>
</div>
<div class="paragraph">
<p>In this chapter we will continue to explore Wicket forms learning how to master them and how to build effective and user-proof forms for our web applications.</p>
</div>
<div class="sect2">
<h3 id="_default_form_processing">Default form processing</h3>
<div class="paragraph">
<p>In  <a href="#guide:modelsforms_3">paragraph 11.3</a>
 we have seen a very basic usage of the Form component and we didn&#8217;t pay much attention to what happens behind the scenes of form submission. In Wicket when we submit a form we trigger the following steps on server side:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Form validation: user input is checked to see if it satisfies the validation rules set on the form. If validation fails, step number 2 is skipped and the form should display a feedback message to explain to user what went wrong. During this step input values (which are simple strings sent with a web request) are converted into Java objects. In the next paragraphs we will explore the infrastructures provided by Wicket for the three sub-tasks involved with form validation, which are: conversion of user input into objects, validation of user input, and visualization of feedback messages.</p>
</li>
<li>
<p>Updating of models: if validation succeeds, the form updates the model of its children components with the converted values obtained in the previous step.</p>
</li>
<li>
<p>Invoking callback methods onSubmit() or onError(): if we didn&#8217;t have any validation error, method onSubmit() is called, otherwise onError() will be called. The default implementation of both these methods is left empty and we can override them to perform custom actions.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Please note that the model of form components is updated only if no validation error occurred (i.e. step two is performed only if validation succeeds).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Without going into too much detail, we can say that the first two steps of form processing correspond to the invocation of one or more Form&#8217;s internal methods (which are declared protected and final). Some examples of these methods are validate(), which is invoked during validation step, and updateFormComponentModels(), which is used at the step that updates the form field models.</p>
</div>
<div class="paragraph">
<p>The whole form processing is started invoking public method process(IFormSubmitter) (Later in  <a href="#guide:forms2_5">paragraph 12.5</a>
 we will introduce interface IFormSubmitter).</p>
</div>
</div>
<div class="sect2">
<h3 id="_form_validation_and_feedback_messages">Form validation and feedback messages</h3>
<div class="paragraph">
<p>A basic example of a validation rule is to make a field required. In  <a href="#guide:modelsforms_3">paragraph 11.3</a>
 we have already seen how this can be done calling setRequired(true) on a field. However, to set a validation rule on a FormComponent we must add the corresponding validator to it.</p>
</div>
<div class="paragraph">
<p>A validator is an implementation of the <em>org.apache.wicket.validation.IValidator</em> interface and the <em>FormComponent</em> has a version of method add which takes as input a reference of this interface.</p>
</div>
<div class="paragraph">
<p>For example if we want to use a text field to insert an email address, we could use the built-in validator  EmailAddressValidator to ensure that the inserted input will respect the email format  <a href="http://en.wikipedia.org/wiki/Email_address">local-part@domain</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">TextField</span> <span class="tok-n">email</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;email&quot;</span><span class="tok-o">);</span>
<span class="tok-n">email</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">EmailAddressValidator</span><span class="tok-o">.</span><span class="tok-na">getInstance</span><span class="tok-o">());</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wicket comes with a set of built-in validators that should suit most of our needs. We will see them later in this chapter.</p>
</div>
</div>
<div class="sect2">
<h3 id="_feedback_messages_and_localization">Feedback messages and localization</h3>
<div class="paragraph">
<p>Wicket generates a feedback message for each field that doesn&#8217;t satisfy one of its validation rules. For example the message generated when a required field is left empty is the following</p>
</div>
<div class="paragraph">
<p><em>Field '&lt;label&gt;</em> is required.'</p>
</div>
<div class="paragraph">
<p>&lt;label&gt; is the value of the label model set on a FormComponent with method setLabel(IModel &lt;String&gt; model). If such model is not provided, component id will be used as the default value.</p>
</div>
<div class="paragraph">
<p>The entire infrastructure of feedback messages is built on top of the Java internationalization (I18N) support and it uses  source[local-part@domain] cs.oracle.com/javase/tutorial/i18n/resbundle/index.html to store messages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The topics of internationalization will be covered in  <a href="#guide:i18n">chapter 15</a>
. For now we will give just few notions needed to understand the examples from this chapter.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default resource bundles are stored into properties files but we can easily configure other sources as described later in  <a href="#guide:i18n_2">paragraph 15.2</a>
.</p>
</div>
<div class="paragraph">
<p>Default feedback messages (like the one above for required fields) are stored in the file Application. properties placed inside Wicket the org.apache.wicket package. Opening this file we can find the key and the localized value of the message:</p>
</div>
<div class="paragraph">
<p><em>Required=Field '${label}</em> is required.'</p>
</div>
<div class="paragraph">
<p>We can note the key (Required in our case) and the label parameter written in the  pression[guide:i18n_2] p://en.wikipedia.org/wiki/Expression_Language (${label}). Scrolling down this file we can also find the message used by the Email AddressValidator:</p>
</div>
<div class="paragraph">
<p><em>EmailAddressValidator=The value of '${label}</em> is not a valid email address.'</p>
</div>
<div class="paragraph">
<p>By default FormComponent provides 3 parameters for feedback message: input (the value that failed validation), label and name (this later is the id of the component).</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
Remember that component model is updated with the user input only if validation succeeds! As a consequence, we can&#8217;t retrieve the wrong value inserted for a field from its model. Instead, we should use getValue() method of FormComponent class. (This method will be introduced in the example used later in this chapter)
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_displaying_feedback_messages_and_filtering_them">Displaying feedback messages and filtering them</h3>
<div class="paragraph">
<p>To display feedback messages we must use component <em>org.apache.wicket.markup.html.panel.FeedbackPanel</em>. This component automatically reads all the feedback messages generated during form validation and displays them with an unordered list:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;ul</span> <span class="tok-na">class=</span><span class="tok-s">&quot;feedbackPanel&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;li</span> <span class="tok-na">class=</span><span class="tok-s">&quot;feedbackPanelERROR&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;span</span> <span class="tok-na">class=</span><span class="tok-s">&quot;feedbackPanelERROR&quot;</span><span class="tok-nt">&gt;</span>Field &#39;Username&#39; is required.<span class="tok-nt">&lt;/span&gt;</span>
	<span class="tok-nt">&lt;/li&gt;</span>
<span class="tok-nt">&lt;/ul&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>CSS classes  [feedbackPanel] nd  [feedbackPanelERROR] an be used in order to customize the style of the message list:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="feedback-panel-style.png" alt="feedback panel style">
</div>
</div>
<div class="paragraph">
<p>The component can be freely placed inside the page and we can set the maximum amount of displayed messages with the setMaxMessages() method.</p>
</div>
<div class="paragraph">
<p>Error messages can be filtered using three built-in filters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>ComponentFeedbackMessageFilter</strong>: shows only messages coming from a specific component.</p>
</li>
<li>
<p><strong>ContainerFeedbackMessageFilter</strong>: shows only messages coming from a specific container or from any of its children components.</p>
</li>
<li>
<p><strong>ErrorLevelFeedbackMessageFilter</strong>: shows only messages with a level of severity equals or greater than a given lower bound. Class FeedbackMessage defines a set of static constants to express different levels of severity: DEBUG, ERROR, WARNING, INFO, SUCCESS, etc&#8230;. Levels of severity for feedback messages are discussed later in this chapter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These filters are intended to be used when there are more than one feedback panel (or more than one form) in the same page. We can pass a filter to a feedback panel via its constructor or using the setFilter method. Custom filters can be created implementing the IFeedbackMessageFilter interface. An example of custom filter is illustrated later in this paragraph.</p>
</div>
</div>
<div class="sect2">
<h3 id="_built_in_validators">Built-in validators</h3>
<div class="paragraph">
<p>Wicket already provides a number of built-in validators ready to be used. The following table is a short reference where validators are listed along with a brief description of what they do. The default feedback message used by each of them is reported as well:</p>
</div>
<div class="sect3">
<h4 id="_emailaddressvalidator">EmailAddressValidator</h4>
<div class="paragraph">
<p>Checks if input respects the format local-part'domain.</p>
</div>
<div class="paragraph">
<p><strong>Message:</strong></p>
</div>
<div class="paragraph">
<p><em>The value of '${label}</em> is not a valid email address.'</p>
</div>
</div>
<div class="sect3">
<h4 id="_urlvalidator">UrlValidator</h4>
<div class="paragraph">
<p>Checks if input is a valid URL. We can specify in the constructor which protocols are allowed (http://, https://, and <a href="ftp://)">ftp://)</a>.</p>
</div>
<div class="paragraph">
<p><strong>Message:</strong></p>
</div>
<div class="paragraph">
<p><em>The value of '${label}</em> is not a valid URL.'</p>
</div>
</div>
<div class="sect3">
<h4 id="_datevalidator">DateValidator</h4>
<div class="paragraph">
<p>Validator class that can be extended or used as a factory class to get date validators to check if a date is bigger than a lower bound (method minimum(Date min)), smaller than a upper bound (method maximum(Date max)) or inside a range (method range(Date min, Date max)).</p>
</div>
<div class="paragraph">
<p><strong>Messages:</strong></p>
</div>
<div class="paragraph">
<p><em>The value of '${label}</em> is less than the minimum of ${minimum}.'</p>
</div>
<div class="paragraph">
<p><em>The value of '${label}</em> is larger than the maximum of ${maximum}.'</p>
</div>
<div class="paragraph">
<p><em>The value of '${label}</em> is not between ${minimum} and ${maximum}.'</p>
</div>
</div>
<div class="sect3">
<h4 id="_rangevalidator">RangeValidator</h4>
<div class="paragraph">
<p>Validator class that can be extended or used as a factory class to get validators to check if a value is bigger than a given lower bound (method minimum(T min)), smaller than a upper bound (method maximum(T max)) or inside a range (method range(T min,T max)).</p>
</div>
<div class="paragraph">
<p>The type of the value is a generic subtype of java.lang.Comparable and must implement Serializable interface.</p>
</div>
<div class="paragraph">
<p><strong>Messages:</strong></p>
</div>
<div class="paragraph">
<p><em>The value of '${label}</em> must be at least ${minimum}.'</p>
</div>
<div class="paragraph">
<p><em>The value of '${label}</em> must be at most ${maximum}.'</p>
</div>
<div class="paragraph">
<p><em>The value of '${label}</em> must be between ${minimum} and ${maximum}.'</p>
</div>
</div>
<div class="sect3">
<h4 id="_stringvalidator">StringValidator</h4>
<div class="paragraph">
<p>Validator class that can be extended or used as a factory class to get validators to check if the length of a string value is bigger then a given lower bound (method minimumLength (int min)), smaller then a given upper bound (method maximumLength (int max)) or within a given range (method lengthBetween(int min, int max)).</p>
</div>
<div class="paragraph">
<p>To accept only string values consisting of exactly n characters, we must use method exactLength(int length).</p>
</div>
<div class="paragraph">
<p><strong>Messages:</strong></p>
</div>
<div class="paragraph">
<p><em>The value of '${label}</em> is shorter than the minimum of ${minimum} characters.'</p>
</div>
<div class="paragraph">
<p><em>The value of '${label}</em> is longer than the maximum of ${maximum} characters.'</p>
</div>
<div class="paragraph">
<p><em>The value of '${label}</em> is not between ${minimum} and ${maximum} characters long.'</p>
</div>
<div class="paragraph">
<p><em>The value of '${label}</em> is not exactly ${exact} characters long.'</p>
</div>
</div>
<div class="sect3">
<h4 id="_creditcardvalidator">CreditCardValidator</h4>
<div class="paragraph">
<p>Checks if input is a valid credit card number. This validator supports some of the most popular credit cards (like “American Express [feedbackPanelERROR] sa” or “Diners Club”).</p>
</div>
<div class="paragraph">
<p><strong>Message:</strong></p>
</div>
<div class="paragraph">
<p><em>The credit card number is invalid.</em></p>
</div>
</div>
<div class="sect3">
<h4 id="_equalpasswordinputvalidator">EqualPasswordInputValidator</h4>
<div class="paragraph">
<p>This validator checks if two password fields have the same value.</p>
</div>
<div class="paragraph">
<p><strong>Message:</strong></p>
</div>
<div class="paragraph">
<p><em>${label0} and ${label1} must be equal.</em></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_overriding_standard_feedback_messages_with_custom_bundles">Overriding standard feedback messages with custom bundles</h3>
<div class="paragraph">
<p>If we don&#8217;t like the default validation feedback messages, we can override them providing custom properties files. In these files we can write our custom messages using the same keys of the messages we want to override. For example if we wanted to override the default message for invalid email addresses, our properties file would contain a line like this:</p>
</div>
<div class="paragraph">
<p><em>EmailAddressValidator=Man, your email address is not good!</em></p>
</div>
<div class="paragraph">
<p>As we will see in the next chapter, Wicket searches for custom properties files in various positions inside the application&#8217;s class path, but for now we will consider just the properties file placed next to our application class. The name of this file must be equal to the name of our application class:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="custom-properties-file.png" alt="custom properties file">
</div>
</div>
<div class="paragraph">
<p>The example project OverrideMailMessage overrides email validator&#8217;s message with a new one which also reports the value that failed validation:</p>
</div>
<div class="paragraph">
<p><em>EmailAddressValidator=The value '${input}</em> inserted for field <em>${label}</em> is not a valid email address.'</p>
</div>
<div class="imageblock">
<div class="content">
<img src="validation-error-message.png" alt="validation error message">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_custom_validators">Creating custom validators</h3>
<div class="paragraph">
<p>If our web application requires a complex validation logic and built-in validators are not enough, we can  implement our own custom validators. For example (project UsernameCustomValidator) suppose we are working on the registration page of our site where users can create their profile choosing their username. Our registration form should validate the new username checking if it was already chosen by another user. In a situation like this we may need to implement a custom validator that queries a specific data source to check if a username is already in use.</p>
</div>
<div class="paragraph">
<p>For the sake of simplicity, the validator of our example will check the given username against a fixed list of three existing usernames.</p>
</div>
<div class="paragraph">
<p>A custom validator must simply implement interface IValidator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">UsernameValidator</span> <span class="tok-kd">implements</span> <span class="tok-n">IValidator</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
	<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">existingUsernames</span> <span class="tok-o">=</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span><span class="tok-s">&quot;bigJack&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;anonymous&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;mrSmith&quot;</span><span class="tok-o">);</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">validate</span><span class="tok-o">(</span><span class="tok-n">IValidatable</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">validatable</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">String</span> <span class="tok-n">chosenUserName</span> <span class="tok-o">=</span> <span class="tok-n">validatable</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">();</span>

		<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">existingUsernames</span><span class="tok-o">.</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-n">chosenUserName</span><span class="tok-o">)){</span>
			<span class="tok-n">ValidationError</span> <span class="tok-n">error</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ValidationError</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
			<span class="tok-n">Random</span> <span class="tok-n">random</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Random</span><span class="tok-o">();</span>

			<span class="tok-n">error</span><span class="tok-o">.</span><span class="tok-na">setVariable</span><span class="tok-o">(</span><span class="tok-s">&quot;suggestedUserName&quot;</span><span class="tok-o">,</span>
					<span class="tok-n">validatable</span><span class="tok-o">.</span><span class="tok-na">getValue</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-n">random</span><span class="tok-o">.</span><span class="tok-na">nextInt</span><span class="tok-o">());</span>
			<span class="tok-n">validatable</span><span class="tok-o">.</span><span class="tok-na">error</span><span class="tok-o">(</span><span class="tok-n">error</span><span class="tok-o">);</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The only method defined inside IValidator is validate(IValidatable&lt;T&gt; validatable) and is invoked during validation&#8217;s step. Interface IValidatable represents the component being validated and it can be used to retrieve the component model (getModel()) or the value to validate (getValue()).</p>
</div>
<div class="paragraph">
<p>The custom validation logic is all inside IValidator&#8217;s method validate. When validation fails a validator must use IValidatable&#8217;s method error(IValidationError error) to generate the appropriate feedback message. In the code above we used the ValidationError class as convenience implementation of the IValidationError interface which represents the validation error that must be displayed to the user. This class provides a constructor that uses the class name of the validator in input as key for the resource to use as feedback message (i.e. <em>UsernameValidator</em> in the example). If we want to specify more then one key to use to locate the error message, we can use method addKey(String key) of ValidationError class.</p>
</div>
<div class="paragraph">
<p>In our example when validation fails, we suggest a possible username concatenating the given input with a pseudo-random integer. This value is passed to the feedback message with a variable named suggestedUserName. The message is inside application&#8217;s properties file:</p>
</div>
<div class="paragraph">
<p><em>UsernameValidator=The username '${input}</em> is already in use. Try with <em>${suggestedusername}</em>'</p>
</div>
<div class="paragraph">
<p>To provide further variables to our feedback message we can use method setVariable(String name, Object value) of class ValidationError as we did in our example.</p>
</div>
<div class="paragraph">
<p>The code of the home page of the project will be examined in the next paragraph after we have introduced the topic of flash messages.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_flash_messages">Using flash messages</h3>
<div class="paragraph">
<p>So far we have considered just the error messages generated during validation step. However Wicket&#8217;s Component class provides a set of methods to explicitly generate feedback messages called flash messages. These methods are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>debug(Serializable message)</p>
</li>
<li>
<p>info(Serializable message)</p>
</li>
<li>
<p>success(Serializable message)</p>
</li>
<li>
<p>warn(Serializable message)</p>
</li>
<li>
<p>error(Serializable message)</p>
</li>
<li>
<p>fatal(Serializable message)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each of these methods corresponds to a level of severity for the message. The list above is sorted by increasing level of severity.</p>
</div>
<div class="paragraph">
<p>In the example seen in the previous paragraph we have a form which uses success method to notify user when the inserted username is valid. Inside this form there are two FeedbackPanel components: one to display the error message produced by custom validator and the other one to display the success message. The code of the example page is the following:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;body&gt;</span>
	<span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;form&quot;</span><span class="tok-nt">&gt;</span>
		Username: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;username&quot;</span><span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;br/&gt;</span>
		<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span><span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/form&gt;</span>
	<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;color:green&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;succesMessage&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;/div&gt;</span>
	<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;color:red&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;feedbackMessage&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-n">Form</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">){</span>
		<span class="tok-nd">@Override</span>
		<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onSubmit</span><span class="tok-o">()</span> <span class="tok-o">{</span>
			<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onSubmit</span><span class="tok-o">();</span>
			<span class="tok-n">success</span><span class="tok-o">(</span><span class="tok-s">&quot;Username is good!&quot;</span><span class="tok-o">);</span>
		<span class="tok-o">}</span>
	<span class="tok-o">};</span>

	<span class="tok-n">TextField</span> <span class="tok-n">mail</span><span class="tok-o">;</span>

	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">mail</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">)));</span>
	<span class="tok-n">mail</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">UsernameValidator</span><span class="tok-o">());</span>

	<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">FeedbackPanel</span><span class="tok-o">(</span><span class="tok-s">&quot;feedbackMessage&quot;</span><span class="tok-o">,</span>
		<span class="tok-k">new</span> <span class="tok-n">ExactErrorLevelFilter</span><span class="tok-o">(</span><span class="tok-n">FeedbackMessage</span><span class="tok-o">.</span><span class="tok-na">ERROR</span><span class="tok-o">)));</span>
	<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">FeedbackPanel</span><span class="tok-o">(</span><span class="tok-s">&quot;succesMessage&quot;</span><span class="tok-o">,</span>
		<span class="tok-k">new</span> <span class="tok-n">ExactErrorLevelFilter</span><span class="tok-o">(</span><span class="tok-n">FeedbackMessage</span><span class="tok-o">.</span><span class="tok-na">SUCCESS</span><span class="tok-o">)));</span>

	<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">class</span> <span class="tok-nc">ExactErrorLevelFilter</span> <span class="tok-kd">implements</span> <span class="tok-n">IFeedbackMessageFilter</span><span class="tok-o">{</span>
    	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">errorLevel</span><span class="tok-o">;</span>

		<span class="tok-kd">public</span> <span class="tok-nf">ExactErrorLevelFilter</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">errorLevel</span><span class="tok-o">){</span>
			<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">errorLevel</span> <span class="tok-o">=</span> <span class="tok-n">errorLevel</span><span class="tok-o">;</span>
		<span class="tok-o">}</span>

		<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">accept</span><span class="tok-o">(</span><span class="tok-n">FeedbackMessage</span> <span class="tok-n">message</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-k">return</span> <span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">getLevel</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-n">errorLevel</span><span class="tok-o">;</span>
		<span class="tok-o">}</span>

    <span class="tok-o">}</span>
    <span class="tok-c1">//UsernameValidator definition</span>
    <span class="tok-c1">//...</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The two feedback panels must be filtered in order to display just the messages with a given level of severity (ERROR for validator message and SUCCESS for form&#8217;s flash message). Unfortunately the built-in message filter ErrorLevelFeedbackMessageFilter is not suitable for this task because its filter condition does not check for an exact error level (the given level is used as lower bound value). As a consequence, we had to build a custom filter (inner class ExactErrorLevelFilter) to accept only the desired severity level (see method accept of interface IFeedbackMessageFilter).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Since version 6.13.0 Wicket provides the additional filter class org.apache.wicket.feedback.ExactLevelFeedbackMessageFilter to accept only feedback messages of a certain error level.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_input_value_conversion">Input value conversion</h3>
<div class="paragraph">
<p>Working with Wicket we will rarely need to worry about conversion between input values (which are strings because the underlying HTTP protocol) and Java types because in most cases the default conversion mechanism will be smart enough to infer the type of the model object and perform the proper conversion. However, sometimes we may need to work under the hood of this mechanism to make it properly work or to perform custom conversions. That&#8217;s why this paragraph will illustrate how to control input value conversion.</p>
</div>
<div class="paragraph">
<p>The component that is responsible for converting input is the FormComponent itself with its convertInput() method. In order to convert its input a FormComponent must know the type of its model object. This parameter can be explicitly set with method setType(Class&lt;?&gt; type):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//this field must receive an integer value</span>
<span class="tok-n">TextField</span> <span class="tok-n">integerField</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;number&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Model</span><span class="tok-o">()).</span><span class="tok-na">setType</span><span class="tok-o">(</span><span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If no type has been provided, FormComponent will try to ask its model for this information. The PropertyModel and CompoundPropertyModel models can use reflection to get the type of object model. By default, if FormComponent can not obtain the type of its model object in any way, it will consider it as a simple String.</p>
</div>
<div class="paragraph">
<p>Once FormComponent has determined the type of model object, it can look up for a converter, which is the entity in charge of converting input to Java object and vice versa. Converters are instances of <em>org.apache.wicket.util.convert.IConverter</em> interface and are registered by our application class on start up.</p>
</div>
<div class="paragraph">
<p>To get a converter for a specific type we must call method getConverter(Class&lt;C&gt; type) on the interface IConverterLocator returned by Application&#8217;s method getConverterLocator():</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//retrieve converter for Boolean type</span>
<span class="tok-n">Application</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">getConverterLocator</span><span class="tok-o">().</span><span class="tok-na">getConverter</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Components which are subclasses of AbstractSingleSelectChoice don&#8217;t follow the schema illustrated above to convert user input.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>These kinds of components (like DropDownChoice and RadioChoice1) use their choice render and their collection of possible choices to perform input conversion.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_custom_application_scoped_converters">Creating custom application-scoped converters</h3>
<div class="paragraph">
<p>The default converter locator used by Wicket is <em>org.apache.wicket.ConverterLocator</em>. This class provides converters for the most common Java types. Here we can see the converters registered inside its constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-nf">ConverterLocator</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">BooleanConverter</span><span class="tok-o">.</span><span class="tok-na">INSTANCE</span><span class="tok-o">);</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Boolean</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">BooleanConverter</span><span class="tok-o">.</span><span class="tok-na">INSTANCE</span><span class="tok-o">);</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Byte</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">ByteConverter</span><span class="tok-o">.</span><span class="tok-na">INSTANCE</span><span class="tok-o">);</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Byte</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">ByteConverter</span><span class="tok-o">.</span><span class="tok-na">INSTANCE</span><span class="tok-o">);</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Character</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">CharacterConverter</span><span class="tok-o">.</span><span class="tok-na">INSTANCE</span><span class="tok-o">);</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Character</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">CharacterConverter</span><span class="tok-o">.</span><span class="tok-na">INSTANCE</span><span class="tok-o">);</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">DoubleConverter</span><span class="tok-o">.</span><span class="tok-na">INSTANCE</span><span class="tok-o">);</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">DoubleConverter</span><span class="tok-o">.</span><span class="tok-na">INSTANCE</span><span class="tok-o">);</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Float</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">FloatConverter</span><span class="tok-o">.</span><span class="tok-na">INSTANCE</span><span class="tok-o">);</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Float</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">FloatConverter</span><span class="tok-o">.</span><span class="tok-na">INSTANCE</span><span class="tok-o">);</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">IntegerConverter</span><span class="tok-o">.</span><span class="tok-na">INSTANCE</span><span class="tok-o">);</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Integer</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">IntegerConverter</span><span class="tok-o">.</span><span class="tok-na">INSTANCE</span><span class="tok-o">);</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Long</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">LongConverter</span><span class="tok-o">.</span><span class="tok-na">INSTANCE</span><span class="tok-o">);</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Long</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">LongConverter</span><span class="tok-o">.</span><span class="tok-na">INSTANCE</span><span class="tok-o">);</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Short</span><span class="tok-o">.</span><span class="tok-na">TYPE</span><span class="tok-o">,</span> <span class="tok-n">ShortConverter</span><span class="tok-o">.</span><span class="tok-na">INSTANCE</span><span class="tok-o">);</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Short</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">ShortConverter</span><span class="tok-o">.</span><span class="tok-na">INSTANCE</span><span class="tok-o">);</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Date</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">DateConverter</span><span class="tok-o">());</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">Calendar</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">CalendarConverter</span><span class="tok-o">());</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">sql</span><span class="tok-o">.</span><span class="tok-na">Date</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">SqlDateConverter</span><span class="tok-o">());</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">sql</span><span class="tok-o">.</span><span class="tok-na">Time</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">SqlTimeConverter</span><span class="tok-o">());</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">sql</span><span class="tok-o">.</span><span class="tok-na">Timestamp</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">SqlTimestampConverter</span><span class="tok-o">());</span>
	<span class="tok-n">set</span><span class="tok-o">(</span><span class="tok-n">BigDecimal</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">BigDecimalConverter</span><span class="tok-o">());</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we want to add more converters to our application, we can override Application&#8217;s method newConverterLocator which is used by application class to build its converter locator.</p>
</div>
<div class="paragraph">
<p>To illustrate how to implement custom converters and use them in our application, we will build a form with two text field: one to input a regular expression pattern and another one to input a string value that will be split with the given pattern.</p>
</div>
<div class="paragraph">
<p>The first text field will have an instance of class java.util.regex.Pattern as model object. The final page will look like this (the code of this example is from the CustomConverter project):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="regex-form.png" alt="regex form">
</div>
</div>
<div class="paragraph">
<p>The conversion between Pattern and String is quite straightforward. The code of our custom converter is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RegExpPatternConverter</span> <span class="tok-kd">implements</span> <span class="tok-n">IConverter</span><span class="tok-o">&lt;</span><span class="tok-n">Pattern</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-n">Pattern</span> <span class="tok-nf">convertToObject</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-n">Locale</span> <span class="tok-n">locale</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">Pattern</span><span class="tok-o">.</span><span class="tok-na">compile</span><span class="tok-o">(</span><span class="tok-n">value</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">convertToString</span><span class="tok-o">(</span><span class="tok-n">Pattern</span> <span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-n">Locale</span> <span class="tok-n">locale</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">value</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">();</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Methods declared by interface IConverter take as input a Locale parameter in order to deal with locale-sensitive data and conversions. We will learn more about locales and internationalization in  <a href="#guide:i18n">paragraph 15</a>
.</p>
</div>
<div class="paragraph">
<p>Once we have implemented our custom converter, we must override method newConverterLocator() inside our application class and tell it to add our new converter to the default set:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-n">IConverterLocator</span> <span class="tok-nf">newConverterLocator</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-n">ConverterLocator</span> <span class="tok-n">defaultLocator</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ConverterLocator</span><span class="tok-o">();</span>

		<span class="tok-n">defaultLocator</span><span class="tok-o">.</span><span class="tok-na">set</span><span class="tok-o">(</span><span class="tok-n">Pattern</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">RegExpPatternConverter</span><span class="tok-o">());</span>

		<span class="tok-k">return</span> <span class="tok-n">defaultLocator</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, in the home page of the project we build the form which displays (with a flash message) the tokens obtained splitting the string with the given pattern:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">Pattern</span> <span class="tok-n">regExpPatter</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">stringToSplit</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    	<span class="tok-n">TextField</span> <span class="tok-n">mail</span><span class="tok-o">;</span>
	<span class="tok-n">TextField</span> <span class="tok-n">stringToSplitTxt</span><span class="tok-o">;</span>

    	<span class="tok-n">Form</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">){</span>
			<span class="tok-nd">@Override</span>
			<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onSubmit</span><span class="tok-o">()</span> <span class="tok-o">{</span>
				<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onSubmit</span><span class="tok-o">();</span>
				<span class="tok-n">String</span> <span class="tok-n">messageResult</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Tokens for the given string and pattern:&lt;br/&gt;&quot;</span><span class="tok-o">;</span>
				<span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">tokens</span> <span class="tok-o">=</span> <span class="tok-n">regExpPatter</span><span class="tok-o">.</span><span class="tok-na">split</span><span class="tok-o">(</span><span class="tok-n">stringToSplit</span><span class="tok-o">);</span>

				<span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">token</span> <span class="tok-o">:</span> <span class="tok-n">tokens</span><span class="tok-o">)</span> <span class="tok-o">{</span>
					<span class="tok-n">messageResult</span> <span class="tok-o">+=</span> <span class="tok-s">&quot;- &quot;</span> <span class="tok-o">+</span> <span class="tok-n">token</span> <span class="tok-o">+</span> <span class="tok-s">&quot;&lt;br/&gt;&quot;</span><span class="tok-o">;</span>
				<span class="tok-o">}</span>
				<span class="tok-n">success</span><span class="tok-o">(</span><span class="tok-n">messageResult</span><span class="tok-o">);</span>
		<span class="tok-o">}</span>
	<span class="tok-o">};</span>

		<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">setDefaultModel</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">CompoundPropertyModel</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">));</span>
		<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">mail</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;regExpPatter&quot;</span><span class="tok-o">));</span>
		<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">stringToSplitTxt</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;stringToSplit&quot;</span><span class="tok-o">));</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">FeedbackPanel</span><span class="tok-o">(</span><span class="tok-s">&quot;feedbackMessage&quot;</span><span class="tok-o">).</span><span class="tok-na">setEscapeModelStrings</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">));</span>

		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
If the user input can not be converted to the target type, FormComponent will generate the default error message “The value of <em>${label}</em> is not a valid ${type}.”. The bundle key for this message is IConverter.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_validation_with_jsr_303">Validation with JSR 303</h3>
<div class="paragraph">
<p>Standard JSR 303 defines a set of annotations and APIs to validate our domain objects at field-level. Wicket has introduced an experimental support for this standard since version 6.4.0 and with version 6.14.0 it has became an official Wicket model (named <em>wicket-bean-validation</em>).
In this paragraph we will see the basic steps needed to use JSR 303 validation in our Wicket application. Code snippets are from example project <em>JSR303validation</em>.</p>
</div>
<div class="paragraph">
<p>In the example application we have a form to insert the data for a new <em>Person</em> bean and its relative <em>Address</em>. The code for class <em>Person</em> is the following</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Person</span> <span class="tok-kd">implements</span> <span class="tok-n">Serializable</span><span class="tok-o">{</span>

	<span class="tok-nd">@NotNull</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>

	<span class="tok-c1">//regular expression to validate an email address</span>
	<span class="tok-nd">@Pattern</span><span class="tok-o">(</span><span class="tok-n">regexp</span> <span class="tok-o">=</span> <span class="tok-s">&quot;^[_A-Za-z0-9-]+(.[_A-Za-z0-9-]+)*[A-Za-z0-9-]+(.[A-Za-z0-9-]+)*((.[A-Za-z]{2,}){1}$)&quot;</span><span class="tok-o">)</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">email</span><span class="tok-o">;</span>

	<span class="tok-nd">@Range</span><span class="tok-o">(</span><span class="tok-n">min</span> <span class="tok-o">=</span> <span class="tok-mi">18</span><span class="tok-o">,</span> <span class="tok-n">max</span> <span class="tok-o">=</span> <span class="tok-mi">150</span><span class="tok-o">)</span>
	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">age</span><span class="tok-o">;</span>

	<span class="tok-nd">@Past</span> <span class="tok-nd">@NotNull</span>
	<span class="tok-kd">private</span> <span class="tok-n">Date</span> <span class="tok-n">birthDay</span><span class="tok-o">;</span>

	<span class="tok-nd">@NotNull</span>
	<span class="tok-kd">private</span> <span class="tok-n">Address</span> <span class="tok-n">address</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can note the JSR 303 annotations used in the code above to declare validation constraints on class fields. Class <em>Address</em> has the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Address</span> <span class="tok-kd">implements</span> <span class="tok-n">Serializable</span> <span class="tok-o">{</span>

	<span class="tok-nd">@NotNull</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">city</span><span class="tok-o">;</span>

	<span class="tok-nd">@NotNull</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">street</span><span class="tok-o">;</span>

	<span class="tok-nd">@Pattern</span><span class="tok-o">(</span><span class="tok-n">regexp</span> <span class="tok-o">=</span> <span class="tok-s">&quot;\\d+&quot;</span><span class="tok-o">,</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;{address.invalidZipCode}&quot;</span><span class="tok-o">)</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">zipCode</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>You might have noted that in class <em>Address</em> we have used annotation <em>Pattern using also attribute 'message</em> which contains the key of the bundle to use for validation message. Our custom bundle is contained inside <em>HomePage.properties</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">address</span><span class="tok-o">.</span><span class="tok-na">invalidZipCode</span><span class="tok-o">=</span><span class="tok-n">The</span> <span class="tok-n">inserted</span> <span class="tok-n">zip</span> <span class="tok-n">code</span> <span class="tok-n">is</span> <span class="tok-n">not</span> <span class="tok-n">valid</span><span class="tok-o">.</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To tell Wicket to use JSR 303, we must register bean validator on Application&#8217;s startup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">WicketApplication</span> <span class="tok-kd">extends</span> <span class="tok-n">WebApplication</span> <span class="tok-o">{</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">(){</span>
		<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>

		<span class="tok-k">new</span> <span class="tok-n">BeanValidationConfiguration</span><span class="tok-o">().</span><span class="tok-na">configure</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last step to harness JSR 303 annotations is to add validator <em>org.apache.wicket.bean.validation.PropertyValidator</em> to our corresponding form components:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">parameters</span><span class="tok-o">);</span>

	<span class="tok-n">setDefaultModel</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">CompoundPropertyModel</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;(</span><span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">()));</span>

	<span class="tok-n">Form</span><span class="tok-o">&lt;</span><span class="tok-n">Void</span><span class="tok-o">&gt;</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">&lt;</span><span class="tok-n">Void</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">);</span>

	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;name&quot;</span><span class="tok-o">).</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">PropertyValidator</span><span class="tok-o">()));</span>
	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;email&quot;</span><span class="tok-o">).</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">PropertyValidator</span><span class="tok-o">()));</span>
	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;age&quot;</span><span class="tok-o">).</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">PropertyValidator</span><span class="tok-o">()));</span>
        <span class="tok-c1">//...</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can run our application an see that JSR 303 annotations are fully effective:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="jsr303-form-validation.png" alt="jsr303 form validation">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_submit_form_with_an_iformsubmittingcomponent">Submit form with an IFormSubmittingComponent</h3>
<div class="paragraph">
<p>Besides submitting forms with a standard HTML submit button, Wicket allows us to use special components which implement interface IFormSubmittingComponent. This entity is a subinterface of  IFormSubmitter:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="class-diag-IFormSubmittingComponent.png" alt="class diag IFormSubmittingComponent">
</div>
</div>
<div class="paragraph">
<p>At the beginning of this chapter we have seen that form processing is started by process method which takes as input an instance of IFormSubmitter. This parameter corresponds to the IFormSubmittingComponent clicked by a user to submit the form and it is null if we have used a standard HTML submit button (like we have done so far).</p>
</div>
<div class="paragraph">
<p>A submitting component is added to a form just like any other child component using method add(Component&#8230;).</p>
</div>
<div class="paragraph">
<p>A form can have any number of submitting components and we can specify which one among them is the default one by calling the Form&#8217;s method setDefaultButton(IFormSubmittingComponent  component). The default submitter is the one that will be used when user presses <em>Enter</em> key in a field of the form. In order to make the default button work, Wicket will add to our form a hidden &lt;div&gt; tag containing a text field and a submit button with some JavaScript code to trigger it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;width:0px;height:0px;position:absolute;left:-100px;top:-100px;overflow:hidden&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">autocomplete=</span><span class="tok-s">&quot;off&quot;</span><span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;submit2&quot;</span> <span class="tok-na">onclick=</span><span class="tok-s">&quot; var b=document....&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just like Wicket forms, interface IFormSubmitter defines methods onSubmit and onError. These two methods have the priority over the namesake methods of the form, meaning that when a form is submitted with an IFormSubmitter, the onSubmit of the submitter is called before the one of the form. Similarly, if validation errors occurs during the first step of form processing, submitter&#8217;s method onError is called before the form&#8217;s one.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Starting with Wicket version 6.0 interface IFormSubmitter defines a further callback method called onAfterSubmit(). This method is called after form&#8217;s method onSubmit() has been executed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_components_button_and_submitlink">Components Button and SubmitLink</h3>
<div class="paragraph">
<p>Component <em>org.apache.wicket.markup.html.form.Button</em> is a basic implementation of a form submitter. It can be used with either the &lt;input&gt; or &lt;button&gt; tags. The string model received as input by its constructor is used as button label and it will be the value of the markup attribute value.</p>
</div>
<div class="paragraph">
<p>In the following snippet we have a form with two submit buttons bound to an &lt;input&gt; tag. One of them is set as default button and both have a string model for the label:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;body&gt;</span>
		<span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;form&quot;</span><span class="tok-nt">&gt;</span>
			Username: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;username&quot;</span><span class="tok-nt">/&gt;</span>
			<span class="tok-nt">&lt;br/&gt;</span>
			<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;submit1&quot;</span><span class="tok-nt">/&gt;</span>
			<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;submit2&quot;</span><span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;/form&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">Form</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">);</span>

     	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">)));</span>
    	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Button</span><span class="tok-o">(</span><span class="tok-s">&quot;submit1&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-s">&quot;First submitter&quot;</span><span class="tok-o">)));</span>
		<span class="tok-n">Button</span> <span class="tok-n">secondSubmitter</span><span class="tok-o">;</span>
		<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">secondSubmitter</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Button</span><span class="tok-o">(</span><span class="tok-s">&quot;submit2&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-s">&quot;Second submitter&quot;</span><span class="tok-o">)));</span>

    	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">setDefaultButton</span><span class="tok-o">(</span><span class="tok-n">secondSubmitter</span><span class="tok-o">);</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Generated markup:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;form&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;form1&quot;</span> <span class="tok-na">method=</span><span class="tok-s">&quot;post&quot;</span> <span class="tok-na">action=</span><span class="tok-s">&quot;?0-1.IFormSubmitListener-form&quot;</span><span class="tok-nt">&gt;</span>
   <span class="tok-nt">&lt;div&gt;</span>
      ...
      <span class="tok-c">&lt;!-- Code generated by Wicket to handle the default button --&gt;</span>
      ...
   <span class="tok-nt">&lt;/div&gt;</span>
   Username: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;username&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;username&quot;</span><span class="tok-nt">/&gt;</span>
   <span class="tok-nt">&lt;br/&gt;</span>
   <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;submit1&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;submit1&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;submit13&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;First submitter&quot;</span><span class="tok-nt">/&gt;</span>
   <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;submit2&quot;</span> <span class="tok-na">name=</span><span class="tok-s">&quot;submit2&quot;</span> <span class="tok-na">id=</span><span class="tok-s">&quot;submit22&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Second submitter&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/form&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another component that can be used to submit a form is <em>org.apache.wicket.markup.html.form.SubmitLink</em>. This component uses JavaScript to submit the form. Like the name suggests, the component can be used with the &lt;a&gt; tag but it can be also bound to any other tag that supports the event handler onclick. When used with the &lt;a&gt; tag, the JavaScript code needed to submit the form will be placed inside href attribute while with other tags the script will go inside the event handler onclick.</p>
</div>
<div class="paragraph">
<p>A notable difference between this component and Button is that SubmitLink can be placed outside the form it must submit. In this case we must specify the form to submit in its constructor:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html</span> <span class="tok-na">xmlns:wicket=</span><span class="tok-s">&quot;http://wicket.apache.org&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
	<span class="tok-nt">&lt;/head&gt;</span>
	<span class="tok-nt">&lt;body&gt;</span>
	<span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;form&quot;</span><span class="tok-nt">&gt;</span>
			Password: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;password&quot;</span><span class="tok-nt">/&gt;</span>
			<span class="tok-nt">&lt;br/&gt;</span>
		<span class="tok-nt">&lt;/form&gt;</span>
		<span class="tok-nt">&lt;button</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;externalSubmitter&quot;</span><span class="tok-nt">&gt;</span>
			Submit
		<span class="tok-nt">&lt;/button&gt;</span>
	<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>

    <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">Form</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">);</span>

		<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">PasswordTextField</span><span class="tok-o">(</span><span class="tok-s">&quot;password&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">)));</span>
		<span class="tok-c1">//specify the form to submit</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">SubmitLink</span><span class="tok-o">(</span><span class="tok-s">&quot;externalSubmitter&quot;</span><span class="tok-o">,</span> <span class="tok-n">form</span><span class="tok-o">));</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_disabling_default_form_processing">Disabling default form processing</h3>
<div class="paragraph">
<p>With an IFormSubmittingComponent we can choose to skip the default form submission process  by setting the appropriate flag to false with the setDefaultFormProcessing method. When the default form processing is disabled only the submitter&#8217;s onSubmit is called while form&#8217;s validation and models updating are skipped.</p>
</div>
<div class="paragraph">
<p>This can be useful if we want to implement a “Cancel” button on our form which redirects user to another page without validating his/her input.</p>
</div>
<div class="paragraph">
<p>When we set this flag to false we can decide to manually invoke the form processing by calling the process(IFormSubmittingComponent) method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_nested_forms">Nested forms</h3>
<div class="paragraph">
<p>As you might already known, HTLM doesn&#8217;t allow to have nested forms. However with Wicket we can overcome this limitation by adding one or more form components to a parent form.</p>
</div>
<div class="paragraph">
<p>This can be useful if we want to split a big form into smaller ones in order to reuse them and to better distribute responsibilities among different components.
Forms can be nested to an arbitrary level:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;outerForm&quot;</span><span class="tok-nt">&gt;</span>
	...
	<span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;innerForm&quot;</span><span class="tok-nt">&gt;</span>
		...
		<span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;veryInnerForm&quot;</span><span class="tok-nt">&gt;</span>
			...
		<span class="tok-nt">&lt;/form&gt;</span>
	<span class="tok-nt">&lt;/form&gt;</span>
<span class="tok-nt">&lt;/form&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>When a form is submitted also its nested forms are submitted and they participate in the validation step. This means that if a nested form contains invalid input values, the outer form won&#8217;t be submitted. On the contrary, nested forms can be singularly submitted without depending on the status of their outer form.</p>
</div>
<div class="paragraph">
<p>To submit a parent form when one of its children forms is submitted, we must override its method wantSubmitOnNestedFormSubmit and make it return true.</p>
</div>
</div>
<div class="sect2">
<h3 id="_multi_line_text_input">Multi-line text input</h3>
<div class="paragraph">
<p>HTML provides a multi-line text input control with &lt;textarea&gt; tag. The Wicket counterpart for this kind of control is <em>org.apache.wicket.markup.html.form.TextArea</em> component:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;textarea</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;description&quot;</span> <span class="tok-na">rows=</span><span class="tok-s">&quot;5&quot;</span> <span class="tok-na">cols=</span><span class="tok-s">&quot;40&quot;</span><span class="tok-nt">&gt;&lt;/textarea&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextArea</span><span class="tok-o">(</span><span class="tok-s">&quot;description&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">)));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Component TextArea is used just like any other single-line text field. To specify the size of the text area we can write attributes rows and cols directly in the markup file or we can create new attribute modifiers and add them to our TextArea component.</p>
</div>
</div>
<div class="sect2">
<h3 id="_file_upload">File upload</h3>
<div class="paragraph">
<p>Wicket supports file uploading with the FileUploadField component which must be used with the &lt;input&gt; tag whose type attribute must be set to  [file] n order to send a file on form submission we must enable multipart mode calling MultiPart(true)on our form.</p>
</div>
<div class="paragraph">
<p>In the next example (project UploadSingleFile) we will see a form which allows users to upload a file into the temporary directory of the server (path /tmp on Unix/Linux systems):</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
	<span class="tok-nt">&lt;head&gt;</span>
	<span class="tok-nt">&lt;/head&gt;</span>
	<span class="tok-nt">&lt;body&gt;</span>
	<span class="tok-nt">&lt;h1&gt;</span>Upload your file here!<span class="tok-nt">&lt;/h1&gt;</span>
	<span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;form&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;file&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;fileUploadField&quot;</span><span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Upload&quot;</span><span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/form&gt;</span>
	<span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;feedbackPanel&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;/div&gt;</span>
	<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
   <span class="tok-kd">private</span> <span class="tok-n">FileUploadField</span> <span class="tok-n">fileUploadField</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    	<span class="tok-n">fileUploadField</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">FileUploadField</span><span class="tok-o">(</span><span class="tok-s">&quot;fileUploadField&quot;</span><span class="tok-o">);</span>

    	<span class="tok-n">Form</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">){</span>
    		<span class="tok-nd">@Override</span>
    		<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onSubmit</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    		  <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onSubmit</span><span class="tok-o">();</span>

    		  <span class="tok-n">FileUpload</span> <span class="tok-n">fileUpload</span> <span class="tok-o">=</span> <span class="tok-n">fileUploadField</span><span class="tok-o">.</span><span class="tok-na">getFileUpload</span><span class="tok-o">();</span>

    		    <span class="tok-k">try</span> <span class="tok-o">{</span>
			<span class="tok-n">File</span> <span class="tok-n">file</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">getProperty</span><span class="tok-o">(</span><span class="tok-s">&quot;java.io.tmpdir&quot;</span><span class="tok-o">)</span> <span class="tok-o">+</span> <span class="tok-s">&quot;/&quot;</span> <span class="tok-o">+</span>
    						<span class="tok-n">fileUpload</span><span class="tok-o">.</span><span class="tok-na">getClientFileName</span><span class="tok-o">());</span>

			    <span class="tok-n">fileUpload</span><span class="tok-o">.</span><span class="tok-na">writeTo</span><span class="tok-o">(</span><span class="tok-n">file</span><span class="tok-o">);</span>
		        <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">IOException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			   <span class="tok-n">e</span><span class="tok-o">.</span><span class="tok-na">printStackTrace</span><span class="tok-o">();</span>
			 <span class="tok-o">}</span>
    		<span class="tok-o">}</span>
    	<span class="tok-o">};</span>

	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">setMultiPart</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
	<span class="tok-c1">//set a limit for uploaded file&#39;s size</span>
	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">setMaxSize</span><span class="tok-o">(</span><span class="tok-n">Bytes</span><span class="tok-o">.</span><span class="tok-na">kilobytes</span><span class="tok-o">(</span><span class="tok-mi">100</span><span class="tok-o">));</span>
	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">fileUploadField</span><span class="tok-o">);</span>
	<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">FeedbackPanel</span><span class="tok-o">(</span><span class="tok-s">&quot;feedbackPanel&quot;</span><span class="tok-o">));</span>
	<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code that copies the uploaded file to the temporary directory is inside the onSubmit method of the Form class. The uploaded file is handled with an instance of class FileUpload returned by the  getFileUpload() method of the FileUploadField class. This class provides a set of methods to perform some common tasks like getting the name of the uploaded file (getClientFileName()), coping the file into a directory (writeTo(destinationFile)), calculating file digest (getDigest (digestAlgorithm)) and so on.</p>
</div>
<div class="paragraph">
<p>Form component can limit the size for uploaded files using its setMaxSize(size) method. In the example we have set this limit to 100 kb to prevent users from uploading files bigger than this size.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The maximum size for uploaded files can also be set at application&#8217;s level using the setDefaultMaximumUploadSize(Bytes maxSize) method of class ApplicationSettings:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
 <span class="tok-n">getApplicationSettings</span><span class="tok-o">().</span><span class="tok-na">setDefaultMaximumUploadSize</span><span class="tok-o">(</span><span class="tok-n">Bytes</span><span class="tok-o">.</span><span class="tok-na">kilobytes</span><span class="tok-o">(</span><span class="tok-mi">100</span><span class="tok-o">));</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_upload_multiple_files">Upload multiple files</h3>
<div class="paragraph">
<p>If we need to upload multiple files at once and our clients support HTML5, we can still use FileUploadField adding attribute  [multiple] o its tag. If we can not rely on HTML5, we can use the MultiFileUploadField component which allows the user to upload an arbitrary number of files using a JavaScript-based solution.
An example showing how to use this component can be found in Wicket module wicket-examples in file MultiUploadPage.java. The live example is hosted at  <a href="http://www.wicket-library.com/wicket-examples-6.0.x/upload/multi">http://www.wicket-library.com/wicket-examples-6.0.x/upload/multi</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_complex_form_components_with_formcomponentpanel">Creating complex form components with FormComponentPanel</h3>
<div class="paragraph">
<p>In  <a href="#guide:layout_2">chapter 5.2.2</a>
 we have seen how to use class Panel to create custom components with their own markup and with an arbitrary number of children components.</p>
</div>
<div class="paragraph">
<p>While it&#8217;s perfectly legal to use Panel also to group form components, the resulting component won&#8217;t be itself a form component and it won&#8217;t participate in the form&#8217;s submission workflow.</p>
</div>
<div class="paragraph">
<p>This could be a strong limitation if the custom component needs to coordinate its children during sub-tasks like input conversion or model updating. That&#8217;s why in Wicket we have the <em>org.apache.wicket.markup.html.form.FormComponentPanel</em> component which combines the features of a Panel (it has its own markup file) and a FormComponent (it is a subclass of FormComponent).</p>
</div>
<div class="paragraph">
<p>A typical scenario in which we may need to implement a custom FormComponentPanel is when our web application and its users work with different units of measurement for the same data.</p>
</div>
<div class="paragraph">
<p>To illustrate this possible scenario, let&#8217;s consider a form where a user can insert a  temperature that will be recorded after being converted to Kelvin degrees (see the example project CustomForm ComponentPanel).</p>
</div>
<div class="paragraph">
<p>The Kelvin scale is wildly adopted among the scientific community and it is one of the seven base units of the  ternational[guide:layout_2] ":http://en.wikipedia.org/wiki/International_System_of_Units , so it makes perfect sense to store temperatures expressed with this unit of measurement.</p>
</div>
<div class="paragraph">
<p>However, in our everyday life we still use other temperature scales like Celsius or Fahrenheit, so it would be nice to have a component which internally works with Kelvin degrees and automatically applies conversion between Kelvin temperature scale and the one adopted by the user.</p>
</div>
<div class="paragraph">
<p>In order to implement such a component, we can make a subclass of FormComponentPanel and leverage the convertInput and onBeforeRender methods: in the implementation of the convertInput method we will convert input value to Kelvin degrees while in the implementation of onBeforeRender method we will take care of converting the Kelvin value to the temperature scale adopted by the user.</p>
</div>
<div class="paragraph">
<p>Our custom component will contain two children components: a text field to let user insert and edit a temperature value and a label to display the letter corresponding to user&#8217;s temperature scale (F for Fahrenheit and C for Celsius). The resulting markup file is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
	<span class="tok-nt">&lt;wicket:panel&gt;</span>
		Registered temperature: <span class="tok-nt">&lt;input</span> <span class="tok-na">size=</span><span class="tok-s">&quot;3&quot;</span> <span class="tok-na">maxlength=</span><span class="tok-s">&quot;3&quot;</span>
                             <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;registeredTemperature&quot;</span><span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;label</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;mesuramentUnit&quot;</span><span class="tok-nt">&gt;&lt;/label&gt;</span>
	<span class="tok-nt">&lt;/wicket:panel&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As shown in the markup above FormComponentPanel uses the same &lt;wicket:panel&gt; tag used by Panel to define its markup. Now let&#8217;s see the Java code of the new form component starting with the onInitialize() method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TemperatureDegreeField</span> <span class="tok-kd">extends</span> <span class="tok-n">FormComponentPanel</span><span class="tok-o">&lt;</span><span class="tok-n">Double</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>

	<span class="tok-kd">private</span> <span class="tok-n">TextField</span><span class="tok-o">&lt;</span><span class="tok-n">Double</span><span class="tok-o">&gt;</span> <span class="tok-n">userDegree</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-nf">TemperatureDegreeField</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-nf">TemperatureDegreeField</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Double</span><span class="tok-o">&gt;</span> <span class="tok-n">model</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">model</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onInitialize</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onInitialize</span><span class="tok-o">();</span>

	     <span class="tok-n">AbstractReadOnlyModel</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">labelModel</span><span class="tok-o">=</span><span class="tok-k">new</span> <span class="tok-n">AbstractReadOnlyModel</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;(){</span>
			<span class="tok-nd">@Override</span>
			<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getObject</span><span class="tok-o">()</span> <span class="tok-o">{</span>
				<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">getLocale</span><span class="tok-o">().</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">Locale</span><span class="tok-o">.</span><span class="tok-na">US</span><span class="tok-o">))</span>
					<span class="tok-k">return</span> <span class="tok-s">&quot;°F&quot;</span><span class="tok-o">;</span>
				<span class="tok-k">return</span> <span class="tok-s">&quot;°C&quot;</span><span class="tok-o">;</span>
			<span class="tok-o">}</span>
		<span class="tok-o">};</span>

		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;mesuramentUnit&quot;</span><span class="tok-o">,</span> <span class="tok-n">labelModel</span><span class="tok-o">));</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">userDegree</span><span class="tok-o">=</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">&lt;</span><span class="tok-n">Double</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;registeredTemperature&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span>
                           <span class="tok-n">Model</span><span class="tok-o">&lt;</span><span class="tok-n">Double</span><span class="tok-o">&gt;()));</span>
		<span class="tok-n">userDegree</span><span class="tok-o">.</span><span class="tok-na">setType</span><span class="tok-o">(</span><span class="tok-n">Double</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Inside the onInitialize method we have created a read-only model for the label that displays the letter corresponding to the user&#8217;s temperature scale. To determinate which temperature scale is in use, we retrieve the Locale from the session by calling Component&#8217;s getLocale() method (we will talk more about this method in  <a href="#guide:i18n">paragraph 15</a>
). Then, if locale is the one corresponding to the United States, the chosen scale will be Fahrenheit, otherwise it will be considered as Celsius.</p>
</div>
<div class="paragraph">
<p>In the final part of onInitialize() we add the two components to our custom form component. You may have noticed that we have explicitly set the type of model object for the text field to double. This is necessary as the starting model object is a null reference and this prevents the component from automatically determining the type of its model object.</p>
</div>
<div class="paragraph">
<p>Now we can look at the rest of the code containing the convertInput and onBeforeRender methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">// continued example</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">convertInput</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-n">Double</span> <span class="tok-n">userDegreeVal</span> <span class="tok-o">=</span> <span class="tok-n">userDegree</span><span class="tok-o">.</span><span class="tok-na">getConvertedInput</span><span class="tok-o">();</span>
		<span class="tok-n">Double</span> <span class="tok-n">kelvinDegree</span><span class="tok-o">;</span>

		<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">getLocale</span><span class="tok-o">().</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">Locale</span><span class="tok-o">.</span><span class="tok-na">US</span><span class="tok-o">)){</span>
			<span class="tok-n">kelvinDegree</span> <span class="tok-o">=</span> <span class="tok-n">userDegreeVal</span> <span class="tok-o">+</span>  <span class="tok-mf">459.67</span><span class="tok-o">;</span>
			<span class="tok-n">BigDecimal</span> <span class="tok-n">bdKelvin</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">BigDecimal</span><span class="tok-o">(</span><span class="tok-n">kelvinDegree</span><span class="tok-o">);</span>
			<span class="tok-n">BigDecimal</span> <span class="tok-n">fraction</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">BigDecimal</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">).</span><span class="tok-na">divide</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">BigDecimal</span><span class="tok-o">(</span><span class="tok-mi">9</span><span class="tok-o">));</span>

			<span class="tok-n">kelvinDegree</span> <span class="tok-o">=</span> <span class="tok-n">bdKelvin</span><span class="tok-o">.</span><span class="tok-na">multiply</span><span class="tok-o">(</span><span class="tok-n">fraction</span><span class="tok-o">).</span><span class="tok-na">doubleValue</span><span class="tok-o">();</span>
		<span class="tok-o">}</span><span class="tok-k">else</span><span class="tok-o">{</span>
			<span class="tok-n">kelvinDegree</span> <span class="tok-o">=</span> <span class="tok-n">userDegreeVal</span> <span class="tok-o">+</span> <span class="tok-mf">273.15</span><span class="tok-o">;</span>
		<span class="tok-o">}</span>

		<span class="tok-n">setConvertedInput</span><span class="tok-o">(</span><span class="tok-n">kelvinDegree</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onBeforeRender</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onBeforeRender</span><span class="tok-o">();</span>

		<span class="tok-n">Double</span> <span class="tok-n">kelvinDegree</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">Double</span><span class="tok-o">)</span> <span class="tok-n">getDefaultModelObject</span><span class="tok-o">();</span>
		<span class="tok-n">Double</span> <span class="tok-n">userDegreeVal</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>

		<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">kelvinDegree</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-k">return</span><span class="tok-o">;</span>

		<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">getLocale</span><span class="tok-o">().</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">Locale</span><span class="tok-o">.</span><span class="tok-na">US</span><span class="tok-o">)){</span>
			<span class="tok-n">BigDecimal</span> <span class="tok-n">bdKelvin</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">BigDecimal</span><span class="tok-o">(</span><span class="tok-n">kelvinDegree</span><span class="tok-o">);</span>
			<span class="tok-n">BigDecimal</span> <span class="tok-n">fraction</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">BigDecimal</span><span class="tok-o">(</span><span class="tok-mi">9</span><span class="tok-o">).</span><span class="tok-na">divide</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">BigDecimal</span><span class="tok-o">(</span><span class="tok-mi">5</span><span class="tok-o">));</span>

			<span class="tok-n">kelvinDegree</span> <span class="tok-o">=</span> <span class="tok-n">bdKelvin</span><span class="tok-o">.</span><span class="tok-na">multiply</span><span class="tok-o">(</span><span class="tok-n">fraction</span><span class="tok-o">).</span><span class="tok-na">doubleValue</span><span class="tok-o">();</span>
			<span class="tok-n">userDegreeVal</span> <span class="tok-o">=</span> <span class="tok-n">kelvinDegree</span> <span class="tok-o">-</span> <span class="tok-mf">459.67</span><span class="tok-o">;</span>
		<span class="tok-o">}</span><span class="tok-k">else</span><span class="tok-o">{</span>
			<span class="tok-n">userDegreeVal</span> <span class="tok-o">=</span> <span class="tok-n">kelvinDegree</span> <span class="tok-o">-</span> <span class="tok-mf">273.15</span><span class="tok-o">;</span>
		<span class="tok-o">}</span>

		<span class="tok-n">userDegree</span><span class="tok-o">.</span><span class="tok-na">setModelObject</span><span class="tok-o">(</span><span class="tok-n">userDegreeVal</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since our component does not directly receive the user input, convertInput() must read this value from the inner text field using FormComponent&#8217;s getConvertedInput() method which returns the input value already converted to the type specified for the component (Double in our case). Once we have the user input we convert it to kelvin degrees and we use the resulting value to set the converted input for our custom component (using method setConvertedInput(T convertedInput)).</p>
</div>
<div class="paragraph">
<p>Method onBeforeRender() is responsible for synchronizing the model of the inner textfield with the model of our custom component. To do this we retrieve the model object of the custom component with the getDefaultModelObject() method, then we convert it to the temperature scale adopted by the user and finally we use this value to set the model object of the text field.</p>
</div>
</div>
<div class="sect2">
<h3 id="_stateless_form">Stateless form</h3>
<div class="paragraph">
<p>In  <a href="#guide:versioningCaching">chapter 8</a>
 we have seen how Wicket pages can be divided into two categories: stateful and stateless. Pages that are stateless don&#8217;t need to be stored in the user session and they should be used  when we don&#8217;t need to save any user data in the user session (for example in the public area of a site).</p>
</div>
<div class="paragraph">
<p>Besides saving resources on server-side, stateless pages can be adopted to improve user experience and to avoid security weaknesses. A typical situation where a stateless page can bring these benefits is when we have to implement a login page.</p>
</div>
<div class="paragraph">
<p>For this kind of page we might encounter two potential problems if we chose to use a stateful page. The first problem occurs when the user tries to login without a valid session assigned to him. This could happen if the user leaves the login page opened for a period of time bigger than the session&#8217;s timeout and then he decides to log in. Under these conditions the user will be redirected to a <em>Page expired</em> error page, which is not exactly a nice thing for user experience.</p>
</div>
<div class="paragraph">
<p>The second problem occurs when a malicious user or a web crawler program attempts to login into our web application, generating a huge number of page versions and consequently increasing the size of the user session.</p>
</div>
<div class="paragraph">
<p>To avoid these kinds of problems we should build a stateless login page which does not depend on a user session. Wicket provides a special version of the Form component called StatelessForm which is stateless by default (i.e its method getStatelessHint() returns true), hence it&#8217;s an ideal solution when we want to build a stateless page with a form. A possible implementation of our login form is the following (example project StatelessLoginForm):</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
   <span class="tok-nt">&lt;head&gt;</span>
      <span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span> <span class="tok-nt">/&gt;</span>
   <span class="tok-nt">&lt;/head&gt;</span>
   <span class="tok-nt">&lt;body&gt;</span>
      <span class="tok-nt">&lt;div&gt;</span>Session is <span class="tok-nt">&lt;b</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;sessionType&quot;</span><span class="tok-nt">&gt;&lt;/b&gt;&lt;/div&gt;</span>
      <span class="tok-nt">&lt;br/&gt;</span>
      <span class="tok-nt">&lt;div&gt;</span>Type &#39;user&#39; as correct credentials<span class="tok-nt">&lt;/div&gt;</span>
      <span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;form&quot;</span><span class="tok-nt">&gt;</span>
         <span class="tok-nt">&lt;fieldset&gt;</span>
            Username: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;username&quot;</span><span class="tok-nt">/&gt;</span> <span class="tok-nt">&lt;br/&gt;</span>
            Password: <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;password&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;password&quot;</span><span class="tok-nt">/&gt;&lt;br/&gt;</span>
            <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span><span class="tok-nt">/&gt;</span>
         <span class="tok-nt">&lt;/fieldset&gt;</span>
      <span class="tok-nt">&lt;/form&gt;</span>
      <span class="tok-nt">&lt;br/&gt;</span>
      <span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;feedbackPanel&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
   <span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">Label</span> <span class="tok-n">sessionType</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">password</span><span class="tok-o">;</span>
    <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">username</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
       <span class="tok-n">StatelessForm</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">StatelessForm</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">){</span>
         <span class="tok-nd">@Override</span>
         <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onSubmit</span><span class="tok-o">()</span> <span class="tok-o">{</span>
            <span class="tok-c1">//sign in if username and password are “user”</span>
            <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-s">&quot;user&quot;</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">username</span><span class="tok-o">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">username</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">password</span><span class="tok-o">))</span>
               <span class="tok-n">info</span><span class="tok-o">(</span><span class="tok-s">&quot;Username and password are correct!&quot;</span><span class="tok-o">);</span>
            <span class="tok-k">else</span>
               <span class="tok-n">error</span><span class="tok-o">(</span><span class="tok-s">&quot;Wrong username or password&quot;</span><span class="tok-o">);</span>
         <span class="tok-o">}</span>
      <span class="tok-o">};</span>

      <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">PasswordTextField</span><span class="tok-o">(</span><span class="tok-s">&quot;password&quot;</span><span class="tok-o">));</span>
      <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-o">));</span>

      <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">setDefaultModel</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">CompoundPropertyModel</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">)));</span>

      <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">sessionType</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;sessionType&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">)));</span>
      <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">FeedbackPanel</span><span class="tok-o">(</span><span class="tok-s">&quot;feedbackPanel&quot;</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Override</span>
    <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onBeforeRender</span><span class="tok-o">()</span> <span class="tok-o">{</span>
       <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onBeforeRender</span><span class="tok-o">();</span>

       <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">getSession</span><span class="tok-o">().</span><span class="tok-na">isTemporary</span><span class="tok-o">())</span>
          <span class="tok-n">sessionType</span><span class="tok-o">.</span><span class="tok-na">setDefaultModelObject</span><span class="tok-o">(</span><span class="tok-s">&quot;temporary&quot;</span><span class="tok-o">);</span>
       <span class="tok-k">else</span>
          <span class="tok-n">sessionType</span><span class="tok-o">.</span><span class="tok-na">setDefaultModelObject</span><span class="tok-o">(</span><span class="tok-s">&quot;permanent&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Label sessionType shows if current session is temporary or not and is set inside onBeforeRender(): if our page is really stateless the session will be always temporary. We have also inserted a feedback panel in the home page that shows if the credentials are correct. This was done to make the example form more interactive.</p>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_radio_buttons_and_checkboxes">Working with radio buttons and checkboxes</h3>
<div class="paragraph">
<p>In this paragraph we will see which components can be used to handle HTML radio buttons and checkboxes. Both these input elements are usually grouped together to display a list of possible choices:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="choice-form-screenshot.png" alt="choice form screenshot">
</div>
</div>
<div class="paragraph">
<p>A check box can be used as single component to set a boolean property. For this purpose Wicket provides the <em>org.apache.wicket.markup.html.form.CheckBox</em> component which must be attached to &lt;input type= ../&gt;[checkbox] ag. In the next example (project SingleCheckBox) we will consider a form similar to the one used in  <a href="#guide:modelsforms_5">paragraph 11.5</a>
 to edit a Person object, but with an additional checkbox to let the user decide if she wants to subscribe to our mailing list or not. The form uses the following bean as backing object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RegistrationInfo</span> <span class="tok-kd">implements</span> <span class="tok-n">Serializable</span> <span class="tok-o">{</span>

	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">name</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">surname</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">address</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">email</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-kt">boolean</span> <span class="tok-n">subscribeList</span><span class="tok-o">;</span>

	<span class="tok-cm">/*Getters and setters*/</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The markup and the code for this example are the following:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;form&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table;&quot;</span><span class="tok-nt">&gt;</span>
			<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-row;&quot;</span><span class="tok-nt">&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>Name: <span class="tok-nt">&lt;/div&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>
					<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;name&quot;</span><span class="tok-nt">/&gt;</span>
				<span class="tok-nt">&lt;/div&gt;</span>
			<span class="tok-nt">&lt;/div&gt;</span>
			<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-row;&quot;</span><span class="tok-nt">&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>Surname: <span class="tok-nt">&lt;/div&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>
					<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;surname&quot;</span><span class="tok-nt">/&gt;</span>
				<span class="tok-nt">&lt;/div&gt;</span>
			<span class="tok-nt">&lt;/div&gt;</span>
			<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-row;&quot;</span><span class="tok-nt">&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>Address: <span class="tok-nt">&lt;/div&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>
					<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;address&quot;</span><span class="tok-nt">/&gt;</span>
				<span class="tok-nt">&lt;/div&gt;</span>
			<span class="tok-nt">&lt;/div&gt;</span>
			<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-row;&quot;</span><span class="tok-nt">&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>Email: <span class="tok-nt">&lt;/div&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>
					<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;email&quot;</span><span class="tok-nt">/&gt;</span>
				<span class="tok-nt">&lt;/div&gt;</span>
			<span class="tok-nt">&lt;/div&gt;</span>
			<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-row;&quot;</span><span class="tok-nt">&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>Subscribe list:<span class="tok-nt">&lt;/div&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;</span>
					<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;checkbox&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;subscribeList&quot;</span><span class="tok-nt">/&gt;</span>
				<span class="tok-nt">&lt;/div&gt;</span>
			<span class="tok-nt">&lt;/div&gt;</span>
		<span class="tok-nt">&lt;/div&gt;</span>
	<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Save&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/form&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    	<span class="tok-n">RegistrationInfo</span> <span class="tok-n">registrtionInfo</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">RegistrationInfo</span><span class="tok-o">();</span>
    	<span class="tok-n">registrtionInfo</span><span class="tok-o">.</span><span class="tok-na">setSubscribeList</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>

    	<span class="tok-n">Form</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">,</span>
    			<span class="tok-k">new</span> <span class="tok-n">CompoundPropertyModel</span><span class="tok-o">&lt;</span><span class="tok-n">RegistrationInfo</span><span class="tok-o">&gt;(</span><span class="tok-n">registrtionInfo</span><span class="tok-o">));</span>

    	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;name&quot;</span><span class="tok-o">));</span>
	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;surname&quot;</span><span class="tok-o">));</span>
	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;address&quot;</span><span class="tok-o">));</span>
	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;email&quot;</span><span class="tok-o">));</span>
	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">CheckBox</span><span class="tok-o">(</span><span class="tok-s">&quot;subscribeList&quot;</span><span class="tok-o">));</span>

	<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that the checkbox will be initially selected because we have set to true the subscribe flag during the model object creation (with instruction registrtionInfo.setSubscribeList(true)):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="subscribe-checkbox-set.png" alt="subscribe checkbox set">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_grouped_checkboxes">Working with grouped checkboxes</h3>
<div class="paragraph">
<p>When we need to display a given number of options with checkboxes, we can use the <em>org.apache.wicket.markup.html.form.CheckBoxMultipleChoice</em> component. For example, If our options are a list of strings, we can display them in this way:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;checkGroup&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;checkbox&quot;</span><span class="tok-nt">/&gt;</span>It will be replaced by the actual checkboxes...
<span class="tok-nt">&lt;/div&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">fruits</span> <span class="tok-o">=</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span><span class="tok-s">&quot;apple&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;strawberry&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;watermelon&quot;</span><span class="tok-o">);</span>
<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">CheckBoxMultipleChoice</span><span class="tok-o">(</span><span class="tok-s">&quot;checkGroup&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">ListModel</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;(</span><span class="tok-k">new</span>
								 <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;()),</span> <span class="tok-n">fruits</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Screenshot:</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="grouped-checkbox.png" alt="grouped checkbox">
</div>
</div>
<div class="paragraph">
<p>This component can be attached to a &lt;div&gt; tag or to a &lt;span&gt; tag. No specific content is required for this tag as it will be populated with the actual checkboxes. Since this component allows multiple selection, its model object is a list. In the example above we have used model class <em>org.apache.wicket.model.util.ListModel</em> which is specifically designed to wrap a List object.</p>
</div>
<div class="paragraph">
<p>By default CheckBoxMultipleChoice inserts a &lt;br/&gt; tag as suffix after each option. We can configure both the suffix and the prefix used by the component with the setPrefix and setSuffix methods.</p>
</div>
<div class="paragraph">
<p>When our options are more complex objects than simple strings, we can render them using an IChoiceRender, as we did for DropDownChoice in  <a href="#guide:modelsforms_5">paragraph 11.5</a>
:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;checkGroup&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;checkbox&quot;</span><span class="tok-nt">/&gt;</span>It will be replaced by actual checkboxes...
<span class="tok-nt">&lt;/div&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Person</span> <span class="tok-n">john</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;John&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Smith&quot;</span><span class="tok-o">);</span>
<span class="tok-n">Person</span> <span class="tok-n">bob</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Bob&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Smith&quot;</span><span class="tok-o">);</span>
<span class="tok-n">Person</span> <span class="tok-n">jill</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Jill&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Smith&quot;</span><span class="tok-o">);</span>
<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">theSmiths</span> <span class="tok-o">=</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span><span class="tok-n">john</span><span class="tok-o">,</span> <span class="tok-n">bob</span><span class="tok-o">,</span> <span class="tok-n">jill</span><span class="tok-o">);</span>
<span class="tok-n">ChoiceRenderer</span> <span class="tok-n">render</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ChoiceRenderer</span><span class="tok-o">(</span><span class="tok-s">&quot;name&quot;</span><span class="tok-o">);</span>
     	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">CheckBoxMultipleChoice</span><span class="tok-o">(</span><span class="tok-s">&quot;checkGroup&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">ListModel</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;(</span><span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;()),</span>
                                    <span class="tok-n">theSmiths</span><span class="tok-o">,</span> <span class="tok-n">render</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Screenshot:</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="grouped-checkbox2.png" alt="grouped checkbox2">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_implement_a_lect_guide_modelsforms_5">How to implement a  lect[guide:modelsforms_5]</h3>
<div class="paragraph">
<p>A nice feature we can offer to users when we have a group of checkboxes is a “special” checkbox which selects/unselects all the other options of the group:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="select-all-checkbox.png" alt="select all checkbox">
</div>
</div>
<div class="paragraph">
<p>Wicket comes with a couple of utility components that make it easy to implement such a feature. They are CheckboxMultipleChoiceSelector and CheckBoxSelector classes, both inside package <em>org.apache.wicket.markup.html.form</em>. The difference between these two components is that the first works with an instance of CheckBoxMultipleChoice while the second takes in input a list of CheckBox objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-cm">/* CheckboxMultipleChoiceSelector usage: */</span>

<span class="tok-n">CheckBoxMultipleChoice</span> <span class="tok-n">checkGroup</span><span class="tok-o">;</span>
<span class="tok-c1">//checkGroup initialization...</span>
<span class="tok-n">CheckboxMultipleChoiceSelector</span> <span class="tok-n">cbmcs</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">CheckboxMultipleChoiceSelector</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">,</span> <span class="tok-n">checkGroup</span><span class="tok-o">);</span>

<span class="tok-cm">/* CheckBoxSelector usage: */</span>

<span class="tok-n">CheckBox</span> <span class="tok-n">checkBox1</span><span class="tok-o">,</span> <span class="tok-n">checkBox2</span><span class="tok-o">,</span> <span class="tok-n">checkBox3</span><span class="tok-o">;</span>
<span class="tok-c1">//checks initialization...</span>
<span class="tok-n">CheckBoxSelector</span> <span class="tok-n">cbmcs</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">CheckBoxSelector</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">,</span> <span class="tok-n">checkBox1</span><span class="tok-o">,</span> <span class="tok-n">checkBox2</span><span class="tok-o">,</span> <span class="tok-n">checkBox3</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_grouped_radio_buttons">Working with grouped radio buttons</h3>
<div class="paragraph">
<p>For groups of radio buttons we can use the <em>org.apache.wicket.markup.html.form.RadioChoice</em> component which works in much the same way as CheckBoxMultipleChoice:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;radioGroup&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;radio&quot;</span><span class="tok-nt">/&gt;</span>It will be replaced by actual radio buttons...
<span class="tok-nt">&lt;/div&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">fruits</span> <span class="tok-o">=</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span><span class="tok-s">&quot;apple&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;strawberry&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;watermelon&quot;</span><span class="tok-o">);</span>
<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">RadioChoice</span><span class="tok-o">(</span><span class="tok-s">&quot;radioGroup&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">),</span> <span class="tok-n">fruits</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Screenshot:</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="grouped-radiobutton.png" alt="grouped radiobutton">
</div>
</div>
<div class="paragraph">
<p>Just like CheckBoxMultipleChoice, this component provides the setPrefix and setSuffix methods to configure the prefix and suffix for our options and it supports IChoiceRender as well. In addition, RadioChoice provides the wantOnSelectionChangedNotifications() method to notify the web server when the selected option changes (this is the same method seen for DropDownChoice in paragraph 9.4).</p>
</div>
</div>
<div class="sect2">
<h3 id="_selecting_multiple_values_with_listmultiplechoices_and_palette">Selecting multiple values with ListMultipleChoices and Palette</h3>
<div class="paragraph">
<p>Checkboxes work well when we have a small amount of options to display, but they quickly become chaotic as the number of options increases. To overcome this limit we can use the &lt;select&gt; tag switching it to multiple-choice mode with attribute multiple= [multiple]</p>
</div>
<div class="imageblock">
<div class="content">
<img src="list-multiple-choices.png" alt="list multiple choices">
</div>
</div>
<div class="paragraph">
<p>Now the user can select multiple options by holding down Ctrl key (or Command key for Mac) and selecting them.</p>
</div>
<div class="paragraph">
<p>To work with multiple choice list Wicket provides the <em>org.apache.wicket.markup.html.form.ListMultipleChoice</em> component:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;select</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;fruits&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;option&gt;</span>choice 1<span class="tok-nt">&lt;/option&gt;</span>
	<span class="tok-nt">&lt;option&gt;</span>choice 2<span class="tok-nt">&lt;/option&gt;</span>
<span class="tok-nt">&lt;/select&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">fruits</span> <span class="tok-o">=</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span><span class="tok-s">&quot;apple&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;strawberry&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;watermelon&quot;</span><span class="tok-o">);</span>
<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ListMultipleChoice</span><span class="tok-o">(</span><span class="tok-s">&quot;fruits&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">ListModel</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;(</span><span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;()),</span> <span class="tok-n">fruits</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Screenshot:</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="list-multiple-choices2.png" alt="list multiple choices2">
</div>
</div>
<div class="paragraph">
<p>This component must be bound to a &lt;select&gt; tag but the attribute multiple= [":
multiple] ot required as it will automatically be added by the component.</p>
</div>
<div class="paragraph">
<p>The number of visible rows can be set with the setMaxRows(int maxRows) method.</p>
</div>
</div>
<div class="sect2">
<h3 id="_component_palette">Component Palette</h3>
<div class="paragraph">
<p>While multiple choice list solves the problem of handling a big number of multiple choices, it is not much intuitive for end users. That&#8217;s why desktop GUIs have introduced a more complex component which can be generally referred to as multi select transfer component (it doesn&#8217;t have an actual official name):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="multi-select-transfer-component.png" alt="multi select transfer component">
</div>
</div>
<div class="paragraph">
<p>This kind of component is composed by two multiple-choice lists, one on the left displaying the available options and the other one on the right displaying the selected options. User can move options from a list to another by double clicking on them or using the buttons placed between the two list.</p>
</div>
<div class="paragraph">
<p>Built-in <em>org.apache.wicket.extensions.markup.html.form.palette.Palette</em> component provides an out-of-the-box implementation of a multi select transfer component. It works in a similar way to ListMultipleChoice:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;palette&quot;</span><span class="tok-nt">&gt;</span>
   Select will be replaced by the actual content...
	   <span class="tok-nt">&lt;select</span> <span class="tok-na">multiple=</span><span class="tok-s">&quot;multiple&quot;</span><span class="tok-nt">&gt;</span>
     <span class="tok-nt">&lt;option&gt;</span>option1<span class="tok-nt">&lt;/option&gt;</span>
     <span class="tok-nt">&lt;option&gt;</span>option2<span class="tok-nt">&lt;/option&gt;</span>
     <span class="tok-nt">&lt;option&gt;</span>option3<span class="tok-nt">&lt;/option&gt;</span>
<span class="tok-nt">&lt;/div&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Person</span> <span class="tok-n">john</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;John&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Smith&quot;</span><span class="tok-o">);</span>
<span class="tok-n">Person</span> <span class="tok-n">bob</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Bob&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Smith&quot;</span><span class="tok-o">);</span>
<span class="tok-n">Person</span> <span class="tok-n">jill</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Jill&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Smith&quot;</span><span class="tok-o">);</span>
<span class="tok-n">Person</span> <span class="tok-n">andrea</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Andrea&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Smith&quot;</span><span class="tok-o">);</span>

<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">theSmiths</span> <span class="tok-o">=</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span><span class="tok-n">john</span><span class="tok-o">,</span> <span class="tok-n">bob</span><span class="tok-o">,</span> <span class="tok-n">jill</span><span class="tok-o">,</span> <span class="tok-n">andrea</span><span class="tok-o">);</span>
<span class="tok-n">ChoiceRenderer</span> <span class="tok-n">render</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ChoiceRenderer</span><span class="tok-o">(</span><span class="tok-s">&quot;name&quot;</span><span class="tok-o">);</span>

<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Palette</span><span class="tok-o">(</span><span class="tok-s">&quot;palette&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;()),</span> <span class="tok-k">new</span> <span class="tok-n">ListModel</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-o">(</span><span class="tok-n">theSmiths</span><span class="tok-o">),</span> <span class="tok-n">render</span><span class="tok-o">,</span> <span class="tok-mi">5</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Screenshot:</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="multi-select-transfer-component-wicket.png" alt="multi select transfer component wicket">
</div>
</div>
<div class="paragraph">
<p>The last two parameters of the Palette&#8217;s constructor (an integer value and a boolean value) are, respectively, the number of visible rows for the two lists and a flag to choose if we want to display the two optional buttons which move selected options up and down. The descriptions of the two lists (“Available” and “Selected”) can be customized providing two resources with keys palette.available and palette.selected.</p>
</div>
<div class="paragraph">
<p>The markup of this component uses a number of CSS classes which can be extended/overriden to customize the style of the component. We can find these classes and see which tags they decorate in the default markup file of the component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;table</span> <span class="tok-na">cellspacing=</span><span class="tok-s">&quot;0&quot;</span> <span class="tok-na">cellpadding=</span><span class="tok-s">&quot;2&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;palette&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;tr&gt;</span>
	<span class="tok-nt">&lt;td</span> <span class="tok-na">class=</span><span class="tok-s">&quot;header headerAvailable&quot;</span><span class="tok-nt">&gt;&lt;span</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;availableHeader&quot;</span><span class="tok-nt">&gt;</span>[available header]<span class="tok-nt">&lt;/span&gt;&lt;/td&gt;</span>
	<span class="tok-nt">&lt;td&gt;</span><span class="tok-ni">&amp;#160;</span><span class="tok-nt">&lt;/td&gt;</span>
	<span class="tok-nt">&lt;td</span> <span class="tok-na">class=</span><span class="tok-s">&quot;header headerSelected&quot;</span><span class="tok-nt">&gt;&lt;span</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;selectedHeader&quot;</span><span class="tok-nt">&gt;</span>[selected header]<span class="tok-nt">&lt;/span&gt;</span>
        <span class="tok-nt">&lt;/td&gt;</span>
<span class="tok-nt">&lt;/tr&gt;</span>
<span class="tok-nt">&lt;tr&gt;</span>
	<span class="tok-nt">&lt;td</span> <span class="tok-na">class=</span><span class="tok-s">&quot;pane choices&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;select</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;choices&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;choicesSelect&quot;</span><span class="tok-nt">&gt;</span>[choices]<span class="tok-nt">&lt;/select&gt;</span>
	<span class="tok-nt">&lt;/td&gt;</span>
	<span class="tok-nt">&lt;td</span> <span class="tok-na">class=</span><span class="tok-s">&quot;buttons&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;button</span> <span class="tok-na">type=</span><span class="tok-s">&quot;button&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;addButton&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;button add&quot;</span><span class="tok-nt">&gt;&lt;div/&gt;</span>
               <span class="tok-nt">&lt;/button&gt;&lt;br/&gt;</span>
		<span class="tok-nt">&lt;button</span> <span class="tok-na">type=</span><span class="tok-s">&quot;button&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;removeButton&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;button remove&quot;</span><span class="tok-nt">&gt;&lt;div/&gt;</span>
               <span class="tok-nt">&lt;/button&gt;&lt;br/&gt;</span>
		<span class="tok-nt">&lt;button</span> <span class="tok-na">type=</span><span class="tok-s">&quot;button&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;moveUpButton&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;button up&quot;</span><span class="tok-nt">&gt;&lt;div/&gt;</span>
               <span class="tok-nt">&lt;/button&gt;&lt;br/&gt;</span>
		<span class="tok-nt">&lt;button</span> <span class="tok-na">type=</span><span class="tok-s">&quot;button&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;moveDownButton&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;button down&quot;</span><span class="tok-nt">&gt;&lt;div/&gt;</span>
               <span class="tok-nt">&lt;/button&gt;&lt;br/&gt;</span>
	<span class="tok-nt">&lt;/td&gt;</span>
	<span class="tok-nt">&lt;td</span> <span class="tok-na">class=</span><span class="tok-s">&quot;pane selection&quot;</span><span class="tok-nt">&gt;</span>
		<span class="tok-nt">&lt;select</span> <span class="tok-na">class=</span><span class="tok-s">&quot;selectionSelect&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;selection&quot;</span><span class="tok-nt">&gt;</span>[selection]<span class="tok-nt">&lt;/select&gt;</span>
	<span class="tok-nt">&lt;/td&gt;</span>
<span class="tok-nt">&lt;/tr&gt;</span>
<span class="tok-nt">&lt;/table&gt;</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_9">Summary</h3>
<div class="paragraph">
<p>Forms are the standard solution to let users interact with our web applications. In this chapter we have seen the three steps involved with the form processing workflow in Wicket. We have started looking at form validation and feedback messages generation, then we have seen how Wicket converts input values into Java objects and vice versa.</p>
</div>
<div class="paragraph">
<p>In the second part of the chapter we learnt how to build reusable form components and how to  implement a stateless form. We have ended the chapter with an overview of the built-in form components needed to handle standard input form elements like checkboxes, radio buttons and multiple selections lists.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_displaying_multiple_items_with_repeaters">Displaying multiple items with repeaters</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A common task for web applications is to display a set of items. The most typical scenario where we need such kind of visualization is when we have to display some kind of search result. With the old template-based technologies (like JSP) we used to accomplish this task using classic for or while loops:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>
<span class="tok-nt">&lt;meta</span> <span class="tok-na">http-equiv=</span><span class="tok-s">&quot;Content-Type&quot;</span> <span class="tok-na">content=</span><span class="tok-s">&quot;text/html; charset=UTF-8&quot;</span><span class="tok-nt">&gt;</span>
<span class="tok-nt">&lt;title&gt;</span>Insert title here<span class="tok-nt">&lt;/title&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
  <span class="tok-err">&lt;</span>%
    for(int i = 12; i<span class="tok-err">&lt;</span>=32; i++) {
      %&gt;
      <span class="tok-nt">&lt;div&gt;</span>Hello! I&#39;m index n°<span class="tok-err">&lt;</span>%= %&gt;<span class="tok-nt">&lt;/div&gt;</span>
  <span class="tok-err">&lt;</span>%
    }
  %&gt;
<span class="tok-nt">&lt;/body&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To ease this task Wicket provides a number of special-purpose components called repeaters which are designed to use their related markup to display the items of a given set in a more natural and less chaotic way.</p>
</div>
<div class="paragraph">
<p>In this chapter we will see some of the built-in repeaters that come with Wicket.</p>
</div>
<div class="sect2">
<h3 id="_the_repeatingview_component">The RepeatingView Component</h3>
<div class="paragraph">
<p>Component <em>org.apache.wicket.markup.repeater.RepeatingView</em> is a container which renders its children components using the tag it is bound to. It can contain an arbitrary number of children elements and we can obtain a new valid id for a new child calling its method newChildId(). This component is particularly suited when we have to repeat a simple markup fragment, for example when we want to display some items as a HTML list:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;ul&gt;</span>
    <span class="tok-nt">&lt;li</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;listItems&quot;</span><span class="tok-nt">&gt;&lt;/li&gt;</span>
<span class="tok-nt">&lt;/ul&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java Code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">RepeatingView</span> <span class="tok-n">listItems</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">RepeatingView</span><span class="tok-o">(</span><span class="tok-s">&quot;listItems&quot;</span><span class="tok-o">);</span>

<span class="tok-n">listItems</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-n">listItems</span><span class="tok-o">.</span><span class="tok-na">newChildId</span><span class="tok-o">(),</span> <span class="tok-s">&quot;green&quot;</span><span class="tok-o">));</span>
<span class="tok-n">listItems</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-n">listItems</span><span class="tok-o">.</span><span class="tok-na">newChildId</span><span class="tok-o">(),</span> <span class="tok-s">&quot;blue&quot;</span><span class="tok-o">));</span>
<span class="tok-n">listItems</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-n">listItems</span><span class="tok-o">.</span><span class="tok-na">newChildId</span><span class="tok-o">(),</span> <span class="tok-s">&quot;red&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Generated markup:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;ul&gt;</span>
    <span class="tok-nt">&lt;li&gt;</span>green<span class="tok-nt">&lt;/li&gt;</span>
    <span class="tok-nt">&lt;li&gt;</span>blue<span class="tok-nt">&lt;/li&gt;</span>
    <span class="tok-nt">&lt;li&gt;</span>red<span class="tok-nt">&lt;/li&gt;</span>
<span class="tok-nt">&lt;/ul&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can see in this example, each child component has been rendered using the parent markup as if it was its own.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_listview_component">The ListView Component</h3>
<div class="paragraph">
<p>As its name suggests, component <em>org.apache.wicket.markup.html.list.ListView</em> is designed to display a given list of objects which can be provided as a standard Java List or as a model containing the concrete List. ListView iterates over the list and creates a child component of type <em>org.apache.wicket.markup.html.list.ListItem</em> for every encountered item.</p>
</div>
<div class="paragraph">
<p>Unlike RepeatingView this component is intended to be used with complex markup fragments containing nested components.</p>
</div>
<div class="paragraph">
<p>To generate its children, ListView calls its abstract method populateItem(ListItem&lt;T&gt; item) for each item in the list, so we must provide an implementation of this method to tell the component how to create its children components. In the following example we use a ListView to display a list of Person objects:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html">...
	<span class="tok-nt">&lt;body&gt;</span>
		<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;bd&quot;</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table;&quot;</span><span class="tok-nt">&gt;</span>
			<span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;persons&quot;</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-row;&quot;</span><span class="tok-nt">&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;&lt;b&gt;</span>Full name: <span class="tok-nt">&lt;/b&gt;&lt;/div&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;fullName&quot;</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
			<span class="tok-nt">&lt;/div&gt;</span>
		<span class="tok-nt">&lt;/div&gt;</span>
	<span class="tok-nt">&lt;/body&gt;</span>
...
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java Code (Page Constructor):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	   <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">persons</span> <span class="tok-o">=</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;John&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Smith&quot;</span><span class="tok-o">),</span>
                                        <span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Dan&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Wong&quot;</span><span class="tok-o">));</span>

   <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ListView</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;persons&quot;</span><span class="tok-o">,</span> <span class="tok-n">persons</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">populateItem</span><span class="tok-o">(</span><span class="tok-n">ListItem</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">item</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	   <span class="tok-n">item</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;fullName&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">PropertyModel</span><span class="tok-o">(</span><span class="tok-n">item</span><span class="tok-o">.</span><span class="tok-na">getModel</span><span class="tok-o">(),</span> <span class="tok-s">&quot;fullName&quot;</span><span class="tok-o">)));</span>
	<span class="tok-o">}</span>
   <span class="tok-o">});</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Screenshot of generated page:</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="simple-listview-screenshot.png" alt="simple listview screenshot">
</div>
</div>
<div class="paragraph">
<p>In this example we have displayed the full name of two Person&#8217;s instances. The most interesting part of the code is the implementation of method populateItem where parameter item is the current child component created by ListView and its model contains the corresponding element of the list. Please note that inside populateItem we must add nested components to the <em>item</em> object and not directly to the <em>ListView</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_listview_and_form">ListView and Form</h3>
<div class="paragraph">
<p>By default <em>ListView</em> replaces its children components with new instances every time is rendered. Unfortunately this behavior is a problem if <em>ListView</em> is inside a form and it contains form components. The problem is caused by the fact that children components are replaced by new ones before form is rendered, hence they can&#8217;t keep their input value if validation fails and, furthermore, their feedback messages can not be displayed.</p>
</div>
<div class="paragraph">
<p>To avoid this kind of problem we can force <em>ListView</em> to reuse its children components using its method setReuseItems and passing true as parameter. If for any reason we need to refresh children components after we have invoked setReuseItems(true), we can use MarkupContainer&#8217;s method <em>removeAll()</em> to force <em>ListView</em> to rebuild them.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_refreshingview_component">The RefreshingView Component</h3>
<div class="paragraph">
<p>Component <em>org.apache.wicket.markup.repeater.RefreshingView</em> is a subclass of  RepeatingView that comes with a customizable rendering strategy for its children components.</p>
</div>
<div class="paragraph">
<p>RefreshingView defines abstract methods populateItem(Item) and getItemModels(). The first method is similar to the namesake method seen for ListView, but it takes in input an instance of class <em>org.apache.wicket.markup.repeater.Item</em> which is a subclass of <em>ListItem</em>. RefreshingView is designed to display a collection of models containing the actual items. An iterator over these models is returned by the other abstract method getItemModels.</p>
</div>
<div class="paragraph">
<p>The following code is a version of the previous example that uses <em>RefreshingView</em> in place of <em>ListView</em>:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html">...
	<span class="tok-nt">&lt;body&gt;</span>
		<span class="tok-nt">&lt;div</span> <span class="tok-na">id=</span><span class="tok-s">&quot;bd&quot;</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table;&quot;</span><span class="tok-nt">&gt;</span>
			<span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;persons&quot;</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-row;&quot;</span><span class="tok-nt">&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;&lt;b&gt;</span>Full name: <span class="tok-nt">&lt;/b&gt;&lt;/div&gt;</span>
				<span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;fullName&quot;</span> <span class="tok-na">style=</span><span class="tok-s">&quot;display: table-cell;&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
			<span class="tok-nt">&lt;/div&gt;</span>
		<span class="tok-nt">&lt;/div&gt;</span>
	<span class="tok-nt">&lt;/body&gt;</span>
...
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java Code (Page Constructor):</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
   <span class="tok-c1">//define the list of models to use</span>
   <span class="tok-kd">final</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;&gt;</span> <span class="tok-n">persons</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ArrayList</span><span class="tok-o">&lt;</span><span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;&gt;();</span>

   <span class="tok-n">persons</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;John&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Smith&quot;</span><span class="tok-o">)));</span>
   <span class="tok-n">persons</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Person</span><span class="tok-o">(</span><span class="tok-s">&quot;Dan&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Wong&quot;</span><span class="tok-o">)));</span>

   <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">RefreshingView</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;persons&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">populateItem</span><span class="tok-o">(</span><span class="tok-n">Item</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">item</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	   <span class="tok-n">item</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;fullName&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">PropertyModel</span><span class="tok-o">(</span><span class="tok-n">item</span><span class="tok-o">.</span><span class="tok-na">getModel</span><span class="tok-o">(),</span> <span class="tok-s">&quot;fullName&quot;</span><span class="tok-o">)));</span>
	<span class="tok-o">}</span>

<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-n">Iterator</span><span class="tok-o">&lt;</span><span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;&gt;</span> <span class="tok-nf">getItemModels</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	   <span class="tok-k">return</span> <span class="tok-n">persons</span><span class="tok-o">.</span><span class="tok-na">iterator</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
   <span class="tok-o">});</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_item_reuse_strategy">Item reuse strategy</h3>
<div class="paragraph">
<p>Similar to <em>ListView</em>, the default behavior of the <em>RefreshingView</em> is to replace its children with new instances every time is rendered. The strategy that decides if and how children components must be refreshed is returned by method <em>getItemReuseStrategy</em>. This strategy is an implementation of interface IItemReuseStrategy. The default implementation used by <em>RefreshingView</em> is class <em>DefaultItemReuseStrategy</em> but Wicket provides also strategy <em>ReuseIfModelsEqualStrategy</em> which reuses an item if its model has been returned by the iterator obtained with method <em>getItemModels</em>.</p>
</div>
<div class="paragraph">
<p>To set a custom strategy we must use method <em>setItemReuseStrategy</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_pageable_repeaters">Pageable repeaters</h3>
<div class="paragraph">
<p>Wicket offers a number of components that should be used when we have to display a big number of  items (for example the results of a select SQL query).</p>
</div>
<div class="paragraph">
<p>All these components implement interface <em>org.apache.wicket.markup.html.navigation.paging.IPageable</em> and use interface <em>IDataProvider</em> (placed in package <em>org.apache.wicket.markup.repeater.data</em>) as data source. This interface is designed to support data paging. We will see an example of data paging later in  <a href="#guide:repeaters_4">paragraph 13.4.2</a>
.</p>
</div>
<div class="paragraph">
<p>The methods defined by IDataProvider are the following:
* iterator(long first, long count): returns an iterator over a subset of the entire dataset. The subset starts from the item at position first and includes all the next count items (i.e. it&#8217;s the closed interval  <a href="#first">first+count</a>
).
* size(): gets the size of the entire dataset.
* model(T object): this method is used to wrap an item returned by the iterator with a model. This can be necessary if, for example, we need to wrap items with a detachable model to prevent them from being serialized.</p>
</div>
<div class="paragraph">
<p>Wicket already provides implementations of IDataProvider to work with a List as data source (ListDataProvider) and to support data sorting (SortableDataProvider).</p>
</div>
</div>
<div class="sect2">
<h3 id="_component_dataview">Component DataView</h3>
<div class="paragraph">
<p>Class <em>org.apache.wicket.markup.repeater.data.DataView</em> is the simplest pageable repeater shipped with Wicket. DataView comes with abstract method populateItem(Item) that must be implemented to configure children components. In the following example we use a DataView to display a list of Person objects in a HTML table:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;table&gt;</span>
	<span class="tok-nt">&lt;tr&gt;</span>
	   <span class="tok-nt">&lt;th&gt;</span>Name<span class="tok-nt">&lt;/th&gt;&lt;th&gt;</span>Surename<span class="tok-nt">&lt;/th&gt;&lt;th&gt;</span>Address<span class="tok-nt">&lt;/th&gt;&lt;th&gt;</span>Email<span class="tok-nt">&lt;/th&gt;</span>
	<span class="tok-nt">&lt;/tr&gt;</span>
	<span class="tok-nt">&lt;tr</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;rows&quot;</span><span class="tok-nt">&gt;</span>
	   <span class="tok-nt">&lt;td</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;dataRow&quot;</span><span class="tok-nt">&gt;&lt;/td&gt;</span>
	<span class="tok-nt">&lt;/tr&gt;</span>
<span class="tok-nt">&lt;/table&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java Code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//method loadPersons is defined elsewhere</span>
<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">persons</span> <span class="tok-o">=</span> <span class="tok-n">loadPersons</span><span class="tok-o">();</span>
<span class="tok-n">ListDataProvider</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">listDataProvider</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ListDataProvider</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;(</span><span class="tok-n">persons</span><span class="tok-o">);</span>

<span class="tok-n">DataView</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">dataView</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DataView</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;rows&quot;</span><span class="tok-o">,</span> <span class="tok-n">listDataProvider</span><span class="tok-o">)</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">populateItem</span><span class="tok-o">(</span><span class="tok-n">Item</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">item</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">Person</span> <span class="tok-n">person</span> <span class="tok-o">=</span> <span class="tok-n">item</span><span class="tok-o">.</span><span class="tok-na">getModelObject</span><span class="tok-o">();</span>
    <span class="tok-n">RepeatingView</span> <span class="tok-n">repeatingView</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">RepeatingView</span><span class="tok-o">(</span><span class="tok-s">&quot;dataRow&quot;</span><span class="tok-o">);</span>

    <span class="tok-n">repeatingView</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-n">repeatingView</span><span class="tok-o">.</span><span class="tok-na">newChildId</span><span class="tok-o">(),</span> <span class="tok-n">person</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">()));</span>
    <span class="tok-n">repeatingView</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-n">repeatingView</span><span class="tok-o">.</span><span class="tok-na">newChildId</span><span class="tok-o">(),</span> <span class="tok-n">person</span><span class="tok-o">.</span><span class="tok-na">getSurename</span><span class="tok-o">()));</span>
    <span class="tok-n">repeatingView</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-n">repeatingView</span><span class="tok-o">.</span><span class="tok-na">newChildId</span><span class="tok-o">(),</span> <span class="tok-n">person</span><span class="tok-o">.</span><span class="tok-na">getAddress</span><span class="tok-o">()));</span>
    <span class="tok-n">repeatingView</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-n">repeatingView</span><span class="tok-o">.</span><span class="tok-na">newChildId</span><span class="tok-o">(),</span> <span class="tok-n">person</span><span class="tok-o">.</span><span class="tok-na">getEmail</span><span class="tok-o">()));</span>
    <span class="tok-n">item</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">repeatingView</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">};</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">dataView</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that in the code above we have used also a RepeatingView component to populate the rows of the table.</p>
</div>
<div class="paragraph">
<p>In the next paragraph we will see a similar example that adds support for data paging.</p>
</div>
</div>
<div class="sect2">
<h3 id="_data_paging">Data paging</h3>
<div class="paragraph">
<p>To enable data paging on a pageable repeater, we must first set the number of items to display per page with method setItemsPerPage(long items). Then, we must attach the repeater to panel PagingNavigator (placed in package <em>org.apache.wicket.markup.html.navigation.paging</em>) which is responsible for rendering a navigation bar containing the links illustrated in the following picture:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="paging-navigator.png" alt="paging navigator">
</div>
</div>
<div class="paragraph">
<p>Project PageDataViewExample mixes a DataView component with a PagingNavigator to display the list of all countries of the world sorted by alphabetical order. Here is the initialization code of the project home page:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;table&gt;</span>
  <span class="tok-nt">&lt;tr&gt;</span>
    <span class="tok-nt">&lt;th&gt;</span>ISO 3166-1<span class="tok-nt">&lt;/th&gt;&lt;th&gt;</span>Name<span class="tok-nt">&lt;/th&gt;&lt;th&gt;</span>Long name<span class="tok-nt">&lt;/th&gt;&lt;th&gt;</span>Capital<span class="tok-nt">&lt;/th&gt;&lt;th&gt;</span>Population<span class="tok-nt">&lt;/th&gt;</span>
  <span class="tok-nt">&lt;/tr&gt;</span>
  <span class="tok-nt">&lt;tr</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;rows&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;td</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;dataRow&quot;</span><span class="tok-nt">&gt;&lt;/td&gt;</span>
  <span class="tok-nt">&lt;/tr&gt;</span>
<span class="tok-nt">&lt;/table&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java Code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">parameters</span><span class="tok-o">);</span>
  <span class="tok-c1">//method loadCountriesFromCsv is defined elsewhere in the class.</span>
  <span class="tok-c1">//It reads countries data from a csv file and returns each row as an array of Strings.</span>
  <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">[]&gt;</span> <span class="tok-n">countries</span> <span class="tok-o">=</span> <span class="tok-n">loadCountriesFromCsv</span><span class="tok-o">();</span>
  <span class="tok-n">ListDataProvider</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">[]&gt;</span> <span class="tok-n">listDataProvider</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ListDataProvider</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">[]&gt;(</span><span class="tok-n">countries</span><span class="tok-o">);</span>

  <span class="tok-n">DataView</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">[]&gt;</span> <span class="tok-n">dataView</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DataView</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">[]&gt;(</span><span class="tok-s">&quot;rows&quot;</span><span class="tok-o">,</span> <span class="tok-n">listDataProvider</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-nd">@Override</span>
    <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">populateItem</span><span class="tok-o">(</span><span class="tok-n">Item</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">[]&gt;</span> <span class="tok-n">item</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-n">countriesArr</span> <span class="tok-o">=</span> <span class="tok-n">item</span><span class="tok-o">.</span><span class="tok-na">getModelObject</span><span class="tok-o">();</span>
      <span class="tok-n">RepeatingView</span> <span class="tok-n">repeatingView</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">RepeatingView</span><span class="tok-o">(</span><span class="tok-s">&quot;dataRow&quot;</span><span class="tok-o">);</span>

      <span class="tok-k">for</span> <span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">i</span> <span class="tok-o">=</span> <span class="tok-mi">0</span><span class="tok-o">;</span> <span class="tok-n">i</span> <span class="tok-o">&lt;</span> <span class="tok-n">countriesArr</span><span class="tok-o">.</span><span class="tok-na">length</span><span class="tok-o">;</span> <span class="tok-n">i</span><span class="tok-o">++){</span>
         <span class="tok-n">repeatingView</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-n">repeatingView</span><span class="tok-o">.</span><span class="tok-na">newChildId</span><span class="tok-o">(),</span> <span class="tok-n">countriesArr</span><span class="tok-o">[</span><span class="tok-n">i</span><span class="tok-o">]));</span>
      <span class="tok-o">}</span>
      <span class="tok-n">item</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">repeatingView</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
  <span class="tok-o">};</span>

  <span class="tok-n">dataView</span><span class="tok-o">.</span><span class="tok-na">setItemsPerPage</span><span class="tok-o">(</span><span class="tok-mi">15</span><span class="tok-o">);</span>

  <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">dataView</span><span class="tok-o">);</span>
  <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">PagingNavigator</span><span class="tok-o">(</span><span class="tok-s">&quot;pagingNavigator&quot;</span><span class="tok-o">,</span> <span class="tok-n">dataView</span><span class="tok-o">));</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The data of a single country (ISO code, name, long name, capital and population) are handled with an array of strings. The usage of PagingNavigator it&#8217;s quite straightforward as we need to simply pass the pageable repeater to its constructor.</p>
</div>
<div class="paragraph">
<p>To explore the other pageable repeaters shipped with Wicket you can visit the page at  <a href="http://www.wicket-library.com/wicket-examples/repeater/">http://www.wicket-library.com/wicket-examples/repeater/</a> here you can find live examples of these components.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Wicket provides also component PageableListView which is a sublcass of ListView that implements interface IPageable, hence it can be considered a pageable repeaters even if it doesn&#8217;t use interface IDataProvider as data source.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_summary_10">Summary</h3>
<div class="paragraph">
<p>In this chapter we have explored the built-in set of components called repeaters which are designed to repeat their own markup in output to display a set of items. We have started with component <em>RepeatingView</em> which can be used to repeat a simple markup fragment.</p>
</div>
<div class="paragraph">
<p>Then, we have seen components <em>ListView</em> and <em>RefreshingView</em> which should be used when the markup to repeat contains nested components to populate.</p>
</div>
<div class="paragraph">
<p>Finally, we have discussed those repeaters that support data paging and that are called pageable repeaters. We ended the chapter looking at an example where a pageable repeater is used with panel PagingNavigator to make its dataset navigable by the user.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_component_queueing">Component queueing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So far to build component hierarchy we have explicitly added each component and container in accordance with the corresponding markup. This necessary step can involve repetitive and boring code which must be change every time we decide to change markup hierarchy.
Component queueing is a new feature in Wicket 7 that solves this problem allowing Wicket to build component hierarchy in Java automatically making your code simpler and more maintainable. This chapter should serve as a short introduction to what Component Queueing is and what problems it is trying to solve.</p>
</div>
<div class="sect2">
<h3 id="_markup_hierarchy_and_code">Markup hierarchy and code</h3>
<div class="paragraph">
<p>With Wicket as developers we use to define the hierarchy of components in the markup templates:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&#39;customer&#39;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&#39;first&#39;</span> <span class="tok-na">type=</span><span class="tok-s">&#39;text&#39;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&#39;last&#39;</span> <span class="tok-na">type=</span><span class="tok-s">&#39;text&#39;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;child&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;input</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&#39;first&#39;</span> <span class="tok-na">type=</span><span class="tok-s">&#39;text&#39;</span><span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;input</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&#39;last&#39;</span> <span class="tok-na">type=</span><span class="tok-s">&#39;text&#39;</span><span class="tok-nt">/&gt;</span>
        <span class="tok-nt">&lt;input</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&#39;dob&#39;</span> <span class="tok-na">type=</span><span class="tok-s">&#39;date&#39;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/form&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>and then we repeat the same hierarchy in Java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Form</span> <span class="tok-n">form</span><span class="tok-o">=</span><span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;customer&quot;</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>

<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;first&quot;</span><span class="tok-o">));</span>
<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;last&quot;</span><span class="tok-o">));</span>

<span class="tok-n">WebMarkupContainer</span> <span class="tok-n">child</span><span class="tok-o">=</span><span class="tok-k">new</span> <span class="tok-n">WebMarkupContainer</span><span class="tok-o">(</span><span class="tok-s">&quot;child&quot;</span><span class="tok-o">);</span>
<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">child</span><span class="tok-o">);</span>

<span class="tok-n">child</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;first&quot;</span><span class="tok-o">));</span>
<span class="tok-n">child</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;last&quot;</span><span class="tok-o">));</span>
<span class="tok-n">child</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;dob&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The need for the hierarchy in the markup is obvious, it is simply how the markup works. On the Java side of things it may not be immediately apparent. After all, why can we not write the code like this?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;customer&quot;</span><span class="tok-o">));</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;first&quot;</span><span class="tok-o">));</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;last&quot;</span><span class="tok-o">));</span>
<span class="tok-n">WebMarkupContainer</span> <span class="tok-n">child</span><span class="tok-o">=</span><span class="tok-k">new</span> <span class="tok-n">WebMarkupContainer</span><span class="tok-o">(</span><span class="tok-s">&quot;child&quot;</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">child</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;first&quot;</span><span class="tok-o">));</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;last&quot;</span><span class="tok-o">));</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;dob&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are a couple of reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ambiguities that happen with duplicate ids</p>
</li>
<li>
<p>Inheriting state from parent to child</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will examine these below.</p>
</div>
</div>
<div class="sect2">
<h3 id="_markup_id_ambiguities">Markup Id Ambiguities</h3>
<div class="paragraph">
<p>In the example above we have a form that collects the name of a customer along with the name of their child and the child’s date of birth. We mapped the name of the customer and child to form components with wicket ids <em>first</em> and <em>last</em>. If we were to add all the components to the same parent we would get an error because we cannot have two components with the same wicket id under the same parent (two components with id <em>first</em> and two with id <em>last</em>).
Without hierarchy in Java we would have to make sure that all wicket ids in a markup file are unique, no small feat in a non-trivial page or panel. But, with hierarchy on the Java side we just have to make sure that no parent has two children with the same id, which is trivial.</p>
</div>
</div>
<div class="sect2">
<h3 id="_inheriting_state_from_parents">Inheriting State From Parents</h3>
<div class="paragraph">
<p>Suppose we wanted to hide form fields related to the child in the example above when certain conditions are met. Without hierarchy we would have to modify the <em>first</em>, <em>last</em>, and <em>dob</em> fields to implement the visibility check. Worse, whenever we would add a new child related field we would have to remember to implement the same check; this is a maintenance headache. With hierarchy this is easy, simply hide the parent container and all children will be hidden as well — the code lives in one place and is automatically inherited by all descendant components. Thus, hierarchy on the Java side allows us to write succinct and maintainable code by making use of the parent-child relationship of components.</p>
</div>
</div>
<div class="sect2">
<h3 id="_pain_points_of_the_java_side_hierarchy">Pain Points of the Java-Side Hierarchy</h3>
<div class="paragraph">
<p>While undeniably useful, the Java-side hierarchy can be a pain to maintain. It is very common to get requests to change things because the designer needs to wrap some components in a <em>div</em> with a dynamic style or class attribute. Essentially we want to go from:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&#39;customer&#39;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&#39;first&#39;</span> <span class="tok-na">type=</span><span class="tok-s">&#39;text&#39;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&#39;last&#39;</span> <span class="tok-na">type=</span><span class="tok-s">&#39;text&#39;</span><span class="tok-nt">/&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">&lt;</span><span class="tok-n">form</span> <span class="tok-n">wicket</span><span class="tok-o">:</span><span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-err">&#39;</span><span class="tok-n">customer</span><span class="tok-err">&#39;</span><span class="tok-o">&gt;</span>
    <span class="tok-o">&lt;</span><span class="tok-n">div</span> <span class="tok-n">wicket</span><span class="tok-o">:</span><span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-err">&#39;</span><span class="tok-n">container</span><span class="tok-err">&#39;</span><span class="tok-o">&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-n">input</span> <span class="tok-n">wicket</span><span class="tok-o">:</span><span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-err">&#39;</span><span class="tok-n">first</span><span class="tok-err">&#39;</span> <span class="tok-n">type</span><span class="tok-o">=</span><span class="tok-err">&#39;</span><span class="tok-n">text</span><span class="tok-err">&#39;</span><span class="tok-o">/&gt;</span>
        <span class="tok-o">&lt;</span><span class="tok-n">input</span> <span class="tok-n">wicket</span><span class="tok-o">:</span><span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-err">&#39;</span><span class="tok-n">last</span><span class="tok-err">&#39;</span> <span class="tok-n">type</span><span class="tok-o">=</span><span class="tok-err">&#39;</span><span class="tok-n">text</span><span class="tok-err">&#39;</span><span class="tok-o">/&gt;</span>
    <span class="tok-o">&lt;/</span><span class="tok-n">div</span><span class="tok-o">&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Seems simple enough, but to do so we need to create the new container, find the code that adds all the components that have to be relocated and change it to add to the new container instead. This code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Form</span> <span class="tok-n">form</span><span class="tok-o">=</span><span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;customer&quot;</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>

<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;first&quot;</span><span class="tok-o">));</span>
<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;last&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Will become:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Form</span> <span class="tok-n">form</span><span class="tok-o">=</span><span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;customer&quot;</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>

<span class="tok-n">WebMarkupContainer</span> <span class="tok-n">container</span><span class="tok-o">=</span><span class="tok-k">new</span> <span class="tok-n">WebMarkupContainer</span><span class="tok-o">(</span><span class="tok-s">&quot;container&quot;</span><span class="tok-o">);</span>
<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">container</span><span class="tok-o">);</span>

<span class="tok-n">container</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;first&quot;</span><span class="tok-o">));</span>
<span class="tok-n">container</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;last&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another common change is to tweak the nesting of markup tags. This is something a designer should be able to do on their own if the change is purely visual, but cannot if it means Wicket components will change parents.</p>
</div>
<div class="paragraph">
<p>In large pages with a lot of components these kinds of simple changes tend to cause a lot of annoyance for the developers.</p>
</div>
</div>
<div class="sect2">
<h3 id="_component_queueing_to_the_rescue">Component Queueing To The Rescue</h3>
<div class="paragraph">
<p>The idea behind component queueing is simple: instead of adding components to their parents directly, the developer can queue them in any ancestor and have Wicket automatically ‘dequeue’ them to the correct parent using the hierarchy defined in the markup. This will give us the best of both worlds: the developer only has to define the hierarchy once in markup, and have it automatically constructed in Java land.</p>
</div>
<div class="paragraph">
<p>That means we can go from code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Form</span> <span class="tok-n">form</span><span class="tok-o">=</span><span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;customer&quot;</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>

<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;first&quot;</span><span class="tok-o">));</span>
<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;last&quot;</span><span class="tok-o">));</span>

<span class="tok-n">WebMarkupContainer</span> <span class="tok-n">child</span><span class="tok-o">=</span><span class="tok-k">new</span> <span class="tok-n">WebMarkupContainer</span><span class="tok-o">(</span><span class="tok-s">&quot;child&quot;</span><span class="tok-o">);</span>
<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">child</span><span class="tok-o">);</span>

<span class="tok-n">child</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;first&quot;</span><span class="tok-o">));</span>
<span class="tok-n">child</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;last&quot;</span><span class="tok-o">));</span>
<span class="tok-n">child</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;dob&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To code like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">queue</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;customer&quot;</span><span class="tok-o">));</span>
<span class="tok-n">queue</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;first&quot;</span><span class="tok-o">));</span>
<span class="tok-n">queue</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;last&quot;</span><span class="tok-o">));</span>

<span class="tok-n">WebMarkupContainer</span> <span class="tok-n">child</span><span class="tok-o">=</span><span class="tok-k">new</span> <span class="tok-n">WebMarkupContainer</span><span class="tok-o">(</span><span class="tok-s">&quot;child&quot;</span><span class="tok-o">);</span>
<span class="tok-n">queue</span><span class="tok-o">(</span><span class="tok-n">child</span><span class="tok-o">);</span>
<span class="tok-n">child</span><span class="tok-o">.</span><span class="tok-na">queue</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;first&quot;</span><span class="tok-o">));</span>
<span class="tok-n">child</span><span class="tok-o">.</span><span class="tok-na">queue</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;last&quot;</span><span class="tok-o">));</span>
<span class="tok-n">child</span><span class="tok-o">.</span><span class="tok-na">queue</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;dob&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Note that we had to queue child’s <em>first</em> and <em>last</em> name fields to the <em>child</em> container in order to disambiguate their wicket ids.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The code above does not look shorter or that much different, so where is the advantage?</p>
</div>
<div class="paragraph">
<p>Suppose our designer wants us to wrap the customer’s first and last name fields with a <em>div</em> that changes its styling based on some condition. We saw how to do that above, we had to create a container and then reparent the two <em>TextField</em> components into it. Using queueing we can skip the second step, all we have to do is add the following line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">queue</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">WebMarkupContainer</span><span class="tok-o">(</span><span class="tok-s">&quot;container&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>When dequeueing Wicket will automatically reparent the first and last name fields into the container for us.</p>
</div>
<div class="paragraph">
<p>If the designer later wanted to move the first name field out of the <em>div</em> we just added for them they could do it all by themselves without requiring any changes in the Java code. Wicket would dequeue the first name field into the form and the last name field into the container div.</p>
</div>
</div>
<div class="sect2">
<h3 id="_improved_auto_components">Improved auto components</h3>
<div class="paragraph">
<p>Auto components, such as Enclosure, are a very useful feature of Wicket, but they have always been a pain to implement and use.</p>
</div>
<div class="paragraph">
<p>Suppose we have:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="xml language-xml"><span class="tok-nt">&lt;wicket:enclosure</span> <span class="tok-na">childId=</span><span class="tok-s">&quot;first&quot;</span><span class="tok-nt">&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;first&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;input</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;last&quot;</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/wicket:enclosure&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Together with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;first&quot;</span><span class="tok-o">).</span><span class="tok-na">setRequired</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">).</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">));</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;last&quot;</span><span class="tok-o">).</span><span class="tok-na">setRequired</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>When developing auto components the biggest pain point is in figuring out who the children of the auto component are. In the markup above the enclosure is a parent of the text fields, but in Java it would be a sibling because auto components do not modify the java-side hierarchy. So when the Enclosure is looking for its children it has to parse the markup to figure out what they are. This is not a trivial task.</p>
</div>
<div class="paragraph">
<p>Because auto components do not insert themselves properly into the Java hierarchy they are also hard for users to use. For example, the documentation of Enclosure does not recommend it to be used to wrap form components like we have above. When the page renders the enclosure will be hidden because <em>first</em> component is not visible. However, when we submit the form, <em>last</em> component will raise a required error. This is because <em>last</em> is not made a child of the hidden enclosure and therefore does not know its hidden — so it will try to process its input and raise the error.</p>
</div>
<div class="paragraph">
<p>Had we used <em>queue</em> instead of <em>add</em> in the code above, everything would work as expected. As part of Queueing implementation Wicket will properly insert auto components into the Java hierarchy. Furthermore, auto components will remain in the hierarchy instead of being added before render and removed afterwords. This is a big improvement because developers will no longer have to parse markup to find the children components — since children will be added to the enclosure by the dequeueing. Likewise, user restrictions are removed as well; the code above would work as expected.</p>
</div>
</div>
<div class="sect2">
<h3 id="_when_are_components_dequeued">When are components dequeued?</h3>
<div class="paragraph">
<p>Once you call <em>queue()</em>, when are the components dequeued into the page hierarchy? When is it safe to call <em>getParent()</em> or use methods such as <em>isVisibleInHierarchy()</em> which rely on component’s position in hierarchy?</p>
</div>
<div class="paragraph">
<p>The components are dequeued as soon as a path is available from <em>Page</em> to the component they are queued into. The dequeue operation needs access to markup which is only available once the Page is known (because the <em>Page</em> object controls the extension of the markup).</p>
</div>
<div class="paragraph">
<p>If the <em>Page</em> is known at the time of the <em>queue()</em> call (eg if its called inside <em>onInitialize()</em>) the components are dequeued before <em>queue()</em> returns.</p>
</div>
</div>
<div class="sect2">
<h3 id="_restrictions_of_queueing">Restrictions of queueing</h3>

</div>
<div class="sect2">
<h3 id="_ancestors">Ancestors</h3>
<div class="paragraph">
<p>Suppose on a user profile panel we have the following code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">queue</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;first&quot;</span><span class="tok-o">));</span>
<span class="tok-n">queue</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;last&quot;</span><span class="tok-o">));</span>

<span class="tok-n">WebMarkupContainer</span> <span class="tok-n">secure</span><span class="tok-o">=</span><span class="tok-k">new</span> <span class="tok-n">WebMarkupContainer</span><span class="tok-o">(</span><span class="tok-s">&quot;secure&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kt">void</span> <span class="tok-nf">onConfigure</span><span class="tok-o">()</span> <span class="tok-o">{</span>
       <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onConfigure</span><span class="tok-o">();</span>
       <span class="tok-n">setVisible</span><span class="tok-o">(</span><span class="tok-n">isViewingOwnProfile</span><span class="tok-o">());</span>
    <span class="tok-o">}</span>
<span class="tok-o">};</span>

<span class="tok-n">queue</span><span class="tok-o">(</span><span class="tok-n">secure</span><span class="tok-o">);</span>
<span class="tok-n">secure</span><span class="tok-o">.</span><span class="tok-na">queue</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;creditCardNumber&quot;</span><span class="tok-o">));</span>
<span class="tok-n">secure</span><span class="tok-o">.</span><span class="tok-na">queue</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;creditCardExpiry&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>What is to prevent someone with access to markup from moving the <em>creditCardNumber</em> label out of the <em>secure</em> div, causing a big security problem for the site?</p>
</div>
<div class="paragraph">
<p>Wicket will only dequeue components either to the component they are queued to or any of its descendants.</p>
</div>
<div class="paragraph">
<p>In the code above this is the reason why we queued the <em>creditCardNumber</em> label into the <em>secure</em> container. That means it can only be dequeued into the <em>secure</em> container’s hierarchy.</p>
</div>
<div class="paragraph">
<p>This restriction allows developers to enforce certain parent-child relationships in their code.</p>
</div>
</div>
<div class="sect2">
<h3 id="_regions">Regions</h3>
<div class="paragraph">
<p>Dequeuing of components will not happen across components that implement the <em>org.apache.wicket.IQueueRegion</em> interface. This interface is implemented by all components that provide their own markup such as: <em>Page</em>, <em>Panel</em>, <em>Border</em>, <em>Fragment</em>. This is done so that if both a page and panel contain a component with id <em>foo</em> the one queued into the page will not be dequeued into the panel. This minimizes confusion and debugging time. The rule so far is that if a component provides its own markup only components queued inside it will be dequeued into it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_summary_11">Summary</h3>
<div class="paragraph">
<p>Component queueing is a new and improved way of creating the component hierarchy in Wicket 7. By having to define the hierarchy only once in markup we can make the Java-side code simpler and more maintainable.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_internationalization_with_wicket">Internationalization with Wicket</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In  <a href="#guide:forms2_2">chapter 12.2</a>
 we have seen how the topic of localization is involved in the generation of feedback messages and we had a first contact with resource bundles. In this chapter we will continue to explore the localization support provided by Wicket and we will learn how to build pages and components ready to be localized in different languages.</p>
</div>
<div class="sect2">
<h3 id="_localization">Localization</h3>
<div class="paragraph">
<p>As we have seen in  <a href="#guide:forms2_2">paragraph 12.2</a>
, the infrastructure of feedback messages is built on top of Java internationalization (i18n) support, so it should not be surprising that the same infrastructure is used also for localization purpose. However, while so far we have used only the &lt;ApplicationClassName&gt;.properties file to store our custom messages, in this chapter we will see that also pages, components, validators and even Java packages can have their own resource bundles. This allows us to split bundles into multiple files keeping them close to where they are used. But before diving into the details of internationalization with Wicket, it&#8217;s worthwhile to quickly review how i18n works under Java, see what classes are involved and how they are integrated into Wicket.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Providing a full description of Java support for i18n is clearly out of the scope of this document. If you need more informations about this topic you can find them in the JavaDocs and in the official  8n[guide:forms2_2] //docs.oracle.com/javase/tutorial/i18n/index.html .
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_class_locale_and_resourcebundle">Class Locale and ResourceBundle</h3>
<div class="paragraph">
<p>Class java.util.Locale represents a specific country or language of the world and is used in Java to retrieve other locale-dependent informations like numeric and date formats, the currency in use in a country and so on. Such kind of informations are accessed through special entities called resource bundles which are implemented by class <em>java.util.ResourceBundle</em>. Every resource bundle is identified by a full name which is built using four parameters: a base name (which is required), a language code, a country code and a variant (which are all optional). These three optional parameters are provided by an instance of Locale with its three corresponding getter methods: getLanguage(), getCountry() and getVariant(). Parameter language code is a lowercase ISO 639 2-letter code (like zh for Chinese, de for German and so on) while country code is an uppercase ISO 3166 2-letter code (like CN for China, DE for Germany and so on). The final full name will have the following structure (NOTE: tokens inside squared brackets are optional):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">&lt;</span><span class="tok-n">base</span> <span class="tok-n">name</span><span class="tok-o">&gt;[</span><span class="tok-n">_</span><span class="tok-o">&lt;</span><span class="tok-n">language</span> <span class="tok-n">code</span><span class="tok-o">&gt;[</span><span class="tok-n">_</span><span class="tok-o">&lt;</span><span class="tok-n">COUNTRY_CODE</span><span class="tok-o">&gt;[</span><span class="tok-n">_</span><span class="tok-o">&lt;</span><span class="tok-n">variant</span> <span class="tok-n">code</span><span class="tok-o">&gt;]]]</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example a bundle with MyBundle as base name and localized for Mandarin Chinese (language code zh, country code CH, variant cmn) will have MyBundle_zh_CH_cmn as full name. A base name can be a fully qualified class name, meaning that it can include a package name before the actual base name. The specified package will be the container of the given bundle. For example if we use org.foo.MyBundle as base name, the bundle named MyBundle will be searched inside package org.foo. The actual base name (MyBundle in our example) will be used to build the full name of the bundle following the same rules seen above.
<em>ResourceBundle</em> is an abstract factory class, hence it exposes a number of factory methods named  getBundle to load a concrete bundle. Without going into too much details we can say that a bundle corresponds to a file in the classpath. To find a file for a given bundle, getBundle needs first to generate an ordered list of candidate bundle names. These names are the set of all possible full names for a given bundle. For example if we have org.foo.MyBundle as base name and the current locale is the one seen before for Mandarin Chinese, the candidate names will be:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>org.foo.MyBundle_zh_CH_cmn</p>
</li>
<li>
<p>org.foo.MyBundle_zh_CH</p>
</li>
<li>
<p>org.foo.MyBundle_zh</p>
</li>
<li>
<p>org.foo.MyBundle</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>The list of these candidate names is generated starting from the most specific one and subtracting an optional parameter at each step. The last name of the list corresponds to the default resource bundle which is the most general name and is equal to the base name. Once that getBundle has generated the list of candidate names, it will iterate over them to find the first one for which is possible to load a class or a properties file. The class must be a subclass of <em>ResourceBundle</em> having as class name the full name used in the current iteration. If such a class is not found, getBundle will try to locate a properties file having a file name equals to the current full name (Java will automatically append extension .properties to the full name). For example given the resource bundle of the previous example, Java will search first for class org.foo.MyBundle_zh_CH_cmn and then for file MyBundle_zh_CH_cmn.properties inside package org.foo. If no file is found for any of the candidate names, a MissingResourceException will be thrown. Bundles contains local-dependent string resources identified by a key that is unique in the given bundle. So once we have obtained a valid bundle we can access these objects with method getString (String key).</p>
</div>
<div class="paragraph">
<p>As we have seen before working with feedback messages, in Wicket most of the times we will work with properties files rather than with bundle classes. In  <a href="#guide:forms2_2">paragraph 12.2</a>
 we used a properties file having as base name the class name of the application class and without any information about the locale. This file is the default resource bundle for a Wicket application. In  <a href="#guide:i18n_3">paragraph 15.3</a>
 we will explore the algorithm used in Wicket to locate the available bundles for a given component. Once we have learnt how to leverage this algorithm, we will be able to split our bundles into more files organized in a logical hierarchy.</p>
</div>
</div>
<div class="sect2">
<h3 id="_localization_in_wicket">Localization in Wicket</h3>
<div class="paragraph">
<p>A component can get the current locale in use calling its method getLocale(). By default this method will be recursively called on component&#8217;s parent containers until one of them returns a valid locale. If no one of them returns a locale, this method will get the one associated with the current user session. This locale is automatically generated by Wicket in accordance with the language settings of the browser.</p>
</div>
<div class="paragraph">
<p>Developers can change the locale of the current session with Session&#8217;s method setLocale (Locale locale):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Session</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">setLocale</span><span class="tok-o">(</span><span class="tok-n">locale</span><span class="tok-o">)</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_style_and_variation_parameters_for_bundles">Style and variation parameters for bundles</h3>
<div class="paragraph">
<p>In addition to locale&#8217;s informations, Wicket supports two further parameters to identify a resource bundle: style and variation. Parameter style is a string value and is defined at session-level. To set/get the style for the current session we can use the corresponding setter and getter of class Session:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Session</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">setStyle</span><span class="tok-o">(</span><span class="tok-s">&quot;myStyle&quot;</span><span class="tok-o">);</span>
<span class="tok-n">Session</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">getStyle</span><span class="tok-o">();</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If set, style&#8217;s value contributes to the final full name of the bundle and it is placed between the base name and the locale&#8217;s informations:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">&lt;</span><span class="tok-n">base</span> <span class="tok-n">name</span><span class="tok-o">&gt;[</span><span class="tok-n">_style</span><span class="tok-o">][</span><span class="tok-n">_</span><span class="tok-o">&lt;</span><span class="tok-n">language</span> <span class="tok-n">code</span><span class="tok-o">&gt;[</span><span class="tok-n">_</span><span class="tok-o">&lt;</span><span class="tok-n">COUNTRY_CODE</span><span class="tok-o">&gt;[</span><span class="tok-n">_</span><span class="tok-o">&lt;</span><span class="tok-n">variant</span> <span class="tok-n">code</span><span class="tok-o">&gt;]]]</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wicket gives the priority to candidate names containing the style information (if available). The other parameter we can use for localization is variation. Just like style also variation is a string value, but it is defined at component-level. The value of variation is returned by Component&#8217;s method getVariation(). By default this method returns the variation of the parent component or a null value if a component hasn&#8217;t a parent (i.e. it&#8217;s a page). If we want to customize this parameter we must overwrite method  getVariation and make it return the desired value.</p>
</div>
<div class="paragraph">
<p>Variation&#8217;s value contributes to the final full name of the bundle and is placed before style parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">&lt;</span><span class="tok-n">base</span> <span class="tok-n">name</span><span class="tok-o">&gt;[</span><span class="tok-n">_variation</span><span class="tok-o">][</span><span class="tok-n">_style</span><span class="tok-o">][</span><span class="tok-n">_</span><span class="tok-o">&lt;</span><span class="tok-n">language</span> <span class="tok-n">code</span><span class="tok-o">&gt;[</span><span class="tok-n">_</span><span class="tok-o">&lt;</span><span class="tok-n">COUNTRY_CODE</span><span class="tok-o">&gt;[</span><span class="tok-n">_</span><span class="tok-o">&lt;</span><span class="tok-n">variant</span> <span class="tok-n">code</span><span class="tok-o">&gt;]]]</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_utf_8_for_resource_bundles">Using UTF-8 for resource bundles</h3>
<div class="paragraph">
<p>Java uses the standard character set  O[] 859-11 ttp://en.wikipedia.org/wiki/ISO/IEC_8859-1[] o encode text files like properties files. Unfortunately ISO 8859-1 does not support most of the extra-European languages like Chinese or Japanese. The only way to use properties files with such languages is to use escaped  <a href="http://en.wikipedia.org/wiki/List_of_Unicode_characters">Unicode</a> haracters, but this leads to not human-readable files. For example if we wanted to write the word <em>website</em> in simplified Chinese (the ideograms are 网站) we should write the Unicode characters <em>\u7F51\u7AD9</em>.
For this reason ISO 8859-11 is being replaced with another Unicode-compliant character encoding called UTF-8. Text files created with this encoding can contain Unicode symbols in plain format.
Wicket provides a useful convention to use properties file encoded with UTF-8. We just have to add prefix <em>.utf8.</em> to file extension (i.e. <em>.utf8.properties</em>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
If you want to use UTF-8 with your text files, make sure that your editor/IDE is actually using this character encoding. Some OS like Windows use a different encoding by default.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_using_xml_files_as_resource_bundles">Using XML files as resource bundles</h3>
<div class="paragraph">
<p>Starting from version 1.5, Java introduced the support for XML files as resource bundles. XML files are generally encoded with character sets UTF-8 or UTF-16 which support every symbol of the Unicode standard. In order to be a valid resource bundle the XML file must conform to the DTD available at  <a href="http://www.oracle.com/webfolder/technetwork/jsc/dtd/properties.dtd">http://www.oracle.com/webfolder/technetwork/jsc/dtd/properties.dtd</a></p>
</div>
<div class="paragraph">
<p>Here is an example of XML resource bundle taken from project LocalizedGreetings (file WicketApplication_zh.properties.xml) containing the translation in simplified Chinese of the greeting message “Welcome to the website!”:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="xml language-xml"><span class="tok-cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tok-cp">&lt;!DOCTYPE properties SYSTEM &quot;http://www.oracle.com/webfolder/technetwork/jsc/dtd/properties.dtd&quot;&gt;</span>
<span class="tok-nt">&lt;properties&gt;</span>
	<span class="tok-nt">&lt;entry</span> <span class="tok-na">key=</span><span class="tok-s">&quot;greetingMessage&quot;</span><span class="tok-nt">&gt;</span>欢迎光临本网站！<span class="tok-nt">&lt;/entry&gt;</span>
<span class="tok-nt">&lt;/properties&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use XML bundles in Wicket we don&#8217;t need to put in place any additional configuration. The only rule we have to respect with these files is to use properties.xml as extension while their base name follows the same rules seen so far for bundle names.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reading_bundles_from_code">Reading bundles from code</h3>
<div class="paragraph">
<p>Class Component makes reading bundles very easy with method getString(String key). This method searches for a resource with the given key looking into the resource bundles visited by the lookup algorithm illustrated in  <a href="#guide:i18n_3">paragraph 15.3</a>
. For example if we have a greeting message with key greetingMessage in our application&#8217;s resource  bundle, we can read it from our component code with this instruction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">getString</span><span class="tok-o">(</span><span class="tok-s">&quot;greetingMessage&quot;</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_localization_of_bundles_in_wicket">Localization of bundles in Wicket</h3>
<div class="paragraph">
<p>In  <a href="#guide:forms2_2">paragraph 12.2</a>
 we have used as resource bundle the properties file placed next to our application class. This file is the default resource bundle for the entire application and it is used by the lookup algorithm if it doesn&#8217;t find any better match for a given component and locale. If we want to provide localized versions of this file we must simply follow the rules of Java i18n and put our translated resources into another properties file with a name corresponding to the desired locale. For example project LocalizedGreetings comes with the default application&#8217;s properties file ( WicketApplication.properties) containing a greeting message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">greetingMessage</span><span class="tok-o">=</span><span class="tok-n">Welcome</span> <span class="tok-n">to</span> <span class="tok-n">the</span> <span class="tok-n">site</span><span class="tok-o">!</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Along with this file we can also find a bundle for German (WicketApplication_de.properties) and another one in XML format for simplified Chinese (WicketApplication_zh.properties.xml). The example project consists of a single page (HomePage.java) displaying the greeting message. The current locale can be changed with a drop-down list and the possible options are English (the default one), German and simplified Chinese:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="locale-german.png" alt="locale german">
</div>
</div>
<div class="paragraph">
<p>The label displaying the greeting message has a custom read-only model which returns the message with method getString. The initialization code for this label is this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">AbstractReadOnlyModel</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">model</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AbstractReadOnlyModel</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;()</span> <span class="tok-o">{</span>
			<span class="tok-nd">@Override</span>
			<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getObject</span><span class="tok-o">()</span> <span class="tok-o">{</span>
				<span class="tok-k">return</span> <span class="tok-n">getString</span><span class="tok-o">(</span><span class="tok-s">&quot;greetingMessage&quot;</span><span class="tok-o">);</span>
			<span class="tok-o">}</span>
<span class="tok-o">};</span>

<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;greetingMessage&quot;</span><span class="tok-o">,</span> <span class="tok-n">model</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Class <em>org.apache.wicket.model.AbstractReadOnlyModel</em> is a convenience class for implementing read-only models. In this project we have implemented a custom read-only model for illustrative purposes only because Wicket already provides built-in models for the same task. We will see them in paragraph  <a href="#guide:i18n_5">paragraph 15.5</a>
.</p>
</div>
<div class="paragraph">
<p>The rest of the code of the home page builds the stateless form and the drop-down menu used to change the locale.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Locale</span><span class="tok-o">&gt;</span> <span class="tok-n">locales</span> <span class="tok-o">=</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span><span class="tok-n">Locale</span><span class="tok-o">.</span><span class="tok-na">ENGLISH</span><span class="tok-o">,</span> <span class="tok-n">Locale</span><span class="tok-o">.</span><span class="tok-na">CHINESE</span><span class="tok-o">,</span> <span class="tok-n">Locale</span><span class="tok-o">.</span><span class="tok-na">GERMAN</span><span class="tok-o">);</span>
<span class="tok-kd">final</span> <span class="tok-n">DropDownChoice</span><span class="tok-o">&lt;</span><span class="tok-n">Locale</span><span class="tok-o">&gt;</span> <span class="tok-n">changeLocale</span> <span class="tok-o">=</span>
             <span class="tok-k">new</span> <span class="tok-n">DropDownChoice</span><span class="tok-o">&lt;</span><span class="tok-n">Locale</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;changeLocale&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Model</span><span class="tok-o">&lt;</span><span class="tok-n">Locale</span><span class="tok-o">&gt;(),</span> <span class="tok-n">locales</span><span class="tok-o">);</span>

<span class="tok-n">StatelessForm</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">StatelessForm</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">){</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onSubmit</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-n">Session</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">setLocale</span><span class="tok-o">(</span><span class="tok-n">changeLocale</span><span class="tok-o">.</span><span class="tok-na">getModelObject</span><span class="tok-o">());</span>
	<span class="tok-o">}</span>
<span class="tok-o">};</span>

<span class="tok-n">setStatelessHint</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">changeLocale</span><span class="tok-o">))</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_localization_of_markup_files">Localization of markup files</h3>
<div class="paragraph">
<p>Although resource bundles exist to extract local-dependent elements from our code and from UI components, in Wicket we can decide to provide different markup files for different locale settings. Just like standard markup files, by default localized markup files must be placed next to component&#8217;s class and their file name must contain the locale&#8217;s informations. In the following picture, CustomPanel comes with a standard (or default) markup file and with another one localized for German:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="comp-with-markup-german.png" alt="comp with markup german">
</div>
</div>
<div class="paragraph">
<p>When the current locale corresponds to German country (language code de), markup file CustomPanel_de.html will be used in place of the default one.</p>
</div>
</div>
<div class="sect2">
<h3 id="_reading_bundles_with_tag_wicket_message">Reading bundles with tag &lt;wicket:message&gt;</h3>
<div class="paragraph">
<p>String resources can be also retrieved directly from markup code using tag &lt;wicket:message&gt;. The key of the desired resource is specified with attribute key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="xml language-xml"><span class="tok-nt">&lt;wicket:message</span> <span class="tok-na">key=</span><span class="tok-s">&quot;greetingMessage&quot;</span><span class="tok-nt">&gt;</span>message goes here<span class="tok-nt">&lt;/wicket:message&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default the resource value is not escaped for HTML entities. To do that use the <em>escape</em> attribute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="xml language-xml"><span class="tok-nt">&lt;wicket:message</span> <span class="tok-na">key=</span><span class="tok-s">&quot;greetingMessage&quot;</span> <span class="tok-na">escape=</span><span class="tok-s">&quot;true&quot;</span><span class="tok-nt">&gt;</span>message goes here<span class="tok-nt">&lt;/wicket:message&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>wicket:message</em> can be adopted also to localize the attributes of a tag. The name of the attribute and the resource key are expressed as a colon-separated value. In the following markup the content of attribute <em>value</em> will be replaced with the localized resource having <em>key4value</em> as key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Preview value&quot;</span> <span class="tok-na">wicket:message=</span><span class="tok-s">&quot;value:key4value&quot;</span><span class="tok-nt">/&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we want to specify multiple attributes at once, we can separate them with a comma:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Preview value&quot;</span> <span class="tok-na">wicket:message=</span><span class="tok-s">&quot;value:key4value, title:key4title&quot;</span><span class="tok-nt">/&gt;</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bundles_lookup_algorithm">Bundles lookup algorithm</h3>
<div class="paragraph">
<p>As we hinted at the beginning of this chapter, by default Wicket provides a very flexible algorithm to locate the resource bundles available for a given component. In this paragraph we will learn how this default lookup algorithm works and which options it offers to manage our bundle files.</p>
</div>
</div>
<div class="sect2">
<h3 id="_localizing_pages_and_panels">Localizing pages and panels</h3>
<div class="paragraph">
<p>Similarly to application class, also component classes can have their own bundle files having as base name the class name of the related component and placed in the same package. So for example if class CustomPanel is a custom panel we created, we can provide it with a default bundle file called  CustomPanel.properties containing the textual resources used by this panel. This rule applies to page classes as well:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="page-and-panel-bundle.png" alt="page and panel bundle">
</div>
</div>
<div class="paragraph">
<p>One fundamental thing to keep in mind when we work with these kinds of bundles is that the lookup algorithm gives priority to the bundles of the containers of the component that is requesting a localized resource. The more a container is higher in the hierarchy, the bigger is its priority over the other components. This mechanism was made to allow containers to overwrite resources used by children components. As a consequence the values inside the resource bundle of a page will have the priority over the other values with the same key defined in the bundles of children components.</p>
</div>
<div class="paragraph">
<p>To better grasp this concept let&#8217;s consider the component hierarchy depicted in the following picture:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="custom-panel-bundle.png" alt="custom panel bundle">
</div>
</div>
<div class="paragraph">
<p>If CustomPanel tries to retrieve the string resource having <em>message</em> as key, it will get the value <em>Wellcome!</em> and not the one defined inside its own bundle file.</p>
</div>
<div class="paragraph">
<p>The default message-lookup algorithm is not limited to component hierarchy but it also includes the class hierarchy of every component visited in the search strategy described so far. This makes bundle files inheritable, just like markup files. When the hierarchy of a container component is explored, any ancestor has the priority over children components. Consider for example the hierarchy in the following picture:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="custom-panel-bundle2.png" alt="custom panel bundle2">
</div>
</div>
<div class="paragraph">
<p>Similarly to the previous example, the bundle owned by CustomPanel is overwritten by the bundle of   page class BasePage (which has been inherited by CustomPage).</p>
</div>
</div>
<div class="sect2">
<h3 id="_component_specific_resources">Component-specific resources</h3>
<div class="paragraph">
<p>In order to make a resource specific for a given child component, we can prefix the message key with the id of the desired component. Consider for example the following code and bundle of a generic page:</p>
</div>
<div class="paragraph">
<p>Page code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;label&quot;</span><span class="tok-o">,</span><span class="tok-k">new</span> <span class="tok-n">ResourceModel</span><span class="tok-o">(</span><span class="tok-s">&quot;labelValue&quot;</span><span class="tok-o">)));</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;anotherLabel&quot;</span><span class="tok-o">,</span><span class="tok-k">new</span> <span class="tok-n">ResourceModel</span><span class="tok-o">(</span><span class="tok-s">&quot;labelValue&quot;</span><span class="tok-o">)));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Page bundle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">labelValue</span><span class="tok-o">=</span><span class="tok-n">Default</span> <span class="tok-n">value</span>
<span class="tok-n">anotherLabel</span><span class="tok-o">.</span><span class="tok-na">labelValue</span><span class="tok-o">=</span><span class="tok-n">Value</span> <span class="tok-k">for</span> <span class="tok-n">anotherLabel</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Label with id anotherLabel will display the value <em>Value for anotherLabel</em> while label label will display <em>Default value</em>. In a similar fashion, parent containers can specify a resource for a nested child component prepending also its relative path (the path is dot-separated):</p>
</div>
<div class="paragraph">
<p>Page code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Form</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">);</span>
<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;anotherLabel&quot;</span><span class="tok-o">,</span><span class="tok-k">new</span> <span class="tok-n">ResourceModel</span><span class="tok-o">(</span><span class="tok-s">&quot;labelValue&quot;</span><span class="tok-o">)));</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Page bundle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">labelValue</span><span class="tok-o">=</span><span class="tok-n">Default</span> <span class="tok-n">value</span>
<span class="tok-n">anotherLabel</span><span class="tok-o">.</span><span class="tok-na">labelValue</span><span class="tok-o">=</span><span class="tok-n">Value</span> <span class="tok-k">for</span> <span class="tok-n">anotherLabel</span>
<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">anotherLabel</span><span class="tok-o">.</span><span class="tok-na">labelValue</span><span class="tok-o">=</span><span class="tok-n">Value</span> <span class="tok-k">for</span> <span class="tok-n">anotherLabel</span> <span class="tok-n">inside</span> <span class="tok-n">form</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the code and the bundle above, the label inside the form will display the value <em>Value for anotherLabel inside form</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_package_bundles">Package bundles</h3>
<div class="paragraph">
<p>If no one of the previous steps can find a resource for the given key, the algorithm will look for package bundles. These bundles have <em>wicket-package</em> as base name and they can be placed in one of the package of our application:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="package-bundles.png" alt="package bundles">
</div>
</div>
<div class="paragraph">
<p>Packages are traversed starting from the one containing the component requesting for a resource and going up to the root package.</p>
</div>
</div>
<div class="sect2">
<h3 id="_bundles_for_feedback_messages">Bundles for feedback messages</h3>
<div class="paragraph">
<p>The algorithm described so far applies to feedback messages as well. In case of validation errors, the component that has caused the error will be considered as the component which the string resource is relative to. Furthermore, just like application class and components, validators can have their own bundles placed next to their class and having as base name their class name. This allows us to distribute validators along with the messages they use to report errors:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="validator-with-bundle.png" alt="validator with bundle">
</div>
</div>
<div class="paragraph">
<p>Validator&#8217;s resource bundles have the lowest priority in the lookup algorithm. They can be overwritten by resource bundles of components, packages and application class.</p>
</div>
</div>
<div class="sect2">
<h3 id="_extending_the_default_lookup_algorithm">Extending the default lookup algorithm</h3>
<div class="paragraph">
<p>Wicket implements the default lookup algorithm using the strategy pattern. The concrete strategies are abstracted with the interface <em>org.apache.wicket.resource.loader.IStringResourceLoader</em>. By default Wicket uses the following implementations of <em>IStringResourceLoader</em> (sorted by execution order):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>ComponentStringResourceLoader:</strong> implements most of the default algorithm. It searches for a given resource across bundles from the container hierarchy, from class hierarchy and from the given component.</p>
</li>
<li>
<p><strong>PackageStringResourceLoader:</strong> searches into package bundles.</p>
</li>
<li>
<p><strong>ClassStringResourceLoader:</strong> searches into bundles of a given class. By default the target class is the application class.</p>
</li>
<li>
<p><strong>ValidatorStringResourceLoader:</strong> searches for resources into validator&#8217;s bundles. A list of validators is provided by the form component that failed validation.</p>
</li>
<li>
<p><strong>InitializerStringResourceLoader:</strong> this resource allows internationalization to interact with the initialization mechanism of the framework that will be illustrated in  <a href="#guide:advanced_3">paragraph 18.3</a>
.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Developer can customize lookup algorithm removing default resource loaders or adding custom implementations to the list of the resource loaders in use. This task can be accomplished using method getStringResourceLoaders of setting class <em>org.apache.wicket.settings.ResourceSettings</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
  <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
  <span class="tok-c1">//retrieve ResourceSettings and then the list of resource loaders</span>
  <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">IStringResourceLoader</span><span class="tok-o">&gt;</span> <span class="tok-n">resourceLoaders</span> <span class="tok-o">=</span> <span class="tok-n">getResourceSettings</span><span class="tok-o">().</span>
                                                <span class="tok-n">getStringResourceLoaders</span><span class="tok-o">();</span>
  <span class="tok-c1">//customize the list...</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_localization_of_component_s_choices">Localization of component&#8217;s choices</h3>
<div class="paragraph">
<p>Components that inherit from <em>AbstractChoice</em> (such as <em>DropDownChoice</em>, <em>CheckBoxMultipleChoice</em> and <em>RadioChoice</em>) must override method <em>localizeDisplayValues</em> and make it return true to localize the values displayed for their choices. By default this method return false so values are displayed as they are. Once localization is activated we can use display values as key for our localized string resources. In project LocalizedChoicesExample we have a drop-down list that displays four colors (green, red, blue, and yellow) which are localized in three languages (English, German and Italian). The current locale can be changed with another drop-down menu (in a similar fashion to project <em>LocalizedGreetings</em>). The code of the home page and the relative bundles are the following:</p>
</div>
<div class="paragraph">
<p>Java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">parameters</span><span class="tok-o">);</span>

	<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Locale</span><span class="tok-o">&gt;</span> <span class="tok-n">locales</span> <span class="tok-o">=</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span><span class="tok-n">Locale</span><span class="tok-o">.</span><span class="tok-na">ENGLISH</span><span class="tok-o">,</span> <span class="tok-n">Locale</span><span class="tok-o">.</span><span class="tok-na">ITALIAN</span><span class="tok-o">,</span> <span class="tok-n">Locale</span><span class="tok-o">.</span><span class="tok-na">GERMAN</span><span class="tok-o">);</span>
	<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">colors</span> <span class="tok-o">=</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span><span class="tok-s">&quot;green&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;red&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;blue&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;yellow&quot;</span><span class="tok-o">);</span>

	<span class="tok-kd">final</span> <span class="tok-n">DropDownChoice</span><span class="tok-o">&lt;</span><span class="tok-n">Locale</span><span class="tok-o">&gt;</span> <span class="tok-n">changeLocale</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DropDownChoice</span><span class="tok-o">&lt;</span><span class="tok-n">Locale</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;changeLocale&quot;</span><span class="tok-o">,</span>
                                                    <span class="tok-k">new</span> <span class="tok-n">Model</span><span class="tok-o">&lt;</span><span class="tok-n">Locale</span><span class="tok-o">&gt;(),</span> <span class="tok-n">locales</span><span class="tok-o">);</span>

	<span class="tok-n">StatelessForm</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">StatelessForm</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">){</span>
		<span class="tok-nd">@Override</span>
		<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onSubmit</span><span class="tok-o">()</span> <span class="tok-o">{</span>
			<span class="tok-n">Session</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">setLocale</span><span class="tok-o">(</span><span class="tok-n">changeLocale</span><span class="tok-o">.</span><span class="tok-na">getModelObject</span><span class="tok-o">());</span>
		<span class="tok-o">}</span>
	<span class="tok-o">};</span>

	<span class="tok-n">DropDownChoice</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">selectColor</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DropDownChoice</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;selectColor&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span>
                                                            <span class="tok-n">Model</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;(),</span> <span class="tok-n">colors</span><span class="tok-o">){</span>
		<span class="tok-nd">@Override</span>
		<span class="tok-kd">protected</span> <span class="tok-kt">boolean</span> <span class="tok-nf">localizeDisplayValues</span><span class="tok-o">()</span> <span class="tok-o">{</span>
			<span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
		<span class="tok-o">}</span>
	<span class="tok-o">};</span>

	<span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">selectColor</span><span class="tok-o">);</span>
	<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">changeLocale</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Default bundle (English):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">selectColor</span><span class="tok-o">.</span><span class="tok-na">null</span><span class="tok-o">=</span><span class="tok-n">Select</span> <span class="tok-n">a</span> <span class="tok-n">color</span>
<span class="tok-n">green</span><span class="tok-o">=</span><span class="tok-n">Green</span>
<span class="tok-n">red</span><span class="tok-o">=</span><span class="tok-n">Red</span>
<span class="tok-n">blue</span><span class="tok-o">=</span><span class="tok-n">Blue</span>
<span class="tok-n">yellow</span><span class="tok-o">=</span><span class="tok-n">Yellow</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>German bundle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">selectColor</span><span class="tok-o">.</span><span class="tok-na">null</span><span class="tok-o">=</span><span class="tok-n">Wählen</span> <span class="tok-n">Sie</span> <span class="tok-n">eine</span> <span class="tok-n">Farbe</span>
<span class="tok-n">green</span><span class="tok-o">=</span><span class="tok-n">Grün</span>
<span class="tok-n">red</span><span class="tok-o">=</span><span class="tok-n">Rot</span>
<span class="tok-n">blue</span><span class="tok-o">=</span><span class="tok-n">Blau</span>
<span class="tok-n">yellow</span><span class="tok-o">=</span><span class="tok-n">Gelb</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Italian bundle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">selectColor</span><span class="tok-o">.</span><span class="tok-na">null</span><span class="tok-o">=</span><span class="tok-n">Scegli</span> <span class="tok-n">un</span> <span class="tok-n">colore</span>
<span class="tok-n">green</span><span class="tok-o">=</span><span class="tok-n">Verde</span>
<span class="tok-n">red</span><span class="tok-o">=</span><span class="tok-n">Rosso</span>
<span class="tok-n">blue</span><span class="tok-o">=</span><span class="tok-n">Blu</span>
<span class="tok-n">yellow</span><span class="tok-o">=</span><span class="tok-n">Giallo</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Along with the localized versions of colors names, in the bundles above we can also find a custom value for the placeholder text (“Select a color ”) used for null value. The resource key for this resource is <em>null</em> or <em>&lt;component id&gt;.null</em> if we want to make it component-specific.</p>
</div>
</div>
<div class="sect2">
<h3 id="_internationalization_and_models">Internationalization and Models</h3>
<div class="paragraph">
<p>Internationalization is another good chance to taste the power of models. Wicket provides two built-in models to better integrate our components with string resources: they are ResourceModel and StringResourceModel.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resourcemodel">ResourceModel</h3>
<div class="paragraph">
<p>Model <em>org.apache.wicket.model.ResourceModel</em> acts just like the read-only model we have implemented in  <a href="#guide:i18n_3">paragraph 15.3</a>
. It simply retrieves a string resource corresponding to a given key:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//build a ResourceModel for key &#39;greetingMessage&#39;</span>
<span class="tok-k">new</span> <span class="tok-n">ResourceModel</span><span class="tok-o">(</span><span class="tok-s">&quot;greetingMessage&quot;</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>We can also specify a default value to use if the requested resource is not found:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//build a ResourceModel with a default value</span>
<span class="tok-k">new</span> <span class="tok-n">ResourceModel</span><span class="tok-o">(</span><span class="tok-s">&quot;notExistingResource&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Resource not found.&quot;</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_stringresourcemodel">StringResourceModel</h3>
<div class="paragraph">
<p>Model <em>org.apache.wicket.model.StringResourceModel</em> allows to work with complex and dynamic string resources containing parameters and property expressions. The basic constructor of this model takes in input a resource key and another model. This further model can be used by both the key and the related resource to specify dynamic values with property expressions. For example let&#8217;s say that we are working on an e-commerce site which has a page where users can see an overview of their orders. To handle the state of user&#8217;s orders we will use the following bean and enum (the code is from project StringResourceModelExample):</p>
</div>
<div class="paragraph">
<p>Bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">Order</span> <span class="tok-kd">implements</span> <span class="tok-n">Serializable</span> <span class="tok-o">{</span>

	<span class="tok-kd">private</span> <span class="tok-n">Date</span> <span class="tok-n">orderDate</span><span class="tok-o">;</span>
	<span class="tok-kd">private</span> <span class="tok-n">ORDER_STATUS</span> <span class="tok-n">status</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-nf">Order</span><span class="tok-o">(</span><span class="tok-n">Date</span> <span class="tok-n">orderDate</span><span class="tok-o">,</span> <span class="tok-n">ORDER_STATUS</span> <span class="tok-n">status</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">();</span>
		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">orderDate</span> <span class="tok-o">=</span> <span class="tok-n">orderDate</span><span class="tok-o">;</span>
		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">status</span> <span class="tok-o">=</span> <span class="tok-n">status</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>
	<span class="tok-c1">//Getters and setters for private fields</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Enum:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">enum</span> <span class="tok-n">ORDER_STATUS</span> <span class="tok-o">{</span>

	<span class="tok-n">PAYMENT_ACCEPTED</span><span class="tok-o">(</span><span class="tok-mi">0</span><span class="tok-o">),</span>
	<span class="tok-n">IN_PROGRESS</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">),</span>
	<span class="tok-n">SHIPPING</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">),</span>
	<span class="tok-n">DELIVERED</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">);</span>

	<span class="tok-kd">private</span> <span class="tok-kt">int</span> <span class="tok-n">code</span><span class="tok-o">;</span>
	<span class="tok-c1">//Getters and setters for private fields</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now what we want to do in this page is to print a simple label which displays the status of an order and the date on  which the order has been submitted. All the informations about the order will be passed to a StringResourceModel with a model containing the bean Order. The bundle in use contains the following key/value pairs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">orderStatus</span><span class="tok-o">.</span><span class="tok-mi">0</span><span class="tok-o">=</span><span class="tok-n">Your</span> <span class="tok-n">payment</span> <span class="tok-n">submitted</span> <span class="tok-n">on</span> <span class="tok-n">$</span><span class="tok-o">{</span><span class="tok-n">orderDate</span><span class="tok-o">}</span> <span class="tok-n">has</span> <span class="tok-n">been</span> <span class="tok-n">accepted</span><span class="tok-o">.</span>
<span class="tok-n">orderStatus</span><span class="tok-o">.</span><span class="tok-mi">1</span><span class="tok-o">=</span><span class="tok-n">Your</span> <span class="tok-n">order</span> <span class="tok-n">submitted</span> <span class="tok-n">on</span> <span class="tok-n">$</span><span class="tok-o">{</span><span class="tok-n">orderDate</span><span class="tok-o">}</span> <span class="tok-n">is</span> <span class="tok-n">in</span> <span class="tok-n">progress</span><span class="tok-o">.</span>
<span class="tok-n">orderStatus</span><span class="tok-o">.</span><span class="tok-mi">2</span><span class="tok-o">=</span><span class="tok-n">Your</span> <span class="tok-n">order</span> <span class="tok-n">submitted</span> <span class="tok-n">on</span> <span class="tok-n">$</span><span class="tok-o">{</span><span class="tok-n">orderDate</span><span class="tok-o">}</span> <span class="tok-n">has</span> <span class="tok-n">been</span> <span class="tok-n">shipped</span><span class="tok-o">.</span>
<span class="tok-n">orderStatus</span><span class="tok-o">.</span><span class="tok-mi">3</span><span class="tok-o">=</span><span class="tok-n">Your</span> <span class="tok-n">order</span> <span class="tok-n">submitted</span> <span class="tok-n">on</span> <span class="tok-n">$</span><span class="tok-o">{</span><span class="tok-n">orderDate</span><span class="tok-o">}</span> <span class="tok-n">has</span> <span class="tok-n">been</span> <span class="tok-n">delivered</span><span class="tok-o">.</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The values above contain a property expression (${orderdate}) that will be evaluated on the data object of the model. The same technique can be applied to the resource key in order to load the right resource according to the state of the order:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Order</span> <span class="tok-n">order</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Order</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Date</span><span class="tok-o">(),</span> <span class="tok-n">ORDER_STATUS</span><span class="tok-o">.</span><span class="tok-na">IN_PROGRESS</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;orderStatus&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">StringResourceModel</span><span class="tok-o">(</span><span class="tok-s">&quot;orderStatus.${status.code}&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-n">order</span><span class="tok-o">))));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can see in the code above also the key contains a property expression (${status.code}) which makes its value dynamic. In this way the state of an object (an Order in our example) can determinate which resource will be loaded by StringResourceModel. If we don&#8217;t use properties expressions we can provide a null value as model and in this case StringResourceModel will behave exactly as a ResourceModel. StringResourceModel supports also the same parameter substitution used by standard class <em>java.text.MessageFormat</em>.</p>
</div>
<div class="paragraph">
<p>Parameters can be generic objects but if we use a model as parameter, StringResourceModel will use the data object inside it as actual value (it will call getObject on the model). Parameters are passed as a vararg argument with method <em>setParameters(Object&#8230; parameters)</em>. Here is an example of usage of parameter substitution:</p>
</div>
<div class="paragraph">
<p>Java code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">PropertyModel</span> <span class="tok-n">propertyModel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PropertyModel</span><span class="tok-o">&lt;</span><span class="tok-n">Order</span><span class="tok-o">&gt;(</span><span class="tok-n">order</span><span class="tok-o">,</span> <span class="tok-s">&quot;orderDate&quot;</span><span class="tok-o">);</span>
<span class="tok-c1">//build a string model with two parameters: a property model and an integer value</span>
<span class="tok-n">StringResourceModel</span> <span class="tok-n">srm</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">StringResourceModel</span><span class="tok-o">(</span><span class="tok-s">&quot;orderStatus.delay&quot;</span><span class="tok-o">).</span><span class="tok-na">setParameters</span><span class="tok-o">(</span><span class="tok-n">propertyModel</span><span class="tok-o">,</span> <span class="tok-mi">3</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Bundle:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">orderStatus</span><span class="tok-o">.</span><span class="tok-na">delay</span><span class="tok-o">=</span><span class="tok-n">Your</span> <span class="tok-n">order</span> <span class="tok-n">submitted</span> <span class="tok-n">on</span> <span class="tok-n">$</span><span class="tok-o">{</span><span class="tok-mi">0</span><span class="tok-o">}</span> <span class="tok-n">has</span> <span class="tok-n">been</span> <span class="tok-n">delayed</span> <span class="tok-n">by</span> <span class="tok-o">{</span><span class="tok-mi">1</span><span class="tok-o">}</span> <span class="tok-n">days</span><span class="tok-o">.</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>One further parameter we can specify when we build a StringResourceModel is the component that must be used by the lookup algorithm. Normally this parameter is not relevant, but if we need to use a particular bundle owned by a component not considered by the algorithm, we can specify this component as second parameter. If we pass all possible parameters to StringResourceModel&#8217;s constructor we obtain something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-k">new</span> <span class="tok-n">StringResourceModel</span><span class="tok-o">(</span><span class="tok-s">&quot;myKey&quot;</span><span class="tok-o">,</span> <span class="tok-n">myComponent</span><span class="tok-o">,</span> <span class="tok-n">myModel</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Default value is supported as well, both as string model or as string value:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-k">new</span> <span class="tok-n">StringResourceModel</span><span class="tok-o">(</span><span class="tok-s">&quot;myKey&quot;</span><span class="tok-o">,</span> <span class="tok-n">myComponent</span><span class="tok-o">,</span> <span class="tok-n">myModel</span><span class="tok-o">).</span><span class="tok-na">setDefaultValue</span><span class="tok-o">(</span><span class="tok-s">&quot;default&quot;</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_12">Summary</h3>
<div class="paragraph">
<p>Internationalization is a mandatory step if we want to take our applications (and our business!) abroad. Choosing the right strategy to manage our localized resources is fundamental to avoid to make a mess of them. In this chapter we have explored the built-in support for localization provided by Wicket, and we have learnt which solutions it offers to manage resource bundles. In the final part of the chapter we have seen how to localize the options displayed by a component (such as DropDownChoice or RadioChoice) and we also introduced two new models specifically designed to localize our components without introducing in their code any detail about internationalization.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_resource_management_with_wicket">Resource management with Wicket</h2>
<div class="sectionbody">
<div class="paragraph">
<p>One of the biggest challenge for a web framework is to offer an efficient and consistent mechanism to handle internal resources such as CSS/JavaScript files, picture files, pdf and so on. Resources can be static (like an icon used across the site) or dynamic (they can be generated on the fly) and they can be made available to users as a download or as a simple URL.</p>
</div>
<div class="paragraph">
<p>In  <a href="#guide:keepControl_6">paragraph 6.6</a>
 we have already seen how to add CSS and JavaScript contents to the header section of the page. In the first half of this chapter we will learn a more sophisticated technique that allows us to manage static resources directly from code and “pack” them with our custom components.</p>
</div>
<div class="paragraph">
<p>Then, in the second part of the chapter we will see how to implement custom resources to enrich our web application with more complex and dynamic functionalities.</p>
</div>
<div class="sect2">
<h3 id="_static_vs_dynamic_resources">Static vs dynamic resources</h3>
<div class="paragraph">
<p>In Wicket a resource is an entity that can interact with the current request and response and It must implement interface <em>org.apache.wicket.request.resource.IResource</em>. This interface defines just method respond(IResource.Attributes attributes) where the nested class IResource. Attributes provides access to request, response and page parameters objects.</p>
</div>
<div class="paragraph">
<p>Resources can be static or dynamic. Static resources don&#8217;t entail any computational effort to be generated and they generally correspond to a resource on the filesystem. On the contrary dynamic resources are generated on the fly when they are requested, following a specific logic coded inside them.</p>
</div>
<div class="paragraph">
<p>An example of dynamic resource is the built-in class CaptchaImageResource in package <em>org.apache.wicket.extensions.markup.html.captcha</em> which generates a captcha image each time is rendered.</p>
</div>
<div class="paragraph">
<p>As we will see in  <a href="#guide:resources_10">paragraph 16.10</a>
, developers can build custom resources extending base class <em>org.apache.wicket.request.resource.AbstractResource</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_resource_references">Resource references</h3>
<div class="paragraph">
<p>Most of the times in Wicket we won&#8217;t directly instantiate a resource but rather we will use a reference to it. Resource references are represented by abstract class <em>org.apache.wicket.request.resource.ResourceReference</em> which returns a concrete resource with factory method getResource(). In this way we can lazy-initialize resources loading them only the first time they are requested.</p>
</div>
</div>
<div class="sect2">
<h3 id="_package_resources">Package resources</h3>
<div class="paragraph">
<p>With HTML we use to include static resources in our pages using tags like &lt;script&gt;, &lt;link&gt; or &lt;img&gt;. This is what we have done so far writing our custom panels and pages. However, when we work with a component-oriented framework like Wicket, this classic approach becomes inadequate because it makes custom components hardly reusable. This happens when a component depends on a big number of resources. In such a case, if somebody wanted to use our custom component in his application, he would be forced to know which resources it depends on and make them available.</p>
</div>
<div class="paragraph">
<p>To solve this problem Wicket allows us to place static resource files into component package (like we do with markup and properties files) and load them from component code.</p>
</div>
<div class="paragraph">
<p>These kinds of resources are called package resources (a CSS and a JavaScript file in this screenshot):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="package-resources.png" alt="package resources">
</div>
</div>
<div class="paragraph">
<p>With package resources custom components become independent and self-contained and client code can use them without worrying about their dependencies.</p>
</div>
<div class="paragraph">
<p>To load package resources Wicket provides class <em>org.apache.wicket.request.resource.PackageResourceReference</em>.</p>
</div>
<div class="paragraph">
<p>To identify a package resource we need to specify a class inside the target package and the name of the desired resource (most of the times this will be a file name).</p>
</div>
<div class="paragraph">
<p>In the following example taken from project ImageAsPackageRes, CustomPanel loads a picture file available as package resource and it displays it in a &lt;img&gt; tag using the built-in component <em>org.apache.wicket.markup.html.image.Image</em>:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;head&gt;</span>...<span class="tok-nt">&lt;/head&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-nt">&lt;wicket:panel&gt;</span>
	Package resource image: <span class="tok-nt">&lt;img</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;packageResPicture&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/wicket:panel&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Jave Code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CustomPanel</span> <span class="tok-kd">extends</span> <span class="tok-n">Panel</span> <span class="tok-o">{</span>

	<span class="tok-kd">public</span> <span class="tok-nf">CustomPanel</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span>
		<span class="tok-n">PackageResourceReference</span> <span class="tok-n">resourceReference</span> <span class="tok-o">=</span>
	            <span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span> <span class="tok-s">&quot;calendar.jpg&quot;</span><span class="tok-o">);</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Image</span><span class="tok-o">(</span><span class="tok-s">&quot;packageResPicture&quot;</span><span class="tok-o">,</span> <span class="tok-n">resourceReference</span><span class="tok-o">));</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wicket will take care of generating a valid URL for file calendar.jpg. URLs for package resources have the following structure:</p>
</div>
<div class="paragraph">
<p><em>&lt;path to application root&gt;/wicket/resource/&lt;fully qualified classname&gt;/&lt;resource file name&gt;-&lt;ver-&lt;id&gt;&gt;(.file extension)</em></p>
</div>
<div class="paragraph">
<p>In our example the URL for our picture file calendar.jpg is the following:</p>
</div>
<div class="paragraph">
<p><em>./wicket/resource/org.wicketTutorial.CustomPanel/calendar-ver-1297887542000.jpg</em></p>
</div>
<div class="paragraph">
<p>The first part of the URL is the relative path to the application root. In our example our page is already at the application&#8217;s root so we have only a single-dotted segment. The next two segments, wicket and resource, are respectively the namespace and the identifier for resources seen in  <a href="#guide:urls_6">paragraph 10.6.4</a>
.</p>
</div>
<div class="paragraph">
<p>The fourth segment is the fully qualified name of the class used to locate the resource and it is the scope of the package resource. In the last segment of the URL we can find the name of the resource (the file name).</p>
</div>
<div class="paragraph">
<p>As you can see Wicket has automatically appended to the file name a version identifier (ver-1297887542000). When Wicket runs in DEVELOPMENT mode this identifier contains the timestamp in millisecond indicating the last time the resource file was modified. This can be useful when we are developing our application and resource files are frequently modified. Appending the timestamp to the original name we are sure that our browser will use always the last version of the file and not an old, out of date, cached version.</p>
</div>
<div class="paragraph">
<p>When instead Wicket is running in DEPLOYMENT mode, the version identifier will contain the MD5 digest of the file instead of the timestamp. The digest is computed only the first time the resource is requested. This perfectly makes sense as static resources don&#8217;t change so often when our application runs into production environment and when this appends the application is redeployed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Package resources can be localized following the same rules seen for resource bundles and markup files:
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="package-resource-localization.png" alt="package resource localization">
</div>
</div>
<div class="paragraph">
<p>In the example illustrated in the picture above, if we try to retrieve package resource calendar.jpg when the current locale is set to French, the actual file returned will be calendar_fr.jpg.</p>
</div>
</div>
<div class="sect2">
<h3 id="_responsive_images_multiple_resource_references_use_in_one_component">Responsive images - multiple resource references use in one component</h3>
<div class="paragraph">
<p>Since Wicket 7.0.0 the build-in component <em>org.apache.wicket.markup.html.image.Image</em> allows you to add several ResourceReferences via varargs and to provide sizes for each image so that the browser is able to pick the best image source.</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html">...
	Package resource image: <span class="tok-nt">&lt;img</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;packageResPicture&quot;</span><span class="tok-nt">/&gt;</span>
...
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java Code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">...</span>
		<span class="tok-n">Image</span> <span class="tok-n">image</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Image</span><span class="tok-o">(</span><span class="tok-s">&quot;packageResPicture&quot;</span><span class="tok-o">,</span>
			<span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span><span class="tok-s">&quot;small.jpg&quot;</span><span class="tok-o">),</span>
			<span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span> <span class="tok-s">&quot;large.jpg&quot;</span><span class="tok-o">),</span>
			<span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span> <span class="tok-s">&quot;medium.jpg&quot;</span><span class="tok-o">),</span>
			<span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span> <span class="tok-s">&quot;small.jpg&quot;</span><span class="tok-o">));</span>
		<span class="tok-n">image</span><span class="tok-o">.</span><span class="tok-na">setXValues</span><span class="tok-o">(</span><span class="tok-s">&quot;1024w&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;640w&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;320w&quot;</span><span class="tok-o">);</span>
		<span class="tok-n">image</span><span class="tok-o">.</span><span class="tok-na">setSizes</span><span class="tok-o">(</span><span class="tok-s">&quot;(min-width: 36em) 33.3vw&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;100vw&quot;</span><span class="tok-o">);</span>

		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">image</span><span class="tok-o">);</span>
<span class="tok-o">...</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The component <em>org.apache.wicket.markup.html.image.Picture</em> is used to provide a fallback image <em>org.apache.wicket.markup.html.image.Image</em> and several source components <em>org.apache.wicket.markup.html.image.Source</em> which gives a developer the control as to when and if those images are presented to the user.</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html">...
	<span class="tok-nt">&lt;picture</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;picture&quot;</span><span class="tok-nt">&gt;</span>
  		<span class="tok-nt">&lt;source</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;big&quot;</span> <span class="tok-nt">/&gt;</span>
  		<span class="tok-nt">&lt;source</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;small&quot;</span> <span class="tok-nt">/&gt;</span>
  		<span class="tok-nt">&lt;img</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;fallback&quot;</span> <span class="tok-nt">/&gt;</span>
	<span class="tok-nt">&lt;/picture&gt;</span>
...
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java Code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">...</span>
		<span class="tok-n">Picture</span> <span class="tok-n">picture</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Picture</span><span class="tok-o">(</span><span class="tok-s">&quot;picture&quot;</span><span class="tok-o">);</span>

		<span class="tok-n">Source</span> <span class="tok-n">big</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Source</span><span class="tok-o">(</span><span class="tok-s">&quot;big&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span> <span class="tok-s">&quot;big.jpg&quot;</span><span class="tok-o">),</span> <span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span> <span class="tok-s">&quot;big-hd.jpg&quot;</span><span class="tok-o">);</span>
		<span class="tok-n">big</span><span class="tok-o">.</span><span class="tok-na">setXValues</span><span class="tok-o">(</span><span class="tok-s">&quot;1x&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;2x&quot;</span><span class="tok-o">);</span>
		<span class="tok-n">big</span><span class="tok-o">.</span><span class="tok-na">setMedia</span><span class="tok-o">(</span><span class="tok-s">&quot;(min-width: 40em)&quot;</span><span class="tok-o">);</span>
		<span class="tok-n">picture</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">big</span><span class="tok-o">);</span>

		<span class="tok-n">Source</span> <span class="tok-n">small</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Source</span><span class="tok-o">(</span><span class="tok-s">&quot;small&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span> <span class="tok-s">&quot;small.jpg&quot;</span><span class="tok-o">),</span> <span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span> <span class="tok-s">&quot;small-hd.jpg&quot;</span><span class="tok-o">);</span>
		<span class="tok-n">small</span><span class="tok-o">.</span><span class="tok-na">setXValues</span><span class="tok-o">(</span><span class="tok-s">&quot;1x&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;2x&quot;</span><span class="tok-o">);</span>
		<span class="tok-n">picture</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">small</span><span class="tok-o">);</span>

		<span class="tok-n">Image</span> <span class="tok-n">image</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Image</span><span class="tok-o">(</span><span class="tok-s">&quot;fallback&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span> <span class="tok-s">&quot;fallback.jpg&quot;</span><span class="tok-o">));</span>
		<span class="tok-n">picture</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">image</span><span class="tok-o">);</span>

		<span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">picture</span><span class="tok-o">);</span>
<span class="tok-o">...</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_inline_image_embedded_resource_reference_content">Inline Image - embedded resource reference content</h3>
<div class="paragraph">
<p>In some components like in the inline image resource references are going to be translated to other representations like base64 content.</p>
</div>
<div class="paragraph">
<p><strong>Java Code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">...</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">InlineImage</span><span class="tok-o">(</span><span class="tok-s">&quot;inline&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span><span class="tok-s">&quot;image2.gif&quot;</span><span class="tok-o">)));</span>
<span class="tok-o">...</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_media_tags_resource_references_with_content_range_support">Media tags - resource references with content range support</h3>
<div class="paragraph">
<p>Since Wicket 7.0.0 the PackageResource and the PackageResourceReference support  [Range] TTP header for the request and  [Content-Range]   [Accept-Range] TTP headers for the response, which are used for videos / audio tags. The  [Range] eader allows the client to only request a specific byte range of the resource. The server provides the  [Content-Range] nd tells the client which bytes are going to be send.</p>
</div>
<div class="paragraph">
<p>If you want the resource not to be load into memory apply readBuffered(false) - this way the stream is written directly to the response. (<em>org.apache.wicket.resource.ITextResourceCompressor</em> will not be applied if readBuffered is set to false)</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html">...
     <span class="tok-nt">&lt;video</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;video&quot;</span> <span class="tok-nt">/&gt;</span>
...
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java Code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">...</span>
    <span class="tok-n">Video</span> <span class="tok-n">video</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Video</span><span class="tok-o">(</span><span class="tok-s">&quot;video&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span><span class="tok-s">&quot;video.mp4&quot;</span><span class="tok-o">).</span><span class="tok-na">readBuffered</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">));</span>
<span class="tok-o">...</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_package_resources_with_tag_wicket_link">Using package resources with tag &lt;wicket:link&gt;</h3>
<div class="paragraph">
<p>In  <a href="#guide:urls_3">paragraph 10.3</a>
 we have used tag &lt;wicket:link&gt; to automatically create links to bookmarkable pages. The same technique can be used also for package resources in order to use them directly from markup file. Let&#8217;s assume for example that we have a picture file called icon.png placed in the same package of the current page. Under these conditions we can display the picture file using the following markup fragment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;wicket:link&gt;</span>
   <span class="tok-nt">&lt;img</span> <span class="tok-na">src=</span><span class="tok-s">&quot;icon.png&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/wicket:link&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above Wicket will populate the attribute src with the URL corresponding to the package resource icon.png. &lt;wicket:link&gt; supports also tag &lt;link&gt; for CSS files and tag &lt;script&gt; for JavaScript files.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adding_resources_to_page_header_section">Adding resources to page header section</h3>
<div class="paragraph">
<p>Wicket comes with interface <em>org.apache.wicket.markup.html.IHeaderContributor</em> which allows components and behaviors (which will be introduced later in  <a href="#guide:advanced_1">paragraph 18.1</a>
) to contribute to the header section of their page. The only method defined in this interface is <em>renderHead(IHeaderResponse response)</em> where <em>IHeaderResponse</em> is an interface which defines method <em>render(HeaderItem item)</em> to write static resources or free-form text into the header section of the page.</p>
</div>
<div class="paragraph">
<p>Header entries are instances of abstract class <em>org.apache.wicket.markup.head.HeaderItem</em>. Wicket provides a set of built-in implementations of this class suited for the most common types of resources. With the exception of <em>PriorityHeaderItem</em>, every implementation of <em>HeaderItem</em> is an abstract factory class:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>CssHeaderItem:</strong> represents a CSS resource. Factory methods provided by this class are <em>forReference</em> which takes in input a resource reference, <em>forUrl</em> which creates an CSS item from a given URL and <em>forCSS</em> which takes in input an arbitrary CSS string and an optional id value to identify the resource.</p>
</li>
<li>
<p><strong>JavaScriptHeaderItem:</strong> represents a JavaScript resource. Just like <em>CssHeaderItem</em> it provides factory methods <em>forReference</em> and <em>forUrl</em> along with method <em>forScript</em> which takes in input an arbitrary string representing the script and an optional id value to identify the resource. Method <em>forReference</em> also supports boolean parameter <em>defer</em> which renders the namesake attribute in the script tag (<em>defer</em> attribute indicates that our script must be execute only after the page has loaded).</p>
</li>
<li>
<p><strong>OnDomReadyHeaderItem:</strong> it adds JavaScript code that will be executed after the DOM has been built, but before external files (such as picture, CSS, etc&#8230;) have been loaded. The class provides a factory method <em>forScript</em> which takes in input an arbitrary string representing the script to execute.</p>
</li>
<li>
<p><strong>OnEventHeaderItem:</strong> the JavaScript code added with this class is executed when a specific JavaScript event is triggered on a given DOM element. The factory method is <em>forScript(String target, String event, CharSequence javaScript)</em>, where target is the id of a DOM element (or the element itself), event is the event that must trigger our code and javaScript is  the code to execute.</p>
</li>
<li>
<p><strong>OnLoadHeaderItem:</strong> the JavaScript code added with this class is executed after the whole page is loaded, external files included. The factory method is <em>forScript(CharSequence javaScript)</em>.</p>
</li>
<li>
<p><strong>PriorityHeaderItem:</strong> it wraps another header item and ensures that it will have the priority over the other items during rendering phase.</p>
</li>
<li>
<p><strong>StringHeaderItem:</strong> with this class we can add an arbitrary text to the header section. Factory method is <em>forString(CharSequence string)</em>.</p>
</li>
<li>
<p><strong>MetaDataHeaderItem:</strong> starting from version 6.17.0, Wicket provides this class to handle meta informations such as &lt;meta&gt; tags or <a href="http://en.wikipedia.org/wiki/Canonical_link_element">canonical link element</a></p>
</li>
<li>
<p><strong>HtmlImportHeaderItem:</strong> introduced in Wicket 6.19.0, provides a HTML5 functionality to include other wicket pages (other html files) into the current generated. Factory methods provided by this class are <em>forImportLinkTag</em> which takes the page class or the url of the page / html to be included.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following example our custom component loads a CSS file as a package resource (placed in the same package) and it adds it to header section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyComponent</span> <span class="tok-kd">extends</span> <span class="tok-n">Component</span><span class="tok-o">{</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">renderHead</span><span class="tok-o">(</span><span class="tok-n">IHeaderResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-n">PackageResourceReference</span> <span class="tok-n">cssFile</span> <span class="tok-o">=</span>
                            <span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">(),</span> <span class="tok-s">&quot;style.css&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">CssHeaderItem</span> <span class="tok-n">cssItem</span> <span class="tok-o">=</span> <span class="tok-n">CssHeaderItem</span><span class="tok-o">.</span><span class="tok-na">forReference</span><span class="tok-o">(</span><span class="tok-n">cssFile</span><span class="tok-o">);</span>

    <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">render</span><span class="tok-o">(</span><span class="tok-n">cssItem</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_context_relative_resources">Context-relative resources</h3>
<div class="paragraph">
<p>In web applications, it&#8217;s quite common to have one or more root context folders containing css/js files. These resources are normally referenced with an absolute path inside link/script tags:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;/misc/js/jscript.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;link</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text/css&quot;</span> <span class="tok-na">rel=</span><span class="tok-s">&quot;stylesheet&quot;</span> <span class="tok-na">href=</span><span class="tok-s">&quot;/misc/css/themes/style.css&quot;</span> <span class="tok-nt">/&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To handle this kind of resources from code we can use resource reference class <em>org.apache.wicket.request.resource.ContextRelativeResourceReference</em>. To build a new instance of this class we must specify the root context path of the resource we want to use:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">ContextRelativeResourceReference</span> <span class="tok-n">resource</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ContextRelativeResourceReference</span><span class="tok-o">(</span><span class="tok-s">&quot;/misc/js/jscript.js&quot;</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default when our application runs in DEPLOYMENT mode <em>ContextRelativeResourceReference</em> will automatically load the minified version of the specified resource using <em>min</em> as postfix. In the example above it will load <em>/misc/js/jscript.min.js</em>. We can force  <em>ContextRelativeResourceReference</em> to always use the not-minified resource passing an additional flag to class constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//it will always use &#39;/misc/js/jscript.js&#39;</span>
<span class="tok-n">ContextRelativeResourceReference</span> <span class="tok-n">resource</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ContextRelativeResourceReference</span><span class="tok-o">(</span><span class="tok-s">&quot;/misc/js/jscript.js&quot;</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The minified postfix can be customized with an optional string parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//it will use &#39;/misc/js/jscript.minified.js&#39; in DEPLOYMENT mode</span>
<span class="tok-n">ContextRelativeResourceReference</span> <span class="tok-n">resource</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ContextRelativeResourceReference</span><span class="tok-o">(</span><span class="tok-s">&quot;/misc/js/jscript.js&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;minified&quot;</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>ContextRelativeResourceReference</em> is usually used with the header item classes we have seen before in this chapter to create entries for the page header section.</p>
</div>
</div>
<div class="sect2">
<h3 id="_picture_files">Picture files</h3>
<div class="paragraph">
<p>For picture files Wicket provides a specific component with class <em>org.apache.wicket.markup.html.image.ContextImage</em> which is meant to be used with tag &lt;img&gt;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//build the component specifying its id and picture&#39;s context path</span>
<span class="tok-n">ContextImage</span> <span class="tok-n">image</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ContextImage</span><span class="tok-o">(</span><span class="tok-s">&quot;myPicture&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;/misc/imgs/mypic.png&quot;</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_resource_dependencies">Resource dependencies</h3>
<div class="paragraph">
<p>Class <em>ResourceReference</em> allows to specify the resources it depends on overriding method <em>getDependencies()</em>. The method returns a list of <em>HeaderItem&#8217;s that must be rendered before the resource referenced by 'ResourceReference</em> can be used. This can be really helpful when our resources are JavaScript or CSS libraries that in turn depend on other libraries.</p>
</div>
<div class="paragraph">
<p>For example we can use this method to ensure that a custom reference to JQueryUI library will find JQuery already loaded in the page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Url</span> <span class="tok-n">jqueyuiUrl</span> <span class="tok-o">=</span> <span class="tok-n">Url</span><span class="tok-o">.</span><span class="tok-na">parse</span><span class="tok-o">(</span><span class="tok-s">&quot;https://ajax.googleapis.com/ajax/libs/jqueryui/&quot;</span> <span class="tok-o">+</span>
                                                                 <span class="tok-s">&quot;1.10.2/jquery-ui.min.js&quot;</span><span class="tok-o">);</span>

<span class="tok-n">UrlResourceReference</span> <span class="tok-n">jqueryuiRef</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">UrlResourceReference</span><span class="tok-o">(</span><span class="tok-n">jqueyuiUrl</span><span class="tok-o">){</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">HeaderItem</span><span class="tok-o">&gt;</span> <span class="tok-nf">getDependencies</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-n">Application</span> <span class="tok-n">application</span> <span class="tok-o">=</span> <span class="tok-n">Application</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">();</span>
		<span class="tok-n">ResourceReference</span> <span class="tok-n">jqueryRef</span> <span class="tok-o">=</span> <span class="tok-n">application</span><span class="tok-o">.</span><span class="tok-na">getJavaScriptLibrarySettings</span><span class="tok-o">().</span>
                                             <span class="tok-n">getJQueryReference</span><span class="tok-o">();</span>

		<span class="tok-k">return</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span><span class="tok-n">JavaScriptHeaderItem</span><span class="tok-o">.</span><span class="tok-na">forReference</span><span class="tok-o">(</span><span class="tok-n">jqueryRef</span><span class="tok-o">));</span>
	<span class="tok-o">}</span>
<span class="tok-o">};</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that in the code above we have built a resource reference using a URL to the desired library instead of a package resource holding the physical file.</p>
</div>
<div class="paragraph">
<p>The same method <em>getDependencies()</em> is defined also for class <em>HeaderItem</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_aggregate_multiple_resources_with_resource_bundles">Aggregate multiple resources with resource bundles</h3>
<div class="paragraph">
<p>One of the best practices to make our web application faster and reduce its latency is to reduce the number of requests to the server to load page resources like JavaScript or CSS files. To achieve this goal some JavaScript-based build tools (like Grunt) allow to merge multiple files used in a page into a single file that can be loaded in a single request. Wicket provides class <em>org.apache.wicket.ResourceBundles</em> to aggregate multiple resource references into a single one. A resource bundle can be declared during application initialization listing all the resources that compose it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span> <span class="tok-o">{</span>
  <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>

  <span class="tok-n">getResourceBundles</span><span class="tok-o">().</span><span class="tok-na">addJavaScriptBundle</span><span class="tok-o">(</span><span class="tok-n">WicketApplication</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span>
                <span class="tok-s">&quot;jqueryUiJs&quot;</span><span class="tok-o">,</span>
                <span class="tok-n">jqueryJsReference</span><span class="tok-o">,</span>
                <span class="tok-n">jqueryUiJsReference</span><span class="tok-o">);</span>

  <span class="tok-n">getResourceBundles</span><span class="tok-o">().</span><span class="tok-na">addCssBundle</span><span class="tok-o">(</span><span class="tok-n">WicketApplication</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span>
                 <span class="tok-s">&quot;jqueryUiCss&quot;</span><span class="tok-o">,</span>
                <span class="tok-n">jqueryCssReference</span><span class="tok-o">,</span>
                <span class="tok-n">jqueryUiCssReference</span><span class="tok-o">);</span>

<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To declare a new resource bundle we need to provide a <em>scope</em> class (<em>WicketApplication.class</em> in our example) and an unique name. Now, when one of the resources included in the bundle is requested, the entire bundle is rendered instead.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
A specific resource reference can not be shared among different resource bundles (i.e. it can be part of only one bundle).
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_put_javascript_inside_page_body">Put JavaScript inside page body</h3>
<div class="paragraph">
<p>Some web developers prefer to put their &lt;script&gt; tags at the end of page body instead of inside the &lt;head&gt; tags:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>

<span class="tok-nt">&lt;head&gt;</span>
//no <span class="tok-nt">&lt;script&gt;</span> <span class="tok-nx">tag</span> <span class="tok-nx">here</span><span class="tok-p">...</span>
<span class="tok-o">&lt;</span><span class="tok-err">/head&gt;</span>

<span class="tok-o">&lt;</span><span class="tok-nx">body</span><span class="tok-o">&gt;</span>
<span class="tok-p">...</span>
<span class="tok-o">&lt;</span><span class="tok-nx">script</span><span class="tok-o">&gt;</span>
<span class="tok-c1">//one or more &lt;script&gt; tags at the end of the body</span>
<span class="tok-nt">&lt;/script&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In Wicket we can achieve this result providing a custom <em>IHeaderResponseDecorator</em> to a our application and using Wicket tag &lt;wicket:container/&gt; to indicate where we want to render our scripts inside the page. Interface <em>IHeaderResponseDecorator</em> defines method <em>IHeaderResponse decorate(IHeaderResponse response)</em> which allows to decorate or add funtionalities to Wicket <em>IHeaderResponse</em>. Our custom <em>IHeaderResponseDecorator</em> can be registered in the application with method <em>setHeaderResponseDecorator</em>. Anytime Wicket creates an instance of <em>IHeaderResponse</em>, it will call the registered <em>IHeaderResponseDecorator</em> to decorate the header response.</p>
</div>
<div class="paragraph">
<p>In the example project <em>ScriptInsideBody</em> we can find a custom <em>IHeaderResponseDecorator</em> that renders CSS into the usual &lt;head&gt; tag and put JavaScricpt header items into a specific container (tag &lt;wicket:container/&gt;)
Wicket already comes with class <em>JavaScriptFilteredIntoFooterHeaderResponse</em> which wraps a <em>IHeaderResponse</em> and renders in a given container all the instances of <em>JavaScriptHeaderItem</em>.
The following code is taken from the Application class of the project:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">    <span class="tok-c1">//...</span>
    <span class="tok-nd">@Override</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
    <span class="tok-o">{</span>
       <span class="tok-n">setHeaderResponseDecorator</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JavaScriptToBucketResponseDecorator</span><span class="tok-o">(</span><span class="tok-s">&quot;footer-container&quot;</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>

     <span class="tok-cm">/**</span>
<span class="tok-cm">     * Decorates an original IHeaderResponse and renders all javascript items</span>
<span class="tok-cm">     * (JavaScriptHeaderItem), to a specific container in the page.</span>
<span class="tok-cm">     */</span>
    <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">JavaScriptToBucketResponseDecorator</span> <span class="tok-kd">implements</span> <span class="tok-n">IHeaderResponseDecorator</span>
    <span class="tok-o">{</span>

        <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">bucketName</span><span class="tok-o">;</span>

        <span class="tok-kd">public</span> <span class="tok-nf">JavaScriptToBucketResponseDecorator</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">bucketName</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">bucketName</span> <span class="tok-o">=</span> <span class="tok-n">bucketName</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>

        <span class="tok-nd">@Override</span>
        <span class="tok-kd">public</span> <span class="tok-n">IHeaderResponse</span> <span class="tok-nf">decorate</span><span class="tok-o">(</span><span class="tok-n">IHeaderResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">JavaScriptFilteredIntoFooterHeaderResponse</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">,</span> <span class="tok-n">bucketName</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>

    <span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see in the code above the  [bucket] hat will contain JavaScript tags is called ' .[footer-container] o make a use of it the developer have to add a special component called <em>HeaderResponseContainer</em> in his page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">HeaderResponseContainer</span><span class="tok-o">(</span><span class="tok-s">&quot;someId&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;filterName&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that <em>HeaderResponseContainer</em>'s needs also a name for the corresponding header response&#8217;s filter. The markup of our page will look like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>

<span class="tok-nt">&lt;header&gt;</span>
//no <span class="tok-nt">&lt;script&gt;</span><span class="tok-err"> tag here...</span>
<span class="tok-nt">&lt;/header&gt;</span>

<span class="tok-nt">&lt;body&gt;</span>
<span class="tok-c">&lt;!-- here we will have our JavaScript tags --&gt;</span>
<span class="tok-nt">&lt;wicket:container</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;someId&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code of the home page is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">   <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">parameters</span><span class="tok-o">);</span>

        <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">HeaderResponseContainer</span><span class="tok-o">(</span><span class="tok-s">&quot;footer-container&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;footer-container&quot;</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Override</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">renderHead</span><span class="tok-o">(</span><span class="tok-n">IHeaderResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">render</span><span class="tok-o">(</span><span class="tok-n">JavaScriptHeaderItem</span><span class="tok-o">.</span><span class="tok-na">forReference</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span>
                <span class="tok-s">&quot;javasciptLibrary.js&quot;</span><span class="tok-o">)));</span>

        <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">render</span><span class="tok-o">(</span><span class="tok-n">OnEventHeaderItem</span><span class="tok-o">.</span><span class="tok-na">forScript</span><span class="tok-o">(</span><span class="tok-s">&quot;&#39;logo&#39;&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;click&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;alert(&#39;Clicked me!&#39;)&quot;</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Looking at the code above you can note that our page adds two script to the header section: the first is an instance of <em>JavaScriptHeaderItem</em> and will be rendered in the <em>HeaderResponseContainer</em> while the second will follow the usual behavior and will be rendered inside &lt;head&gt; tag.</p>
</div>
</div>
<div class="sect2">
<h3 id="_header_contributors_positioning">Header contributors positioning</h3>
<div class="paragraph">
<p>Starting from version 6.15.0 we can specify where header contributors must be rendered inside &lt;head&gt; tag using the placeholder tag <em>&lt;wicket:header-items/&gt;</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;head&gt;</span>
  <span class="tok-nt">&lt;meta</span> <span class="tok-na">chartset=</span><span class="tok-s">&quot;UTF-8&quot;</span><span class="tok-nt">/&gt;</span>
  <span class="tok-nt">&lt;wicket:header-items/&gt;</span>
  <span class="tok-nt">&lt;script </span><span class="tok-na">src=</span><span class="tok-s">&quot;my-monkey-patch-of-wicket-ajax.js&quot;</span><span class="tok-nt">&gt;&lt;/script&gt;</span>
<span class="tok-nt">&lt;/head&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the code above all header contributions done by using IHeaderResponse in your Java code or the special <em>&lt;wicket:head&gt;</em> tag will be put between the &lt;meta&gt; and &lt;script&gt; elements, i.e. in the place of <em>&lt;wicket:header-items/&gt;</em>.</p>
</div>
<div class="paragraph">
<p>This way you can make sure that some header item is always before or after the header items managed by Wicket.</p>
</div>
<div class="paragraph">
<p><em>&lt;wicket:header-items/&gt;</em> can be used only in the page&#8217;s &lt;head&gt; element and there could be at most one instance of it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_custom_resources">Custom resources</h3>
<div class="paragraph">
<p>In Wicket the best way to add dynamic functionalities to our application (such as csv export, a pdf generated on the fly, etc&#8230;) is implementing a custom resource. In this paragraph as example of custom resource we will build a basic RSS feeds generator which can be used to publish feeds on our site (project CustomResourceMounting). Instead of generating a RSS feed by hand we will use Rome framework and its utility classes.</p>
</div>
<div class="paragraph">
<p>As hinted above in  <a href="#guide:resources_1">paragraph 16.1</a>
, class <em>AbstractResource</em> can be used as base class to implement new resources. This class defines abstract method <em>newResourceResponse</em> which is invoked when the resource is requested. The following is the code of our RSS feeds generator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RSSProducerResource</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractResource</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">protected</span> <span class="tok-n">ResourceResponse</span> <span class="tok-nf">newResourceResponse</span><span class="tok-o">(</span><span class="tok-n">Attributes</span> <span class="tok-n">attributes</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-n">ResourceResponse</span> <span class="tok-n">resourceResponse</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ResourceResponse</span><span class="tok-o">();</span>
    <span class="tok-n">resourceResponse</span><span class="tok-o">.</span><span class="tok-na">setContentType</span><span class="tok-o">(</span><span class="tok-s">&quot;text/xml&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">resourceResponse</span><span class="tok-o">.</span><span class="tok-na">setTextEncoding</span><span class="tok-o">(</span><span class="tok-s">&quot;utf-8&quot;</span><span class="tok-o">);</span>

    <span class="tok-n">resourceResponse</span><span class="tok-o">.</span><span class="tok-na">setWriteCallback</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">WriteCallback</span><span class="tok-o">()</span>
    <span class="tok-o">{</span>
      <span class="tok-nd">@Override</span>
      <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">writeData</span><span class="tok-o">(</span><span class="tok-n">Attributes</span> <span class="tok-n">attributes</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">IOException</span>
      <span class="tok-o">{</span>
        <span class="tok-n">OutputStream</span> <span class="tok-n">outputStream</span> <span class="tok-o">=</span> <span class="tok-n">attributes</span><span class="tok-o">.</span><span class="tok-na">getResponse</span><span class="tok-o">().</span><span class="tok-na">getOutputStream</span><span class="tok-o">();</span>
        <span class="tok-n">Writer</span> <span class="tok-n">writer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">OutputStreamWriter</span><span class="tok-o">(</span><span class="tok-n">outputStream</span><span class="tok-o">);</span>
        <span class="tok-n">SyndFeedOutput</span> <span class="tok-n">output</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">SyndFeedOutput</span><span class="tok-o">();</span>
            <span class="tok-k">try</span> <span class="tok-o">{</span>
          <span class="tok-n">output</span><span class="tok-o">.</span><span class="tok-na">output</span><span class="tok-o">(</span><span class="tok-n">getFeed</span><span class="tok-o">(),</span> <span class="tok-n">writer</span><span class="tok-o">);</span>
        <span class="tok-o">}</span> <span class="tok-k">catch</span> <span class="tok-o">(</span><span class="tok-n">FeedException</span> <span class="tok-n">e</span><span class="tok-o">)</span> <span class="tok-o">{</span>
          <span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">WicketRuntimeException</span><span class="tok-o">(</span><span class="tok-s">&quot;Problems writing feed to response...&quot;</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
      <span class="tok-o">}</span>
    <span class="tok-o">});</span>

    <span class="tok-k">return</span> <span class="tok-n">resourceResponse</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
  <span class="tok-c1">// method getFeed()...</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Method <em>newResourceResponse</em> returns an instance of <em>ResourceResponse</em> representing the response generated by the custom resource. Since RSS feeds are based on XML, in the code above we have set the type of the response to text/xml and the text encoding to utf-8.</p>
</div>
<div class="paragraph">
<p>To specify the content that will be returned by our resource we must also provide an implementation of inner class <em>WriteCallback</em> which is responsible for writing content data to response&#8217;s output stream. In our project we used class SyndFeedOutput from Rome framework to write our feed to response. Method <em>getFeed()</em> is just an utility method that generates a sample RSS feed (which is an instance of interface <em>com.sun.syndication.feed.synd.SyndFeed</em>).</p>
</div>
<div class="paragraph">
<p>Now that we have our custom resource in place, we can use it in the home page of the project. The easiest way to make a resource available to users is to expose it with link component <em>ResourceLink</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ResourceLink</span><span class="tok-o">(</span><span class="tok-s">&quot;rssLink&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">RSSProducerResource</span><span class="tok-o">()));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the next paragraphs we will see how to register a resource at application-level and how to mount it to an arbitrary URL.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mounting_resources">Mounting resources</h3>
<div class="paragraph">
<p>Just like pages also resources can be mounted to a specific path. Class <em>WebApplication</em> provides method <em>mountResource</em> which is almost identical to <em>mountPage</em> seen in  <a href="#guide:urls_6">paragraph 10.6.1</a>
:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span> <span class="tok-o">{</span>
  <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
  <span class="tok-c1">//resource mounted to path /foo/bar</span>
  <span class="tok-n">ResourceReference</span> <span class="tok-n">resourceReference</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ResourceReference</span><span class="tok-o">(</span><span class="tok-s">&quot;rssProducer&quot;</span><span class="tok-o">){</span>
     <span class="tok-n">RSSReaderResource</span> <span class="tok-n">rssResource</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">RSSReaderResource</span><span class="tok-o">();</span>
     <span class="tok-nd">@Override</span>
     <span class="tok-kd">public</span> <span class="tok-n">IResource</span> <span class="tok-nf">getResource</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	<span class="tok-k">return</span> <span class="tok-n">rssResource</span><span class="tok-o">;</span>
  <span class="tok-o">}};</span>
  <span class="tok-n">mountResource</span><span class="tok-o">(</span><span class="tok-s">&quot;/foo/bar&quot;</span><span class="tok-o">,</span> <span class="tok-n">resourceReference</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the configuration above (taken from project <em>CustomResourceMounting</em>) every request to /foo/bar will be served by the custom resource built in the previous paragraph.</p>
</div>
<div class="paragraph">
<p>Parameter placeholders are supported as well:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span> <span class="tok-o">{</span>
  <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
  <span class="tok-c1">//resource mounted to path /foo with a required indexed parameter</span>
  <span class="tok-n">ResourceReference</span> <span class="tok-n">resourceReference</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ResourceReference</span><span class="tok-o">(</span><span class="tok-s">&quot;rssProducer&quot;</span><span class="tok-o">){</span>
     <span class="tok-n">RSSReaderResource</span> <span class="tok-n">rssResource</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">RSSReaderResource</span><span class="tok-o">();</span>
     <span class="tok-nd">@Override</span>
     <span class="tok-kd">public</span> <span class="tok-n">IResource</span> <span class="tok-nf">getResource</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	<span class="tok-k">return</span> <span class="tok-n">rssResource</span><span class="tok-o">;</span>
  <span class="tok-o">}};</span>
  <span class="tok-n">mountResource</span><span class="tok-o">(</span><span class="tok-s">&quot;/bar/${baz}&quot;</span><span class="tok-o">,</span> <span class="tok-n">resourceReference</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_shared_resources">Shared resources</h3>
<div class="paragraph">
<p>Resources can be added to a global registry in order to share them at application-level. Shared resources are identified by an application-scoped key and they can be easily retrieved at a later time using reference class <em>SharedResourceReference</em>. The global registry can be accessed with <em>Application</em>'s method <em>getSharedResources</em>. In the following excerpt of code (taken again from project <em>CustomResourceMounting</em>) we register an instance of our custom RSS feeds producer as application-shared resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">  <span class="tok-c1">//init application&#39;s method</span>
  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">(){</span>
    <span class="tok-n">RSSProducerResource</span> <span class="tok-n">rssResource</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">RSSProducerResource</span><span class="tok-o">();</span>
    <span class="tok-c1">// ...</span>
    <span class="tok-n">getSharedResources</span><span class="tok-o">().</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;globalRSSProducer&quot;</span><span class="tok-o">,</span> <span class="tok-n">rssResource</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now to use an application-shared resource we can simply retrieve it using class <em>SharedResourceReference</em> and providing the key previously used to register the resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ResourceLink</span><span class="tok-o">(</span><span class="tok-s">&quot;globalRssLink&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">SharedResourceReference</span><span class="tok-o">(</span><span class="tok-s">&quot;globalRSSProducer&quot;</span><span class="tok-o">)));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The URL generated for application shared resources follows the same pattern seen for package resources:</p>
</div>
<div class="paragraph">
<p><em>./wicket/resource/org.apache.wicket.Application/globalRSSProducer</em></p>
</div>
<div class="paragraph">
<p>The last segment of the URL is the key of the resource while the previous segment contains the scope of the resource. For application-scoped resources the scope is always the fully qualified name of class <em>Application</em>. This should not be surprising since global resources are visible at application level (i.e. the scope is the application).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Package resources are also application-shared resources but they don&#8217;t need to be explicitly registered.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Remember that we can get the URL of a resource reference using method <em>urlFor(ResourceReference resourceRef, PageParameters params )</em> available with both class <em>RequestCycle</em> and class <em>Component</em>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_customizing_resource_loading">Customizing resource loading</h3>
<div class="paragraph">
<p>Wicket loads application&#8217;s resources delegating this task to a resource locator represented by interface <em>org.apache.wicket.core.util.resource.locator.IResourceStreamLocator</em>. To retrieve or modify the current resource locator we can use the getter and setter methods defined by setting class <em>ResourceSettings</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">  <span class="tok-c1">//init application&#39;s method</span>
  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">(){</span>
    <span class="tok-c1">//get the resource locator</span>
    <span class="tok-n">getResourceSettings</span><span class="tok-o">().</span><span class="tok-na">getResourceStreamLocator</span><span class="tok-o">();</span>
    <span class="tok-c1">//set the resource locator</span>
    <span class="tok-n">getResourceSettings</span><span class="tok-o">().</span><span class="tok-na">setResourceStreamLocator</span><span class="tok-o">(</span><span class="tok-n">myLocator</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default locator used by Wicket is class <em>ResourceStreamLocator</em> which in turn tries to load a requested resource using a set of implementations of interface <em>IResourceFinder</em>. This interface defines method <em>find(Class class, String pathname)</em> which tries to resolve a resource corresponding to the given class and path.</p>
</div>
<div class="paragraph">
<p>The default implementation of <em>IResourceFinder</em> used by Wicket is <em>ClassPathResourceFinder</em> which searches for resources into the application class path. This is the implementation we have used so far in our examples. However some developers may prefer storing markup files and other resources in a separate folder rather than placing them side by side with Java classes.</p>
</div>
<div class="paragraph">
<p>To customize resource loading we can add further resource finders to our application in order to extend the resource-lookup algorithm to different locations. Wicket already comes with two other implementations of IResourceFinder designed to search for resources into a specific folder on the file system. The first is class <em>Path</em> and it&#8217;s defined in package <em>org.apache.wicket.util.file</em>. The constructor of this class takes in input an arbitrary folder that can be expressed as a string path or as an instance of Wicket utility class <em>Folder</em> (in package <em>org.apache.wicket.util.file</em>). The second implementation of interface <em>IResourceFinder</em> is class <em>WebApplicationPath</em> which looks into a folder placed inside webapp&#8217;s root path (but not inside folder WEB-INF).</p>
</div>
<div class="paragraph">
<p>Project CustomFolder4MarkupExample uses <em>WebApplicationPath</em> to load the markup file and the resource bundle for its home page from a custom folder. The folder is called markupFolder and it is placed in the root path of the webapp. The following picture illustrates the file structure of the project:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="package-structure-custom-folder.png" alt="package structure custom folder">
</div>
</div>
<div class="paragraph">
<p>As we can see in the picture above, we must preserve the package structure also in the custom folder used as resource container. The code used inside application class to configure  WebApplicationPath is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
	<span class="tok-n">getResourceSettings</span><span class="tok-o">().</span><span class="tok-na">getResourceFinders</span><span class="tok-o">().</span><span class="tok-na">add</span><span class="tok-o">(</span>
			<span class="tok-k">new</span> <span class="tok-n">WebApplicationPath</span><span class="tok-o">(</span><span class="tok-n">getServletContext</span><span class="tok-o">(),</span> <span class="tok-s">&quot;markupFolder&quot;</span><span class="tok-o">));</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Method getResourceFinders() defined by setting class ResourceSettings returns the list of  resource finders defined in our application. The constructor of WebApplicationPath takes in input also an instance of standard interface javax.servlet.ServletContext which can be retrieved with WebApplication&#8217;s method getServletContext().</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
By default, if resource files can not be found inside application classpath, Wicket will search for them inside “resources” folder. You may have noted this folder in the previous picture. It is placed next to the folder “java” containing our source files:
</td>
</tr>
</table>
</div>
<div class="imageblock">
<div class="content">
<img src="package-structure-resource-folder.png" alt="package structure resource folder">
</div>
</div>
<div class="paragraph">
<p>This folder can be used to store resource files without writing any configuration code.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cssheaderitem_and_javascriptheaderitem_compression">CssHeaderItem and JavaScriptHeaderItem compression</h3>
<div class="paragraph">
<p>Introduced in Wicket 6.20.0 / Wicket 7.0.0 there is a default way to be used in which the output of all CssHeaderItems / JavaScriptHeaderItems is modified before they are cached and delivered to the client. You can add a so called Compressor by receiving the resource settings and invoke 1.setJavaScriptCompressor(&#8230;) / 1.setJavaScriptCompressor(&#8230;). If you want to add several Compressors use <em>org.apache.wicket.resource.CompositeCssCompressor</em> or <em>org.apache.wicket.resource.CompositeJavaScriptCompressor</em></p>
</div>
<div class="paragraph">
<p><strong>Java Code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">...</span>
    <span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">WicketApplication</span> <span class="tok-kd">extends</span> <span class="tok-n">WebApplication</span>
    <span class="tok-o">{</span>
        <span class="tok-nd">@Override</span>
        <span class="tok-kd">public</span> <span class="tok-n">Class</span><span class="tok-o">&lt;?</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span><span class="tok-o">&gt;</span> <span class="tok-nf">getHomePage</span><span class="tok-o">()</span>
        <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
    
        <span class="tok-nd">@Override</span>
        <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
        <span class="tok-o">{</span>
            <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
            <span class="tok-n">getResourceSettings</span><span class="tok-o">().</span><span class="tok-na">setCssCompressor</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">CssUrlReplacer</span><span class="tok-o">());</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">...</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the previous example you see that a <em>org.apache.wicket.resource.CssUrlReplacer</em> is added which does not compress the content, but replaces all urls in CSS files and applies a Wicket representation for them by automatically wrapping them into PackageResourceReferences. Here is an example where you can see what Wicket does with the url representation.</p>
</div>
<div class="paragraph">
<p>HomePage (in package my/company/):
<strong>Java Code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">...</span>
<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">render</span><span class="tok-o">(</span><span class="tok-n">CssReferenceHeaderItem</span><span class="tok-o">.</span><span class="tok-na">forReference</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-s">&quot;res/css/mycss.css&quot;</span><span class="tok-o">)));</span>
<span class="tok-o">...</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>mycss.css (in package my/company/res/css/):
<strong>CSS:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">...</span>
<span class="tok-n">body</span><span class="tok-o">{</span>
    <span class="tok-n">background</span><span class="tok-o">-</span><span class="tok-n">image</span><span class="tok-o">:</span><span class="tok-n">url</span><span class="tok-o">(</span><span class="tok-err">&#39;</span><span class="tok-o">../</span><span class="tok-n">images</span><span class="tok-o">/</span><span class="tok-n">some</span><span class="tok-o">.</span><span class="tok-na">png</span><span class="tok-err">&#39;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-o">...</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>some.png (in package my/company/res/images/):
&lt;blob&gt;</p>
</div>
<div class="paragraph">
<p>Output of mycss.css:
<strong>CSS:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">...</span>
<span class="tok-n">body</span><span class="tok-o">{</span>
    <span class="tok-n">background</span><span class="tok-o">-</span><span class="tok-n">image</span><span class="tok-o">:</span><span class="tok-n">url</span><span class="tok-o">(</span><span class="tok-err">&#39;</span><span class="tok-o">../</span><span class="tok-n">images</span><span class="tok-o">/</span><span class="tok-n">some</span><span class="tok-o">-</span><span class="tok-n">ver</span><span class="tok-o">-</span><span class="tok-mi">1425904170000</span><span class="tok-o">.</span><span class="tok-na">png</span><span class="tok-err">&#39;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-o">...</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you add a url which looks like this background-image:url(<em>../images/some.png?embedBase64</em>); Wicket is going to embed the complete image as base64 string with its corresponding mime type into the css file. It looks like the following code block demonstrates.</p>
</div>
<div class="paragraph">
<p>Output of mycss.css:
<strong>CSS:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">...</span>
<span class="tok-n">body</span><span class="tok-o">{</span>
    <span class="tok-n">background</span><span class="tok-o">-</span><span class="tok-n">image</span><span class="tok-o">:</span> <span class="tok-n">url</span><span class="tok-o">(</span><span class="tok-n">data</span><span class="tok-o">:</span><span class="tok-n">image</span><span class="tok-o">/</span><span class="tok-n">png</span><span class="tok-o">;</span><span class="tok-n">base64</span><span class="tok-o">,</span><span class="tok-n">R0lGODlh1wATAX</span><span class="tok-o">....);</span>
<span class="tok-o">}</span>
<span class="tok-o">...</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_13">Summary</h3>
<div class="paragraph">
<p>In this chapter we have learnt how to manage resources with the built-in mechanism provided by Wicket. With this mechanism we handle resources from Java code and Wicket will automatically take care of generating a valid URL for them. We have also seen how resources can be bundled as package resources with a component that depends on them to make it self-contained.</p>
</div>
<div class="paragraph">
<p>Then, in the second part of the chapter, we have built a custom resource and we have learnt how to mount it to an arbitrary URL and how to make it globally available as shared resource.</p>
</div>
<div class="paragraph">
<p>Finally, in the last part of the paragraph we took a peek at the mechanism provided by the framework to customize the locations where the resource-lookup algorithm searches for resources.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_an_example_of_integration_with_javascript">An example of integration with JavaScript</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It&#8217;s time to put into practice what we have learnt so far in this guide. To do this we will build a custom date component consisting of a text field to edit a date value and a fancy calendar icon to open a JavaScript datepicker. This chapter will also illustrate an example of integration of Wicket with a JavaScript library like  <a href="http://jquery.com/">JQuery</a> nd its child project  uery[JQuery] p://jqueryui.com/ .</p>
</div>
<div class="sect2">
<h3 id="_what_we_want_to_do">What we want to do&#8230;</h3>
<div class="paragraph">
<p>For end-users a datepicker is one of the most appreciated widget. It allows to simply edit a date value with the help of a user-friendly pop-up calendar. That&#8217;s why nearly all UI frameworks provide a version of this widget.</p>
</div>
<div class="paragraph">
<p>Popular JavaScript libraries like YUI and JQuery come with a ready-to-use datepicker to enrich the user experience of our web applications. Wicket already provides a component which integrates a text field with a calendar widget from YUI library, but there is no built-in component that uses a datepicker based on JQuery library.</p>
</div>
<div class="paragraph">
<p>As both JQuery and its child project JQueryUI have gained a huge popularity in the last years, it&#8217;s quite interesting to see how to integrate them in Wicket building a custom component. In this chapter we will create a custom datepicker based on the corresponding widget from JQueryUI project:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="datepicker-screenshot.png" alt="datepicker screenshot">
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
On Internet you can find different libraries that already offer a strong integration between Wicket and JQuery. The goal of this chapter is to see how to integrate Wicket with a JavaScript framework building a simple homemade datepicker which is not intended to provide every feature of the original JavaScript widget.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_what_features_we_want_to_implement">What features we want to implement</h3>
<div class="paragraph">
<p>Before starting to write code, we must clearly define what features we want to implement for our component. The new component should:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Be self-contained</strong>: we must be able to distribute it and use it in other projects without requiring any kind of additional configuration.</p>
</li>
<li>
<p><strong>Have a customizable date format</strong>: developer must be able to decide the date format used to display date value and to parse user input.</p>
</li>
<li>
<p><strong>Be localizable</strong>: the pop-up calendar must be localizable in order to support different languages.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>That&#8217;s what we&#8217;d like to have with our custom datepicker. In the rest of the chapter we will see how to implement the features listed above and which resources must be packaged with our component.</p>
</div>
</div>
<div class="sect2">
<h3 id="__and_how_we_will_do_it">&#8230;and how we will do it</h3>
<div class="paragraph">
<p>Our new component will extend the a built-in text field <em>org.apache.wicket.extensions.markup.html.form.DateTextField</em> which already uses a java.util.Date as model object and already performs conversion and validation for input values. Since the component must be self-contained, we must ensure that the JavaScript libraries it relies on (JQuery and JQuery UI) will be always available.</p>
</div>
<div class="paragraph">
<p>Starting from version 6.0 Wicket has adopted JQuery as backing JavaScript library so we can use the  version bundled with Wicket for our custom datepicker.</p>
</div>
<div class="paragraph">
<p>To make JQuery UI available we should instead go to its official site, download the required artifacts and use them as package resources of our component.</p>
</div>
</div>
<div class="sect2">
<h3 id="_component_package_resources">Component package resources</h3>
<div class="paragraph">
<p>JQuery UI needs the following static resources in order to work properly:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>jquery-ui.min.js</strong>: the minified version of the library.</p>
</li>
<li>
<p><strong>jquery-ui.css</strong>: the CSS containing the style used by JQuery UI widgets.</p>
</li>
<li>
<p><strong>jquery-ui-i18n.min.js</strong>: the minified JavaScript containing the built-in support for localization.</p>
</li>
<li>
<p><strong>Folder <em>images</em></strong>: the folder containing picture files used by JQuery UI widgets.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the following picture we can see these package resources with our component class (named JQueryDateField):</p>
</div>
<div class="imageblock">
<div class="content">
<img src="datepicker-package-resources.png" alt="datepicker package resources">
</div>
</div>
<div class="paragraph">
<p>Along with the four static resources listed above, we can find also file calendar.jpg, which is the calendar icon used to open the pop up calendar, and file JQDatePicker.js which contains the following custom JavaScript code that binds our component to a JQuery UI datepicker:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">function</span> <span class="tok-nf">initJQDatepicker</span><span class="tok-o">(</span><span class="tok-n">inputId</span><span class="tok-o">,</span> <span class="tok-n">countryIsoCode</span><span class="tok-o">,</span> <span class="tok-n">dateFormat</span><span class="tok-o">,</span>  <span class="tok-n">calendarIcon</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-n">var</span> <span class="tok-n">localizedArray</span> <span class="tok-o">=</span> <span class="tok-n">$</span><span class="tok-o">.</span><span class="tok-na">datepicker</span><span class="tok-o">.</span><span class="tok-na">regional</span><span class="tok-o">[</span><span class="tok-n">countryIsoCode</span><span class="tok-o">];</span>
	<span class="tok-n">localizedArray</span><span class="tok-o">[</span><span class="tok-err">&#39;</span><span class="tok-n">buttonImage</span><span class="tok-err">&#39;</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">calendarIcon</span><span class="tok-o">;</span>
	<span class="tok-n">localizedArray</span><span class="tok-o">[</span><span class="tok-err">&#39;</span><span class="tok-n">dateFormat</span><span class="tok-err">&#39;</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-n">dateFormat</span><span class="tok-o">;</span>
	<span class="tok-n">initCalendar</span><span class="tok-o">(</span><span class="tok-n">localizedArray</span><span class="tok-o">);</span>
	<span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-s">&quot;#&quot;</span> <span class="tok-o">+</span> <span class="tok-n">inputId</span><span class="tok-o">).</span><span class="tok-na">datepicker</span><span class="tok-o">(</span><span class="tok-n">localizedArray</span><span class="tok-o">);</span>
<span class="tok-o">};</span>

<span class="tok-n">function</span> <span class="tok-nf">initCalendar</span><span class="tok-o">(</span><span class="tok-n">localizedArray</span><span class="tok-o">){</span>
	 <span class="tok-n">localizedArray</span><span class="tok-o">[</span><span class="tok-err">&#39;</span><span class="tok-n">changeMonth</span><span class="tok-err">&#39;</span><span class="tok-o">]=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
	 <span class="tok-n">localizedArray</span><span class="tok-o">[</span><span class="tok-err">&#39;</span><span class="tok-n">changeYear</span><span class="tok-err">&#39;</span><span class="tok-o">]=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
	 <span class="tok-n">localizedArray</span><span class="tok-o">[</span><span class="tok-err">&#39;</span><span class="tok-n">showOn</span><span class="tok-err">&#39;</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-err">&#39;</span><span class="tok-n">button</span><span class="tok-err">&#39;</span><span class="tok-o">;</span>
	 <span class="tok-n">localizedArray</span><span class="tok-o">[</span><span class="tok-err">&#39;</span><span class="tok-n">buttonImageOnly</span><span class="tok-err">&#39;</span><span class="tok-o">]</span> <span class="tok-o">=</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
<span class="tok-o">};</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Function initJQDatepicker takes in input the following parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>inputId</strong>: the id of the HTML text field corresponding to our custom component instance.</p>
</li>
<li>
<p><strong>countryIsoCode</strong>: a two-letter low-case ISO language code. It can contain also the two-letter upper-case ISO country code separated with a minus sign (for example en-GB)</p>
</li>
<li>
<p><strong>dateFormat</strong>: the date format to use for parsing and displaying date values.</p>
</li>
<li>
<p><strong>calendarIcon</strong>: the relative URL of the icon used as calendar icon.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As we will see in the next paragraphs, its up to our component to generate this parameters and invoke the initJQDatepicker function.</p>
</div>
<div class="paragraph">
<p>Function initCalendar is a simple utility function that sets the initialization array for datepicker widget. For more details on JQuery UI datepicker usage see the documentation at <a href="http://jqueryui.com/">http://jqueryui.com/</a> datepicker.</p>
</div>
</div>
<div class="sect2">
<h3 id="_initialization_code">Initialization code</h3>
<div class="paragraph">
<p>The initialization code for our component is contained inside its method onInitialize and is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onInitialize</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onInitialize</span><span class="tok-o">();</span>
	<span class="tok-n">setOutputMarkupId</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>

	<span class="tok-n">datePattern</span> <span class="tok-o">=</span>  <span class="tok-k">new</span> <span class="tok-n">ResourceModel</span><span class="tok-o">(</span><span class="tok-s">&quot;jqueryDateField.shortDatePattern&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;mm/dd/yy&quot;</span><span class="tok-o">)</span>
                                          <span class="tok-o">.</span><span class="tok-na">getObject</span><span class="tok-o">();</span>
	<span class="tok-n">countryIsoCode</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ResourceModel</span><span class="tok-o">(</span><span class="tok-s">&quot;jqueryDateField.countryIsoCode&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;en-GB&quot;</span><span class="tok-o">)</span>
                                          <span class="tok-o">.</span><span class="tok-na">getObject</span><span class="tok-o">();</span>

	<span class="tok-n">PackageResourceReference</span> <span class="tok-n">resourceReference</span> <span class="tok-o">=</span>
                            <span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span> <span class="tok-s">&quot;calendar.jpg&quot;</span><span class="tok-o">);</span>

	<span class="tok-n">urlForIcon</span> <span class="tok-o">=</span> <span class="tok-n">urlFor</span><span class="tok-o">(</span><span class="tok-n">resourceReference</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">PageParameters</span><span class="tok-o">());</span>
	<span class="tok-n">dateConverter</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PatternDateConverter</span><span class="tok-o">(</span><span class="tok-n">datePattern</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="tok-o">}</span>

<span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-o">&lt;</span><span class="tok-n">Date</span><span class="tok-o">&gt;</span> <span class="tok-n">IConverter</span><span class="tok-o">&lt;</span><span class="tok-n">Date</span><span class="tok-o">&gt;</span> <span class="tok-nf">getConverter</span><span class="tok-o">(</span><span class="tok-n">Class</span><span class="tok-o">&lt;</span><span class="tok-n">Date</span><span class="tok-o">&gt;</span> <span class="tok-n">type</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-k">return</span> <span class="tok-o">(</span><span class="tok-n">IConverter</span><span class="tok-o">&lt;</span><span class="tok-n">Date</span><span class="tok-o">&gt;)</span> <span class="tok-n">dateConverter</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first thing to do inside onInitialize is to ensure that our component will have a markup id for its related text field. This is done invoking setOutputMarkupId(true).</p>
</div>
<div class="paragraph">
<p>Next, JQueryDateField tries to retrieve the date format and the ISO language code that must be used as initialization parameters. This is done using class <em>ResourceModel</em> which searches for a given resource in the available bundles. If no value is found for date format or for ISO language code, default values will be used (<em>mm/dd/yy</em> and <em>en-GB</em>).</p>
</div>
<div class="paragraph">
<p>To generate the relative URL for calendar icon, we load it as package resource reference and then we use <em>Component</em>'s method urlFor to get the URL value (we have seen this method in  <a href="#guide:requestProcessing_3">paragraph 9.3.2</a>
).</p>
</div>
<div class="paragraph">
<p>The last configuration instruction executed inside onInitialize is the instantiation of the custom converter used by our component. This converter is an instance of the built-in class <em>org.apache.wicket.datetime.PatternDateConvert</em> and must use the previously retrieved date format to perform conversion operations. Now to tell our component to use this converter we must return it overriding <em>FormComponent</em>'s method <em>getConverter</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_header_contributor_code">Header contributor code</h3>
<div class="paragraph">
<p>The rest of the code of our custom component is inside method <em>renderHeader</em>, which is responsible for adding to page header the bundled JQuery library, the three files from JQuery UI distribution, the custom file JQDatePicker.js and the invocation of function <em>initJQDatepicker</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">renderHead</span><span class="tok-o">(</span><span class="tok-n">IHeaderResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">renderHead</span><span class="tok-o">(</span><span class="tok-n">response</span><span class="tok-o">);</span>

	<span class="tok-c1">//if component is disabled we don&#39;t have to load the JQueryUI datepicker</span>
	<span class="tok-k">if</span><span class="tok-o">(!</span><span class="tok-n">isEnabledInHierarchy</span><span class="tok-o">())</span>
		<span class="tok-k">return</span><span class="tok-o">;</span>
	<span class="tok-c1">//add bundled JQuery</span>
	<span class="tok-n">JavaScriptLibrarySettings</span> <span class="tok-n">javaScriptSettings</span> <span class="tok-o">=</span>
                      <span class="tok-n">getApplication</span><span class="tok-o">().</span><span class="tok-na">getJavaScriptLibrarySettings</span><span class="tok-o">();</span>
	<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">render</span><span class="tok-o">(</span><span class="tok-n">JavaScriptHeaderItem</span><span class="tok-o">.</span>
			<span class="tok-nf">forReference</span><span class="tok-o">(</span><span class="tok-n">javaScriptSettings</span><span class="tok-o">.</span><span class="tok-na">getJQueryReference</span><span class="tok-o">()));</span>
	<span class="tok-c1">//add package resources</span>
	<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">render</span><span class="tok-o">(</span><span class="tok-n">JavaScriptHeaderItem</span><span class="tok-o">.</span>
	      <span class="tok-nf">forReference</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span> <span class="tok-s">&quot;jquery-ui.min.js&quot;</span><span class="tok-o">)));</span>
	<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">render</span><span class="tok-o">(</span><span class="tok-n">JavaScriptHeaderItem</span><span class="tok-o">.</span>
	      <span class="tok-nf">forReference</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span> <span class="tok-s">&quot;jquery-ui-i18n.min.js&quot;</span><span class="tok-o">)));</span>
	<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">render</span><span class="tok-o">(</span><span class="tok-n">CssHeaderItem</span><span class="tok-o">.</span>
	      <span class="tok-nf">forReference</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">getClass</span><span class="tok-o">(),</span> <span class="tok-s">&quot;jquery-ui.css&quot;</span><span class="tok-o">)));</span>
	<span class="tok-c1">//add custom file JQDatePicker.js. Reference JQDatePickerRef is a static field</span>
	<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">render</span><span class="tok-o">(</span><span class="tok-n">JavaScriptHeaderItem</span><span class="tok-o">.</span><span class="tok-na">forReference</span><span class="tok-o">(</span><span class="tok-n">JQDatePickerRef</span><span class="tok-o">));</span>

	<span class="tok-c1">//add the init script for datepicker</span>
	<span class="tok-n">String</span> <span class="tok-n">jqueryDateFormat</span> <span class="tok-o">=</span> <span class="tok-n">datePattern</span><span class="tok-o">.</span><span class="tok-na">replace</span><span class="tok-o">(</span><span class="tok-s">&quot;yyyy&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;yy&quot;</span><span class="tok-o">).</span><span class="tok-na">toLowerCase</span><span class="tok-o">();</span>
	<span class="tok-n">String</span> <span class="tok-n">initScript</span> <span class="tok-o">=</span> <span class="tok-s">&quot;;initJQDatepicker(&#39;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">getMarkupId</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot;&#39;, &#39;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">countryIsoCode</span> <span class="tok-o">+</span>
                            <span class="tok-s">&quot;&#39;, &#39;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">jqueryDateFormat</span> <span class="tok-o">+</span> <span class="tok-s">&quot;&#39;, &quot;</span> <span class="tok-o">+</span> <span class="tok-s">&quot;&#39;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">urlForIcon</span> <span class="tok-o">+</span><span class="tok-s">&quot;&#39;);&quot;</span><span class="tok-o">;</span>
	<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">render</span><span class="tok-o">(</span><span class="tok-n">OnLoadHeaderItem</span><span class="tok-o">.</span><span class="tok-na">forScript</span><span class="tok-o">(</span><span class="tok-n">initScript</span><span class="tok-o">));</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If component is disabled the calendar icon must be hidden and no datepicker must be displayed. That&#8217;s why <em>renderHeader</em> is skipped if component is not enabled.</p>
</div>
<div class="paragraph">
<p>To get a reference to the bundled JQuery library we used the JavaScript setting class <em>JavaScriptLibrarySettings</em> and its method <em>getJQueryReference</em>.</p>
</div>
<div class="paragraph">
<p>In the last part of <em>renderHeader</em> we build the string to invoke function <em>initJQDatepicker</em> using the values obtained inside onInitialize. Unfortunately the date format used by JQuery UI is different from the one adopted in Java so we have to convert it before building the JavaScript code. This init script is rendered into header section using a <em>OnLoadHeaderItem</em> to ensure that it will be executed after all the other scripts have been loaded.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
If we add more than one instance of our custom component to a single page, static resources are rendered to the header section just once. Wicket automatically checks if a static resource is already referenced by a page and if so, it will not render it again.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This does not apply to the init script which is dynamically generated and is rendered for every instance of the component.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
Our datepicker is not ready yet to be used with AJAX. In  <a href="#guide:ajax">chapter 19</a>
 we will see how to modify it to make it AJAX-compatible.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_summary_14">Summary</h3>
<div class="paragraph">
<p>In this brief chapter we have seen how custom components can be integrated with <a href="http://en.wikipedia.org/wiki/Dynamic_HTML">DHTML</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wicket_advanced_topics">Wicket advanced topics</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this chapter we will learn some advanced topics which have not been covered yet in the previous chapters but which are nonetheless essential to make the most of Wicket and to build sophisticated web applications.</p>
</div>
<div class="sect2">
<h3 id="_enriching_components_with_behaviors">Enriching components with behaviors</h3>
<div class="paragraph">
<p>With class <em>org.apache.wicket.behavior.Behavior</em> Wicket provides a very flexible mechanism to share common features across different components and to enrich existing components with further functionalities. As the class name suggests, <em>Behavior</em> adds a generic behavior to a component modifying its markup and/or contributing to the header section of the page (<em>Behavior</em> implements the interface <em>IHeaderContributor</em>).</p>
</div>
<div class="paragraph">
<p>One or more behaviors can be added to a component with <em>Component</em>'s method <em>add(Behavior&#8230;)</em>, while to remove a behavior we must use method <em>remove(Behavior)</em>.</p>
</div>
<div class="paragraph">
<p>Here is a partial list of methods defined inside class <em>Behavior</em> along with a brief description of what they do:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>beforeRender(Component component)</strong>: called when a component is about to be rendered.</p>
</li>
<li>
<p><strong>afterRender(Component component)</strong>: called after a component has been rendered.</p>
</li>
<li>
<p><strong>onComponentTag(Component component, ComponentTag tag)</strong>: called when component tag is being rendered.</p>
</li>
<li>
<p><strong>getStatelessHint(Component component)</strong>: returns if a behavior is stateless or not.</p>
</li>
<li>
<p><strong>bind(Component component)</strong>: called after a behavior has been added to a component.</p>
</li>
<li>
<p><strong>unbind(Component component)</strong>: called when a behavior has been removed from a component.</p>
</li>
<li>
<p><strong>detach(Component component)</strong>: overriding this method a behavior can detach its state before being serialized.</p>
</li>
<li>
<p><strong>isEnabled(Component component)</strong>: tells if the current behavior is enabled for a given component. When a behavior is disabled it will be simply ignored and not executed.</p>
</li>
<li>
<p><strong>isTemporary(Component component)</strong>: tells component if the current behavior is temporary. A temporary behavior is discarded at the end of the current request (i.e it&#8217;s executed only once).</p>
</li>
<li>
<p><strong>onConfigure(Component component)</strong>: called right after the owner component has been configured.</p>
</li>
<li>
<p><strong>onRemove(Component component)</strong>: called when the owner component has been removed from its container.</p>
</li>
<li>
<p><strong>renderHead(Component component, IHeaderResponse response)</strong>: overriding this method behaviors can render resources to the header section of the page.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For example the following behavior prepends a red asterisk to the tag of a form component if this one  is required:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RedAsteriskBehavior</span> <span class="tok-kd">extends</span> <span class="tok-n">Behavior</span> <span class="tok-o">{</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">beforeRender</span><span class="tok-o">(</span><span class="tok-n">Component</span> <span class="tok-n">component</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-n">Response</span> <span class="tok-n">response</span> <span class="tok-o">=</span> <span class="tok-n">component</span><span class="tok-o">.</span><span class="tok-na">getResponse</span><span class="tok-o">();</span>
      <span class="tok-n">StringBuffer</span> <span class="tok-n">asterisktHtml</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">StringBuffer</span><span class="tok-o">(</span><span class="tok-mi">200</span><span class="tok-o">);</span>

      <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">component</span> <span class="tok-k">instanceof</span> <span class="tok-n">FormComponent</span>
            <span class="tok-o">&amp;&amp;</span> <span class="tok-o">((</span><span class="tok-n">FormComponent</span><span class="tok-o">)</span><span class="tok-n">component</span><span class="tok-o">).</span><span class="tok-na">isRequired</span><span class="tok-o">()){</span>
        <span class="tok-n">asteriskHtml</span><span class="tok-o">.</span><span class="tok-na">append</span><span class="tok-o">(</span><span class="tok-s">&quot; &lt;b style=\&quot;color:red;font-size:medium\&quot;&gt;*&lt;/b&gt;&quot;</span><span class="tok-o">);</span>
      <span class="tok-o">}</span>
      <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">write</span><span class="tok-o">(</span><span class="tok-n">asteriskHtml</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since method <em>beforeRender</em> is called before the coupled component is rendered, we can use it to prepend custom markup to component tag. This can be done writing our markup directly to the current  Response object, as we did in the example above.</p>
</div>
<div class="paragraph">
<p>Please note that we could achieve the same result overriding component method <em>onBeforeRender</em>. However using a behavior we can easily reuse our custom code with any other kind of component without modifying its source code. As general best practice we should always consider to implement a new functionality using a behavior if it can be shared among different kinds of component.</p>
</div>
<div class="paragraph">
<p>Behaviors play also a strategic role in the built-in AJAX support provided by Wicket, as we will see in the next chapter.</p>
</div>
</div>
<div class="sect2">
<h3 id="_generating_callback_urls_with_irequestlistener">Generating callback URLs with IRequestListener</h3>
<div class="paragraph">
<p>With Wicket it&#8217;s quite easy to build a callback URL that executes a specific method on server side. This method must be defined in a functional interface (i.e. an an interface that defines just one method) that inherits from built-in <em>org.apache.wicket.IRequestListener</em> and it must be a void method with no parameters in input:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">IMyListener</span> <span class="tok-kd">extends</span> <span class="tok-n">IRequestListener</span>
<span class="tok-o">{</span>
	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Called when the relative callback URL is requested.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kt">void</span> <span class="tok-nf">myCallbackMethod</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To control how the method will be invoked we must use class <em>org.apache.wicket.RequestListenerInterface</em>. In Wicket is a common practice to instantiate this class as a public static field inside the relative callback interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">IMyListener</span> <span class="tok-kd">extends</span> <span class="tok-n">IRequestListener</span>
<span class="tok-o">{</span>
	<span class="tok-cm">/**RequestListenerInterface instance*/</span>
	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">RequestListenerInterface</span> <span class="tok-n">INTERFACE</span> <span class="tok-o">=</span> <span class="tok-k">new</span>
                               <span class="tok-n">RequestListenerInterface</span><span class="tok-o">(</span><span class="tok-n">IMyListener</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Called when the relative callback URL is requested.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kt">void</span> <span class="tok-nf">myCallbackMethod</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default <em>RequestListenerInterface</em> will respond rendering the current page after the callback method has been executed (if we have a non-AJAX request). To change this behavior we can use setter method <em>setRenderPageAfterInvocation(boolean)</em>.</p>
</div>
<div class="paragraph">
<p>Now that our callback interface is complete we can generate a callback URL with <em>Component</em>'s method <em>urlFor(RequestListenerInterface, PageParameters)</em> or with method <em>urlFor (Behavior, RequestListenerInterface, PageParameters)</em> if we are using a callback interface with a behavior (see the following example).</p>
</div>
<div class="paragraph">
<p>Project CallbackURLExample contains a behavior (class <em>OnChangeSingleChoiceBehavior</em>) that implements a callback interface to update the model of an <em>AbstractSingleSelectChoice</em> component when user changes the selected option (it provides the same functionality of method <em>wantOnSelectionChangedNotifications</em>).</p>
</div>
<div class="paragraph">
<p>Instead of a custom callback interface, <em>OnChangeSingleChoiceBehavior</em> implements built-in interface <em>org.apache.wicket.behavior.IBehaviorListener</em> which is designed to generate a callback URL for behaviors. The callback method defined in this interface is <em>onRequest()</em> and the following is the implementation provided by <em>OnSelectionChangedNotifications</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onRequest</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	<span class="tok-n">Request</span> <span class="tok-n">request</span> <span class="tok-o">=</span> <span class="tok-n">RequestCycle</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">getRequest</span><span class="tok-o">();</span>
	<span class="tok-n">IRequestParameters</span> <span class="tok-n">requestParameters</span> <span class="tok-o">=</span> <span class="tok-n">request</span><span class="tok-o">.</span><span class="tok-na">getRequestParameters</span><span class="tok-o">();</span>
	<span class="tok-n">StringValue</span> <span class="tok-n">choiceId</span> <span class="tok-o">=</span> <span class="tok-n">requestParameters</span><span class="tok-o">.</span><span class="tok-na">getParameterValue</span><span class="tok-o">(</span><span class="tok-s">&quot;choiceId&quot;</span><span class="tok-o">);</span>
	<span class="tok-c1">//boundComponent is the component that the behavior it is bound to.</span>
	<span class="tok-n">boundComponent</span><span class="tok-o">.</span><span class="tok-na">setDefaultModelObject</span><span class="tok-o">(</span> <span class="tok-n">convertChoiceIdToChoice</span><span class="tok-o">(</span><span class="tok-n">choiceId</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">()));</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>When invoked via URL, the behavior expects to find a request parameter (choiceId) containing the id of the selected choice. This value is used to obtain the corresponding choice object that must be used to set the model of the component that the behavior is bound to (boundComponent). Method <em>convertChoiceIdToChoice</em> is in charge of retrieving the choice object given its id and it has been copied from class <em>AbstractSingleSelectChoice</em>.</p>
</div>
<div class="paragraph">
<p>Another interesting part of <em>OnChangeSingleChoiceBehavior</em> is its method <em>onComponentTag</em> where some JavaScript “magic” is used to move user&#8217;s browser to the callback URL when event “change” occurs on bound component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onComponentTag</span><span class="tok-o">(</span><span class="tok-n">Component</span> <span class="tok-n">component</span><span class="tok-o">,</span> <span class="tok-n">ComponentTag</span> <span class="tok-n">tag</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onComponentTag</span><span class="tok-o">(</span><span class="tok-n">component</span><span class="tok-o">,</span> <span class="tok-n">tag</span><span class="tok-o">);</span>

	<span class="tok-n">CharSequence</span> <span class="tok-n">callBackURL</span> <span class="tok-o">=</span> <span class="tok-n">getCallbackUrl</span><span class="tok-o">();</span>
	<span class="tok-n">String</span> <span class="tok-n">separatorChar</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">callBackURL</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">().</span><span class="tok-na">indexOf</span><span class="tok-o">(</span><span class="tok-sc">&#39;?&#39;</span><span class="tok-o">)</span> <span class="tok-o">&gt;</span> <span class="tok-o">-</span><span class="tok-mi">1</span> <span class="tok-o">?</span> <span class="tok-s">&quot;&amp;&quot;</span> <span class="tok-o">:</span> <span class="tok-s">&quot;?&quot;</span><span class="tok-o">);</span>

	<span class="tok-n">String</span> <span class="tok-n">finalScript</span> <span class="tok-o">=</span> <span class="tok-s">&quot;var isSelect = $(this).is(&#39;select&#39;);\n&quot;</span> <span class="tok-o">+</span>
				 <span class="tok-s">&quot;var component;\n&quot;</span> <span class="tok-o">+</span>
				 <span class="tok-s">&quot;if(isSelect)\n&quot;</span> <span class="tok-o">+</span>
				 <span class="tok-s">&quot;	component = $(this);\n&quot;</span> <span class="tok-o">+</span>
				 <span class="tok-s">&quot;else \n&quot;</span> <span class="tok-o">+</span>
				 <span class="tok-s">&quot;	component = $(this).find(&#39;input:radio:checked&#39;);\n&quot;</span> <span class="tok-o">+</span>
				 <span class="tok-s">&quot;window.location.href=&#39;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">callBackURL</span> <span class="tok-o">+</span>  <span class="tok-n">separatorChar</span> <span class="tok-o">+</span>
				 <span class="tok-s">&quot;choiceId=&#39; + &quot;</span> <span class="tok-o">+</span> <span class="tok-s">&quot;component.val()&quot;</span><span class="tok-o">;</span>

	<span class="tok-n">tag</span><span class="tok-o">.</span><span class="tok-na">put</span><span class="tok-o">(</span><span class="tok-s">&quot;onchange&quot;</span><span class="tok-o">,</span> <span class="tok-n">finalScript</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The goal of <em>onComponentTag</em> is to build an onchange handler that forces user&#8217;s browser to move to the callback URL (modifing standard property window.location.href). Please note that we have appended the expected parameter (choiceId) to the URL retrieving its value with a JQuery selector suited for the current type of component (a drop-down menu or a radio group). Since we are using JQuery in our JavaScript code, the behavior comes also with method <em>renderHead</em> that adds the bundled JQuery library to the current page.</p>
</div>
<div class="paragraph">
<p>Method <em>getCallbackUrl()</em> is used to generate the callback URL for our custom behavior and it has been copied from built-in class <em>AbstractAjaxBehavior</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-n">CharSequence</span> <span class="tok-nf">getCallbackUrl</span><span class="tok-o">(){</span>
	<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">boundComponent</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">){</span>
		<span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">(</span>
			<span class="tok-s">&quot;Behavior must be bound to a component to create the URL&quot;</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">final</span> <span class="tok-n">RequestListenerInterface</span> <span class="tok-n">rli</span><span class="tok-o">;</span>

	<span class="tok-n">rli</span> <span class="tok-o">=</span> <span class="tok-n">IBehaviorListener</span><span class="tok-o">.</span><span class="tok-na">INTERFACE</span><span class="tok-o">;</span>

	<span class="tok-k">return</span> <span class="tok-n">boundComponent</span><span class="tok-o">.</span><span class="tok-na">urlFor</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">,</span> <span class="tok-n">rli</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">PageParameters</span><span class="tok-o">());</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Static field <em>IBehaviorListener.INTERFACE</em> is the implementation of <em>RequestListenerInterface</em> defined inside callback interface <em>IBehaviorListener</em>.</p>
</div>
<div class="paragraph">
<p>The home page of project <em>CallbackURLExample</em> contains a <em>DropDownChoice</em> and a <em>RadioChoice</em> which use our custom behavior. There are also two labels to display the content of the models of the two components:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="CallbackURLExample-screenshot.png" alt="CallbackURLExample screenshot">
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Implementing interface <em>IBehaviorListener</em> makes a behavior stateful because its callback URL is specific for a given instance of component.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As final note it&#8217;s interesting to see how Wicket internally uses callback URLs for its standard link component. Class <em>org.apache.wicket.markup.html.link.Link</em> implements interface <em>org.apache.wicket.markup.html.link.ILinkListener</em> which in turn extends <em>IRequestListener</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">ILinkListener</span> <span class="tok-kd">extends</span> <span class="tok-n">IRequestListener</span>
<span class="tok-o">{</span>
	<span class="tok-cm">/** Listener interface */</span>
	<span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">RequestListenerInterface</span> <span class="tok-n">INTERFACE</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">RequestListenerInterface</span><span class="tok-o">(</span>
		<span class="tok-n">ILinkListener</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	 * Called when a link is clicked.</span>
<span class="tok-cm">	 */</span>
	<span class="tok-kt">void</span> <span class="tok-nf">onLinkClicked</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The implementation of method <em>onLinkClicked</em> simply delegates event handling to our custom version of <em>onClick</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kd">final</span> <span class="tok-kt">void</span> <span class="tok-nf">onLinkClicked</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
	<span class="tok-c1">// Invoke subclass handler</span>
	<span class="tok-n">onClick</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wicket_events_infrastructure">Wicket events infrastructure</h3>
<div class="paragraph">
<p>Starting from version 1.5 Wicket offers an event-based infrastructure for inter-component communication. The infrastructure is based on two simple interfaces (both in package <em>org.apache.wicket.event</em>) : <em>IEventSource</em> and <em>IEventSink</em>.</p>
</div>
<div class="paragraph">
<p>The first interface must be implemented by those entities that want to broadcast en event while the second interface must be implemented by those entities that want to receive a broadcast event.</p>
</div>
<div class="paragraph">
<p>The following entities already implement both these two interfaces (i.e. they can be either sender or receiver): <em>Component</em>, <em>Session</em>, <em>RequestCycle</em> and <em>Application</em>.
<em>IEventSource</em> exposes a single method named send which takes in input three parameters:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>sink</strong>: an implementation of <em>IEventSink</em> that will be the receiver of the event.</p>
</li>
<li>
<p><strong>broadcast</strong>: a <em>Broadcast</em> enum which defines the broadcast method used to dispatch the event to the sink and to other entities such as sink children, sink containers, session object, application object and the current request cycle. It has four possible values:</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Value</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BREADTH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event is sent first to the specified sink and then to all its children components following a breadth-first order.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DEPTH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event is sent to the specified sink only after it has been dispatched to all its children components following a depth-first order.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">BUBBLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event is sent first to the specified sink and then to its parent containers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXACT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The event is sent only to the specified sink.</p></td>
</tr>
</tbody>
</table>

<div class="ulist">
<ul>
<li>
<p><strong>payload</strong>: a generic object representing the data sent with the event.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Each broadcast mode has its own traversal order for <em>Session</em>, <em>RequestCycle</em> and <em>Application</em>. See JavaDoc of class <em>Broadcast</em> for further details about this order.</p>
</div>
<div class="paragraph">
<p>Interface <em>IEventSink</em> exposes callback method <em>onEvent(IEvent&lt;?&gt; event)</em> which is triggered when a sink receives an event. The interface <em>IEvent</em> represents the received event and provides getter methods to retrieve the event broadcast type, the source of the event and its payload. Typically the received event is used checking the type of its payload object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onEvent</span><span class="tok-o">(</span><span class="tok-n">IEvent</span> <span class="tok-n">event</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-c1">//if the type of payload is MyPayloadClass perform some actions</span>
  <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">event</span><span class="tok-o">.</span><span class="tok-na">getPayload</span><span class="tok-o">()</span> <span class="tok-k">instanceof</span> <span class="tok-n">MyPayloadClass</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-c1">//execute some business code.</span>
  <span class="tok-o">}</span><span class="tok-k">else</span><span class="tok-o">{</span>
     <span class="tok-c1">//other business code</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Project <em>InterComponetsEventsExample</em> provides a concrete example of sending an event to a component (named <em>container in the middle</em>) using all the available broadcast methods:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="InterComponentsEventsExample-screenshot.png" alt="InterComponentsEventsExample screenshot">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_initializers">Initializers</h3>
<div class="paragraph">
<p>Some components or resources may need to be configured before being used in our applications. While so far we used Application&#8217;s init method to initialize these kinds of entities, Wicket offers a more flexible and modular way to configure our classes.</p>
</div>
<div class="paragraph">
<p>During application&#8217;s bootstrap Wicket searches for any properties file placed in one of the <em>/META-INF/wicket/</em> folder visible to the application classpath. When one of these files is found, the initializer defined inside it will be executed. An initializer is an implementation of interface <em>org.apache.wicket.IInitializer</em> and is defined inside a properties with a line like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">initializer</span><span class="tok-o">=</span><span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">wicketTutorial</span><span class="tok-o">.</span><span class="tok-na">MyInitializer</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The fully qualified class name corresponds to the initializer that must be executed. Interface <em>IInitializer</em> defines method init(Application) which should contain our initialization code, and method <em>destroy(Application)</em> which is invoked when application is terminated:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyInitializer</span> <span class="tok-kd">implements</span> <span class="tok-n">IInitializer</span><span class="tok-o">{</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">(</span><span class="tok-n">Application</span> <span class="tok-n">application</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-c1">//initialization code</span>
	<span class="tok-o">}</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">destroy</span><span class="tok-o">(</span><span class="tok-n">Application</span> <span class="tok-n">application</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-c1">//code to execute when application is terminated</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only one initializer can be defined in a single properties file. To overcome this limit we can create a main initializer that in turn executes every initializer we need:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MainInitializer</span> <span class="tok-kd">implements</span> <span class="tok-n">IInitializer</span><span class="tok-o">{</span>

	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">(</span><span class="tok-n">Application</span> <span class="tok-n">application</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-k">new</span> <span class="tok-n">AnotherInitializer</span><span class="tok-o">().</span><span class="tok-na">init</span><span class="tok-o">(</span><span class="tok-n">application</span><span class="tok-o">);</span>
		<span class="tok-k">new</span> <span class="tok-n">YetAnotherInitializer</span><span class="tok-o">().</span><span class="tok-na">init</span><span class="tok-o">(</span><span class="tok-n">application</span><span class="tok-o">);</span>
		<span class="tok-c1">//...</span>
	<span class="tok-o">}</span>
	<span class="tok-c1">//destroy...</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_jmx_with_wicket">Using JMX with Wicket</h3>
<div class="paragraph">
<p>JMX (Java Management Extensions) is the standard technology adopted in Java for managing and monitoring running applications or Java Virtual Machines. Wicket offers support for JMX through module wicket-jmx. In this paragraph we will see how we can connect to a Wicket application using JMX. In our example we will use JConsole as JMX client. This program is bundled with Java SE since version 5 and we can run it typing jconsole in our OS shell.</p>
</div>
<div class="paragraph">
<p>Once JConsole has started it will ask us to establish a new connection to a Java process, choosing between a local process or a remote one. In the following picture we have selected the process corresponding to the local instance of Jetty server we used to run one of our example projects:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="JMX-new-connection.png" alt="JMX new connection">
</div>
</div>
<div class="paragraph">
<p>After we have established a JMX connection, JConsole will show us the following set of tabs:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="JMX-console.png" alt="JMX console">
</div>
</div>
<div class="paragraph">
<p>JMX exposes application-specific informations using special objects called MBeans (Manageable Beans), hence if we want to control our application we must open the corresponding tab. The MBeans containing the application&#8217;s informations is named <em>org.apache.wicket.app.&lt;filter/servlet name&gt;</em>.</p>
</div>
<div class="paragraph">
<p>In our example we have used wicket.test as filter name for our application:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="JMX-console2.png" alt="JMX console2">
</div>
</div>
<div class="paragraph">
<p>As we can see in the picture above, every MBean exposes a node containing its attributes and another node showing the possible operations that can be performed on the object. In the case of a Wicket application the available operations are clearMarkupCache and clearLocalizerCache:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="JMX-console3.png" alt="JMX console3">
</div>
</div>
<div class="paragraph">
<p>With these two operations we can force Wicket to clear the internal caches used to load components markup and resource bundles. This can be particularly useful if we have our application running in DEPLOYMENT mode and we want to publish minor fixes for markup or bundle files (like spelling or typo corrections) without restarting the entire application. Without cleaning these two caches Wicket would continue to use cached values ignoring any change made to markup or bundle files.</p>
</div>
<div class="paragraph">
<p>Some of the exposed properties are editable, hence we can tune their values while the application is running. For example if we look at the properties of <em>ApplicationSettings</em> we can set the maximum size allowed for an upload modifying the attribute DefaultMaximumUploadSize:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="JMX-console4.png" alt="JMX console4">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_generating_html_markup_from_code">Generating HTML markup from code</h3>
<div class="paragraph">
<p>So far, as markup source for our pages/panels we have used a static markup file, no matter if it was inherited or directly associated to the component. Now we want to investigate a more complex use case where we want to dynamical generate the markup directly inside component code.</p>
</div>
<div class="paragraph">
<p>To become a markup producer, a component must simply implement interface <em>org.apache.wicket.markup.IMarkupResourceStreamProvider</em>. The only method defined in this interface is <em>getMarkupResourceStream(MarkupContainer, Class&lt;?&gt;)</em> which returns an utility interface called <em>IResourceStream</em> representing the actual markup.</p>
</div>
<div class="paragraph">
<p>In the following example we have a custom panel without a related markup file that generates a simple &lt;div&gt; tag as markup:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AutoMarkupGenPanel</span> <span class="tok-kd">extends</span> <span class="tok-n">Panel</span> <span class="tok-kd">implements</span> <span class="tok-n">IMarkupResourceStreamProvider</span> <span class="tok-o">{</span>
	<span class="tok-kd">public</span> <span class="tok-nf">AutoMarkupGenPanel</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">model</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">model</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-n">IResourceStream</span> <span class="tok-nf">getMarkupResourceStream</span><span class="tok-o">(</span><span class="tok-n">MarkupContainer</span> <span class="tok-n">container</span><span class="tok-o">,</span>
			<span class="tok-n">Class</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">containerClass</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">String</span> <span class="tok-n">markup</span> <span class="tok-o">=</span> <span class="tok-s">&quot;&lt;div&gt;Panel markup&lt;/div&gt;&quot;</span><span class="tok-o">;</span>
		<span class="tok-n">StringResourceStream</span> <span class="tok-n">resourceStream</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">StringResourceStream</span><span class="tok-o">(</span><span class="tok-n">markup</span><span class="tok-o">);</span>

		<span class="tok-k">return</span> <span class="tok-n">resourceStream</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Class StringResourceStream is a resource stream that uses a String instance as backing object.</p>
</div>
</div>
<div class="sect2">
<h3 id="_avoiding_markup_caching">Avoiding markup caching</h3>
<div class="paragraph">
<p>As we have seen in the previous paragraph, Wicket uses an internal cache for components markup. This can be a problem if our component dynamical generates its markup when it is rendered because once the markup has been cached, Wicket will always use the cached version for the specific component. To overwrite this default caching policy, a component can implement interface <em>IMarkupCacheKeyProvider</em>.</p>
</div>
<div class="paragraph">
<p>This interface defines method <em>getCacheKey(MarkupContainer, Class&lt;?&gt;)</em> which returns a string value representing the key used by Wicket to retrieve the markup of the component from the cache. If this value is null the markup will not be cached, allowing the component to display the last generated markup each time it is rendered:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">NoCacheMarkupPanel</span> <span class="tok-kd">extends</span> <span class="tok-n">Panel</span> <span class="tok-kd">implements</span> <span class="tok-n">IMarkupCacheKeyProvider</span> <span class="tok-o">{</span>
	<span class="tok-kd">public</span> <span class="tok-nf">NoCacheMarkupPanel</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">model</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">model</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	* Generate a dynamic HTML markup that changes every time</span>
<span class="tok-cm">	* the component is rendered</span>
<span class="tok-cm">	*/</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-n">IResourceStream</span> <span class="tok-nf">getMarkupResourceStream</span><span class="tok-o">(</span><span class="tok-n">MarkupContainer</span> <span class="tok-n">container</span><span class="tok-o">,</span>
			<span class="tok-n">Class</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">containerClass</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">String</span> <span class="tok-n">markup</span> <span class="tok-o">=</span> <span class="tok-s">&quot;&lt;div&gt;Panel with current nanotime: &quot;</span> <span class="tok-o">+</span> <span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">nanoTime</span><span class="tok-o">()</span> <span class="tok-o">+</span>
				 <span class="tok-s">&quot;&lt;/div&gt;&quot;</span><span class="tok-o">;</span>
		<span class="tok-n">StringResourceStream</span> <span class="tok-n">resourceStream</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">StringResourceStream</span><span class="tok-o">(</span><span class="tok-n">markup</span><span class="tok-o">);</span>

		<span class="tok-k">return</span> <span class="tok-n">resourceStream</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-cm">/**</span>
<span class="tok-cm">	* Avoid markup caching for this component</span>
<span class="tok-cm">	*/</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getCacheKey</span><span class="tok-o">(</span><span class="tok-n">MarkupContainer</span> <span class="tok-n">arg0</span><span class="tok-o">,</span> <span class="tok-n">Class</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">arg1</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_15">Summary</h3>
<div class="paragraph">
<p>In this chapter we have introduced some advanced topics we didn&#8217;t have the chance to cover yet. We have started talking about behaviors and we have seen how they can be used to enrich existing components (promoting a component-oriented approach). Behaviors are also fundamental to work with AJAX in Wicket, as we will see in the next chapter.</p>
</div>
<div class="paragraph">
<p>After behaviors we have learnt how to generate callback URLs to execute a custom method on server side defined inside a specific callback interface.</p>
</div>
<div class="paragraph">
<p>The third topic of the chapter has been the event infrastructure provided in Wicket for inter-component communication which brings to our components a desktop-like event-driven architecture.</p>
</div>
<div class="paragraph">
<p>Then, we have introduced a new entity called initializer which can be used to configure resources and component in a modular and self-contained way.</p>
</div>
<div class="paragraph">
<p>We have also looked at Wicket support for JMX and we have seen how to use this technology for monitoring and managing our running applications.</p>
</div>
<div class="paragraph">
<p>Finally we have introduced a new technique to generate the markup of a component from its Java code.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_working_with_ajax">Working with AJAX</h2>
<div class="sectionbody">
<div class="paragraph">
<p>AJAX has become a must-have for nearly all kinds of web application. This technology does not only help to achieve a better user experience but it also allows to improve the bandwidth performance of web applications. Using AJAX usually means writing tons of JavaScript code to handle asynchronous requests and to update user interface, but with Wicket we can leave all this boilerplate code to the framework and we don&#8217;t even need to write a single line of JavaScript to start using AJAX.</p>
</div>
<div class="paragraph">
<p>In this chapter we will learn how to leverage the AJAX support provided by Wicket to make our applications fully  b[] .0 ttp://en.wikipedia.org/wiki/Web_2.0[] ompliant.</p>
</div>
<div class="sect2">
<h3 id="_how_to_use_ajax_components_and_behaviors">How to use AJAX components and behaviors</h3>
<div class="paragraph">
<p>Wicket support for AJAX is implemented in file wicket-ajax-jquery.js which makes complete transparent to Java code any detail about AJAX communication.</p>
</div>
<div class="paragraph">
<p>AJAX components and behaviors shipped with Wicket expose one or more callback methods which are executed when they receive an AJAX request. One of the arguments of these methods is an instance of interface <em>org.apache.wicket.ajax.AjaxRequestTarget</em>.</p>
</div>
<div class="paragraph">
<p>For example component AjaxLink (in package <em>org.apache.wicket.ajax.markup.html</em>) defines abstract method <em>onClick(AjaxRequestTarget target)</em> which is executed when user clicks on the component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-k">new</span> <span class="tok-n">AjaxLink</span><span class="tok-o">(</span><span class="tok-s">&quot;ajaxLink&quot;</span><span class="tok-o">){</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">(</span><span class="tok-n">AjaxRequestTarget</span> <span class="tok-n">target</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	    <span class="tok-c1">//some server side code...</span>
	<span class="tok-o">}</span>
<span class="tok-o">};</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using AjaxRequestTarget we can specify the content that must be sent back to the client as response to the current AJAX request. The most commonly used method of this interface is probably <em>add(Component&#8230; components)</em>. With this method we tell Wicket to render again the specified components and refresh their markup via AJAX:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-k">new</span> <span class="tok-n">AjaxLink</span><span class="tok-o">(</span><span class="tok-s">&quot;ajaxLink&quot;</span><span class="tok-o">){</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">(</span><span class="tok-n">AjaxRequestTarget</span> <span class="tok-n">target</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	    <span class="tok-c1">//modify the model of a label and refresh it on browser</span>
	    <span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setDefaultModelObject</span><span class="tok-o">(</span><span class="tok-s">&quot;Another value 4 label.&quot;</span><span class="tok-o">);</span>
	    <span class="tok-n">target</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
<span class="tok-o">};</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Components can be refreshed via Ajax only if they have rendered a markup id for their related tag. As a consequence, we must remember to set a valid id value on every component we want to add to <em>AjaxRequestTarget</em>. This can be done using one of the two methods seen in  <a href="#guide:keepControl_3">paragraph 6.3</a>
:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">final</span> <span class="tok-n">Label</span> <span class="tok-n">label</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;labelComponent&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Initial value.&quot;</span><span class="tok-o">);</span>
<span class="tok-c1">//autogenerate a markup id</span>
<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setOutputMarkupId</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">);</span>
<span class="tok-c1">//...</span>
<span class="tok-k">new</span> <span class="tok-n">AjaxLink</span><span class="tok-o">(</span><span class="tok-s">&quot;ajaxLink&quot;</span><span class="tok-o">){</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">(</span><span class="tok-n">AjaxRequestTarget</span> <span class="tok-n">target</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	    <span class="tok-c1">//modify the model of a label and refresh it on client side</span>
	    <span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setDefaultModelObject</span><span class="tok-o">(</span><span class="tok-s">&quot;Another value 4 label.&quot;</span><span class="tok-o">);</span>
	    <span class="tok-n">target</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
<span class="tok-o">};</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Another common use of AjaxRequestTarget is to prepend or append some JavaScript code to the generated response. For example the following AJAX link displays an alert box as response to user&#8217;s click:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-k">new</span> <span class="tok-n">AjaxLink</span><span class="tok-o">(</span><span class="tok-s">&quot;ajaxLink&quot;</span><span class="tok-o">){</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">(</span><span class="tok-n">AjaxRequestTarget</span> <span class="tok-n">target</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	    <span class="tok-n">target</span><span class="tok-o">.</span><span class="tok-na">appendJavaScript</span><span class="tok-o">(</span><span class="tok-s">&quot;;alert(&#39;Hello!!&#39;);&quot;</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
<span class="tok-o">};</span>
</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
Repeaters component that have <em>org.apache.wicket.markup.repeater.AbstractRepeater</em> as base class (like <em>ListView</em>, <em>RepeatingView</em>, etc&#8230;) can not be directly updated via AJAX.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If we want to refresh their markup via AJAX we must add one of their parent containers to the <em>AjaxRequestTarget</em>.</p>
</div>
<div class="paragraph">
<p>The standard implementation of <em>AjaxRequestTarget</em> used by Wicket is class <em>org.apache.wicket.ajax.AjaxRequestHandler</em>. To create new instances of <em>AjaxRequestTarget</em> a Wicket application uses the provider object registered with method <em>setAjaxRequestTargetProvider</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">setAjaxRequestTargetProvider</span><span class="tok-o">(</span>
		<span class="tok-n">IContextProvider</span><span class="tok-o">&lt;</span><span class="tok-n">AjaxRequestTarget</span><span class="tok-o">,</span> <span class="tok-n">Page</span><span class="tok-o">&gt;</span> <span class="tok-n">ajaxRequestTargetProvider</span><span class="tok-o">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The provider is an implementation of interface <em>org.apache.wicket.util.IContextProvider</em>, hence to use custom implementations of <em>AjaxRequestTarget</em> we must register a custom provider that returns the desired implementation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-kd">class</span> <span class="tok-nc">MyCustomAjaxRequestTargetProvider</span> <span class="tok-kd">implements</span>
		<span class="tok-n">IContextProvider</span><span class="tok-o">&lt;</span><span class="tok-n">AjaxRequestTarget</span><span class="tok-o">,</span> <span class="tok-n">Page</span><span class="tok-o">&gt;</span>
	<span class="tok-o">{</span>
		<span class="tok-nd">@Override</span>
		<span class="tok-kd">public</span> <span class="tok-n">AjaxRequestTarget</span> <span class="tok-nf">get</span><span class="tok-o">(</span><span class="tok-n">Page</span> <span class="tok-n">page</span><span class="tok-o">)</span>
		<span class="tok-o">{</span>
			<span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">MyCustomAjaxRequestTarget</span><span class="tok-o">();</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
During request handling <em>AjaxRequestHandler</em> sends an event to its application to notify the entire component hierarchy of the current page:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">   <span class="tok-c1">//&#39;page&#39; is the associated Page instance</span>
   <span class="tok-n">page</span><span class="tok-o">.</span><span class="tok-na">send</span><span class="tok-o">(</span><span class="tok-n">app</span><span class="tok-o">,</span> <span class="tok-n">Broadcast</span><span class="tok-o">.</span><span class="tok-na">BREADTH</span><span class="tok-o">,</span> <span class="tok-k">this</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The payload of the event is the <em>AjaxRequestHandler</em> itself.</p>
</div>
</div>
<div class="sect2">
<h3 id="_build_in_ajax_components">Build-in AJAX components</h3>
<div class="paragraph">
<p>Wicket distribution comes with a number of built-in AJAX components ready to be used. Some of them are the ajaxified version of common components like links and buttons, while others are AJAX-specific components.</p>
</div>
<div class="paragraph">
<p>AJAX components are not different from any other component seen so far and they don&#8217;t require any additional configuration to be used. As we will shortly see, switching from a classic link or button to the ajaxified version is just a matter of prepending “Ajax” to the component class name.</p>
</div>
<div class="paragraph">
<p>This paragraph provides an overview of what we can find in Wicket to start writing AJAX-enhanced web applications.</p>
</div>
</div>
<div class="sect2">
<h3 id="_links_and_buttons">Links and buttons</h3>
<div class="paragraph">
<p>In the previous paragraph we have already introduced component AjaxLink. Wicket provides also the ajaxified versions of submitting components SubmitLink and Button which are simply called AjaxSubmitLink and AjaxButton. These components come with a version of methods onSubmit, onError and onAfterSubmit that takes in input also an instance of <em>AjaxRequestTarget</em>.</p>
</div>
<div class="paragraph">
<p>Both components are in package <em>org.apache.wicket.ajax.markup.html.form</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_fallback_components">Fallback components</h3>
<div class="paragraph">
<p>Building an entire site using AJAX can be risky as some clients may not support this technology. In order to provide an usable version of our site also to these clients, we can use components <em>AjaxFallbackLink</em> and <em>AjaxFallbackButton</em> which are able to automatically degrade to a standard link or to a standard button if client doesn&#8217;t support AJAX.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ajax_checkbox">AJAX Checkbox</h3>
<div class="paragraph">
<p>Class <em>org.apache.wicket.ajax.markup.html.form.AjaxCheckBox</em> is a checkbox component that updates its model via AJAX when user changes its value. Its AJAX callback method is <em>onUpdate(AjaxRequestTarget target)</em>. The component extends standard checkbox component <em>CheckBox</em> adding an <em>AjaxFormComponentUpdatingBehavior</em> to itself (we will see this behavior later in  <a href="#guide:ajax_3">paragraph 19.3.3</a>
).</p>
</div>
</div>
<div class="sect2">
<h3 id="_ajax_editable_labels">AJAX editable labels</h3>
<div class="paragraph">
<p>An editable label is a special label that can be edited by the user when she/he clicks on it. Wicket ships three different implementations for this component (all inside package <em>org.apache.wicket.extensions.ajax.markup.html</em>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>AjaxEditableLabel</strong>: it&#8217;s a basic version of editable label. User can edit the content of the label with a text field. This is also the base class for the other two editable labels.</p>
</li>
<li>
<p><strong>AjaxEditableMultiLineLabel</strong>: this label supports multi-line values and uses a text area as editor component.</p>
</li>
<li>
<p><strong>AjaxEditableChoiceLabel</strong>: this label uses a drop-down menu to edit its value.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Base component AjaxEditableLabel exposes the following set of AJAX-aware methods that can be overriden:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>onEdit(AjaxRequestTarget target)</strong>: called when user clicks on component. The default implementation shows the component used to edit the value of the label.</p>
</li>
<li>
<p><strong>onSubmit(AjaxRequestTarget target)</strong>: called when the value has been successfully updated with the new input.</p>
</li>
<li>
<p><strong>onError(AjaxRequestTarget target)</strong>: called when the new inserted input has failed validation.</p>
</li>
<li>
<p><strong>onCancel(AjaxRequestTarget target)</strong>: called when user has exited from editing mode pressing escape key. The default implementation brings back the label to its initial state hiding the editor component.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wicket module wicket-examples contains page class <em>EditableLabelPage.java</em> which shows all these three components together. You can see this page in action at  <a href="http://www.wicket-library.com/wicket-examples-6.0.x/ajax/editable-label">http://www.wicket-library.com/wicket-examples-6.0.x/ajax/editable-label</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="edit-label-example-screenshot.png" alt="edit label example screenshot">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_autocomplete_text_field">Autocomplete text field</h3>
<div class="paragraph">
<p>On Internet we can find many examples of text fields that display a list of suggestions (or options) while the user types a text inside them. This feature is known as autocomplete functionality.</p>
</div>
<div class="paragraph">
<p>Wicket offers an out-of-the-box implementation of an autocomplete text field with component <em>org.apache.wicket.extensions.ajax.markup.html.autocomplete.AutoCompleteTextField</em>.</p>
</div>
<div class="paragraph">
<p>When using AutoCompleteTextField we are required to implement its abstract method getChoices(String input) where the input parameter is the current input of the component. This method returns an iterator over the suggestions that will be displayed as a drop-down menu:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="autocomplete-example-screenshot.png" alt="autocomplete example screenshot">
</div>
</div>
<div class="paragraph">
<p>Suggestions are rendered using a render which implements interface <em>IAutoCompleteRenderer</em>. The default implementation simply calls toString() on each suggestion object. If we need to work with a custom render we can specify it via component constructor.</p>
</div>
<div class="paragraph">
<p>AutoCompleteTextField supports a wide range of settings that are passed to its constructor with class <em>AutoCompleteSettings</em>.</p>
</div>
<div class="paragraph">
<p>One of the most interesting parameter we can specify for <em>AutoCompleteTextField</em> is the throttle delay which is the amount of time (in milliseconds) that must elapse between a change of input value and the transmission of a new Ajax request to display suggestions. This parameter can be set with method <em>setThrottleDelay(int)</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">AutoCompleteSettings</span> <span class="tok-n">settings</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AutoCompleteSettings</span><span class="tok-o">();</span>
<span class="tok-c1">//set throttle to 400 ms: component will wait 400ms before displaying the options</span>
<span class="tok-n">settings</span><span class="tok-o">.</span><span class="tok-na">setThrottleDelay</span><span class="tok-o">(</span><span class="tok-mi">400</span><span class="tok-o">);</span>
<span class="tok-c1">//...</span>
<span class="tok-n">AutoCompleteTextField</span> <span class="tok-n">field</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AutoCompleteTextField</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;field&quot;</span><span class="tok-o">,</span> <span class="tok-n">model</span><span class="tok-o">)</span> <span class="tok-o">{</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-n">Iterator</span> <span class="tok-nf">getChoices</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">arg0</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-c1">//return an iterator over the options</span>
	<span class="tok-o">}</span>
<span class="tok-o">};</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wicket module wicket-examples contains page class <em>AutoCompletePagePage.java</em> which shows an example of autocomplete text field. The running example is available at  <a href="http://www.wicket-library.com/wicket-examples-6.0.x/ajax/autocomplete">http://www.wicket-library.com/wicket-examples-6.0.x/ajax/autocomplete</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_modal_window">Modal window</h3>
<div class="paragraph">
<p>Class <em>org.apache.wicket.extensions.ajax.markup.html.modal.ModalWindow</em> is an implementation of a  dal[<a href="http://www.wicket-library.com/wicket-examples-6.0.x/ajax/autocomplete">http://www.wicket-library.com/wicket-examples-6.0.x/ajax/autocomplete</a>]
image::modal-window-example-screenshot.png[]</p>
</div>
<div class="paragraph">
<p>The content of a modal window can be either another component or a page. In the first case the id of the  component used as content must be retrieved with method getContentId().</p>
</div>
<div class="paragraph">
<p>If instead we want to use a page as window content, we must implement the inner interface <em>ModalWindow.PageCreator</em> and pass it to method <em>setPageCreator</em>. The page used as content will be embedded in a &lt;iframe&gt; tag.</p>
</div>
<div class="paragraph">
<p>To display a modal window we must call its method <em>show(AjaxRequestTarget target)</em>. This is  usually done inside the AJAX callback method of another component (like an <em>AjaxLink</em>). The following markup and code are taken from project <em>BasicModalWindowExample</em> and illustrate a basic usage of a modal window:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;body&gt;</span>
	<span class="tok-nt">&lt;h2&gt;</span>Modal Windod example<span class="tok-nt">&lt;/h2&gt;</span>
	<span class="tok-nt">&lt;a</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;openWindow&quot;</span><span class="tok-nt">&gt;</span>Open the window!<span class="tok-nt">&lt;/a&gt;</span>
	<span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;modalWindow&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java Code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
   	<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">parameters</span><span class="tok-o">);</span>
   	<span class="tok-kd">final</span> <span class="tok-n">ModalWindow</span> <span class="tok-n">modalWindow</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ModalWindow</span><span class="tok-o">(</span><span class="tok-s">&quot;modalWindow&quot;</span><span class="tok-o">);</span>
   	<span class="tok-n">Label</span> <span class="tok-n">label</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-n">modalWindow</span><span class="tok-o">.</span><span class="tok-na">getContentId</span><span class="tok-o">(),</span> <span class="tok-s">&quot;I&#39;m a modal window!&quot;</span><span class="tok-o">);</span>

   	<span class="tok-n">modalWindow</span><span class="tok-o">.</span><span class="tok-na">setContent</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">);</span>
   	<span class="tok-n">modalWindow</span><span class="tok-o">.</span><span class="tok-na">setTitle</span><span class="tok-o">(</span><span class="tok-s">&quot;Modal window&quot;</span><span class="tok-o">);</span>

   	<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">modalWindow</span><span class="tok-o">);</span>
   	<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">AjaxLink</span><span class="tok-o">(</span><span class="tok-s">&quot;openWindow&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	  <span class="tok-nd">@Override</span>
	  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">(</span><span class="tok-n">AjaxRequestTarget</span> <span class="tok-n">target</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-n">modalWindow</span><span class="tok-o">.</span><span class="tok-na">show</span><span class="tok-o">(</span><span class="tok-n">target</span><span class="tok-o">);</span>
	  <span class="tok-o">}</span>
	<span class="tok-o">});</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just like any other component also <em>ModalWindow</em> must be added to a markup tag, like we did in our example using a &lt;div&gt; tag. Wicket will automatically hide this tag in the final markup appending the style value display:none.
The component provides different setter methods to customize the appearance of the window:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>setTitle(String)</strong>: specifies the title of the window</p>
</li>
<li>
<p><strong>setResizable(boolean)</strong>: by default the window is resizeable. If we need to make its size fixed we can use this method to turn off this feature.</p>
</li>
<li>
<p><strong>setInitialWidth(int) and setInitialHeight(int)</strong>: set the initial dimensions of the window.</p>
</li>
<li>
<p><strong>setMinimalWidth(int) and setMinimalHeight(int)</strong>: specify the minimal dimensions of the window.</p>
</li>
<li>
<p><strong>setCookieName(String)</strong>: this method can be used to specify the name of the cookie used on  client side to store size and position of the window when it is closed. The component will use this cookie to restore these two parameters the next time the window will be opened. If no cookie name is provided, the component will not remember its last position and size.</p>
</li>
<li>
<p><strong>setCssClassName(String)</strong>: specifies the CSS class used for the window.</p>
</li>
<li>
<p><strong>setAutoSize(boolean)</strong>: when this flag is set to true the window will automatically adjust its size to fit content width and height. By default it is false.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The modal window can be closed from code using its method <em>close(AjaxRequestTarget target)</em>. The currently opened window can be closed also with the following JavaScript instruction:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Wicket</span><span class="tok-o">.</span><span class="tok-na">Window</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">close</span><span class="tok-o">();</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>ModalWindow</em> gives the opportunity to perform custom actions when window is closing. Inner interface <em>ModalWindow.WindowClosedCallback</em> can be implemented and passed to window&#8217;s method <em>setWindowClosedCallback</em> to specify the callback that must be executed after window has been closed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">modalWindow</span><span class="tok-o">.</span><span class="tok-na">setWindowClosedCallback</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ModalWindow</span><span class="tok-o">.</span><span class="tok-na">WindowClosedCallback</span><span class="tok-o">()</span> <span class="tok-o">{</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClose</span><span class="tok-o">(</span><span class="tok-n">AjaxRequestTarget</span> <span class="tok-n">target</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	  <span class="tok-c1">//custom code...</span>
	<span class="tok-o">}</span>
<span class="tok-o">});</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tree_repeaters">Tree repeaters</h3>
<div class="paragraph">
<p>Class <em>org.apache.wicket.extensions.markup.html.repeater.tree.AbstractTree</em> is the base class of another family of repeaters called tree repeaters and designed to display a data hierarchy as a tree, resembling the behavior and the look &amp; feel of desktop tree components. A classic example of tree component on desktop is the tree used by nearly all file managers to navigate file system:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="file-system-trees.png" alt="file system trees">
</div>
</div>
<div class="paragraph">
<p>Because of their highly interactive nature, tree repeaters are implemented as AJAX components,  meaning that they are updated via AJAX when we expand or collapse their nodes.</p>
</div>
<div class="paragraph">
<p>The basic implementation of a tree repeater shipped with Wicket is component <em>NestedTree</em>. In order to use a tree repeater we must provide an implementation of interface <em>ITreeProvider</em> which is in charge of returning the nodes that compose the tree.</p>
</div>
<div class="paragraph">
<p>Wicket comes with a built-in implementation of ITreeProvider called TreeModelProvider that works with the same tree model and nodes used by Swing component <em>javax.swing.JTree</em>. These Swing entities should be familiar to you if you have previously worked with the old tree repeaters (components <em>Tree</em> and <em>TreeTable</em>) that have been deprecated with Wicket 6 and that are strongly dependent on Swing-based model and nodes. <em>TreeModelProvider</em> can be used to migrate your code to the new tree repeaters.</p>
</div>
<div class="paragraph">
<p>In the next example (project <em>CheckBoxAjaxTree</em>) we will build a tree that displays some of the main cities of three European countries: Italy, Germany and France. The cities are sub-nodes of a main node representing the relative county. The nodes of the final tree will be also selectable with a checkbox control. The whole tree will have the classic look &amp; feel of Windows XP. This is how our tree will look like:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="AJAX-tree-repeater.png" alt="AJAX tree repeater">
</div>
</div>
<div class="paragraph">
<p>We will start to explore the code of this example from the home page. The first portion of code we will see is where we build the nodes and the <em>TreeModelProvider</em> for the three. As tree node we will use Swing class <em>javax.swing.tree.DefaultMutableTreeNode</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
     <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">parameters</span><span class="tok-o">);</span>
     <span class="tok-n">DefaultMutableTreeNode</span> <span class="tok-n">root</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DefaultMutableTreeNode</span><span class="tok-o">(</span><span class="tok-s">&quot;Cities of Europe&quot;</span><span class="tok-o">);</span>

     <span class="tok-n">addNodes</span><span class="tok-o">(</span><span class="tok-n">addNodes</span><span class="tok-o">(</span><span class="tok-n">root</span><span class="tok-o">,</span> <span class="tok-s">&quot;Italy&quot;</span><span class="tok-o">),</span> <span class="tok-s">&quot;Rome&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Venice&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Milan&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Florence&quot;</span><span class="tok-o">);</span>
     <span class="tok-n">addNodes</span><span class="tok-o">(</span><span class="tok-n">addNodes</span><span class="tok-o">(</span><span class="tok-n">root</span><span class="tok-o">,</span> <span class="tok-s">&quot;Germany&quot;</span><span class="tok-o">),</span><span class="tok-s">&quot;Stuttgart&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;Munich&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Berlin&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;Dusseldorf&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Dresden&quot;</span><span class="tok-o">);</span>
     <span class="tok-n">addNodes</span><span class="tok-o">(</span><span class="tok-n">addNodes</span><span class="tok-o">(</span><span class="tok-n">root</span><span class="tok-o">,</span> <span class="tok-s">&quot;France&quot;</span><span class="tok-o">),</span> <span class="tok-s">&quot;Paris&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;Toulouse&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Strasbourg&quot;</span><span class="tok-o">,</span><span class="tok-s">&quot;Bordeaux&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Lyon&quot;</span><span class="tok-o">);</span>

     <span class="tok-n">DefaultTreeModel</span> <span class="tok-n">treeModel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DefaultTreeModel</span><span class="tok-o">(</span><span class="tok-n">root</span><span class="tok-o">);</span>
     <span class="tok-n">TreeModelProvider</span><span class="tok-o">&lt;</span><span class="tok-n">DefaultMutableTreeNode</span><span class="tok-o">&gt;</span> <span class="tok-n">modelProvider</span> <span class="tok-o">=</span> <span class="tok-k">new</span>
                            <span class="tok-n">TreeModelProvider</span><span class="tok-o">&lt;</span><span class="tok-n">DefaultMutableTreeNode</span><span class="tok-o">&gt;(</span> <span class="tok-n">treeModel</span> <span class="tok-o">){</span>
       <span class="tok-nd">@Override</span>
       <span class="tok-kd">public</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">DefaultMutableTreeNode</span><span class="tok-o">&gt;</span> <span class="tok-nf">model</span><span class="tok-o">(</span><span class="tok-n">DefaultMutableTreeNode</span> <span class="tok-n">object</span><span class="tok-o">){</span>
          <span class="tok-k">return</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-n">object</span><span class="tok-o">);</span>
       <span class="tok-o">}</span>
     <span class="tok-o">};</span>
     <span class="tok-c1">//To be continued...</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Nodes have been built using simple strings as data objects and invoking custom utility method addNodes which converts string parameters into children nodes for a given parent node. Once we have our tree of <em>DefaultMutableTreeNodes</em> we can build the Swing tree model (<em>DefaultTreeModel</em>) that will be the backing object for a <em>TreeModelProvider</em>. This provider wraps each node in a model invoking its abstract method model. In our example we have used a simple <em>Model</em> as wrapper model.</p>
</div>
<div class="paragraph">
<p>Scrolling down the code we can see how the tree component is instantiated and configured before being added to the home page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//Continued from previous snippet...</span>
 <span class="tok-n">NestedTree</span><span class="tok-o">&lt;</span><span class="tok-n">DefaultMutableTreeNode</span><span class="tok-o">&gt;</span> <span class="tok-n">tree</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">NestedTree</span><span class="tok-o">&lt;</span><span class="tok-n">DefaultMutableTreeNode</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;tree&quot;</span><span class="tok-o">,</span>
                                                      <span class="tok-n">modelProvider</span><span class="tok-o">)</span>
  <span class="tok-o">{</span>

   <span class="tok-nd">@Override</span>
   <span class="tok-kd">protected</span> <span class="tok-n">Component</span> <span class="tok-nf">newContentComponent</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">DefaultMutableTreeNode</span><span class="tok-o">&gt;</span><span class="tok-n">model</span><span class="tok-o">)</span>
   <span class="tok-o">{</span>
     <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-n">CheckedFolder</span><span class="tok-o">&lt;</span><span class="tok-n">DefaultMutableTreeNode</span><span class="tok-o">&gt;(</span><span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-k">this</span><span class="tok-o">,</span> <span class="tok-n">model</span><span class="tok-o">);</span>
   <span class="tok-o">}</span>
  <span class="tok-o">};</span>
  <span class="tok-c1">//select Windows theme</span>
  <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">WindowsTheme</span><span class="tok-o">());</span>

  <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">tree</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
  <span class="tok-c1">//implementation of addNodes</span>
  <span class="tok-c1">//...</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use tree repeaters we must implement their abstract method <em>newContentComponent</em> which is called internally by base class <em>AbstractTree</em> when a new node must be built. As content component we have used built-in class <em>CheckedFolder</em> which combines a <em>Folder</em> component with a <em>CheckBox</em> form control.</p>
</div>
<div class="paragraph">
<p>The final step before adding the tree to its page is to apply a theme to it. Wicket comes with two behaviors, WindowsTheme and HumanTheme, which correspond to the classic Windows XP theme and to the Human theme from Ubuntu.</p>
</div>
<div class="paragraph">
<p>Our checkable tree is finished but our work is not over yet because the component doesn&#8217;t offer many functionalities as it is. Unfortunately neither NestedTree nor CheckedFolder provide a means for collecting checked nodes and returning them to client code. It&#8217;s up to us to implement a way to keep track of checked nodes.</p>
</div>
<div class="paragraph">
<p>Another nice feature we would like to implement for our tree is the following user-friendly behavior that should occur when a user checks/unchecks a node:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>When a node is checked also all its children nodes (if any) must be checked. We must also ensure that all the ancestors of the checked node (root included) are checked, otherwise we would get an inconsistent selection.</p>
</li>
<li>
<p>When a node is unchecked also all its children nodes (if any) must be unchecked and we must also ensure that ancestors get unchecked if they have no more checked children.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The first goal (keeping track of checked node) can be accomplished building a custom version of <em>CheckedFolder</em> that uses a shared Java Set to store checked node and to verify if its node has been  checked. This kind of solution requires a custom model for checkbox component in order to reflect its checked status when its container node is rendered. This model must implement typed interface <em>IModel&lt;Boolean&gt;</em> and must be returned by <em>CheckedFolder</em>'s method <em>newCheckBoxModel</em>.</p>
</div>
<div class="paragraph">
<p>For the second goal (auto select/unselect children and ancestor nodes) we can use <em>CheckedFolder</em>'s callback method onUpdate(AjaxRequestTarget) that is invoked after a checkbox is clicked and its value has been updated. Overriding this method we can handle user click adding/removing nodes to/from the Java Set.</p>
</div>
<div class="paragraph">
<p>Following this implementation plan we can start coding our custom <em>CheckedFolder</em> (named <em>AutocheckedFolder</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AutocheckedFolder</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-kd">extends</span> <span class="tok-n">CheckedFolder</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>

   <span class="tok-kd">private</span> <span class="tok-n">ITreeProvider</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">treeProvider</span><span class="tok-o">;</span>
   <span class="tok-kd">private</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;&gt;</span> <span class="tok-n">checkedNodes</span><span class="tok-o">;</span>
   <span class="tok-kd">private</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Boolean</span><span class="tok-o">&gt;</span> <span class="tok-n">checkboxModel</span><span class="tok-o">;</span>

   <span class="tok-kd">public</span> <span class="tok-nf">AutocheckedFolder</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">AbstractTree</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">tree</span><span class="tok-o">,</span>
                        <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">model</span><span class="tok-o">,</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Set</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;&gt;</span> <span class="tok-n">checkedNodes</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">tree</span><span class="tok-o">,</span> <span class="tok-n">model</span><span class="tok-o">);</span>
      <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">treeProvider</span> <span class="tok-o">=</span> <span class="tok-n">tree</span><span class="tok-o">.</span><span class="tok-na">getProvider</span><span class="tok-o">();</span>
      <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">checkedNodes</span> <span class="tok-o">=</span> <span class="tok-n">checkedNodes</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@Override</span>
   <span class="tok-kd">protected</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Boolean</span><span class="tok-o">&gt;</span> <span class="tok-nf">newCheckBoxModel</span><span class="tok-o">(</span><span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">model</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-n">checkboxModel</span> <span class="tok-o">=</span>  <span class="tok-k">new</span> <span class="tok-n">CheckModel</span><span class="tok-o">();</span>
      <span class="tok-k">return</span> <span class="tok-n">checkboxModel</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@Override</span>
   <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onUpdate</span><span class="tok-o">(</span><span class="tok-n">AjaxRequestTarget</span> <span class="tok-n">target</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onUpdate</span><span class="tok-o">(</span><span class="tok-n">target</span><span class="tok-o">);</span>
      <span class="tok-n">T</span> <span class="tok-n">node</span> <span class="tok-o">=</span> <span class="tok-n">getModelObject</span><span class="tok-o">();</span>
      <span class="tok-kt">boolean</span> <span class="tok-n">nodeChecked</span> <span class="tok-o">=</span> <span class="tok-n">checkboxModel</span><span class="tok-o">.</span><span class="tok-na">getObject</span><span class="tok-o">();</span>

      <span class="tok-n">addRemoveSubNodes</span><span class="tok-o">(</span><span class="tok-n">node</span><span class="tok-o">,</span> <span class="tok-n">nodeChecked</span><span class="tok-o">);</span>
      <span class="tok-n">addRemoveAncestorNodes</span><span class="tok-o">(</span><span class="tok-n">node</span><span class="tok-o">,</span> <span class="tok-n">nodeChecked</span><span class="tok-o">);</span>
   <span class="tok-o">}</span>

  <span class="tok-kd">class</span> <span class="tok-nc">CheckModel</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractCheckBoxModel</span><span class="tok-o">{</span>
      <span class="tok-nd">@Override</span>
      <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isSelected</span><span class="tok-o">()</span> <span class="tok-o">{</span>
         <span class="tok-k">return</span> <span class="tok-n">checkedNodes</span><span class="tok-o">.</span><span class="tok-na">getObject</span><span class="tok-o">().</span><span class="tok-na">contains</span><span class="tok-o">(</span><span class="tok-n">getModelObject</span><span class="tok-o">());</span>
      <span class="tok-o">}</span>

      <span class="tok-nd">@Override</span>
      <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">select</span><span class="tok-o">()</span> <span class="tok-o">{</span>
         <span class="tok-n">checkedNodes</span><span class="tok-o">.</span><span class="tok-na">getObject</span><span class="tok-o">().</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">getModelObject</span><span class="tok-o">());</span>
      <span class="tok-o">}</span>

      <span class="tok-nd">@Override</span>
      <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">unselect</span><span class="tok-o">()</span> <span class="tok-o">{</span>
         <span class="tok-n">checkedNodes</span><span class="tok-o">.</span><span class="tok-na">getObject</span><span class="tok-o">().</span><span class="tok-na">remove</span><span class="tok-o">(</span><span class="tok-n">getModelObject</span><span class="tok-o">());</span>
      <span class="tok-o">}</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The constructor of this new component takes in input a further parameter which is the set containing checked nodes.</p>
</div>
<div class="paragraph">
<p>Class CheckModel is the custom model we have implemented for checkbox control. As base class for this model we have used <em>AbstractCheckBoxModel</em> which is provided to implement custom models for checkbox controls.</p>
</div>
<div class="paragraph">
<p>Methods <em>addRemoveSubNodes</em> and <em>addRemoveAncestorNodes</em> are called to automatically add/remove children and ancestor nodes to/from the current Set. Their implementation is mainly focused on the navigation of tree nodes and it heavily depends on the internal implementation of the tree, so we won&#8217;t dwell on their code.</p>
</div>
<div class="paragraph">
<p>Now we are just one step away from completing our tree as we still have to find a way to update the checked status of both children and ancestors nodes on client side. Although we could easily accomplish this task by simply refreshing the whole tree via AJAX, we would like to find a better and more performant solution for this task.</p>
</div>
<div class="paragraph">
<p>When we modify the checked status of a node we don&#8217;t expand/collapse any node of the three so we can simply update the desired checkboxes rather than updating the entire tree component. This alternative approach could lead to a more responsive interface and to a strong reduction of bandwidth consumption.</p>
</div>
<div class="paragraph">
<p>With the help of JQuery we can code a couple of JavaScript functions that can be used to check/ uncheck all the children and ancestors of a given node. Then, we can append these functions to the current <em>AjaxRequest</em> at the end of method onUpdate:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">   <span class="tok-nd">@Override</span>
   <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onUpdate</span><span class="tok-o">(</span><span class="tok-n">AjaxRequestTarget</span> <span class="tok-n">target</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onUpdate</span><span class="tok-o">(</span><span class="tok-n">target</span><span class="tok-o">);</span>
      <span class="tok-n">T</span> <span class="tok-n">node</span> <span class="tok-o">=</span> <span class="tok-n">getModelObject</span><span class="tok-o">();</span>
      <span class="tok-kt">boolean</span> <span class="tok-n">nodeChecked</span> <span class="tok-o">=</span> <span class="tok-n">checkboxModel</span><span class="tok-o">.</span><span class="tok-na">getObject</span><span class="tok-o">();</span>

      <span class="tok-n">addRemoveSubNodes</span><span class="tok-o">(</span><span class="tok-n">node</span><span class="tok-o">,</span> <span class="tok-n">nodeChecked</span><span class="tok-o">);</span>
      <span class="tok-n">addRemoveAncestorNodes</span><span class="tok-o">(</span><span class="tok-n">node</span><span class="tok-o">,</span> <span class="tok-n">nodeChecked</span><span class="tok-o">);</span>
      <span class="tok-n">updateNodeOnClientSide</span><span class="tok-o">(</span><span class="tok-n">target</span><span class="tok-o">,</span> <span class="tok-n">nodeChecked</span><span class="tok-o">);</span>
   <span class="tok-o">}</span>

   <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">updateNodeOnClientSide</span><span class="tok-o">(</span><span class="tok-n">AjaxRequestTarget</span> <span class="tok-n">target</span><span class="tok-o">,</span>
			<span class="tok-kt">boolean</span> <span class="tok-n">nodeChecked</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-n">target</span><span class="tok-o">.</span><span class="tok-na">appendJavaScript</span><span class="tok-o">(</span><span class="tok-s">&quot;;CheckAncestorsAndChildren.checkChildren(&#39;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">getMarkupId</span><span class="tok-o">()</span> <span class="tok-o">+</span>
                              <span class="tok-s">&quot;&#39;,&quot;</span> <span class="tok-o">+</span> <span class="tok-n">nodeChecked</span> <span class="tok-o">+</span> <span class="tok-s">&quot;);&quot;</span><span class="tok-o">);</span>

      <span class="tok-n">target</span><span class="tok-o">.</span><span class="tok-na">appendJavaScript</span><span class="tok-o">(</span><span class="tok-s">&quot;;CheckAncestorsAndChildren.checkAncestors(&#39;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">getMarkupId</span><span class="tok-o">()</span> <span class="tok-o">+</span>
                              <span class="tok-s">&quot;&#39;,&quot;</span> <span class="tok-o">+</span> <span class="tok-n">nodeChecked</span> <span class="tok-o">+</span> <span class="tok-s">&quot;);&quot;</span><span class="tok-o">);</span>
   <span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The JavaScript code can be found inside file autocheckedFolder.js which is added to the header section as package resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">renderHead</span><span class="tok-o">(</span><span class="tok-n">IHeaderResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-n">PackageResourceReference</span> <span class="tok-n">scriptFile</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">getClass</span><span class="tok-o">(),</span>
                                                      <span class="tok-s">&quot;autocheckedFolder.js&quot;</span><span class="tok-o">);</span>
	<span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">render</span><span class="tok-o">(</span><span class="tok-n">JavaScriptHeaderItem</span><span class="tok-o">.</span><span class="tok-na">forReference</span><span class="tok-o">(</span><span class="tok-n">scriptFile</span><span class="tok-o">));</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_working_with_hidden_components">Working with hidden components</h3>
<div class="paragraph">
<p>When a component is not visible its markup and the related id attribute are not rendered in the final page, hence it can not be updated via AJAX. To overcome this problem we must use Component&#8217;s method <em>setOutputMarkupPlaceholderTag(true)</em> which has the effect of rendering a hidden &lt;span&gt; tag containing the markup id of the hidden component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">final</span> <span class="tok-n">Label</span> <span class="tok-n">label</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;labelComponent&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Initial value.&quot;</span><span class="tok-o">);</span>
<span class="tok-c1">//make label invisible</span>
<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="tok-c1">//ensure that label will leave a placeholder for its markup id</span>
<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setOutputMarkupPlaceholderTag</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">);</span>
<span class="tok-c1">//...</span>
<span class="tok-k">new</span> <span class="tok-n">AjaxLink</span><span class="tok-o">(</span><span class="tok-s">&quot;ajaxLink&quot;</span><span class="tok-o">){</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">(</span><span class="tok-n">AjaxRequestTarget</span> <span class="tok-n">target</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	    <span class="tok-c1">//turn label to visible</span>
	    <span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
	    <span class="tok-n">target</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">label</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
<span class="tok-o">};</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that in the code above we didn&#8217;t invoked method <em>setOutputMarkupId(true)</em> as <em>setOutputMarkupPlaceholderTag</em> already does it internally.</p>
</div>
</div>
<div class="sect2">
<h3 id="_built_in_ajax_behaviors">Built-in AJAX behaviors</h3>
<div class="paragraph">
<p>In addition to specific components, Wicket offers also a set of built in AJAX behaviors that can be used to easily add AJAX functionalities to existing components. As we will see in this paragraph AJAX behaviors can be used also to ajaxify components that weren&#8217;t initially designed to work with this technology. All the following behaviors are inside package <em>org.apache.wicket.ajax</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ajaxeventbehavior">AjaxEventBehavior</h3>
<div class="paragraph">
<p>AjaxEventBehavior allows to handle a JavaScript event (like click, change, etc&#8230;) on server side via AJAX. Its constructor takes in input the name of the event that must be handled. Every time this event is fired for a given component on client side, the callback method <em>onEvent(AjaxRequestTarget target)</em> is executed. onEvent is abstract, hence we must implement it to tell <em>AjaxEventBehavior</em> what to do when the specified event occurs.</p>
</div>
<div class="paragraph">
<p>In project <em>AjaxEventBehaviorExample</em> we used this behavior to build a “clickable” Label component that counts the number of clicks. Here is the code from the home page of the project:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;body&gt;</span>
  <span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;clickCounterLabel&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
  User has clicked <span class="tok-nt">&lt;span</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;clickCounter&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span> time/s on the label above.
<span class="tok-nt">&lt;/body&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java Code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
   <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">parameters</span><span class="tok-o">);</span>

      <span class="tok-kd">final</span> <span class="tok-n">ClickCounterLabel</span> <span class="tok-n">clickCounterLabel</span> <span class="tok-o">=</span>
         <span class="tok-k">new</span> <span class="tok-n">ClickCounterLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;clickCounterLabel&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Click on me!&quot;</span><span class="tok-o">);</span>
      <span class="tok-kd">final</span> <span class="tok-n">Label</span> <span class="tok-n">clickCounter</span> <span class="tok-o">=</span>
         <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;clickCounter&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">PropertyModel</span><span class="tok-o">(</span><span class="tok-n">clickCounterLabel</span><span class="tok-o">,</span> <span class="tok-s">&quot;clickCounter&quot;</span><span class="tok-o">));</span>


      <span class="tok-n">clickCounterLabel</span><span class="tok-o">.</span><span class="tok-na">setOutputMarkupId</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
      <span class="tok-n">clickCounterLabel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">AjaxEventBehavior</span><span class="tok-o">(</span><span class="tok-s">&quot;click&quot;</span><span class="tok-o">){</span>

         <span class="tok-nd">@Override</span>
         <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onEvent</span><span class="tok-o">(</span><span class="tok-n">AjaxRequestTarget</span> <span class="tok-n">target</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-n">clickCounterLabel</span><span class="tok-o">.</span><span class="tok-na">clickCounter</span><span class="tok-o">++;</span>
            <span class="tok-n">target</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">clickCounter</span><span class="tok-o">);</span>
         <span class="tok-o">}</span>
      <span class="tok-o">});</span>

      <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">clickCounterLabel</span><span class="tok-o">);</span>
      <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">clickCounter</span><span class="tok-o">.</span><span class="tok-na">setOutputMarkupId</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-kd">class</span> <span class="tok-nc">ClickCounterLabel</span> <span class="tok-kd">extends</span> <span class="tok-n">Label</span><span class="tok-o">{</span>
   <span class="tok-kd">public</span> <span class="tok-kt">int</span> <span class="tok-n">clickCounter</span><span class="tok-o">;</span>

   <span class="tok-kd">public</span> <span class="tok-nf">ClickCounterLabel</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">);</span>
   <span class="tok-o">}</span>

   <span class="tok-kd">public</span> <span class="tok-nf">ClickCounterLabel</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">model</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">model</span><span class="tok-o">);</span>
   <span class="tok-o">}</span>

   <span class="tok-kd">public</span> <span class="tok-nf">ClickCounterLabel</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">label</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">label</span><span class="tok-o">);</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code above we have declared a custom label class named <em>ClickCounterLabel</em> that exposes a public integer field called clickCounter. Then, in the home page we have attached a <em>AjaxEventBehavior</em> to our custom label to increment clickCounter every time it receives a click event.</p>
</div>
<div class="paragraph">
<p>The number of clicks is displayed with another standard label named <em>clickCounter</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ajaxformsubmitbehavior">AjaxFormSubmitBehavior</h3>
<div class="paragraph">
<p>This behavior allows to send a form via AJAX when the component it is attached to receives the specified event. The component doesn&#8217;t need to be inside the form if we use the constructor version that, in addition to the name of the event, takes in input also the target form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Form</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">);</span>
<span class="tok-n">Button</span> <span class="tok-n">submitButton</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Button</span><span class="tok-o">(</span><span class="tok-s">&quot;submitButton&quot;</span><span class="tok-o">);</span>
<span class="tok-c1">//submit form when button is clicked</span>
<span class="tok-n">submitButton</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">AjaxFormSubmitBehavior</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">,</span> <span class="tok-s">&quot;click&quot;</span><span class="tok-o">){});</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">submitButton</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ajaxformcomponentupdatingbehavior">AjaxFormComponentUpdatingBehavior</h3>
<div class="paragraph">
<p>This behavior updates the model of the form component it is attached to when a given event occurs. The standard form submitting process is skipped and the behavior validates only its form component.</p>
</div>
<div class="paragraph">
<p>The behavior doesn&#8217;t work with radio buttons and checkboxes. For these kinds of components we must use <em>AjaxFormChoiceComponentUpdatingBehavior</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Form</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">);</span>
<span class="tok-n">TextField</span> <span class="tok-n">textField</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;textField&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">));</span>
<span class="tok-c1">//update the model of the text field each time event &quot;change&quot; occurs</span>
<span class="tok-n">textField</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">AjaxFormComponentUpdatingBehavior</span><span class="tok-o">(</span><span class="tok-s">&quot;change&quot;</span><span class="tok-o">){</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onUpdate</span><span class="tok-o">(</span><span class="tok-n">AjaxRequestTarget</span> <span class="tok-n">target</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-c1">//...</span>
	<span class="tok-o">}</span>
<span class="tok-o">});</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">textField</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_abstractajaxtimerbehavior">AbstractAjaxTimerBehavior</h3>
<div class="paragraph">
<p><em>AbstractAjaxTimerBehavior</em> executes callback method <em>onTimer(AjaxRequestTarget target)</em> at a specified interval. The behavior can be stopped and restarted at a later time with methods <em>stop(AjaxRequestTarget target)</em> and <em>restart(AjaxRequestTarget target)</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Label</span> <span class="tok-n">dynamicLabel</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;dynamicLabel&quot;</span><span class="tok-o">);</span>
<span class="tok-c1">//trigger an AJAX request every three seconds</span>
<span class="tok-n">dynamicLabel</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">AbstractAjaxTimerBehavior</span><span class="tok-o">(</span><span class="tok-n">Duration</span><span class="tok-o">.</span><span class="tok-na">seconds</span><span class="tok-o">(</span><span class="tok-mi">3</span><span class="tok-o">))</span> <span class="tok-o">{</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onTimer</span><span class="tok-o">(</span><span class="tok-n">AjaxRequestTarget</span> <span class="tok-n">target</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-c1">//...</span>
	<span class="tok-o">}</span>
<span class="tok-o">});</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">dynamicLabel</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
As side effect AJAX components and behaviors make their hosting page stateful. As a consequence they are unfit for those pages that must stay stateless. Project WicketStuff provides a module with a stateless version of the most common AJAX components and behaviors. You can find more informations on this module in Appendix B.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_using_an_activity_indicator">Using an activity indicator</h3>
<div class="paragraph">
<p>One of the things we must take care of when we use AJAX is to notify user when an AJAX request is already in progress. This is usually done displaying an animated picture as activity indicator while the AJAX request is running.</p>
</div>
<div class="paragraph">
<p>Wicket comes with a variant of components <em>AjaxButton</em>, <em>AjaxLink</em> and <em>AjaxFallbackLink</em> that display a default activity indicator during AJAX request processing. These components are respectively <em>IndicatingAjaxButton</em>, <em>IndicatingAjaxLink</em> and <em>IndicatingAjaxFallbackLink</em>.</p>
</div>
<div class="paragraph">
<p>The default activity indicator used in Wicket can be easily integrated in our components using behavior AjaxIndicatorAppender (available in package <em>org.apache.wicket.extensions.ajax.markup.html</em>) and implementing the interface <em>IAjaxIndicatorAware</em> (in package <em>org.apache.wicket.ajax</em>).</p>
</div>
<div class="paragraph">
<p><em>IAjaxIndicatorAware</em> declares method <em>getAjaxIndicatorMarkupId()</em> which returns the id of the markup element used to display the activity indicator. This id can be obtained from the AjaxIndicatorAppender behavior that has been added to the current component. The following code snippet summarizes the steps needed to integrate the default activity indicator with an ajaxified component:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//1-Implement interface IAjaxIndicatorAware</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyComponent</span> <span class="tok-kd">extends</span> <span class="tok-n">Component</span> <span class="tok-kd">implements</span> <span class="tok-n">IAjaxIndicatorAware</span> <span class="tok-o">{</span>
	<span class="tok-c1">//2-Instantiate an AjaxIndicatorAppender</span>
	<span class="tok-kd">private</span> <span class="tok-n">AjaxIndicatorAppender</span> <span class="tok-n">indicatorAppender</span> <span class="tok-o">=</span>
			<span class="tok-k">new</span> <span class="tok-n">AjaxIndicatorAppender</span><span class="tok-o">();</span>

	<span class="tok-kd">public</span> <span class="tok-nf">MyComponent</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">model</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">model</span><span class="tok-o">);</span>
		<span class="tok-c1">//3-Add the AjaxIndicatorAppender to the component</span>
		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">indicatorAppender</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
	<span class="tok-c1">//4-Return the markup id obtained from AjaxIndicatorAppender</span>
	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getAjaxIndicatorMarkupId</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">indicatorAppender</span><span class="tok-o">.</span><span class="tok-na">getMarkupId</span><span class="tok-o">();</span>
	<span class="tok-o">}</span>
<span class="tok-c1">//...</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we need to change the default picture used as activity indicator, we can override method <em>getIndicatorUrl()</em> of <em>AjaxIndicatorAppender</em> and return the URL to the desired picture.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ajax_request_attributes_and_call_listeners">AJAX request attributes and call listeners</h3>
<div class="paragraph">
<p>Starting from version 6.0 Wicket has introduced two entities which allow us to control how an AJAX request is generated on client side and to specify the custom JavaScript code we want to execute during request handling. These entities are class <em>AjaxRequestAttributes</em> and interface <em>IAjaxCallListener</em>, both placed in package <em>org.apache.wicket.ajax.attributes</em>.</p>
</div>
<div class="paragraph">
<p>AjaxRequestAttributes exposes the attributes used to generate the JavaScript call invoked on client side to start an AJAX request. Each attribute will be passed as a  <a href="http://en.wikipedia.org/wiki/JSON">JSON</a> arameter to the JavaScript function <em>Wicket.Ajax.ajax</em> which is responsible for sending the concrete AJAX request. Every JSON parameter is identified by a short name. Here is a partial list of the available parameters:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Short name</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Description</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Default value</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">u</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The callback URL used to serve the AJAX request that will be sent.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the component that wants to start the AJAX call.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">e</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of event (click, change, etc&#8230;) that can trigger the AJAX call.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">domready</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The request method that must be used (GET or POST).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The id of the form that must be submitted with the AJAX call.</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If the AJAX call involves the submission of a form, this flag indicates whether the data must be encoded using the encoding mode “multipart/form-data”.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">sc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The input name of the submitting component of the form</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">async</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A boolean parameter that indicates if the AJAX call is asynchronous (true) or not.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">wr</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the type of data returned by the AJAX call (XML, HTML, JSON, etc&#8230;).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">bh, pre, bsh, ah, sh, fh, coh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This is a list of the listeners that are executed on client side (they are JavaScript scripts) during the lifecycle of an AJAX request. Each short name is the abbreviation of one of the methods defined in the interface IAjaxCallListener (see below).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An empty list</p></td>
</tr>
</tbody>
</table>

<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
A full list of the available request parameters as well as more details on the related JavaScript code can be found at  <a href="https://cwiki.apache.org/confluence/display/WICKET/Wicket+Ajax">https://cwiki.apache.org/confluence/display/WICKET/Wicket+Ajax</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Parameters <em>u</em> (callback URL) and <em>c</em> (the id of the component) are generated by the AJAX behavior that will serve the AJAX call and they are not accessible through <em>AjaxRequestAttributes</em>.</p>
</div>
<div class="paragraph">
<p>Here is the final AJAX function generate for the behavior used in example project <em>AjaxEventBehavior</em> Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Wicket</span><span class="tok-o">.</span><span class="tok-na">Ajax</span><span class="tok-o">.</span><span class="tok-na">ajax</span><span class="tok-o">({</span><span class="tok-s">&quot;u&quot;</span><span class="tok-o">:</span><span class="tok-s">&quot;./?0-1.IBehaviorListener.0-clickCounterLabel&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;e&quot;</span><span class="tok-o">:</span><span class="tok-s">&quot;click&quot;</span><span class="tok-o">,</span>
                  <span class="tok-s">&quot;c&quot;</span><span class="tok-o">:</span><span class="tok-s">&quot;clickCounterLabel1&quot;</span><span class="tok-o">});</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Even if most of the times we will let Wicket generate request attributes for us, both AJAX components and behaviors give us the chance to modify them overriding their method <em>updateAjaxAttributes (AjaxRequestAttributes attributes)</em>.</p>
</div>
<div class="paragraph">
<p>One of the attribute we may need to modify is the list of <em>IAjaxCallListeners</em> returned by method <em>getAjaxCallListeners()</em>.</p>
</div>
<div class="paragraph">
<p><em>IAjaxCallListener</em> defines a set of methods which return the JavaScript code (as a <em>CharSequence</em>) that must be executed on client side when the AJAX request handling reaches a given stage:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>getBeforeHandler(Component)</strong>: returns the JavaScript code that will be executed before any other handlers returned by IAjaxCallListener. The code is executed in a scope where it can use variable attrs, which is an array containing the JSON parameters passed to Wicket.Ajax.ajax.</p>
</li>
<li>
<p><strong>getPrecondition(Component)</strong>: returns the JavaScript code that will be used as precondition for the AJAX call. If the script returns false then neither the Ajax call nor the other handlers will be executed. The code is executed in a scope where it can use variable attrs, which is the same variable seen for getBeforeHandler.</p>
</li>
<li>
<p><strong>getBeforeSendHandler(Component)</strong>: returns the JavaScript code that will be executed just before the AJAX call is performed. The code is executed in a scope where it can use variables attrs, jqXHR and settings:</p>
<div class="ulist">
<ul>
<li>
<p>attrs is the same variable seen for getBeforeHandler.</p>
</li>
<li>
<p>jqXHR is the the jQuery XMLHttpRequest object used to make the AJAX call.</p>
</li>
<li>
<p>settings contains the settings used for calling jQuery.ajax().</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>getAfterHandler(Component)</strong>: returns the JavaScript code that will be executed after the AJAX call. The code is executed in a scope where it can use variable attrs, which is the same variable seen before for getBeforeHandler.</p>
</li>
<li>
<p><strong>getSuccessHandler(Component)</strong>: returns the JavaScript code that will be executed if the AJAX call has successfully returned. The code is executed in a scope where it can use variables attrs, jqXHR, data and textStatus:</p>
<div class="ulist">
<ul>
<li>
<p>attrs and jqXHR are same variables seen for getBeforeSendHandler:</p>
</li>
<li>
<p>data is the data returned by the AJAX call. Its type depends on parameter wr (Wicket AJAX response).</p>
</li>
<li>
<p>textStatus it&#8217;s the status returned as text.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>getFailureHandler(Component)</strong>: returns the JavaScript code that will be executed if the AJAX call has returned with a failure. The code is executed in a scope where it can use variable attrs, which is the same variable seen for getBeforeHandler.</p>
</li>
<li>
<p><strong>getCompleteHandler(Component)</strong>: returns the JavaScript that will be invoked after success or failure handler has been executed. The code is executed in a scope where it can use variables attrs, jqXHR and textStatus which are the same variables seen for getSuccessHandler.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the next paragraph we will see an example of custom <em>IAjaxCallListener</em> designed to disable a component during AJAX request processing.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_custom_ajax_call_listener">Creating custom AJAX call listener</h3>
<div class="paragraph">
<p>Displaying an activity indicator is a nice way to notify user that an AJAX request is already running, but sometimes is not enough. In some situations we may need to completely disable a component during AJAX request processing, for example when we want to avoid that impatient users submit a form multiple times. In this paragraph we will see how to accomplish this goal building a custom and reusable <em>IAjaxCallListener</em>. The code used in this example is from project <em>CustomAjaxListenerExample</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_what_we_want_for_our_listener">What we want for our listener</h3>
<div class="paragraph">
<p>The listener should execute some JavaScript code to disable a given component when the component it is attached to is about to make an AJAX call. Then, when the AJAX request has been completed, the listener should bring back the disabled component to an active state.</p>
</div>
<div class="paragraph">
<p>When a component is disabled it must be clear to user that an AJAX request is running and that he/she must wait for it to complete. To achieve this result we want to disable a given component covering it with a semi-transparent overlay area with an activity indicator in the middle.</p>
</div>
<div class="paragraph">
<p>The final result will look like this:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="custom-ajax-call-listener.png" alt="custom ajax call listener">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_implement_the_listener">How to implement the listener</h3>
<div class="paragraph">
<p>The listener will implement methods <em>getBeforeHandler</em> and <em>getAfterHandler</em>: the first will return the code needed to place an overlay &lt;div&gt; on the desired component while the second must remove this overlay when the AJAX call has completed.</p>
</div>
<div class="paragraph">
<p>To move and resize the overlay area we will use another module from  ueryUI[] ibrary ttp://jqueryui.com/position/[] hat allows us to position DOM elements on our page relative to another element.</p>
</div>
<div class="paragraph">
<p>So our listener will depend on four static resources: the JQuery library, the position module of JQuery UI, the custom code used to move the overlay &lt;div&gt; and the picture used as activity indicator. Except for the activity indicator, all these resources must be added to page header section in order to be used.</p>
</div>
<div class="paragraph">
<p>Ajax call listeners can contribute to header section by simply implementing interface <em>IComponentAwareHeaderContributor</em>. Wicket provides adapter class <em>AjaxCallListener</em> that implements both <em>IAjaxCallListener</em> and <em>IComponentAwareHeaderContributor</em>. We will use this class as base class for our listener.</p>
</div>
</div>
<div class="sect2">
<h3 id="_javascript_code">JavaScript code</h3>
<div class="paragraph">
<p>Now that we know what to do on the Java side, let&#8217;s have a look at the custom JavaScript code that must be returned by our listener (file moveHiderAndIndicator.js):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">DisableComponentListener</span> <span class="tok-o">=</span> <span class="tok-o">{</span>
   <span class="tok-n">disableElement</span><span class="tok-o">:</span> <span class="tok-n">function</span><span class="tok-o">(</span><span class="tok-n">elementId</span><span class="tok-o">,</span> <span class="tok-n">activeIconUrl</span><span class="tok-o">){</span>
      <span class="tok-n">var</span> <span class="tok-n">hiderId</span> <span class="tok-o">=</span> <span class="tok-n">elementId</span> <span class="tok-o">+</span> <span class="tok-s">&quot;-disable-layer&quot;</span><span class="tok-o">;</span>
      <span class="tok-n">var</span> <span class="tok-n">indicatorId</span> <span class="tok-o">=</span> <span class="tok-n">elementId</span> <span class="tok-o">+</span> <span class="tok-s">&quot;-indicator-picture&quot;</span><span class="tok-o">;</span>

      <span class="tok-n">elementId</span> <span class="tok-o">=</span> <span class="tok-s">&quot;#&quot;</span> <span class="tok-o">+</span> <span class="tok-n">elementId</span><span class="tok-o">;</span>
      <span class="tok-c1">//create the overlay &lt;div&gt;</span>
      <span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-n">elementId</span><span class="tok-o">).</span><span class="tok-na">after</span><span class="tok-o">(</span><span class="tok-err">&#39;</span><span class="tok-o">&lt;</span><span class="tok-n">div</span> <span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-s">&quot;&#39; + hiderId</span>
<span class="tok-s">         + &#39;&quot;</span> <span class="tok-n">style</span><span class="tok-o">=</span><span class="tok-s">&quot;position:absolute;&quot;</span><span class="tok-o">&gt;</span><span class="tok-err">&#39;</span>
         <span class="tok-o">+</span> <span class="tok-err">&#39;</span><span class="tok-o">&lt;</span><span class="tok-n">img</span> <span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-s">&quot;&#39; + indicatorId +  &#39;&quot;</span> <span class="tok-n">src</span><span class="tok-o">=</span><span class="tok-s">&quot;&#39; + activeIconUrl + &#39;&quot;</span><span class="tok-o">/&gt;</span><span class="tok-err">&#39;</span>
         <span class="tok-o">+</span> <span class="tok-err">&#39;</span><span class="tok-o">&lt;/</span><span class="tok-n">div</span><span class="tok-o">&gt;</span><span class="tok-err">&#39;</span><span class="tok-o">);</span>

      <span class="tok-n">hiderId</span> <span class="tok-o">=</span> <span class="tok-s">&quot;#&quot;</span> <span class="tok-o">+</span> <span class="tok-n">hiderId</span><span class="tok-o">;</span>
      <span class="tok-c1">//set the style properties of the overlay &lt;div&gt;</span>
      <span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-n">hiderId</span><span class="tok-o">).</span><span class="tok-na">css</span><span class="tok-o">(</span><span class="tok-err">&#39;</span><span class="tok-n">opacity</span><span class="tok-err">&#39;</span><span class="tok-o">,</span> <span class="tok-err">&#39;</span><span class="tok-mf">0.8</span><span class="tok-err">&#39;</span><span class="tok-o">);</span>
      <span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-n">hiderId</span><span class="tok-o">).</span><span class="tok-na">css</span><span class="tok-o">(</span><span class="tok-err">&#39;</span><span class="tok-n">text</span><span class="tok-o">-</span><span class="tok-n">align</span><span class="tok-err">&#39;</span><span class="tok-o">,</span> <span class="tok-err">&#39;</span><span class="tok-n">center</span><span class="tok-err">&#39;</span><span class="tok-o">);</span>
      <span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-n">hiderId</span><span class="tok-o">).</span><span class="tok-na">css</span><span class="tok-o">(</span><span class="tok-err">&#39;</span><span class="tok-n">background</span><span class="tok-o">-</span><span class="tok-n">color</span><span class="tok-err">&#39;</span><span class="tok-o">,</span> <span class="tok-err">&#39;</span><span class="tok-n">WhiteSmoke</span><span class="tok-err">&#39;</span><span class="tok-o">);</span>
      <span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-n">hiderId</span><span class="tok-o">).</span><span class="tok-na">css</span><span class="tok-o">(</span><span class="tok-err">&#39;</span><span class="tok-n">border</span><span class="tok-err">&#39;</span><span class="tok-o">,</span> <span class="tok-err">&#39;</span><span class="tok-mi">1</span><span class="tok-n">px</span> <span class="tok-n">solid</span> <span class="tok-n">DarkGray</span><span class="tok-err">&#39;</span><span class="tok-o">);</span>
      <span class="tok-c1">//set the dimention of the overlay &lt;div&gt;</span>
      <span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-n">hiderId</span><span class="tok-o">).</span><span class="tok-na">width</span><span class="tok-o">(</span><span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-n">elementId</span><span class="tok-o">).</span><span class="tok-na">outerWidth</span><span class="tok-o">());</span>
      <span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-n">hiderId</span><span class="tok-o">).</span><span class="tok-na">height</span><span class="tok-o">(</span><span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-n">elementId</span><span class="tok-o">).</span><span class="tok-na">outerHeight</span><span class="tok-o">());</span>
      <span class="tok-c1">//positioning the overlay &lt;div&gt; on the component that must be disabled.</span>
      <span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-n">hiderId</span><span class="tok-o">).</span><span class="tok-na">position</span><span class="tok-o">({</span><span class="tok-n">of</span><span class="tok-o">:</span> <span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-n">elementId</span><span class="tok-o">),</span><span class="tok-n">at</span><span class="tok-o">:</span> <span class="tok-err">&#39;</span><span class="tok-n">top</span> <span class="tok-n">left</span><span class="tok-err">&#39;</span><span class="tok-o">,</span> <span class="tok-n">my</span><span class="tok-o">:</span> <span class="tok-err">&#39;</span><span class="tok-n">top</span> <span class="tok-n">left</span><span class="tok-err">&#39;</span><span class="tok-o">});</span>

      <span class="tok-c1">//positioning the activity indicator in the middle of the overlay &lt;div&gt;</span>
      <span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-s">&quot;#&quot;</span> <span class="tok-o">+</span> <span class="tok-n">indicatorId</span><span class="tok-o">).</span><span class="tok-na">position</span><span class="tok-o">({</span><span class="tok-n">of</span><span class="tok-o">:</span> <span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-n">hiderId</span><span class="tok-o">),</span> <span class="tok-n">at</span><span class="tok-o">:</span> <span class="tok-err">&#39;</span><span class="tok-n">center</span> <span class="tok-n">center</span><span class="tok-err">&#39;</span><span class="tok-o">,</span>
                                     <span class="tok-n">my</span><span class="tok-o">:</span> <span class="tok-err">&#39;</span><span class="tok-n">center</span> <span class="tok-n">center</span><span class="tok-err">&#39;</span><span class="tok-o">});</span>
   <span class="tok-o">},</span>
   <span class="tok-c1">//function hideComponent</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Function DisableComponentListener.disableElement places the overlay &lt;div&gt; an the activity indicator on the desired component. The parameters in input are the markup id of the component we want to disable and the URL of the activity indicator picture. These two parameters must be provided by our custom listener.</p>
</div>
<div class="paragraph">
<p>The rest of custom JavaScript contains function DisableComponentListener.hideComponent which is just a wrapper around the JQuery function remove():</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nl">hideComponent:</span> <span class="tok-n">function</span><span class="tok-o">(</span><span class="tok-n">elementId</span><span class="tok-o">){</span>
	<span class="tok-n">var</span> <span class="tok-n">hiderId</span> <span class="tok-o">=</span> <span class="tok-n">elementId</span> <span class="tok-o">+</span> <span class="tok-s">&quot;-disable-layer&quot;</span><span class="tok-o">;</span>
	<span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-sc">&#39;#&#39;</span> <span class="tok-o">+</span> <span class="tok-n">hiderId</span><span class="tok-o">).</span><span class="tok-na">remove</span><span class="tok-o">();</span>
	<span class="tok-o">}</span>
<span class="tok-o">};</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_java_class_code">Java class code</h3>
<div class="paragraph">
<p>The code of our custom listener is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">DisableComponentListener</span> <span class="tok-kd">extends</span> <span class="tok-n">AjaxCallListener</span> <span class="tok-o">{</span>
   <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">PackageResourceReference</span> <span class="tok-n">customScriptReference</span> <span class="tok-o">=</span> <span class="tok-k">new</span>
   <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">DisableComponentListener</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-s">&quot;moveHiderAndIndicator.js&quot;</span><span class="tok-o">);</span>

   <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">PackageResourceReference</span> <span class="tok-n">jqueryUiPositionRef</span> <span class="tok-o">=</span> <span class="tok-k">new</span>
   <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">DisableComponentListener</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-s">&quot;jquery-ui-position.min.js&quot;</span><span class="tok-o">);</span>

   <span class="tok-kd">private</span> <span class="tok-kd">static</span> <span class="tok-n">PackageResourceReference</span> <span class="tok-n">indicatorReference</span> <span class="tok-o">=</span>
         <span class="tok-k">new</span> <span class="tok-n">PackageResourceReference</span><span class="tok-o">(</span><span class="tok-n">DisableComponentListener</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-s">&quot;ajax-loader.gif&quot;</span><span class="tok-o">);</span>

   <span class="tok-kd">private</span> <span class="tok-n">Component</span> <span class="tok-n">targetComponent</span><span class="tok-o">;</span>

   <span class="tok-kd">public</span> <span class="tok-nf">DisableComponentListener</span><span class="tok-o">(</span><span class="tok-n">Component</span> <span class="tok-n">targetComponent</span><span class="tok-o">){</span>
      <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">targetComponent</span> <span class="tok-o">=</span> <span class="tok-n">targetComponent</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@Override</span>
   <span class="tok-kd">public</span> <span class="tok-n">CharSequence</span> <span class="tok-nf">getBeforeHandler</span><span class="tok-o">(</span><span class="tok-n">Component</span> <span class="tok-n">component</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-n">CharSequence</span> <span class="tok-n">indicatorUrl</span> <span class="tok-o">=</span> <span class="tok-n">getIndicatorUrl</span><span class="tok-o">(</span><span class="tok-n">component</span><span class="tok-o">);</span>
      <span class="tok-k">return</span> <span class="tok-s">&quot;;DisableComponentListener.disableElement(&#39;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">targetComponent</span><span class="tok-o">.</span><span class="tok-na">getMarkupId</span><span class="tok-o">()</span>
              <span class="tok-o">+</span> <span class="tok-s">&quot;&#39;,&quot;</span> <span class="tok-o">+</span> <span class="tok-s">&quot;&#39;&quot;</span> <span class="tok-o">+</span> <span class="tok-n">indicatorUrl</span> <span class="tok-o">+</span> <span class="tok-s">&quot;&#39;);&quot;</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@Override</span>
   <span class="tok-kd">public</span> <span class="tok-n">CharSequence</span> <span class="tok-nf">getCompleteHandler</span><span class="tok-o">(</span><span class="tok-n">Component</span> <span class="tok-n">component</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-k">return</span> <span class="tok-s">&quot;;DisableComponentListener.hideComponent(&#39;&quot;</span>
		<span class="tok-o">+</span> <span class="tok-n">targetComponent</span><span class="tok-o">.</span><span class="tok-na">getMarkupId</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot;&#39;);&quot;</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>

   <span class="tok-kd">protected</span> <span class="tok-n">CharSequence</span> <span class="tok-nf">getIndicatorUrl</span><span class="tok-o">(</span><span class="tok-n">Component</span> <span class="tok-n">component</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-k">return</span> <span class="tok-n">component</span><span class="tok-o">.</span><span class="tok-na">urlFor</span><span class="tok-o">(</span><span class="tok-n">indicatorReference</span><span class="tok-o">,</span> <span class="tok-kc">null</span><span class="tok-o">);</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@Override</span>
   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">renderHead</span><span class="tok-o">(</span><span class="tok-n">Component</span> <span class="tok-n">component</span><span class="tok-o">,</span> <span class="tok-n">IHeaderResponse</span> <span class="tok-n">response</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-n">ResourceReference</span> <span class="tok-n">jqueryReference</span> <span class="tok-o">=</span>
      <span class="tok-n">Application</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">getJavaScriptLibrarySettings</span><span class="tok-o">().</span><span class="tok-na">getJQueryReference</span><span class="tok-o">();</span>
      <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">render</span><span class="tok-o">(</span><span class="tok-n">JavaScriptHeaderItem</span><span class="tok-o">.</span><span class="tok-na">forReference</span><span class="tok-o">(</span><span class="tok-n">jqueryReference</span><span class="tok-o">));</span>
      <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">render</span><span class="tok-o">(</span><span class="tok-n">JavaScriptHeaderItem</span><span class="tok-o">.</span><span class="tok-na">forReference</span><span class="tok-o">(</span><span class="tok-n">jqueryUiPositionRef</span><span class="tok-o">));</span>
      <span class="tok-n">response</span><span class="tok-o">.</span><span class="tok-na">render</span><span class="tok-o">(</span><span class="tok-n">JavaScriptHeaderItem</span><span class="tok-o">.</span><span class="tok-na">forReference</span><span class="tok-o">(</span><span class="tok-n">customScriptReference</span><span class="tok-o">)</span> <span class="tok-o">);</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see in the code above we have created a function (<em>getIndicatorUrl</em>) to retrieve the URL of the indicator picture. This was done in order to make the picture customizable by overriding this method.</p>
</div>
<div class="paragraph">
<p>Once we have our listener in place, we can finally use it in our example overwriting method <em>updateAjaxAttributes</em> of the AJAX button that submits the form:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//...</span>
<span class="tok-k">new</span> <span class="tok-n">AjaxButton</span><span class="tok-o">(</span><span class="tok-s">&quot;ajaxButton&quot;</span><span class="tok-o">){</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">updateAjaxAttributes</span><span class="tok-o">(</span><span class="tok-n">AjaxRequestAttributes</span> <span class="tok-n">attributes</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	  <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">updateAjaxAttributes</span><span class="tok-o">(</span><span class="tok-n">attributes</span><span class="tok-o">);</span>
	  <span class="tok-n">attributes</span><span class="tok-o">.</span><span class="tok-na">getAjaxCallListeners</span><span class="tok-o">().</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">DisableComponentListener</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">));</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
<span class="tok-c1">//...</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_global_listeners">Global listeners</h3>
<div class="paragraph">
<p>So far we have seen how to use an AJAX call listener to track the AJAX activity of a single component. In addition to these kinds of listeners, Wicket provides also global listeners which are triggered for any AJAX request sent from a page.</p>
</div>
<div class="paragraph">
<p>Global AJAX call events are handled with JavaScript. We can register a callback function for a specific event of the AJAX call lifecycle with function <em>Wicket.Event.subscribe(</em>&lt;eventName&gt;', &lt;callback Function&gt;)'. The first parameter of this function is the name of the event we want to handle. The possible names are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>/ajax/call/before</em>: called before any other event handler.</p>
</li>
<li>
<p><em>/ajax/call/beforeSend</em>: called just before the AJAX call.</p>
</li>
<li>
<p><em>/ajax/call/after</em>: called after the AJAX request has been sent.</p>
</li>
<li>
<p><em>/ajax/call/success</em>: called if the AJAX call has successfully returned.</p>
</li>
<li>
<p><em>/ajax/call/failure</em>: called if the AJAX call has returned with a failure.</p>
</li>
<li>
<p><em>/ajax/call/complete</em>: called when the AJAX call has completed.</p>
</li>
<li>
<p><em>/dom/node/removing</em>: called when a component is about to be removed via AJAX. This  happens when component markup is updated via AJAX (i.e. the component itself or one of its containers has been added to <em>AjaxRequestTarget</em>)</p>
</li>
<li>
<p><em>/dom/node/added</em>: called when a component has been added via AJAX. Just like <em>/dom/node/removing</em>, this event is triggered when a component is added to <em>AjaxRequestTarget</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The callback function takes in input the following parameters:  attrs, jqXHR, textStatus, jqEvent and errorThrown. The first three parameters are the same seen before with <em>IAjaxCallListener</em> while jqEvent is an event internally fired by Wicket. The last parameter errorThrown indicates if an error has occurred during the AJAX call.</p>
</div>
<div class="paragraph">
<p>To see a basic example of use of a global AJAX call listener, let&#8217;s go back to our custom datepicker created in  <a href="#guide:jsintegration">chapter 19</a>
. When we built it we didn&#8217;t think about a possible use of the component with AJAX.  When a complex component like our datepicker is refreshed via AJAX, the following two side effects can occur:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>After been refreshed, the component loses every JavaScript handler set on it. This is not a problem for our datepicker as it sets a new JQuery datepicker every time is rendered (inside method renderHead).</p>
</li>
<li>
<p>The markup previously created with JavaScript is not removed. For our datepicker this means that the icon used to open the calendar won&#8217;t be removed while a new one will be added each time the component is refreshed.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To solve the second unwanted side effect we can register a global AJAX call listener that completely removes the datepicker functionality from our component before it is removed due to an AJAX refresh (which fires event <em>/dom/node/removing</em>).</p>
</div>
<div class="paragraph">
<p>Project <em>CustomDatepickerAjax</em> contains a new version of our datepicker which adds to its JavaScript file JQDatePicker.js the code needed to register a callback function that gets rid of the JQuery datepicker before the component is removed from the DOM:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Wicket</span><span class="tok-o">.</span><span class="tok-na">Event</span><span class="tok-o">.</span><span class="tok-na">subscribe</span><span class="tok-o">(</span><span class="tok-err">&#39;</span><span class="tok-o">/</span><span class="tok-n">dom</span><span class="tok-o">/</span><span class="tok-n">node</span><span class="tok-o">/</span><span class="tok-n">removing</span><span class="tok-err">&#39;</span><span class="tok-o">,</span>
    <span class="tok-n">function</span><span class="tok-o">(</span><span class="tok-n">jqEvent</span><span class="tok-o">,</span> <span class="tok-n">attributes</span><span class="tok-o">,</span> <span class="tok-n">jqXHR</span><span class="tok-o">,</span> <span class="tok-n">errorThrown</span><span class="tok-o">,</span> <span class="tok-n">textStatus</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-n">var</span> <span class="tok-n">componentId</span> <span class="tok-o">=</span> <span class="tok-sc">&#39;#&#39;</span> <span class="tok-o">+</span> <span class="tok-n">attributes</span><span class="tok-o">[</span><span class="tok-err">&#39;</span><span class="tok-n">id</span><span class="tok-err">&#39;</span><span class="tok-o">];</span>
	<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-n">componentId</span><span class="tok-o">).</span><span class="tok-na">datepicker</span> <span class="tok-o">!==</span> <span class="tok-n">undefined</span><span class="tok-o">)</span>
	      <span class="tok-n">$</span><span class="tok-o">(</span><span class="tok-n">componentId</span><span class="tok-o">).</span><span class="tok-na">datepicker</span><span class="tok-o">(</span><span class="tok-err">&#39;</span><span class="tok-n">destroy</span><span class="tok-err">&#39;</span><span class="tok-o">);</span>
     <span class="tok-o">}</span>
<span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above retrieves the id of the component that is about to be removed using parameter attributes. Then it checks if a JQuery datepicker was defined for the given component and if so, it removes the widget calling function destroy.</p>
</div>
</div>
<div class="sect2">
<h3 id="_summary_16">Summary</h3>
<div class="paragraph">
<p>AJAX is another example of how Wicket can simplify web technologies providing a good component and object oriented abstraction of them.</p>
</div>
<div class="paragraph">
<p>In this chapter we have seen how to take advantage of the AJAX support provided by Wicket to write AJAX-enhanced applications. Most of the chapter has been dedicated to the built-in components and behaviors that let us adopt AJAX without almost any effort.</p>
</div>
<div class="paragraph">
<p>In the final part of the chapter we have seen how Wicket physically implements an AJAX call on client side using AJAX request attributes. Then, we have learnt how to use call listeners to execute custom JavaScript during AJAX request lifecycle.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_integration_with_enterprise_containers">Integration with enterprise containers</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Writing a web application is not just about producing a good layout and a bunch of “cool” pages. We must also integrate our presentation code with enterprise resources like data sources, message queues, business objects, etc&#8230;</p>
</div>
<div class="paragraph">
<p>The first decade of 2000s has seen the rising of new frameworks (like  <a href="http://spring.io/">Spring</a>  and new specifications (like  B[Spring] tp://en.wikipedia.org/wiki/Enterprise_JavaBeans ) aimed to simplify the management of enterprise resources and (among other things) their integration with presentation code.</p>
</div>
<div class="paragraph">
<p>All these new technologies are based on the concepts of container and dependency injection. Container is the environment where our enterprise resources are created and configured while   pendency[Spring] on ttp://en.wikipedia.org/wiki/Dependency_Injection[Spring] ttern implemented by containers to inject into an object the resources it depends on.</p>
</div>
<div class="paragraph">
<p>Wicket can be easily integrated with enterprise containers using component instantiation listeners. These entities are instances of interface <em>org.apache.wicket.application.IComponentInstantiationListener</em> and can be registered during application&#8217;s initialization.   IComponentInstantiationListener defines callback method onInstantiation(Component component) which can be used to provide custom instantiation logic for Wicket components.</p>
</div>
<div class="paragraph">
<p>Wicket distribution and project  <a href="https://github.com/wicketstuff">WicketStuff</a> lready provide a set of built-in listeners to integrate our applications with EJB 3.1 compliant containers (like JBoss Seam) or with some of the most popular enterprise frameworks like  <a href="http://code.google.com/p/google-guice/">Guice</a> r Spring.</p>
</div>
<div class="paragraph">
<p>In this chapter we will see two basic examples of injecting a container-defined object into a page using first an implementation of the EJB 3.1 specifications (project  <a href="http://openejb.apache.org/">OpenEJB</a>  and then using Spring.</p>
</div>
<div class="sect2">
<h3 id="_integrating_wicket_with_ejb">Integrating Wicket with EJB</h3>
<div class="paragraph">
<p>WicketStuff provides a module called wicketstuff-javaee-inject that contains component instantiation listener <em>JavaEEComponentInjector</em>. If we register this listener in our application we can use standard EJB annotations to inject dependencies into our Wicket components.</p>
</div>
<div class="paragraph">
<p>To register a component instantiation listener in Wicket we must use <em>Application</em>'s method <em>getComponentInstantiationListeners</em> which returns a typed collection of <em>IComponentInstantiationListeners</em>.</p>
</div>
<div class="paragraph">
<p>The following initialization code is taken from project <em>EjbInjectionExample</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">WicketApplication</span> <span class="tok-kd">extends</span> <span class="tok-n">WebApplication</span>
<span class="tok-o">{</span>
       <span class="tok-c1">//Constructor...</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
	<span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
		<span class="tok-n">getComponentInstantiationListeners</span><span class="tok-o">().</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">JavaEEComponentInjector</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">));</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this example the object that we want to inject is a simple class containing a greeting message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@ManagedBean</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EnterpriseMessage</span> <span class="tok-o">{</span>
	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Welcome to the EJB world!&quot;</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Please note that we have used annotation ManagedBean to decorate our object. Now to inject it into the home page we must add a field of type EnterpriseMessage and annotate it with annotation 'EJB:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>

	<span class="tok-nd">@EJB</span>
	<span class="tok-kd">private</span> <span class="tok-n">EnterpriseMessage</span> <span class="tok-n">enterpriseMessage</span><span class="tok-o">;</span>
	<span class="tok-c1">//getter and setter for enterpriseMessage...</span>

	<span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">parameters</span><span class="tok-o">);</span>

		<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;message&quot;</span><span class="tok-o">,</span> <span class="tok-n">enterpriseMessage</span><span class="tok-o">.</span><span class="tok-na">message</span><span class="tok-o">));</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>That is all. We can point the browser to the home page of the project and see the greeting message injected into the page:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="EjbInjectionExample.png" alt="EjbInjectionExample">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_integrating_wicket_with_spring">Integrating Wicket with Spring</h3>
<div class="paragraph">
<p>If we need to inject dependencies with Spring we can use listener <em>org.apache.wicket.spring.injection.annot.SpringComponentInjector</em> provided by module wicket-spring.</p>
</div>
<div class="paragraph">
<p>For the sake of simplicity in the example project <em>SpringInjectionExample</em> we have used Spring class <em>AnnotationConfigApplicationContext</em> to avoid any XML file and create a Spring context directly from code:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">WicketApplication</span> <span class="tok-kd">extends</span> <span class="tok-n">WebApplication</span>
<span class="tok-o">{</span>
  <span class="tok-c1">//Constructor...</span>

  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
  <span class="tok-o">{</span>
    <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>

    <span class="tok-n">AnnotationConfigApplicationContext</span> <span class="tok-n">ctx</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AnnotationConfigApplicationContext</span><span class="tok-o">();</span>
    <span class="tok-c1">//Scan package for annotated beans</span>
    <span class="tok-n">ctx</span><span class="tok-o">.</span><span class="tok-na">scan</span><span class="tok-o">(</span><span class="tok-s">&quot;org.wicketTutorial.ejbBean&quot;</span><span class="tok-o">);</span>
    <span class="tok-n">ctx</span><span class="tok-o">.</span><span class="tok-na">refresh</span><span class="tok-o">();</span>

    <span class="tok-n">getComponentInstantiationListeners</span><span class="tok-o">().</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">SpringComponentInjector</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">,</span> <span class="tok-n">ctx</span><span class="tok-o">));</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can see in the code above, the constructor of <em>SpringComponentInjector</em> takes in input also an instance of Spring context.</p>
</div>
<div class="paragraph">
<p>The injected object is the same used in the previous project <em>EjbInjectionExample</em>, it differs only for the greeting message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@ManagedBean</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">EnterpriseMessage</span> <span class="tok-o">{</span>
	<span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-n">message</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Welcome to the Spring world!&quot;</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the home page of the project the object is injected using Wicket annotation 'SpringBean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
  <span class="tok-nd">@SpringBean</span>
  <span class="tok-kd">private</span> <span class="tok-n">EnterpriseMessage</span> <span class="tok-n">enterpriseMessage</span><span class="tok-o">;</span>
  <span class="tok-c1">//getter and setter for enterpriseMessage...</span>

  <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  	<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">parameters</span><span class="tok-o">);</span>

	<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;message&quot;</span><span class="tok-o">,</span> <span class="tok-n">enterpriseMessage</span><span class="tok-o">.</span><span class="tok-na">message</span><span class="tok-o">));</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default <em>SpringBean</em> searches into Spring context for a bean having the same type of the annotated field. If we want we can specify also the name of the bean to use as injected object and we can declare if the dependency is required or not. By default dependencies are required and if they can not be resolved to a compatible bean, Wicket will throw an <em>IllegalStateException</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">  <span class="tok-c1">//set the dependency as not required, i.e the field can be left null</span>
  <span class="tok-nd">@SpringBean</span><span class="tok-o">(</span><span class="tok-n">name</span><span class="tok-o">=</span><span class="tok-s">&quot;anotherName&quot;</span><span class="tok-o">,</span> <span class="tok-n">required</span><span class="tok-o">=</span><span class="tok-kc">false</span><span class="tok-o">)</span>
  <span class="tok-kd">private</span> <span class="tok-n">EnterpriseMessage</span> <span class="tok-n">enterpriseMessage</span><span class="tok-o">;</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jsr_330_annotations">JSR-330 annotations</h3>
<div class="paragraph">
<p>Spring (and Guice) users can use standard  <a href="http://jcp.org/en/jsr/detail?id=330">JSR-330</a> nnotations to wire their dependencies. This will make their code more interoperable with other containers that support this standard:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">  <span class="tok-c1">//inject a bean specifying its name with JSR-330 annotations</span>
  <span class="tok-nd">@Inject</span>
  <span class="tok-nd">@Named</span><span class="tok-o">(</span><span class="tok-s">&quot;anotherName&quot;</span><span class="tok-o">)</span>
  <span class="tok-kd">private</span> <span class="tok-n">EnterpriseMessage</span> <span class="tok-n">enterpriseMessage</span><span class="tok-o">;</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_17">Summary</h3>
<div class="paragraph">
<p>In this chapter we have seen how to integrate Wicket applications with Spring and with an EJB container. Module wicket-examples contains also an example of integration with Guice (see application class <em>org.apache.wicket.examples.guice.GuiceApplication</em>).</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_native_websockets">Native WebSockets</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/WebSocket">WebSockets</a>
This means that once the browser establish a web socket connection to the server the server can push data back to the browser without the browser explicitly asking again and again whether there is something new for it.</p>
</div>
<div class="paragraph">
<p>Wicket Native WebSockets modules provide functionality to integrate with the non-standard APIs provided by different web containers (like <a href="http://tomcat.apache.org/">Apache Tomcat</a></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
Native WebSocket works only when both the browser and the web containers support WebSocket technology. There are no plans to add support to fallback to long-polling, streaming or any other technology that simulates two way communication. Use it only if you really know that you will run your application in an environment that supports WebSockets.
Currently supported web containers are Jetty 7.5+ , Tomcat 7.0.27+ and JBoss WildFly 8.0.0+.
Supported browsers can be found at <a href="http://caniuse.com/#search=websocket">caniuse.com</a>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_how_does_it_work">How does it work ?</h3>
<div class="paragraph">
<p>Each of the modules provide a specialization of <em>org.apache.wicket.protocol.http.WicketFilter</em> that registers implementation specific endpoint when an HTTP request is <a href="http://en.wikipedia.org/wiki/WebSocket#WebSocket_protocol_handshake">upgraded</a></p>
</div>
<div class="paragraph">
<p>WebSockets communication can be used in a Wicket page by using <em>org.apache.wicket.protocol.ws.api.WebSocketBehavior</em> or in a IResource by exteding <em>org.apache.wicket.protocol.ws.api.WebSocketResource</em>.
When a client is connected it is being registered in a application scoped registry using as a key the application name, the client http session id, and the id of the page or the resource name that registered it. Later when the server needs to push a message it can use this registry to filter out which clients need to receive the message.</p>
</div>
<div class="paragraph">
<p>When a message is received from the client Wicket wraps it in <em>IWebSocketMessage</em> and calls WebSocketBehavior1.<strong>onMessage()</strong> or WebSocketResource1.<strong>onMessage()</strong> where the application logic can react on it.
The server can push plain text and binary data to the client, but it can also add components for re-render, prepend/append JavaScript as it can do with  <a href="#guide:ajax">Ajax</a>
.</p>
</div>
</div>
<div class="sect2">
<h3 id="_how_to_use">How to use</h3>
<div class="ulist">
<ul>
<li>
<p><strong>Classpath dependency</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Depending on the web container that is used the application has to add a dependency to either:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for Jetty 9.0.x</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dependency&gt;
  &lt;groupId&gt;org.apache.wicket&lt;/groupId&gt;
  &lt;artifactId&gt;wicket-native-websocket-jetty9&lt;/artifactId&gt;
  &lt;version&gt;...&lt;/version&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>for Jetty 7.x and 8.x</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dependency&gt;
  &lt;groupId&gt;org.apache.wicket&lt;/groupId&gt;
  &lt;artifactId&gt;wicket-native-websocket-jetty&lt;/artifactId&gt;
  &lt;version&gt;...&lt;/version&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>for Tomcat 7.0.27+ (the old, non-JSR356 implementation)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dependency&gt;
  &lt;groupId&gt;org.apache.wicket&lt;/groupId&gt;
  &lt;artifactId&gt;wicket-native-websocket-tomcat&lt;/artifactId&gt;
  &lt;version&gt;...&lt;/version&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>for JSR356 complaint implementations (at the moment are supported: Tomcat 8.0+, Tomcat 7.0.47+, Jetty 9.1.0+ and JBoss Wildfly 8.0.0+)</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dependency&gt;
  &lt;groupId&gt;org.apache.wicket&lt;/groupId&gt;
  &lt;artifactId&gt;wicket-native-websocket-javax&lt;/artifactId&gt;
  &lt;version&gt;...&lt;/version&gt;
&lt;/dependency&gt;</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
All web containers providing JSR356 implementation are built with Java 7. This is the reason why <em>wicket-native-websocket-javax</em> module is available only with Wicket 7.x. If your application runs with JRE 7.x then you can
use <em>wicket-native-websocket-javax</em> together with the latest version of Wicket 6.x. Beware that the API/implementation of <em>wicket-native-websocket-javax</em> may change before Wicket 7.0.0 is released!
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
The examples above show snippets for Maven&#8217;s pom.xml but the application can use any other dependency management tool like <a href="http://www.gradle.org/">Gradle</a>
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>web.xml</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In <em>WEB-INF/web.xml</em> replace the usage of <strong>WicketFilter</strong> with any of the following depending on the web container that is used:</p>
</div>
<div class="paragraph">
<p>For Jetty 9.0.x:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">&lt;</span><span class="tok-n">filter</span><span class="tok-o">-</span><span class="tok-n">class</span><span class="tok-o">&gt;</span><span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">apache</span><span class="tok-o">.</span><span class="tok-na">wicket</span><span class="tok-o">.</span><span class="tok-na">protocol</span><span class="tok-o">.</span><span class="tok-na">ws</span><span class="tok-o">.</span><span class="tok-na">jetty9</span><span class="tok-o">.</span><span class="tok-na">Jetty9WebSocketFilter</span><span class="tok-o">&lt;/</span><span class="tok-n">filter</span><span class="tok-o">-</span><span class="tok-n">class</span><span class="tok-o">&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Jetty 7.5+ and 8.x:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">&lt;</span><span class="tok-n">filter</span><span class="tok-o">-</span><span class="tok-n">class</span><span class="tok-o">&gt;</span><span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">apache</span><span class="tok-o">.</span><span class="tok-na">wicket</span><span class="tok-o">.</span><span class="tok-na">protocol</span><span class="tok-o">.</span><span class="tok-na">ws</span><span class="tok-o">.</span><span class="tok-na">jetty7</span><span class="tok-o">.</span><span class="tok-na">Jetty7WebSocketFilter</span><span class="tok-o">&lt;/</span><span class="tok-n">filter</span><span class="tok-o">-</span><span class="tok-n">class</span><span class="tok-o">&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>For Tomcat 7.0.27+ (old implementation):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">&lt;</span><span class="tok-n">filter</span><span class="tok-o">-</span><span class="tok-n">class</span><span class="tok-o">&gt;</span><span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">apache</span><span class="tok-o">.</span><span class="tok-na">wicket</span><span class="tok-o">.</span><span class="tok-na">protocol</span><span class="tok-o">.</span><span class="tok-na">ws</span><span class="tok-o">.</span><span class="tok-na">tomcat7</span><span class="tok-o">.</span><span class="tok-na">Tomcat7WebSocketFilter</span><span class="tok-o">&lt;/</span><span class="tok-n">filter</span><span class="tok-o">-</span><span class="tok-n">class</span><span class="tok-o">&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>For JSR356 complaint web containers (at the moment: Tomcat 7.0.47+, Tomcat 8.x and Jetty 9.1.x):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">&lt;</span><span class="tok-n">filter</span><span class="tok-o">-</span><span class="tok-n">class</span><span class="tok-o">&gt;</span><span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">apache</span><span class="tok-o">.</span><span class="tok-na">wicket</span><span class="tok-o">.</span><span class="tok-na">protocol</span><span class="tok-o">.</span><span class="tok-na">ws</span><span class="tok-o">.</span><span class="tok-na">javax</span><span class="tok-o">.</span><span class="tok-na">JavaxWebSocketFilter</span><span class="tok-o">&lt;/</span><span class="tok-n">filter</span><span class="tok-o">-</span><span class="tok-n">class</span><span class="tok-o">&gt;</span>
</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>WebSocketBehavior</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>org.apache.wicket.protocol.ws.api.WebSocketBehavior</em> is similar to Wicket Ajax behaviors that you may have used.
Add WebSocketBehavior to the page (or to any component in the page) that will use web socket communication:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyPage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>

  <span class="tok-kd">public</span> <span class="tok-nf">MyPage</span><span class="tok-o">()</span>
  <span class="tok-o">{</span>
    <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">WebSocketBehavior</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-nd">@Override</span>
      <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onMessage</span><span class="tok-o">(</span><span class="tok-n">WebSocketRequestHandler</span> <span class="tok-n">handler</span><span class="tok-o">,</span> <span class="tok-n">TextMessage</span> <span class="tok-n">message</span><span class="tok-o">)</span>
      <span class="tok-o">{</span>
        <span class="tok-n">String</span> <span class="tok-n">msg</span> <span class="tok-o">=</span> <span class="tok-n">message</span><span class="tok-o">.</span><span class="tok-na">getText</span><span class="tok-o">();</span>
        <span class="tok-c1">// do something with msg</span>
      <span class="tok-o">}</span>
    <span class="tok-o">});</span>
  <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Use <em>message.getText()</em> to read the message sent by the client and use <em>handler.push(String)</em> to push a text message to the connected client. Additionally you can use <em>handler.add(Component&#8230;)</em> to add Wicket components for re-render, <em>handler1.prependJavaScript(CharSequence)</em> and <em>handler1.appendJavaScript(CharSequence)</em> as you do with <em>AjaxRequestTarget</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>WebSocketResource</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wicket allows one thread at a time to use a page instance to simplify the usage of the pages in multithreaded enviroment. When a WebSocket message is sent to a page Wicket needs to acquire the lock to that page to be able to pass the <em>IWebSocketMessage</em> to the <em>WebSocketBehavior</em>. This may be problematic when the application needs to send many messages from the client to the server.
For this reason Wicket provides <em>WebSocketResource</em> - an IResource implemetation that provides the same APIs as <em>WebSocketBehavior</em>. The benefit is that there is no need of synchronization as with the pages and the drawback is that <em>WebSocketRequesthandler1.add(Component&#8230;)</em> method cannot be used because there is no access to the components in an <em>IResource</em>.</p>
</div>
<div class="paragraph">
<p>To register such WebSocket resource add such line to <em>YourApplication1.init()</em> method:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">getSharedResources</span><span class="tok-o">().</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;someName&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">MyWebSocketResource</span><span class="tok-o">());</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>and</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">  <span class="tok-n">page</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">BaseWebSocketBehavior</span><span class="tok-o">(</span><span class="tok-s">&quot;someName&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>to any page. This will prepare the JavaScript connection for you.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>WebSocket connection registry</strong></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To push data to one or more clients the application can use the <em>IWebSocketConnectionRegistry</em> to find all registered connections and send data to all/any of them:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Application</span> <span class="tok-n">application</span> <span class="tok-o">=</span> <span class="tok-n">Application</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">applicationName</span><span class="tok-o">);</span>
<span class="tok-n">WebSocketSettings</span> <span class="tok-n">webSocketSettings</span> <span class="tok-o">=</span> <span class="tok-n">WebSocketSettings</span><span class="tok-o">.</span><span class="tok-na">Holder</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-n">application</span><span class="tok-o">);</span>
<span class="tok-n">IWebSocketConnectionRegistry</span> <span class="tok-n">webSocketConnectionRegistry</span> <span class="tok-o">=</span> <span class="tok-n">webSocketSettings</span><span class="tok-o">.</span><span class="tok-na">getConnectionRegistry</span><span class="tok-o">();</span>
<span class="tok-n">IWebSocketConnection</span> <span class="tok-n">connection</span> <span class="tok-o">=</span> <span class="tok-n">webSocketConnectionRegistry</span><span class="tok-o">.</span><span class="tok-na">getConnection</span><span class="tok-o">(</span><span class="tok-n">application</span><span class="tok-o">,</span> <span class="tok-n">sessionId</span><span class="tok-o">,</span> <span class="tok-n">key</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_client_side_apis">Client-side APIs</h3>
<div class="paragraph">
<p>By adding a <em>(Base)WebSocketBehavior</em> to your component(s) Wicket will contribute <em>wicket-websocket-jquery.js</em> library which provides some helper functions to write your client side code. There is a default websocket connection per Wicket Page opened for you which you can use like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Wicket</span><span class="tok-o">.</span><span class="tok-na">WebSocket</span><span class="tok-o">.</span><span class="tok-na">send</span><span class="tok-o">(</span><span class="tok-err">&#39;</span><span class="tok-o">{</span><span class="tok-n">msg</span><span class="tok-o">:</span> <span class="tok-s">&quot;my message&quot;</span><span class="tok-o">}</span><span class="tok-err">&#39;</span><span class="tok-o">).</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you need more WebSocket connections then you can do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">var</span> <span class="tok-n">ws</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Wicket</span><span class="tok-o">.</span><span class="tok-na">WebSocket</span><span class="tok-o">();</span>
<span class="tok-n">ws</span><span class="tok-o">.</span><span class="tok-na">send</span><span class="tok-o">(</span><span class="tok-err">&#39;</span><span class="tok-n">message</span><span class="tok-err">&#39;</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To close a connection:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Wicket</span><span class="tok-o">.</span><span class="tok-na">WebSocket</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">()</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">ws</span><span class="tok-o">.</span><span class="tok-na">close</span><span class="tok-o">()</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wicket.WebSocket is a simple wrapper around the native window.WebSocket API which is used to intercept the calls and to fire special JavaScript events (Wicket.Event PubSub).
Once a page that contributes <em>(Base)WebSocketBehavior</em> is rendered the client may react on messages pushed by the server by subscribing to the <em>'/websocket/message</em>' event:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Wicket</span><span class="tok-o">.</span><span class="tok-na">Event</span><span class="tok-o">.</span><span class="tok-na">subscribe</span><span class="tok-o">(</span><span class="tok-s">&quot;/websocket/message&quot;</span><span class="tok-o">,</span> <span class="tok-n">function</span><span class="tok-o">(</span><span class="tok-n">jqEvent</span><span class="tok-o">,</span> <span class="tok-n">message</span><span class="tok-o">)</span> <span class="tok-o">{</span>
  <span class="tok-n">var</span> <span class="tok-n">data</span> <span class="tok-o">=</span> <span class="tok-n">JSON</span><span class="tok-o">.</span><span class="tok-na">parse</span><span class="tok-o">(</span><span class="tok-n">message</span><span class="tok-o">);</span>
  <span class="tok-n">processData</span><span class="tok-o">(</span><span class="tok-n">data</span><span class="tok-o">);</span> <span class="tok-c1">// does something with the pushed message</span>
<span class="tok-o">});</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is a table of all events that the application can subscribe to:</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Event name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arguments</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/websocket/open</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jqEvent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A WebSocket connection has been just opened</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/websocket/message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jqEvent, message</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A message has been received from the server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/websocket/closed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jqEvent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A WebSocket connection has been closed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/websocket/error</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">jqEvent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An error occurred in the communication. The connection will be closed</p></td>
</tr>
</tbody>
</table>

</div>
<div class="sect2">
<h3 id="_testing">Testing</h3>
<div class="paragraph">
<p>The module provides <em>org.apache.wicket.protocol.ws.util.tester.WebSocketTester</em> which gives you the possibility to emulate sending and receiving messages without the need to run in a real web container, as WicketTester does this for HTTP requests.
Check <a href="https://github.com/apache/wicket/blob/master/wicket-native-websocket/wicket-native-websocket-core/src/test/java/org/apache/wicket/protocol/ws/util/tester/WebSocketTesterBehaviorTest.java?source=c">WebSocketTesterBehaviorTest</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_differences_with_wicket_atmosphere_module">Differences with Wicket-Atmosphere module.</h3>
<div class="paragraph">
<p>Wicket-Atmosphere experimental module provides integration with <a href="https://github.com/Atmosphere/atmosphere">Atmosphere</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_faq">FAQ</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Request and session scoped beans do not work.
The Web Socket communication is not processed by Servlet Filters and Listeners and thus the Dependency Injection libraries have no chance to export the request and session bean proxies.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_security_with_wicket">Security with Wicket</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Security is one of the most important non-functional requirements we must implement in our applications. This is particularly true for enterprise applications as they usually support multiple concurrent users, and therefore they need to have an access control policy.</p>
</div>
<div class="paragraph">
<p>In this chapter we will explore the security infrastructure provided by Wicket and we will learn how to use it to implement authentication and authorizations in our web applications.</p>
</div>
<div class="sect2">
<h3 id="_authentication">Authentication</h3>
<div class="paragraph">
<p>The first step in implementing a security policy is assigning a trusted identity to our users, which means that we must authenticate them. Web applications usually adopt a form-based authentication with a login form that asks user for a unique username and the relative password:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="wikipedia-login-form.png" alt="wikipedia login form">
</div>
</div>
<div class="paragraph">
<p>Wicket supports form-based authentication with session class <em>AuthenticatedWebSession</em> and application class <em>AuthenticatedWebApplication</em>, both placed inside package <em>org.apache.wicket.authroles.authentication</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_authenticatedwebsession">AuthenticatedWebSession</h3>
<div class="paragraph">
<p>Class AuthenticatedWebSession comes with the following set of public methods to manage user authentication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>authenticate(String username, String password)</strong>: this is an abstract method that must be implemented by every subclass of <em>AuthenticatedWebSession</em>. It should contain the actual code that checks for user&#8217;s identity. It returns a boolean value which is true if authentication has succeeded or false otherwise.</p>
</li>
<li>
<p><strong>signIn(String username, String password)</strong>: this method internally calls authenticate and set the flag signedIn to true if authentication succeeds.</p>
</li>
<li>
<p><strong>isSignedIn()</strong>:getter method for flag signedIn.</p>
</li>
<li>
<p><strong>signOut()</strong>: sets the flag signedIn to false.</p>
</li>
<li>
<p><strong>invalidate()</strong>: calls signOut and invalidates session.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
Remember that signOut does not discard any session-relative data. If we want to get rid of these data, we must invoke method invalidate instead of signOut.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Another abstract method we must implement when we use <em>AuthenticatedWebSession</em> is  getRoles which is inherited from parent class <em>AbstractAuthenticatedWebSession</em>. This method can be ignored for now as it will be discussed later when we will talk about role-based authorization.</p>
</div>
</div>
<div class="sect2">
<h3 id="_authenticatedwebapplication">AuthenticatedWebApplication</h3>
<div class="paragraph">
<p>Class AuthenticatedWebApplication provides the following methods to support form-based authentication:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>getWebSessionClass()</strong>: abstract method that returns the session class to use for this application. The returned class must be a subclass of <em>AbstractAuthenticatedWebSession</em>.</p>
</li>
<li>
<p><strong>getSignInPageClass()</strong>: abstract method that returns the page to use as sign in page when a user must be authenticated.</p>
</li>
<li>
<p><strong>restartResponseAtSignInPage()</strong>: forces the current response to restart at the sign in page. After we have used this method to redirect a user, we can make her/him return to the original page calling <em>Componet</em>'s method <em>continueToOriginalDestination()</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The other methods implemented inside <em>AuthenticatedWebApplication</em> will be introduced when we will talk about authorizations.</p>
</div>
</div>
<div class="sect2">
<h3 id="_a_basic_example_of_authentication">A basic example of authentication</h3>
<div class="paragraph">
<p>Project <em>BasicAuthenticationExample</em> is a basic example of form-based authentication implemented with classes <em>AuthenticatedWebSession</em> and <em>AuthenticatedWebApplication</em>.</p>
</div>
<div class="paragraph">
<p>The homepage of the project contains only a link to page <em>AuthenticatedPage</em> which can be accessed only if user is signed in. The code of <em>AuthenticatedPage</em> is this following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AuthenticatedPage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
   <span class="tok-nd">@Override</span>
   <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onConfigure</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onConfigure</span><span class="tok-o">();</span>
      <span class="tok-n">AuthenticatedWebApplication</span> <span class="tok-n">app</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">AuthenticatedWebApplication</span><span class="tok-o">)</span><span class="tok-n">Application</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">();</span>
      <span class="tok-c1">//if user is not signed in, redirect him to sign in page</span>
      <span class="tok-k">if</span><span class="tok-o">(!</span><span class="tok-n">AuthenticatedWebSession</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">isSignedIn</span><span class="tok-o">())</span>
         <span class="tok-n">app</span><span class="tok-o">.</span><span class="tok-na">restartResponseAtSignInPage</span><span class="tok-o">();</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@Override</span>
   <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onInitialize</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onInitialize</span><span class="tok-o">();</span>
      <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Link</span><span class="tok-o">(</span><span class="tok-s">&quot;goToHomePage&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>

         <span class="tok-nd">@Override</span>
         <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">()</span> <span class="tok-o">{</span>
            <span class="tok-n">setResponsePage</span><span class="tok-o">(</span><span class="tok-n">getApplication</span><span class="tok-o">().</span><span class="tok-na">getHomePage</span><span class="tok-o">());</span>
         <span class="tok-o">}</span>
      <span class="tok-o">});</span>

      <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Link</span><span class="tok-o">(</span><span class="tok-s">&quot;logOut&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>

         <span class="tok-nd">@Override</span>
         <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">()</span> <span class="tok-o">{</span>
            <span class="tok-n">AuthenticatedWebSession</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">invalidate</span><span class="tok-o">();</span>
            <span class="tok-n">setResponsePage</span><span class="tok-o">(</span><span class="tok-n">getApplication</span><span class="tok-o">().</span><span class="tok-na">getHomePage</span><span class="tok-o">());</span>
         <span class="tok-o">}</span>
      <span class="tok-o">});</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Page <em>AuthenticatedPage</em> checks inside onConfigure if user is signed in and if not, it redirects her/him to the sign in page with method <em>restartResponseAtSignInPage</em>. The page contains also a link to the homepage and another link that signs out user.</p>
</div>
<div class="paragraph">
<p>The sign in page is implemented in class <em>SignInPage</em> and contains the form used to authenticate users:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SignInPage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
   <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">username</span><span class="tok-o">;</span>
   <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">password</span><span class="tok-o">;</span>

   <span class="tok-nd">@Override</span>
   <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onInitialize</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">onInitialize</span><span class="tok-o">();</span>

      <span class="tok-n">StatelessForm</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">StatelessForm</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">){</span>
         <span class="tok-nd">@Override</span>
         <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onSubmit</span><span class="tok-o">()</span> <span class="tok-o">{</span>
            <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">Strings</span><span class="tok-o">.</span><span class="tok-na">isEmpty</span><span class="tok-o">(</span><span class="tok-n">username</span><span class="tok-o">))</span>
               <span class="tok-k">return</span><span class="tok-o">;</span>

            <span class="tok-kt">boolean</span> <span class="tok-n">authResult</span> <span class="tok-o">=</span> <span class="tok-n">AuthenticatedWebSession</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">signIn</span><span class="tok-o">(</span><span class="tok-n">username</span><span class="tok-o">,</span> <span class="tok-n">password</span><span class="tok-o">);</span>
            <span class="tok-c1">//if authentication succeeds redirect user to the requested page</span>
            <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">authResult</span><span class="tok-o">)</span>
               <span class="tok-n">continueToOriginalDestination</span><span class="tok-o">();</span>
         <span class="tok-o">}</span>
      <span class="tok-o">};</span>

      <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">setDefaultModel</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">CompoundPropertyModel</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">));</span>

      <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-o">));</span>
      <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">PasswordTextField</span><span class="tok-o">(</span><span class="tok-s">&quot;password&quot;</span><span class="tok-o">));</span>

      <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The form is responsible for handling user authentication inside its method onSubmit. The username and password are passed to <em>AuthenticatedWebSession</em>'s method <em>signIn(username, password)</em> and if authentication succeeds, the user is redirected to the original page with method <em>continueToOriginalDestination</em>.</p>
</div>
<div class="paragraph">
<p>The session class and the application class used in the project are reported here:</p>
</div>
<div class="paragraph">
<p><strong>Session class:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BasicAuthenticationSession</span> <span class="tok-kd">extends</span> <span class="tok-n">AuthenticatedWebSession</span> <span class="tok-o">{</span>

	<span class="tok-kd">public</span> <span class="tok-nf">BasicAuthenticationSession</span><span class="tok-o">(</span><span class="tok-n">Request</span> <span class="tok-n">request</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">request</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">authenticate</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">username</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">password</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	      <span class="tok-c1">//user is authenticated if both username and password are equal to &#39;wicketer&#39;</span>
		<span class="tok-k">return</span> <span class="tok-n">username</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">password</span><span class="tok-o">)</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">username</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;wicketer&quot;</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-n">Roles</span> <span class="tok-nf">getRoles</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Application class:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">WicketApplication</span> <span class="tok-kd">extends</span> <span class="tok-n">AuthenticatedWebApplication</span><span class="tok-o">{</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-n">Class</span><span class="tok-o">&lt;</span><span class="tok-n">HomePage</span><span class="tok-o">&gt;</span> <span class="tok-nf">getHomePage</span><span class="tok-o">(){</span>
		<span class="tok-k">return</span> <span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-n">Class</span><span class="tok-o">&lt;?</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractAuthenticatedWebSession</span><span class="tok-o">&gt;</span> <span class="tok-nf">getWebSessionClass</span><span class="tok-o">(){</span>
		<span class="tok-k">return</span> <span class="tok-n">BasicAuthenticationSession</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-n">Class</span><span class="tok-o">&lt;?</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span><span class="tok-o">&gt;</span> <span class="tok-nf">getSignInPageClass</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-k">return</span> <span class="tok-n">SignInPage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The authentication logic inside authenticate has been kept quite trivial in order to make the code as clean as possible. Please note also that session class must have a constructor that accepts an instance of class <em>Request</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_redirecting_user_to_an_intermediate_page">Redirecting user to an intermediate page</h3>
<div class="paragraph">
<p>Method <em>restartResponseAtSignInPage</em> is an example of redirecting user to an intermediate page before allowing him to access to the requested page. This method internally throws exception <em>org.apache.wicket.RestartResponseAtInterceptPageException</em> which saves the URL of the requested page into session metadata and then redirects user to the page passed as constructor parameter (the sign in page).</p>
</div>
<div class="paragraph">
<p>Component&#8217;s method <em>redirectToInterceptPage(Page)</em> works in much the same way as <em>restartResponseAtSignInPage</em> but it allows us to specify which page to use as intermediate page:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">    <span class="tok-n">redirectToInterceptPage</span><span class="tok-o">(</span><span class="tok-n">intermediatePage</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Since both <em>restartResponseAtSignInPage</em> and <em>redirectToInterceptPage</em> internally throw an exception, the code placed after them will not be executed.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_authorizations">Authorizations</h3>
<div class="paragraph">
<p>The authorization support provided by Wicket is built around the concept of authorization strategy which is represented by interface <em>IAuthorizationStrategy</em> (in package <em>org.apache.wicket.authorization</em>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">IAuthorizationStrategy</span>
<span class="tok-o">{</span>
  <span class="tok-c1">//interface methods</span>
 <span class="tok-o">&lt;</span><span class="tok-n">T</span> <span class="tok-kd">extends</span> <span class="tok-n">IRequestableComponent</span><span class="tok-o">&gt;</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isInstantiationAuthorized</span><span class="tok-o">(</span><span class="tok-n">Class</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">componentClass</span><span class="tok-o">);</span>
 <span class="tok-kt">boolean</span> <span class="tok-nf">isActionAuthorized</span><span class="tok-o">(</span><span class="tok-n">Component</span> <span class="tok-n">component</span><span class="tok-o">,</span> <span class="tok-n">Action</span> <span class="tok-n">action</span><span class="tok-o">);</span>

 <span class="tok-c1">//default authorization strategy that allows everything</span>
 <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-kd">final</span> <span class="tok-n">IAuthorizationStrategy</span> <span class="tok-n">ALLOW_ALL</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">IAuthorizationStrategy</span><span class="tok-o">()</span>
 <span class="tok-o">{</span>
  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span> <span class="tok-kd">extends</span> <span class="tok-n">IRequestableComponent</span><span class="tok-o">&gt;</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isInstantiationAuthorized</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">Class</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">c</span><span class="tok-o">)</span>
  <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isActionAuthorized</span><span class="tok-o">(</span><span class="tok-n">Component</span> <span class="tok-n">c</span><span class="tok-o">,</span> <span class="tok-n">Action</span> <span class="tok-n">action</span><span class="tok-o">)</span>
  <span class="tok-o">{</span>
    <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
  <span class="tok-o">}</span>
 <span class="tok-o">};</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>This interface defines two methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>isInstantiationAuthorized checks if user is allowed to instantiate a given component.</p>
</li>
<li>
<p>isActionAuthorized checks if user is authorized to perform a given action on a component&#8217;s instance. The standard actions checked by this method are defined into class Action and are Action.ENABLE and Action.RENDER.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Inside <em>IAuthorizationStrategy</em> we can also find a default implementation of the interface (called ALLOW_ALL) that allows everyone to instantiate every component and perform every possible action on it. This is the default strategy adopted by class <em>Application</em>.</p>
</div>
<div class="paragraph">
<p>To change the authorization strategy in use we must register the desired implementation into security settings (class <em>SecuritySettings</em>) during initialization phase with method setAuthorization Strategy:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">  <span class="tok-c1">//Application class code...</span>
  <span class="tok-nd">@Override</span>
  <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
  <span class="tok-o">{</span>
    <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
    <span class="tok-n">getSecuritySettings</span><span class="tok-o">().</span>
	<span class="tok-n">setAuthorizationStrategy</span><span class="tok-o">(</span><span class="tok-n">myAuthorizationStrategy</span><span class="tok-o">);</span>
  <span class="tok-o">}</span>
<span class="tok-c1">//...</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we want to combine the action of two or more authorization strategies we can chain them with strategy <em>CompoundAuthorizationStrategy</em> which implements composite pattern for authorization strategies.</p>
</div>
<div class="paragraph">
<p>Most of the times we won&#8217;t need to implement an <em>IAuthorizationStrategy</em> from scratch as Wicket already comes with a set of built-in strategies. In the next paragraphs we will see some of these strategies that can be used to implement an effective and flexible security policy.</p>
</div>
</div>
<div class="sect2">
<h3 id="_simplepageauthorizationstrategy">SimplePageAuthorizationStrategy</h3>
<div class="paragraph">
<p>Abstract class SimplePageAuthorizationStrategy (in package <em>org.apache.wicket.authorization.strategies.page</em>) is a strategy that checks user authorizations calling abstract method <em>isAuthorized</em> only for those pages that are subclasses of a given supertype. If <em>isAuthorized</em> returns false, the user is redirected to the sign in page specified as second constructor parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">SimplePageAuthorizationStrategy</span> <span class="tok-n">authorizationStrategy</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">SimplePageAuthorizationStrategy</span><span class="tok-o">(</span>
                                                  <span class="tok-n">PageClassToCheck</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">SignInPage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-o">{</span>
  <span class="tok-kd">protected</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isAuthorized</span><span class="tok-o">()</span>
  <span class="tok-o">{</span>
    <span class="tok-c1">//Authentication code...</span>
  <span class="tok-o">}</span>
<span class="tok-o">};</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default <em>SimplePageAuthorizationStrategy</em> checks for permissions only on pages. If we want to change this behavior and check also other kinds of components, we must override method <em>isActionAuthorized</em> and implement our custom logic inside it.</p>
</div>
</div>
<div class="sect2">
<h3 id="_role_based_strategies">Role-based strategies</h3>
<div class="paragraph">
<p>At the end of  <a href="#guide:security_1">paragraph 22.1</a>
 we have introduced AbstractAuthenticatedWebSession&#8217;s method getRoles which is provided to support role-based authorization returning the set of roles granted to the current user.</p>
</div>
<div class="paragraph">
<p>In Wicket roles are simple strings like “BASIC_USER” or “ADMIN” (they don&#8217;t need to be capitalized) and they are handled with class <em>org.apache.wicket.authroles.authorization.strategies.role.Roles</em>. This class extends standard HashSet collection adding some functionalities to check whether the set contains one or more roles. Class <em>Roles</em> already defines roles Roles.USER and Roles.ADMIN.</p>
</div>
<div class="paragraph">
<p>The session class in the following example returns a custom “SIGNED_IN” role for every authenticated user and it adds an Roles.ADMIN role if username is equal to superuser:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">class</span> <span class="tok-nc">BasicAuthenticationRolesSession</span> <span class="tok-kd">extends</span> <span class="tok-n">AuthenticatedWebSession</span> <span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">userName</span><span class="tok-o">;</span>

	<span class="tok-kd">public</span> <span class="tok-nf">BasicAuthenticationRolesSession</span><span class="tok-o">(</span><span class="tok-n">Request</span> <span class="tok-n">request</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">request</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">authenticate</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">username</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">password</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-kt">boolean</span> <span class="tok-n">authResult</span><span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">;</span>

		<span class="tok-n">authResult</span> <span class="tok-o">=</span> <span class="tok-c1">//some authentication logic...</span>

		<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">authResult</span><span class="tok-o">)</span>
			<span class="tok-n">userName</span> <span class="tok-o">=</span> <span class="tok-n">username</span><span class="tok-o">;</span>

		<span class="tok-k">return</span> <span class="tok-n">authResult</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>

	<span class="tok-nd">@Override</span>
	<span class="tok-kd">public</span> <span class="tok-n">Roles</span> <span class="tok-nf">getRoles</span><span class="tok-o">()</span> <span class="tok-o">{</span>
		<span class="tok-n">Roles</span> <span class="tok-n">resultRoles</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Roles</span><span class="tok-o">();</span>

		<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">isSignedIn</span><span class="tok-o">())</span>
			<span class="tok-n">resultRoles</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;SIGNED_IN&quot;</span><span class="tok-o">);</span>

		<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">userName</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;superuser&quot;</span><span class="tok-o">))</span>
			<span class="tok-n">resultRoles</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Roles</span><span class="tok-o">.</span><span class="tok-na">ADMIN</span><span class="tok-o">);</span>

		<span class="tok-k">return</span> <span class="tok-n">resultRoles</span><span class="tok-o">;</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Roles can be adopted to apply security restrictions on our pages and components. This can be done  using one of the two built-in authorization strategies that extend super class <em>AbstractRoleAuthorizationStrategyWicket</em>: <em>MetaDataRoleAuthorizationStrategy</em> and <em>AnnotationsRoleAuthorizationStrategy</em></p>
</div>
<div class="paragraph">
<p>The difference between these two strategies is that <em>MetaDataRoleAuthorizationStrategy</em> handles role-based authorizations with Wicket metadata while <em>AnnotationsRoleAuthorizationStrategy</em> uses Java annotations.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Application class <em>AuthenticatedWebApplication</em> already sets <em>MetaDataRoleAuthorizationStrategy</em> and <em>AnnotationsRoleAuthorizationStrategy</em> as its own authorization strategies (it uses a compound strategy as we will see in  <a href="#guide:security_2">paragraph 22.2</a>
).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The code that we will see in the next examples is for illustrative purpose only. If our application class inherits from <em>AuthenticatedWebApplication</em> we won&#8217;t need to configure anything to use these two strategies.</p>
</div>
<div class="sect3">
<h4 id="_using_roles_with_metadata">Using roles with metadata</h4>
<div class="paragraph">
<p>Strategy <em>MetaDataRoleAuthorizationStrategy</em> uses application and components metadata to implement role-based authorizations. The class defines a set of static methods authorize that can be used to specify which roles are allowed to instantiate a component and which roles can perform a given action on a component.</p>
</div>
<div class="paragraph">
<p>The following code snippet reports both application and session classes from project <em>MetaDataRolesStrategyExample</em> and illustrates how to use <em>MetaDataRoleAuthorizationStrategy</em> to allow access to a given page (AdminOnlyPage) only to ADMIN role:</p>
</div>
<div class="paragraph">
<p><strong>Application class:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">WicketApplication</span> <span class="tok-kd">extends</span> <span class="tok-n">AuthenticatedWebApplication</span><span class="tok-o">{</span>
   <span class="tok-nd">@Override</span>
   <span class="tok-kd">public</span> <span class="tok-n">Class</span><span class="tok-o">&lt;?</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span><span class="tok-o">&gt;</span> <span class="tok-nf">getHomePage</span><span class="tok-o">(){</span>
      <span class="tok-k">return</span> <span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@Override</span>
   <span class="tok-kd">protected</span> <span class="tok-n">Class</span><span class="tok-o">&lt;?</span> <span class="tok-kd">extends</span> <span class="tok-n">AbstractAuthenticatedWebSession</span><span class="tok-o">&gt;</span> <span class="tok-nf">getWebSessionClass</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-k">return</span> <span class="tok-n">BasicAuthenticationSession</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@Override</span>
   <span class="tok-kd">protected</span> <span class="tok-n">Class</span><span class="tok-o">&lt;?</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span><span class="tok-o">&gt;</span> <span class="tok-nf">getSignInPageClass</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-k">return</span> <span class="tok-n">SignInPage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@Override</span>
   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">(){</span>
      <span class="tok-n">getSecuritySettings</span><span class="tok-o">().</span><span class="tok-na">setAuthorizationStrategy</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">MetaDataRoleAuthorizationStrategy</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">));</span>
      <span class="tok-n">MetaDataRoleAuthorizationStrategy</span><span class="tok-o">.</span><span class="tok-na">authorize</span><span class="tok-o">(</span><span class="tok-n">AdminOnlyPage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-n">Roles</span><span class="tok-o">.</span><span class="tok-na">ADMIN</span><span class="tok-o">);</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Session class:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BasicAuthenticationSession</span> <span class="tok-kd">extends</span> <span class="tok-n">AuthenticatedWebSession</span> <span class="tok-o">{</span>

   <span class="tok-kd">private</span> <span class="tok-n">String</span> <span class="tok-n">username</span><span class="tok-o">;</span>

   <span class="tok-kd">public</span> <span class="tok-nf">BasicAuthenticationSession</span><span class="tok-o">(</span><span class="tok-n">Request</span> <span class="tok-n">request</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">request</span><span class="tok-o">);</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@Override</span>
   <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">authenticate</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">username</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">password</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-c1">//user is authenticated if username and password are equal</span>
     <span class="tok-kt">boolean</span> <span class="tok-n">authResult</span> <span class="tok-o">=</span> <span class="tok-n">username</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-n">password</span><span class="tok-o">);</span>

      <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">authResult</span><span class="tok-o">)</span>
         <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">username</span> <span class="tok-o">=</span> <span class="tok-n">username</span><span class="tok-o">;</span>

      <span class="tok-k">return</span> <span class="tok-n">authResult</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>

   <span class="tok-kd">public</span> <span class="tok-n">Roles</span> <span class="tok-nf">getRoles</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">Roles</span> <span class="tok-n">resultRoles</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Roles</span><span class="tok-o">();</span>
      <span class="tok-c1">//if user is signed in add the relative role</span>
      <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">isSignedIn</span><span class="tok-o">())</span>
         <span class="tok-n">resultRoles</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-s">&quot;SIGNED_IN&quot;</span><span class="tok-o">);</span>
      <span class="tok-c1">//if username is equal to &#39;superuser&#39; add the ADMIN role</span>
      <span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">username</span><span class="tok-o">!=</span> <span class="tok-kc">null</span> <span class="tok-o">&amp;&amp;</span> <span class="tok-n">username</span><span class="tok-o">.</span><span class="tok-na">equals</span><span class="tok-o">(</span><span class="tok-s">&quot;superuser&quot;</span><span class="tok-o">))</span>
         <span class="tok-n">resultRoles</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Roles</span><span class="tok-o">.</span><span class="tok-na">ADMIN</span><span class="tok-o">);</span>

      <span class="tok-k">return</span> <span class="tok-n">resultRoles</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>

   <span class="tok-nd">@Override</span>
   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">signOut</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">signOut</span><span class="tok-o">();</span>
      <span class="tok-n">username</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code that instantiates <em>MetaDataRoleAuthorizationStrategy</em> and set it as application&#8217;s strategy is inside application class method init.</p>
</div>
<div class="paragraph">
<p>Any subclass of <em>AbstractRoleAuthorizationStrategyWicket</em> needs an implementation of interface <em>IRoleCheckingStrategy</em> to be instantiated. For this purpose in the code above we used the application class itself because its base class <em>AuthenticatedWebApplication</em> already implements interface <em>IRoleCheckingStrategy</em>. By default <em>AuthenticatedWebApplication</em> checks for authorizations using the roles returned by the current <em>AbstractAuthenticatedWebSession</em>. As final step inside init we grant the access to page <em>AdminOnlyPage</em> to ADMIN role calling method authorize.</p>
</div>
<div class="paragraph">
<p>The code from session class has three interesting methods. The first is authenticate which considers as valid credentials every pair of username and password having the same value. The second notable method is getRoles which returns role SIGNED_IN if user is authenticated and it adds role ADMIN if username is equal to superuser. Finally, we have method signOut which has been overridden in order to clean the username field used internally to generate roles.</p>
</div>
<div class="paragraph">
<p>Now if we run the project and we try to access to <em>AdminOnlyPage</em> from the home page without having the ADMIN role, we will be redirected to the default access-denied page used by Wicket:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="authorization-access-denied.png" alt="authorization access denied">
</div>
</div>
<div class="paragraph">
<p>The access-denied page can be customized using method <em>setAccessDeniedPage(Class&lt;? extends Page&gt;)</em> of setting class <em>ApplicationSettings</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">   <span class="tok-c1">//Application class code...</span>
   <span class="tok-nd">@Override</span>
   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">(){</span>
      <span class="tok-n">getApplicationSettings</span><span class="tok-o">().</span><span class="tok-na">setAccessDeniedPage</span><span class="tok-o">(</span>
			<span class="tok-n">MyCustomAccessDeniedPage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
   <span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Just like custom “Page expired” page (see  <a href="#guide:versioningCaching_2">chapter 8.2.5</a>
), also custom “Access denied” page must be bookmarkable.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_roles_with_annotations">Using roles with annotations</h4>
<div class="paragraph">
<p>Strategy <em>AnnotationsRoleAuthorizationStrategy</em> relies on two built-in annotations to handle role-based authorizations. These annotations are <em>AuthorizeInstantiation</em> and <em>AuthorizeAction</em>. As their names suggest the first annotation specifies which roles are allowed to instantiate the annotated component while the second must be used to indicate which roles are allowed to perform a specific action on the annotated component.</p>
</div>
<div class="paragraph">
<p>In the following example we use annotations to make a page accessible only to signed-in users and to enable it only if user has the ADMIN role:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@AuthorizeInstantiation</span><span class="tok-o">(</span><span class="tok-s">&quot;SIGNED_IN&quot;</span><span class="tok-o">)</span>
<span class="tok-nd">@AuthorizeAction</span><span class="tok-o">(</span><span class="tok-n">action</span> <span class="tok-o">=</span> <span class="tok-s">&quot;ENABLE&quot;</span><span class="tok-o">,</span> <span class="tok-n">roles</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-s">&quot;ADMIN&quot;</span><span class="tok-o">})</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyPage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
   <span class="tok-c1">//Page class code...</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember that when a component is not enabled, user can render it but he can neither click on its links nor interact with its forms.</p>
</div>
<div class="paragraph">
<p>Example project <em>AnnotationsRolesStrategyExample</em> is a revisited version of <em>MetaDataRolesStrategyExample</em> where we use <em>AnnotationsRoleAuthorizationStrategy</em> as authorization strategy. To ensure that page <em>AdminOnlyPage</em> is accessible only to ADMIN role we have used the following annotation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@AuthorizeInstantiation</span><span class="tok-o">(</span><span class="tok-s">&quot;ADMIN&quot;</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">AdminOnlyPage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
    <span class="tok-c1">//Page class code...</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_catching_an_unauthorized_component_instantiation">Catching an unauthorized component instantiation</h3>
<div class="paragraph">
<p>Interface IUnauthorizedComponentInstantiationListener (in package <em>org.apache.wicket.authorization</em>) is provided to give the chance to handle the case in which a user tries to instantiate a component without having the permissions to do it. The method defined inside this interface is <em>onUnauthorizedInstantiation(Component)</em> and it is executed whenever a user attempts to execute an unauthorized instantiation.</p>
</div>
<div class="paragraph">
<p>This listener must be registered into application&#8217;s security settings with method <em>setUnauthorizedComponentInstantiationListener</em> defined by setting class <em>SecuritySettings</em>. In the following code snippet we register a listener that redirect user to a warning page if he tries to do a not-allowed instantiation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">WicketApplication</span> <span class="tok-kd">extends</span> <span class="tok-n">AuthenticatedWebApplication</span><span class="tok-o">{</span>
     <span class="tok-c1">//Application code...</span>
     <span class="tok-nd">@Override</span>
     <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">(){</span>
        <span class="tok-n">getSecuritySettings</span><span class="tok-o">().</span><span class="tok-na">setUnauthorizedComponentInstantiationListener</span><span class="tok-o">(</span>
			<span class="tok-k">new</span> <span class="tok-n">IUnauthorizedComponentInstantiationListener</span><span class="tok-o">()</span> <span class="tok-o">{</span>

	    <span class="tok-nd">@Override</span>
	    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onUnauthorizedInstantiation</span><span class="tok-o">(</span><span class="tok-n">Component</span> <span class="tok-n">component</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	        <span class="tok-n">component</span><span class="tok-o">.</span><span class="tok-na">setResponsePage</span><span class="tok-o">(</span><span class="tok-n">AuthWarningPage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
	    <span class="tok-o">}</span>
        <span class="tok-o">});</span>
     <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition to interface <em>IRoleCheckingStrategy</em>, class <em>AuthenticatedWebApplication</em> implements also <em>IUnauthorizedComponentInstantiationListener</em> and registers itself as listener for unauthorized instantiations.</p>
</div>
<div class="paragraph">
<p>By default <em>AuthenticatedWebApplication</em> redirects users to sign-in page if they are not signed-in and they try to instantiate a restricted component. Otherwise, if users are already signed in but they are not allowed to instantiate a given component, an <em>UnauthorizedInstantiationException</em> will be thrown.</p>
</div>
</div>
<div class="sect2">
<h3 id="_strategy_roleauthorizationstrategy">Strategy RoleAuthorizationStrategy</h3>
<div class="paragraph">
<p>Class <em>RoleAuthorizationStrategy</em> is a compound strategy that combines both <em>MetaDataRoleAuthorizationStrategy</em> and <em>AnnotationsRoleAuthorizationStrategy</em>.</p>
</div>
<div class="paragraph">
<p>This is the strategy used internally by <em>AuthenticatedWebApplication</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_https_protocol">Using HTTPS protocol</h3>
<div class="paragraph">
<p>HTTPS is the standard technology adopted on Internet to create a secure communication channel between web applications and their users.</p>
</div>
<div class="paragraph">
<p>In Wicket we can easily protect our pages with HTTPS mounting a special request mapper called <em>HttpsMapper</em> and using annotation RequireHttps with those pages we want to serve over this protocol. Both these two entities are in package <em>org.apache.wicket.protocol.https</em>.</p>
</div>
<div class="paragraph">
<p>HttpsMapper wraps an existing mapper and redirects incoming requests to HTTPS if the related response must render a page containing annotation <em>RequireHttps</em>. Most of the times the wrapped mapper will be the root one, just like we saw before for <em>CryptoMapper</em> in  <a href="#guide:urls_6">paragraph 10.6</a>
.</p>
</div>
<div class="paragraph">
<p>Another parameter needed to build a <em>HttpsMapper</em> is an instance of class 'HttpsConfi&#8217;g. This class allows us to specify which ports must be used for HTTPS and HTTP. By default the port numbers used by these two protocols are respectively 443 and 80.</p>
</div>
<div class="paragraph">
<p>The following code is taken from project <em>HttpsProtocolExample</em> and illustrates how to enable HTTPS  in our applications:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//Application class code...</span>
<span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">(){</span>
   <span class="tok-n">setRootRequestMapper</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">HttpsMapper</span><span class="tok-o">(</span><span class="tok-n">getRootRequestMapper</span><span class="tok-o">(),</span>
                                       <span class="tok-k">new</span> <span class="tok-n">HttpsConfig</span><span class="tok-o">(</span><span class="tok-mi">8080</span><span class="tok-o">,</span> <span class="tok-mi">443</span><span class="tok-o">)));</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we can use annotation RequireHttps to specify which pages must be served using HTTPS:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@RequireHttps</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    	<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">parameters</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we want to protect many pages with HTTPS without adding annotation <em>RequireHttps</em> to each of them, we can annotate a marker interface or a base page class and implement/extend it in any page we want to make secure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">// Marker interface:</span>
<span class="tok-nd">@RequireHttps</span>
<span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">IMarker</span><span class="tok-o">{</span>
<span class="tok-o">}</span>

<span class="tok-c1">// Base class:</span>
<span class="tok-nd">@RequireHttps</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BaseClass</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span><span class="tok-o">{</span>
<span class="tok-c1">//Page code...</span>
<span class="tok-o">}</span>

<span class="tok-c1">// Secure page inheriting from BaseClass:</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HttpsPage</span> <span class="tok-kd">extends</span> <span class="tok-n">BaseClass</span><span class="tok-o">{</span>
<span class="tok-c1">//Page code...</span>
<span class="tok-o">}</span>

<span class="tok-c1">// Secure page implementing IMarker:</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HttpsPage</span> <span class="tok-kd">implements</span> <span class="tok-n">IMarker</span><span class="tok-o">{</span>
<span class="tok-c1">//Page code...</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_urls_encryption_in_detail">URLs encryption in detail</h3>
<div class="paragraph">
<p>In chapter  <a href="#guide:urls_6">10.6</a>
 we have seen how to encrypt URLs using <em>CryptoMapper</em> request mapper. To encrypt/decrypt page URLs <em>CryptoMapper</em> uses an instance of <em>org.apache.wicket.util.crypt.ICrypt</em> interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">ICrypt</span>
<span class="tok-o">{</span>
	<span class="tok-n">String</span> <span class="tok-nf">encryptUrlSafe</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">plainText</span><span class="tok-o">);</span>

	<span class="tok-n">String</span> <span class="tok-nf">decryptUrlSafe</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">encryptedText</span><span class="tok-o">);</span>

	<span class="tok-o">...</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default implementation for this interface is class <em>org.apache.wicket.util.crypt.SunJceCrypt</em>. It provides password-based cryptography using <em>PBEWithMD5AndDES</em> algorithm coming with the standard security providers in the Java Runtime Environment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
For better security it is recommended to install Java Cryptography Extension (JCE) Unlimited Strength Jurisdiction <a href="http://www.oracle.com/technetwork/java/javase/downloads/jce-7-download-432124.html">Policy Files</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By using <em>CryptoMapper(IRequestMapper wrappedMapper, Application application)</em> constructor the mapper will use the configured <em>org.apache.wicket.util.crypt.ICryptFactory</em> from <em>org.apache.wicket.settings.SecuritySettings1.getCryptFactory()</em>. To use a stronger cryptography mechanism there are the following options:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first option is to use constructor <em>CryptoMapper(IRequestMapper wrappedMapper, IProvider&lt;ICrypt&gt; cryptProvider)</em> and give it an implementation of <em>org.apache.wicket.util.IProvider</em> that returns a custom <em>org.apache.wicket.util.crypt.ICrypt</em>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<em>org.apache.wicket.util.IProvider</em> is a single-method interface that acts as object supplier:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">IProvider</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span>
<span class="tok-o">{</span>
	<span class="tok-n">T</span> <span class="tok-nf">get</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The second option is to register a cipher factory at application level with method <em>setCryptFactory(ICryptFactory cryptFactory)</em> of class <em>SecuritySettings</em>:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span> <span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>
	<span class="tok-n">getSecuritySettings</span><span class="tok-o">().</span><span class="tok-na">setCryptFactory</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">SomeCryptFactory</span><span class="tok-o">());</span>
	<span class="tok-n">setRootRequestMapper</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">CryptoMapper</span><span class="tok-o">(</span><span class="tok-n">getRootRequestMapper</span><span class="tok-o">(),</span> <span class="tok-k">this</span><span class="tok-o">));</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since version 6.19.0 Wicket uses <em>org.apache.wicket.core.util.crypt.KeyInSessionSunJceCryptFactory</em> as a default factory for <em>ICrypt</em> objects. This factory generates a unique key for each user that is stored in her HTTP
session. This way it helps to protect the application against <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)">CSRF</a>
for each user of the application. The url itself serves as <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet#Encrypted_Token_Pattern">encrypted token</a></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
<em>org.apache.wicket.core.util.crypt.KeyInSessionSunJceCryptFactory</em> binds the http session if it is not already bound! If the application needs to run in stateless mode then the application will have to provide a custom
implementation of <em>ICryptFactory</em> that stores the user specific keys by other means.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_package_resource_guard">Package Resource Guard</h3>
<div class="paragraph">
<p>Wicket internally uses an entity called package resource guard to protect package resources from external access. This entity is an implementation of interface <em>org.apache.wicket.markup.html.IPackageResourceGuard</em>.</p>
</div>
<div class="paragraph">
<p>By default Wicket applications use as package resource guard class <em>SecurePackageResourceGuard</em>, which allows to access only to the following file extensions (grouped by type):</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">File</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Extensions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>JavaScript files</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.js</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CSS files</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.css</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HTML pages</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.html</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Textual files</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.txt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Flash files</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.swf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Picture files</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.png, .jpg, .jpeg, .gif, .ico, .cur, .bmp, .svg</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Web font files</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">.eot, .ttf, .woff</p></td>
</tr>
</tbody>
</table>

<div class="paragraph">
<p>To modify the set of allowed files formats we can add one or more patterns with method <em>addPattern(String)</em>. The rules to write a pattern are the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>patterns start with either a  [+] r a  [-] n the first case the pattern will add one or more file to the set while starting a pattern with a “-” we exclude all the files matching the given pattern. For example pattern “-web.xml” excludes all web.xml files in all directories.</p>
</li>
<li>
<p>wildcard character “*” is supported as placeholder for zero or more characters. For example  pattern “+\*.mp4” adds all the mp4 files inside all directories.</p>
</li>
<li>
<p>subdirectories are supported as well. For example pattern “+documents/*.pdf” adds all pdf files under “documents” directory. Character “\*” can be used with directories to specify a nesting level. For example “+documents/*/\*.pdf” adds all pdf files placed one level below “documents” directory.</p>
</li>
<li>
<p>a double wildcard character “*\*” indicates zero or more subdirectories. For example pattern “+documents/*\*/\*.pdf” adds all pdf files placed inside “documents” directory or inside any of its subdirectories.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Patterns that allow to access to every file with a given extensions (such as “+\*.pdf”) should be always avoided in favour of more restrictive expressions that contain a directory structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//Application class code...</span>
<span class="tok-nd">@Override</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
      <span class="tok-n">IPackageResourceGuard</span> <span class="tok-n">packageResourceGuard</span> <span class="tok-o">=</span> <span class="tok-n">application</span><span class="tok-o">.</span><span class="tok-na">getResourceSettings</span><span class="tok-o">()</span>
                                                   <span class="tok-o">.</span><span class="tok-na">getPackageResourceGuard</span><span class="tok-o">();</span>
      <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">packageResourceGuard</span> <span class="tok-k">instanceof</span> <span class="tok-n">SecurePackageResourceGuard</span><span class="tok-o">)</span>
      <span class="tok-o">{</span>
         <span class="tok-n">SecurePackageResourceGuard</span> <span class="tok-n">guard</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">SecurePackageResourceGuard</span><span class="tok-o">)</span> <span class="tok-n">packageResourceGuard</span><span class="tok-o">;</span>
         <span class="tok-c1">//Allow to access only to pdf files placed in the “public” directory.</span>
         <span class="tok-n">guard</span><span class="tok-o">.</span><span class="tok-na">addPattern</span><span class="tok-o">(</span><span class="tok-s">&quot;+public/*.pdf&quot;</span><span class="tok-o">);</span>
      <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_18">Summary</h3>
<div class="literalblock">
<div class="content">
<pre>In this chapter we have seen the components and the mechanisms that allow us to implement security policies in our Wicket-based applications. Wicket comes with an out of the box support for both authorization and authentication.</pre>
</div>
</div>
<div class="paragraph">
<p>The central element of authorization mechanism is the interface <em>IAuthorizationStrategy</em> which decouples our components from any detail about security strategy. The implementations of this interface must decide if a user is allowed to instantiate a given page or component and if she/he can perform a given action on it.</p>
</div>
<div class="paragraph">
<p>Wicket natively supports role-based authorizations with strategies <em>MetaDataRoleAuthorizationStrategy</em> and <em>AnnotationsRoleAuthorizationStrategy</em>. The difference between these two strategies is that the first offers a programmatic approach for role handling while the second promotes a declarative approach using built-in annotations.</p>
</div>
<div class="paragraph">
<p>After having explored how Wicket internally implements authentication and authorization, in the last part of the chapter we have learnt how to configure our applications to support HTTPS and how to specify which pages must be served over this protocol.</p>
</div>
<div class="paragraph">
<p>In the last paragraph we have seen how Wicket protects package resources with a guard entity that allows us to decide which package resources can be accessed from users.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_test_driven_development_with_wicket">Test Driven Development with Wicket</h2>
<div class="sectionbody">
<div class="literalblock">
<div class="content">
<pre>st[] riven Development ttp://en.wikipedia.org/wiki/Test-driven_development[] as become a crucial activity for every modern development methodology. This chapter will cover the built-in support for testing provided by Wicket with its rich set of helper and mock classes that allows us to test our components and our applications in isolation (i.e without the need for a servlet container) using JUnit, the de facto standard for Java unit testing.</pre>
</div>
</div>
<div class="paragraph">
<p>In this chapter we will see how to write unit tests for our applications and components and we will learn how to use helper classes to simulate user navigation and write acceptance tests without the need of any testing framework other than JUnit.</p>
</div>
<div class="paragraph">
<p>The JUnit version used in this chapter is 4.x.</p>
</div>
<div class="sect2">
<h3 id="_utility_class_wickettester">Utility class WicketTester</h3>
<div class="paragraph">
<p>A good way to start getting confident with Wicket unit testing support is looking at the test case class <em>TestHomePage</em> that is automatically generated by Maven when we use Wicket archetype to create a new project:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="mvn-wicket-archetype.png" alt="mvn wicket archetype">
</div>
</div>
<div class="paragraph">
<p>Here is the content of TestHomePage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TestHomePage</span><span class="tok-o">{</span>
	<span class="tok-kd">private</span> <span class="tok-n">WicketTester</span> <span class="tok-n">tester</span><span class="tok-o">;</span>

	<span class="tok-nd">@Before</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setUp</span><span class="tok-o">(){</span>
		<span class="tok-n">tester</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">WicketTester</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">WicketApplication</span><span class="tok-o">());</span>
	<span class="tok-o">}</span>
	<span class="tok-nd">@Test</span>
	<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">homepageRendersSuccessfully</span><span class="tok-o">(){</span>
		<span class="tok-c1">//start and render the test page</span>
		<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">startPage</span><span class="tok-o">(</span><span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
		<span class="tok-c1">//assert rendered page class</span>
		<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">assertRenderedPage</span><span class="tok-o">(</span><span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The central class in a Wicket testing is <em>org.apache.wicket.util.tester.WicketTester</em>. This utility class provides a set of methods to render a component, click links, check if page contains a given component or a feedback message, and so on.</p>
</div>
<div class="paragraph">
<p>The basic test case shipped with <em>TestHomePage</em> illustrates how <em>WicketTester</em> is typically instantiated (inside method <em>setUp()</em>). In order to test our components, WicketTester needs to use an instance of <em>WebApplication</em>. Usually, we will use our application class as <em>WebApplication</em>, but we can also decide to build WicketTester invoking its no-argument constructor and letting it automatically build a mock web application (an instance of class <em>org.apache.wicket.mock.MockApplication</em>).</p>
</div>
<div class="paragraph">
<p>The code from <em>TestHomePage</em> introduces two basic methods to test our pages. The first is method <em>startPage</em> that renders a new instance of the given page class and sets it as current rendered page for WicketTester. The second method is assertRenderedPage which checks if the current rendered page is an instance of the given class. In this way if TestHomePage succeeds we are sure that page HomePage has been rendered without any problem. The last rendered page can be retrieved with method <em>getLastRenderedPage</em>.</p>
</div>
<div class="paragraph">
<p>That&#8217;s only a taste of what <em>WicketTester</em> can do. In the next paragraphs we will see how it can be used to test every element that composes a Wicket page (links, models, behaviors, etc&#8230;).</p>
</div>
</div>
<div class="sect2">
<h3 id="_testing_links">Testing links</h3>
<div class="paragraph">
<p>A click on a Wicket link can be simulated with method <em>clickLink</em> which takes in input the link component or the page-relative path to it.</p>
</div>
<div class="paragraph">
<p>To see an example of usage of clickLink, let&#8217;s consider again project <em>LifeCycleStagesRevisited</em>. As we know from chapter 5 the home page of the project alternately displays two different labels (“First label” and “Second label”), swapping between them each time button  [reload] s clicked. The code from its test case checks that label has actually changed after button  [reload] as been pressed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//...</span>
<span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">switchLabelTest</span><span class="tok-o">(){</span>
	<span class="tok-c1">//start and render the test page</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">startPage</span><span class="tok-o">(</span><span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
	<span class="tok-c1">//assert rendered page class</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">assertRenderedPage</span><span class="tok-o">(</span><span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
	<span class="tok-c1">//assert rendered label</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">assertLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;label&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;First label&quot;</span><span class="tok-o">);</span>
	<span class="tok-c1">//simulate a click on &quot;reload&quot; button</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">clickLink</span><span class="tok-o">(</span><span class="tok-s">&quot;reload&quot;</span><span class="tok-o">);</span>
	<span class="tok-c1">//assert rendered label</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">assertLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;label&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;Second label&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-c1">//...</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code above we have used <em>clickLink</em> to click on the  [reload] utton and force page to be rendered again. In addition, we have used also method <em>assertLabel</em> that checks if a given label contains the expected text.</p>
</div>
<div class="paragraph">
<p>By default <em>clickLink</em> assumes that AJAX is enabled on client side. To switch AJAX off we can use another version of this method that takes in input the path to the link component and a boolean flag that indicates if AJAX must be enabled (true) or not (false).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//...</span>
<span class="tok-c1">//simulate a click on a button without AJAX support</span>
<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">clickLink</span><span class="tok-o">(</span><span class="tok-s">&quot;reload&quot;</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="tok-c1">//...</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_component_status">Testing component status</h3>
<div class="paragraph">
<p>WicketTester provides also a set of methods to test the states of a component. They are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>assertEnabled(String path)/assertDisabled(String path)</strong>: they test if a component is enabled or not.</p>
</li>
<li>
<p><strong>assertVisible(String path)/assertInvisible(String path)</strong>: they test component visibility.</p>
</li>
<li>
<p><strong>assertRequired(String path)</strong>: checks if a form component is required.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the test case from project <em>CustomDatepickerAjax</em> we used <em>assertEnabled</em>/<em>assertDisabled</em> to check if button  [update] eally disables our datepicker:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//...</span>
<span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testDisableDatePickerWithButton</span><span class="tok-o">(){</span>
	<span class="tok-c1">//start and render the test page</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">startPage</span><span class="tok-o">(</span><span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
	<span class="tok-c1">//assert that datepicker is enabled</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">assertEnabled</span><span class="tok-o">(</span><span class="tok-s">&quot;form:datepicker&quot;</span><span class="tok-o">);</span>
	<span class="tok-c1">//click on update button to disable datepicker</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">clickLink</span><span class="tok-o">(</span><span class="tok-s">&quot;update&quot;</span><span class="tok-o">);</span>
	<span class="tok-c1">//assert that datepicker is disabled</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">assertDisabled</span><span class="tok-o">(</span><span class="tok-s">&quot;form:datepicker&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-c1">//...</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_components_in_isolation">Testing components in isolation</h3>
<div class="paragraph">
<p>Method <em>startComponent(Component)</em> can be used to test a component in isolation without having to create a container page for this purpose. The target component is rendered and both its methods <em>onInitialize()</em> and <em>onBeforeRender()</em> are executed. In the test case from project <em>CustomFormComponentPanel</em> we used this method to check if our custom form component correctly renders its internal label:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//...</span>
<span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testCustomPanelContainsLabel</span><span class="tok-o">(){</span>
	<span class="tok-n">TemperatureDegreeField</span> <span class="tok-n">field</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TemperatureDegreeField</span><span class="tok-o">(</span><span class="tok-s">&quot;field&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-mf">0.00</span><span class="tok-o">));</span>
	<span class="tok-c1">//Use standard JUnit class Assert</span>
	<span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertNull</span><span class="tok-o">(</span><span class="tok-n">field</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s">&quot;mesuramentUnit&quot;</span><span class="tok-o">));</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">startComponent</span><span class="tok-o">(</span><span class="tok-n">field</span><span class="tok-o">);</span>
	<span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">field</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s">&quot;mesuramentUnit&quot;</span><span class="tok-o">));</span>
<span class="tok-o">}</span>
<span class="tok-c1">//...</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If test requires a page we can use <em>startComponentInPage(Component)</em> which automatically generates a page for our component.</p>
</div>
</div>
<div class="sect2">
<h3 id="_testing_the_response">Testing the response</h3>
<div class="paragraph">
<p><em>WicketTester</em> allows us to access to the last response generated during testing with method <em>getLastResponse</em>. The returned value is an instance of class MockHttpServletResponse that provides helper methods to extract informations from mocked request.</p>
</div>
<div class="paragraph">
<p>In the test case from project <em>CustomResourceMounting</em> we extract the text contained in the last response with method <em>getDocument</em> and we check if it is equal to the RSS feed used for the test:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//...</span>
<span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testMountedResourceResponse</span><span class="tok-o">()</span> <span class="tok-kd">throws</span> <span class="tok-n">IOException</span><span class="tok-o">,</span> <span class="tok-n">FeedException</span><span class="tok-o">{</span><span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">startResource</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">RSSProducerResource</span><span class="tok-o">());</span>
	<span class="tok-n">String</span> <span class="tok-n">responseTxt</span> <span class="tok-o">=</span> <span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">getLastResponse</span><span class="tok-o">().</span><span class="tok-na">getDocument</span><span class="tok-o">();</span>
	<span class="tok-c1">//write the RSS feed used in the test into a ByteArrayOutputStream</span>
	<span class="tok-n">ByteArrayOutputStream</span> <span class="tok-n">outputStream</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ByteArrayOutputStream</span><span class="tok-o">();</span>
	<span class="tok-n">Writer</span> <span class="tok-n">writer</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">OutputStreamWriter</span><span class="tok-o">(</span><span class="tok-n">outputStream</span><span class="tok-o">);</span>
	<span class="tok-n">SyndFeedOutput</span> <span class="tok-n">output</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">SyndFeedOutput</span><span class="tok-o">();</span>

	<span class="tok-n">output</span><span class="tok-o">.</span><span class="tok-na">output</span><span class="tok-o">(</span><span class="tok-n">RSSProducerResource</span><span class="tok-o">.</span><span class="tok-na">getFeed</span><span class="tok-o">(),</span> <span class="tok-n">writer</span><span class="tok-o">);</span>
	<span class="tok-c1">//the response and the RSS must be equal</span>
	<span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-n">responseTxt</span><span class="tok-o">,</span> <span class="tok-n">outputStream</span><span class="tok-o">.</span><span class="tok-na">toString</span><span class="tok-o">());</span>
<span class="tok-o">}</span>
<span class="tok-c1">//...</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To simulate a request to the custom resource we used method <em>startResource</em> which can be used also with resource references.</p>
</div>
</div>
<div class="sect2">
<h3 id="_testing_urls">Testing URLs</h3>
<div class="paragraph">
<p><em>WicketTester</em> can be pointed to an arbitrary URL with method <em>executeUrl(String url)</em>. This can be useful to test mounted pages, resources or request mappers:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//...</span>
<span class="tok-c1">//the resource was mapped at &#39;/foo/bar&#39;</span>
<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">executeUrl</span><span class="tok-o">(</span><span class="tok-s">&quot;./foo/bar&quot;</span><span class="tok-o">);</span>
<span class="tok-c1">//...</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_ajax_components">Testing AJAX components</h3>
<div class="paragraph">
<p>If our application uses AJAX to refresh components markup, we can test if <em>AjaxRequestTarget</em> contains a given component with <em>WicketTester</em>'s method <em>assertComponentOnAjaxResponse</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//...</span>
<span class="tok-c1">//test if AjaxRequestTarget contains a component (using its instance)</span>
<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">assertComponentOnAjaxResponse</span><span class="tok-o">(</span><span class="tok-n">amountLabel</span><span class="tok-o">);</span>
<span class="tok-c1">//...</span>
<span class="tok-c1">//test if AjaxRequestTarget contains a component (using its path)</span>
<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">assertComponentOnAjaxResponse</span><span class="tok-o">(</span><span class="tok-s">&quot;pathToLabel:labelId&quot;</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>It&#8217;s also possible to use method <em>isComponentOnAjaxResponse(Component cmp)</em> to know if a component has been added to <em>AjaxRequestTarget</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//...</span>
<span class="tok-c1">//test if AjaxRequestTarget does NOT contain amountLabel</span>
<span class="tok-n">assertFalse</span><span class="tok-o">(</span><span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">isComponentOnAjaxResponse</span><span class="tok-o">(</span><span class="tok-n">amountLabel</span><span class="tok-o">));</span>
<span class="tok-c1">//...</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_ajax_events">Testing AJAX events</h3>
<div class="paragraph">
<p>Behavior <em>AjaxEventBehavior</em> and its subclasses can be tested simulating AJAX events with <em>WicketTester</em>'s method <em>executeAjaxEvent(Component cmp, String event)</em>. Here is the sample code from project <em>TestAjaxEventsExample</em>:</p>
</div>
<div class="paragraph">
<p><strong>Home page code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">HomePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
 <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">String</span> <span class="tok-n">INIT_VALUE</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Initial value&quot;</span><span class="tok-o">;</span>
 <span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">String</span> <span class="tok-n">OTHER_VALUE</span> <span class="tok-o">=</span> <span class="tok-s">&quot;Other value&quot;</span><span class="tok-o">;</span>

 <span class="tok-kd">public</span> <span class="tok-nf">HomePage</span><span class="tok-o">(</span><span class="tok-kd">final</span> <span class="tok-n">PageParameters</span> <span class="tok-n">parameters</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">parameters</span><span class="tok-o">);</span>
	<span class="tok-n">Label</span> <span class="tok-n">label</span><span class="tok-o">;</span>
	<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">label</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;label&quot;</span><span class="tok-o">,</span> <span class="tok-n">INIT_VALUE</span><span class="tok-o">));</span>
	<span class="tok-n">label</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">AjaxEventBehavior</span><span class="tok-o">(</span><span class="tok-s">&quot;click&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>

		<span class="tok-nd">@Override</span>
		<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onEvent</span><span class="tok-o">(</span><span class="tok-n">AjaxRequestTarget</span> <span class="tok-n">target</span><span class="tok-o">)</span> <span class="tok-o">{</span>
			<span class="tok-c1">//change label&#39;s data object</span>
			<span class="tok-n">getComponent</span><span class="tok-o">().</span><span class="tok-na">setDefaultModelObject</span><span class="tok-o">(</span>
                                                  <span class="tok-n">OTHER_VALUE</span><span class="tok-o">);</span>
			<span class="tok-n">target</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">getComponent</span><span class="tok-o">());</span>
		<span class="tok-o">}</span>
	<span class="tok-o">}).</span><span class="tok-na">setOutputMarkupId</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
	<span class="tok-c1">//...</span>
 <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Test method:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testAjaxBehavior</span><span class="tok-o">(){</span>
	<span class="tok-c1">//start and render the test page</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">startPage</span><span class="tok-o">(</span><span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
	<span class="tok-c1">//test if label has the initial expected value</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">assertLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;label&quot;</span><span class="tok-o">,</span> <span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">INIT_VALUE</span><span class="tok-o">);</span>
	<span class="tok-c1">//simulate an AJAX &quot;click&quot; event</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">executeAjaxEvent</span><span class="tok-o">(</span><span class="tok-s">&quot;label&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;click&quot;</span><span class="tok-o">);</span>
	<span class="tok-c1">//test if label has changed as expected</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">assertLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;label&quot;</span><span class="tok-o">,</span> <span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">OTHER_VALUE</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_ajax_behaviors">Testing AJAX behaviors</h3>
<div class="paragraph">
<p>To test a generic AJAX behavior we can simulate a request to it using <em>WicketTester</em>'s method <em>executeBehavior(AbstractAjaxBehavior behavior)</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//...</span>
<span class="tok-n">AjaxFormComponentUpdatingBehavior</span> <span class="tok-n">ajaxBehavior</span> <span class="tok-o">=</span>
		<span class="tok-k">new</span> <span class="tok-n">AjaxFormComponentUpdatingBehavior</span><span class="tok-o">(</span><span class="tok-s">&quot;change&quot;</span><span class="tok-o">){</span>
	<span class="tok-nd">@Override</span>
	<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onUpdate</span><span class="tok-o">(</span><span class="tok-n">AjaxRequestTarget</span> <span class="tok-n">target</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-c1">//...</span>
	<span class="tok-o">}</span>
<span class="tok-o">};</span>
<span class="tok-n">component</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">ajaxBehavior</span><span class="tok-o">);</span>
<span class="tok-c1">//...</span>
<span class="tok-c1">//execute AJAX behavior, i.e. onUpdate will be invoked</span>
<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">executeBehavior</span><span class="tok-o">(</span><span class="tok-n">ajaxBehavior</span><span class="tok-o">));</span>
<span class="tok-c1">//...</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_a_custom_servlet_context">Using a custom servlet context</h3>
<div class="paragraph">
<p>In  <a href="#guide:resources_13">paragraph 16.13</a>
 we have seen how to configure our application to store resource files into a custom folder placed inside webapp root folder (see project <em>CustomFolder4MarkupExample</em>).</p>
</div>
<div class="paragraph">
<p>In order to write testing code for applications that use this kind of customization, we must tell <em>WicketTester</em> which folder to use as webapp root. This is necessary as under test environment we don&#8217;t have any web server, hence it&#8217;s impossible for <em>WicketTester</em> to retrieve this parameter from servlet context.</p>
</div>
<div class="paragraph">
<p>Webapp root folder can be passed to <em>WicketTester</em>'s constructor as further parameter like we did in the test case of project <em>CustomFolder4MarkupExample</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">TestHomePage</span><span class="tok-o">{</span>
   <span class="tok-kd">private</span> <span class="tok-n">WicketTester</span> <span class="tok-n">tester</span><span class="tok-o">;</span>

   <span class="tok-nd">@Before</span>
   <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setUp</span><span class="tok-o">(){</span>
      <span class="tok-c1">//build the path to webapp root folder</span>
      <span class="tok-n">File</span> <span class="tok-n">curDirectory</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span><span class="tok-n">System</span><span class="tok-o">.</span><span class="tok-na">getProperty</span><span class="tok-o">(</span><span class="tok-s">&quot;user.dir&quot;</span><span class="tok-o">));</span>
      <span class="tok-n">File</span> <span class="tok-n">webContextDir</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">File</span><span class="tok-o">(</span><span class="tok-n">curDirectory</span><span class="tok-o">,</span> <span class="tok-s">&quot;src/main/webapp&quot;</span><span class="tok-o">);</span>

      <span class="tok-n">tester</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">WicketTester</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">WicketApplication</span><span class="tok-o">(),</span> <span class="tok-n">webContextDir</span><span class="tok-o">.</span><span class="tok-na">getAbsolutePath</span><span class="tok-o">());</span>
   <span class="tok-o">}</span>
   <span class="tok-c1">//test methods...</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
After a test method has been executed, we may need to clear any possible side effect occurred to the <em>Application</em> and <em>Session</em> objects. This can be done invoking <em>WicketTester</em>'s method <em>destroy()</em>:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@After</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">tearDown</span><span class="tok-o">(){</span>
	<span class="tok-c1">//clear any side effect occurred during test.</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">destroy</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_wicket_forms">Testing Wicket forms</h3>
<div class="paragraph">
<p>Wicket provides utility class FormTester that is expressly designed to test Wicket forms. A new FormTester is returned by <em>WicketTester</em>'s method <em>newFormTester(String, boolean)</em> which takes in input the page-relative path of the form we want to test and a boolean flag indicating if its form components must be filled with a blank string:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//...</span>
<span class="tok-c1">//create a new form tester without filling its form components with a blank string</span>
<span class="tok-n">FormTester</span> <span class="tok-n">formTester</span> <span class="tok-o">=</span> <span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">newFormTester</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="tok-c1">//...</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>FormTester</em> can simulate form submission with method submit which takes in input as optional parameter the submitting component to use instead of the default one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">//...</span>
<span class="tok-c1">//create a new form tester without filling its form components with a blank string</span>
<span class="tok-n">FormTester</span> <span class="tok-n">formTester</span> <span class="tok-o">=</span> <span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">newFormTester</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="tok-c1">//submit form with default submitter</span>
<span class="tok-n">formTester</span><span class="tok-o">.</span><span class="tok-na">submit</span><span class="tok-o">();</span>
<span class="tok-c1">//...</span>
<span class="tok-c1">//submit form using inner component &#39;button&#39; as alternate button</span>
<span class="tok-n">formTester</span><span class="tok-o">.</span><span class="tok-na">submit</span><span class="tok-o">(</span><span class="tok-s">&quot;button&quot;</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we want to submit a form with an external link component we can use method <em>submitLink(String path, boolean pageRelative)</em> specifying the path to the link.</p>
</div>
<div class="paragraph">
<p>In the next paragraphs we will see how to use <em>WicketTester</em> and <em>FormTester</em> to interact with a form and with its children components.</p>
</div>
</div>
<div class="sect2">
<h3 id="_setting_form_components_input">Setting form components input</h3>
<div class="paragraph">
<p>The purpose of a HTML form is to collect user input. <em>FormTester</em> comes with the following set of methods that simulate input insertion into form&#8217;s fields:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>setValue(String path, String value)</strong>: inserts the given textual value into the specified component. It can be used with components <em>TextField</em> and <em>TextArea</em>. A version of this method that accepts a component instance instead of its path is also available.</p>
</li>
<li>
<p><strong>setValue(String checkboxId, boolean value)</strong>: sets the value of a given <em>CheckBox</em> component.</p>
</li>
<li>
<p><strong>setFile(String formComponentId, File file, String contentType)</strong>: sets a <em>File</em> object on a <em>FileUploadField</em> component.</p>
</li>
<li>
<p><strong>select(String formComponentId, int index)</strong>: selects an option among a list of possible options owned by a component. It supports components that are subclasses of <em>AbstractChoice</em> along with <em>RadioGroup</em> and <em>CheckGroup</em>.</p>
</li>
<li>
<p><strong>selectMultiple(String formComponentId, int &lt;&lt;&gt;&gt;
indexes)</strong>: selects all the options corresponding to the given array of indexes. It can be used with multiple-choice components like <em>CheckGroup</em> or <em>ListMultipleChoice</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>setValue</em> is used inside method <em>insertUsernamePassword</em> to set the username and password fields of the form used in project <em>StatelessLoginForm</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">insertUsernamePassword</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">username</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">password</span><span class="tok-o">)</span> <span class="tok-o">{</span>
	<span class="tok-c1">//start and render the test page</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">startPage</span><span class="tok-o">(</span><span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
	<span class="tok-n">FormTester</span> <span class="tok-n">formTester</span> <span class="tok-o">=</span> <span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">newFormTester</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">);</span>
	<span class="tok-c1">//set credentials</span>
	<span class="tok-n">formTester</span><span class="tok-o">.</span><span class="tok-na">setValue</span><span class="tok-o">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-o">,</span> <span class="tok-n">username</span><span class="tok-o">);</span>
	<span class="tok-n">formTester</span><span class="tok-o">.</span><span class="tok-na">setValue</span><span class="tok-o">(</span><span class="tok-s">&quot;password&quot;</span><span class="tok-o">,</span> <span class="tok-n">password</span><span class="tok-o">);</span>
	<span class="tok-c1">//submit form</span>
	<span class="tok-n">formTester</span><span class="tok-o">.</span><span class="tok-na">submit</span><span class="tok-o">();</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_feedback_messages">Testing feedback messages</h3>
<div class="paragraph">
<p>To check if a page contains one or more expected feedback messages we can use the following methods provided by <em>WicketTester</em>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>assertFeedback(String path, String&#8230; messages)</strong>: asserts that a given panel contains the specified messages</p>
</li>
<li>
<p><strong>assertInfoMessages(String&#8230; expectedInfoMessages)</strong>: asserts that the expected info messages are rendered in the page.</p>
</li>
<li>
<p><strong>assertErrorMessages(String&#8230; expectedErrorMessages)</strong>: asserts that the expected error messages are rendered in the page.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>assertInfoMessages</em> and <em>assertErrorMessages</em> are used in the test case from project <em>StatelessLoginForm</em> to check that form generates a feedback message in accordance with the login result:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testMessageForSuccessfulLogin</span><span class="tok-o">(){</span>
	<span class="tok-n">inserUsernamePassword</span><span class="tok-o">(</span><span class="tok-s">&quot;user&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;user&quot;</span><span class="tok-o">);</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">assertInfoMessages</span><span class="tok-o">(</span><span class="tok-s">&quot;Username and password are correct!&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>

<span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testMessageForFailedLogin</span> <span class="tok-o">(){</span>
	<span class="tok-n">inserUsernamePassword</span><span class="tok-o">(</span><span class="tok-s">&quot;wrongCredential&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;wrongCredential&quot;</span><span class="tok-o">);</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">assertErrorMessages</span><span class="tok-o">(</span><span class="tok-s">&quot;Wrong username or password&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_models">Testing models</h3>
<div class="paragraph">
<p>Component model can be tested as well. With method <em>assertModelValue</em> we can test if a specific component has the expected data object inside its model.</p>
</div>
<div class="paragraph">
<p>This method has been used in the test case of project <em>ModelChainingExample</em> to check if the form and the drop-down menu share the same data object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testFormSelectSameModelObject</span><span class="tok-o">(){</span>
	<span class="tok-n">PersonListDetails</span> <span class="tok-n">personListDetails</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">PersonListDetails</span><span class="tok-o">();</span>
	<span class="tok-n">DropDownChoice</span> <span class="tok-n">dropDownChoice</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">DropDownChoice</span><span class="tok-o">)</span> <span class="tok-n">personListDetails</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-s">&quot;persons&quot;</span><span class="tok-o">);</span>
	<span class="tok-n">List</span> <span class="tok-n">choices</span> <span class="tok-o">=</span> <span class="tok-n">dropDownChoice</span><span class="tok-o">.</span><span class="tok-na">getChoices</span><span class="tok-o">();</span>
	<span class="tok-c1">//select the second option of the drop-down menu</span>
	<span class="tok-n">dropDownChoice</span><span class="tok-o">.</span><span class="tok-na">setModelObject</span><span class="tok-o">(</span><span class="tok-n">choices</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">(</span><span class="tok-mi">1</span><span class="tok-o">));</span>

	<span class="tok-c1">//start and render the test page</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">startPage</span><span class="tok-o">(</span><span class="tok-n">personListDetails</span><span class="tok-o">);</span>
	<span class="tok-c1">//assert that form has the same data object used by drop-down menu</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">assertModelValue</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">,</span> <span class="tok-n">dropDownChoice</span><span class="tok-o">.</span><span class="tok-na">getModelObject</span><span class="tok-o">());</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_testing_markup_with_tagtester">Testing markup with TagTester</h3>
<div class="paragraph">
<p>If we need to test component markup at a more fine-grained level, we can use class <em>TagTester</em> from package <em>org.apache.wicket.util.tester</em>.</p>
</div>
<div class="paragraph">
<p>This test class allows to check if the generated markup contains one or more tags having a given attribute with a given value. TagTester can not be directly instantiated but it comes with three factory methods that return one or more TagTester matching the searching criteria. In the following test case (from project <em>TagTesterExample</em>) we retrieve the first tag of the home page (a &lt;span&gt; tag) having attribute class equal to myClass:</p>
</div>
<div class="paragraph">
<p><strong>HomePage markup:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html</span> <span class="tok-na">xmlns:wicket=</span><span class="tok-s">&quot;http://wicket.apache.org&quot;</span><span class="tok-nt">&gt;</span>
	<span class="tok-nt">&lt;head&gt;</span>
		<span class="tok-nt">&lt;meta</span> <span class="tok-na">charset=</span><span class="tok-s">&quot;utf-8&quot;</span> <span class="tok-nt">/&gt;</span>
		<span class="tok-nt">&lt;title&gt;&lt;/title&gt;</span>
	<span class="tok-nt">&lt;/head&gt;</span>
	<span class="tok-nt">&lt;body&gt;</span>
		<span class="tok-nt">&lt;span</span> <span class="tok-na">class=</span><span class="tok-s">&quot;myClass&quot;</span><span class="tok-nt">&gt;&lt;/span&gt;</span>
		<span class="tok-nt">&lt;div</span> <span class="tok-na">class=</span><span class="tok-s">&quot;myClass&quot;</span><span class="tok-nt">&gt;&lt;/div&gt;</span>
	<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Test method:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">homePageMarkupTest</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
	<span class="tok-c1">//start and render the test page</span>
	<span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">startPage</span><span class="tok-o">(</span><span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
	<span class="tok-c1">//retrieve response&#39;s markup</span>
	<span class="tok-n">String</span> <span class="tok-n">responseTxt</span> <span class="tok-o">=</span> <span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">getLastResponse</span><span class="tok-o">().</span><span class="tok-na">getDocument</span><span class="tok-o">();</span>

	<span class="tok-n">TagTester</span> <span class="tok-n">tagTester</span> <span class="tok-o">=</span> <span class="tok-n">TagTester</span><span class="tok-o">.</span><span class="tok-na">createTagByAttribute</span><span class="tok-o">(</span><span class="tok-n">responseTxt</span><span class="tok-o">,</span> <span class="tok-s">&quot;class&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;myClass&quot;</span><span class="tok-o">);</span>

	<span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertNotNull</span><span class="tok-o">(</span><span class="tok-n">tagTester</span><span class="tok-o">);</span>
	<span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-s">&quot;span&quot;</span><span class="tok-o">,</span> <span class="tok-n">tagTester</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">());</span>

	<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">TagTester</span><span class="tok-o">&gt;</span> <span class="tok-n">tagTesterList</span> <span class="tok-o">=</span> <span class="tok-n">TagTester</span><span class="tok-o">.</span><span class="tok-na">createTagsByAttribute</span><span class="tok-o">(</span><span class="tok-n">responseTxt</span><span class="tok-o">,</span>
						<span class="tok-s">&quot;class&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;myClass&quot;</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">);</span>

	<span class="tok-n">Assert</span><span class="tok-o">.</span><span class="tok-na">assertEquals</span><span class="tok-o">(</span><span class="tok-mi">2</span><span class="tok-o">,</span> <span class="tok-n">tagTesterList</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">());</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The name of the tag found by TagTester can be retrieved with its method getName. Method <em>createTagsByAttribute</em> returns all the tags that have the given value on the class attribute. In the code above we have used this method to test that our markup contains two tags having attribute class equal to myClass.</p>
</div>
<div class="paragraph">
<p>Another utility class that comes in handy when we want to test components markup is <em>ComponentRenderer</em> in package <em>org.apache.wicket.core.util.string</em>. The purpose of this class is to render a page or a component in isolation with its static methods <em>renderComponent</em> and <em>renderPage</em>. Both methods return the generated markup as <em>CharSequence</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">customComponentMarkupTest</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
	<span class="tok-c1">//instantiate MyComponent</span>
	<span class="tok-n">MyComponent</span> <span class="tok-n">myComponent</span> <span class="tok-o">=</span> <span class="tok-c1">//...</span>

	<span class="tok-c1">//render and save component markup</span>
	<span class="tok-n">String</span> <span class="tok-n">componentMarkup</span> <span class="tok-o">=</span> <span class="tok-n">ComponentRenderer</span><span class="tok-o">.</span><span class="tok-na">renderComponent</span><span class="tok-o">(</span><span class="tok-n">myComponent</span><span class="tok-o">);</span>

	<span class="tok-c1">//perform test operations</span>
	<span class="tok-c1">//...</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_19">Summary</h3>
<div class="paragraph">
<p>With a component-oriented framework we can test our pages and components as we use to do with any other Java entity. Wicket offers a complete support for writing testing code, offering built-in tools to test nearly all the elements that build up our applications (pages, containers, links, behaviors, etc&#8230;).</p>
</div>
<div class="paragraph">
<p>The main entity discussed in this chapter has been class <em>WicketTester</em> which can be used to write unit tests and acceptance tests for our application, but we have also seen how to test forms with <em>FormTester</em> and how to inspect markup with <em>TagTester</em>.</p>
</div>
<div class="paragraph">
<p>In addition to learning how to use the utility classes provided by Wicket for testing, we have also experienced the innovative approach of Wicket to web testing that allows to test components in isolation without the need of running our tests with a web server and depending only on JUnit as testing framework.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_test_driven_development_with_wicket_and_spring">Test Driven Development with Wicket and Spring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Since the development of many web applications is mostly based on the Spring framework for dependency injection and application configuration in general, it&#8217;s especially important to get these two frameworks running together smoothly not only when deployed on a running server instance itself but rather during the execution of JUnit based integration tests as well. Thanks to the <em>WicketTester</em> API provided by the Wicket framework itself, one can easily build high-quality web applications while practicing test driven development and providing a decent set of unit and integration tests to be executed with each build. As already mentioned previously, integration and configuration of our web applications is based on a lightweight Spring container meaning that the integration of Spring&#8217;s <em>ApplicationContext</em> and a WicketTester API is essential to get our integration tests running. In order to explain how to achieve that integration in an easy and elegant fashion in your integration test environment, we&#8217;ll first take a look at a configuration of these 2 framework beauties in a runtime environment.</p>
</div>
<div class="sect2">
<h3 id="_configuration_of_the_runtime_environment">Configuration of the runtime environment</h3>
<div class="paragraph">
<p>In order to get the Wicket framework up to speed when your server is up and running, you usually configure a <em>WicketFilter</em> instance in your web application deployment descriptor file (<em>web.xml</em>) while passing it a single init parameter called <em>applicationClassName</em> that points to your main implementation class extending <em>org.apache.wicket.protocol.http.WebApplication</em> where all of your application-wide settings and initialization requirements are dealt with:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="xml language-xml"><span class="tok-nt">&lt;filter&gt;</span>
    <span class="tok-nt">&lt;filter-name&gt;</span>wicketfilter<span class="tok-nt">&lt;/filter-name&gt;</span>
    <span class="tok-nt">&lt;filter-class&gt;</span>org.apache.wicket.protocol.http.WicketFilter<span class="tok-nt">&lt;/filter-class&gt;</span>
    <span class="tok-nt">&lt;init-param&gt;</span>
        <span class="tok-nt">&lt;param-name&gt;</span>applicationClassName<span class="tok-nt">&lt;/param-name&gt;</span>
        <span class="tok-nt">&lt;param-value&gt;</span>com.comsysto.webapp.MyWebApplication<span class="tok-nt">&lt;/param-value&gt;</span>
    <span class="tok-nt">&lt;/init-param&gt;</span>
<span class="tok-nt">&lt;/filter&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case you want to get Wicket application up and running while leaving the application configuration and dependency injection issues to the Spring container, the configuration to be provided within the deployment descriptor looks slightly different though:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="xml language-xml"><span class="tok-nt">&lt;web-app&gt;</span>
    <span class="tok-nt">&lt;filter&gt;</span>
        <span class="tok-nt">&lt;filter-name&gt;</span>wicketfilter<span class="tok-nt">&lt;/filter-name&gt;</span>
        <span class="tok-nt">&lt;filter-class&gt;</span>org.apache.wicket.protocol.http.WicketFilter<span class="tok-nt">&lt;/filter-class&gt;</span>
        <span class="tok-nt">&lt;init-param&gt;</span>
            <span class="tok-nt">&lt;param-name&gt;</span>applicationFactoryClassName<span class="tok-nt">&lt;/param-name&gt;</span>
            <span class="tok-nt">&lt;param-value&gt;</span>org.apache.wicket.spring.SpringWebApplicationFactory<span class="tok-nt">&lt;/param-value&gt;</span>
        <span class="tok-nt">&lt;/init-param&gt;</span>
    <span class="tok-nt">&lt;/filter&gt;</span>
    <span class="tok-nt">&lt;listener&gt;</span>
        <span class="tok-nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tok-nt">&lt;/listener-class&gt;</span>
    <span class="tok-nt">&lt;/listener&gt;</span>
    <span class="tok-nt">&lt;context-param&gt;</span>
        <span class="tok-nt">&lt;param-name&gt;</span>contextConfigLocation<span class="tok-nt">&lt;param-name&gt;</span>
        <span class="tok-nt">&lt;param-value&gt;</span>/WEB-INF/applicationContext.xml<span class="tok-nt">&lt;param-value&gt;</span>
    <span class="tok-nt">&lt;/context-param&gt;</span>
<span class="tok-nt">&lt;/web-app&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The additional configuration part containing listener and context parameter definition is a usual Spring container related configuration detail. ContextLoaderListener is an implementation of standard Servlet API ServletContextListener interface provided by the Spring framework itself and is responsible for looking up an according bean definition file(s) specified by the context param above and creating an ApplicationContext instance during servlet context initialization accordingly. When integrating an ApplicationContext instance with Wicket, one of the beans defined in the above mentioned Spring bean definition file has to be your own specific extension of <em>org.apache.wicket.protocol.http.WebApplication</em>. You can either define a suitable bean in the bean definition file itself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="xml language-xml"><span class="tok-nt">&lt;beans&gt;</span>
    <span class="tok-nt">&lt;bean</span> <span class="tok-na">id=</span><span class="tok-s">&quot;myWebApp&quot;</span> <span class="tok-na">class=</span><span class="tok-s">&quot;com.comsysto.webapp.MyWebApplication&quot;</span><span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/beans&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>or use powerful classpath scanning feature of the Spring framework and annotate the MyWebApplication implementation with the appropriate <em>\'Component</em> annotation accordingly while enabling the Spring container to scan the according package(s) of your application for relevant bean definitions:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="xml language-xml"><span class="tok-nt">&lt;beans&gt;</span>
    <span class="tok-nt">&lt;context:component-scan</span> <span class="tok-na">base-package=</span><span class="tok-s">&quot;com.comsysto.webapp&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;context:component-scan</span> <span class="tok-na">base-package=</span><span class="tok-s">&quot;com.comsysto.webapp.service&quot;</span> <span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;context:component-scan</span> <span class="tok-na">base-package=</span><span class="tok-s">&quot;com.comsysto.webapp.repository&quot;</span> <span class="tok-nt">/&gt;</span>
<span class="tok-nt">&lt;/beans&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Either way, if everything goes well, you&#8217;ll get a pre-configured ApplicationContext all set up during the startup of your web container. One of the beans in the ApplicationContext will be your own extension of Wicket&#8217;s WebApplication type. SpringWebApplicationFactory implementation provided by the Wicket framework itself that you have defined as the <em>applicationFactoryClassName</em> in the configuration of your WicketFilter will then be used in order to retrieve that very same WebApplication bean out of your Spring ApplicationContext. The Factory expects one and only one extension of Wicket&#8217;s very own WebApplication type to be found within the ApplicationContext instance at runtime. If no such bean or more than one bean extending WebApplication is found in the given ApplicationContext an according IllegalStateException will be raised and initialization of your web application will fail:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">Map</span><span class="tok-o">&lt;?,?&gt;</span> <span class="tok-n">beans</span> <span class="tok-o">=</span> <span class="tok-n">BeanFactoryUtils</span><span class="tok-o">.</span><span class="tok-na">beansOfTypeIncludingAncestors</span><span class="tok-o">(</span><span class="tok-n">ac</span><span class="tok-o">,</span><span class="tok-n">WebApplication</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">);</span>
<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">beans</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-mi">0</span><span class="tok-o">)</span>
<span class="tok-o">{</span>
	<span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">IllegalStateException</span><span class="tok-o">(</span><span class="tok-s">&quot;bean of type [&quot;</span> <span class="tok-o">+</span> <span class="tok-n">WebApplication</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">()</span> <span class="tok-o">+</span>
			<span class="tok-s">&quot;] not found&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">beans</span><span class="tok-o">.</span><span class="tok-na">size</span><span class="tok-o">()</span> <span class="tok-o">&gt;</span> <span class="tok-mi">1</span><span class="tok-o">)</span>
<span class="tok-o">{</span>
	<span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">IllegalStateException</span><span class="tok-o">(</span><span class="tok-s">&quot;more than one bean of type [&quot;</span> <span class="tok-o">+</span>
			<span class="tok-n">WebApplication</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">.</span><span class="tok-na">getName</span><span class="tok-o">()</span> <span class="tok-o">+</span> <span class="tok-s">&quot;] found, must have only one&quot;</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>After the WebApplication bean has been successfully retrieved from the ApplicationContext via SpringWebApplicationFactory, WicketFilter will then, as part of its own initialization process, trigger both internalInit() and init() methods of the WebApplication bean. The latter one is the exact spot where the last piece of the runtime configuration puzzle between Wicket and Spring is to be placed :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Component</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyWebApplication</span> <span class="tok-kd">extends</span> <span class="tok-n">WebApplication</span> <span class="tok-o">{</span>
    <span class="tok-nd">@Override</span>
    <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">addComponentInstantiationListener</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">SpringComponentInjector</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>

<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>SpringComponentInjector provided by the Wicket framework enables you to get dependencies from the ApplicationContext directly injected into your Wicket components by simply annotating these with the according <em>\'SpringBean</em> annotation.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuration_of_the_junit_based_integration_test_environment">Configuration of the JUnit based integration test environment</h3>
<div class="paragraph">
<p>One of the main features of Apache Wicket framework is the ability to easily write and run plain unit tests for your Pages and all other kinds of Components that even include the verification of the rendering process itself by using JUnit framework and the WicketTester API only. When using Spring framework for application configuration together with Wicket, as we do, you can even use the same tools to easily write and run full blown integration tests for your web application as well. All you have to do is use  ring&#8217;s[] estContext ttp://docs.spring.io/spring/docs/3.0.x/spring-framework-reference/html/testing.html#testcontext-framework[] ramework additionally to configure and run your JUnit based integration tests. The Spring Framework provides a set of Spring specific annotations that you can use in your integration tests in conjunction with the TestContext framework itself in order to easily configure an according ApplicationContext instance for your tests as well as for appropriate transaction management before, during and after your test execution. Following code snippet represents a simple JUnit 4 based test case using Spring&#8217;s specific annotations in order to initialize an ApplicationContext instance prior to executing the test itself:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@RunWith</span><span class="tok-o">(</span><span class="tok-n">SpringJUnit4ClassRunner</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">)</span>
<span class="tok-nd">@ContextConfiguration</span><span class="tok-o">(</span><span class="tok-n">locations</span> <span class="tok-o">=</span> <span class="tok-o">{</span><span class="tok-s">&quot;classpath:WEB-INF/applicationContext.xml&quot;</span><span class="tok-o">})</span>
<span class="tok-nd">@TransactionConfiguration</span><span class="tok-o">(</span><span class="tok-n">transactionManager</span> <span class="tok-o">=</span> <span class="tok-s">&quot;txManager&quot;</span><span class="tok-o">,</span> <span class="tok-n">defaultRollback</span> <span class="tok-o">=</span> <span class="tok-kc">false</span><span class="tok-o">)</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LoginPageTest</span> <span class="tok-o">{</span>

    <span class="tok-kd">private</span> <span class="tok-n">WicketTester</span> <span class="tok-n">tester</span><span class="tok-o">;</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">ApplicationContext</span> <span class="tok-n">ctx</span><span class="tok-o">;</span>

    <span class="tok-nd">@Autowired</span>
    <span class="tok-kd">private</span> <span class="tok-n">MyWebApplication</span> <span class="tok-n">myWebApplication</span><span class="tok-o">;</span>

    <span class="tok-nd">@Before</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setUp</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">tester</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">WicketTester</span><span class="tok-o">(</span><span class="tok-n">myWebApplication</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@Test</span>
    <span class="tok-nd">@Transactional</span>
    <span class="tok-nd">@Rollback</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testRenderMyPage</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">startPage</span><span class="tok-o">(</span><span class="tok-n">LoginPage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
        <span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">assertRenderedPage</span><span class="tok-o">(</span><span class="tok-n">LoginPage</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
        <span class="tok-n">tester</span><span class="tok-o">.</span><span class="tok-na">assertComponent</span><span class="tok-o">(</span><span class="tok-s">&quot;login&quot;</span><span class="tok-o">,</span> <span class="tok-n">LoginComponent</span><span class="tok-o">.</span><span class="tok-na">class</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>By defining three annotations on the class level (see code snippet above) in your test, Spring&#8217;s TestContext framework takes care of preparing and initializing an ApplicationContext instance having all the beans defined in the according Spring context file as well as the transaction management in case your integration test includes some kind of database access. Fields marked with <em>\'Autowired</em> annotation will be automatically dependency injected as well so that you can easily access and use these for your testing purposes. Since MyWebApplication, which extends Wicket&#8217;s WebApplication type and represents the main class of our web application, is also a bean within the ApplicationContext managed by Spring, it will also be provided to us by the test framework itself and can be easily used in order to initialize a WicketTester instance later on during the execution of the test&#8217;s setUp() method. With this kind of simple, annotation based test configuration we are able to run an integration test that verifies whether a LoginPage gets started and initialized, whether the rendering of the page runs smoothly and whether the page itself contains a LoginComponent that we possibly need in order to process user&#8217;s login successfully.</p>
</div>
<div class="paragraph">
<p>When you run this test though, you&#8217;ll unfortunately get the following exception raised:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">java</span><span class="tok-o">.</span><span class="tok-na">lang</span><span class="tok-o">.</span><span class="tok-na">IllegalStateException</span><span class="tok-o">:</span> <span class="tok-n">No</span> <span class="tok-n">WebApplicationContext</span> <span class="tok-n">found</span><span class="tok-o">:</span> <span class="tok-n">no</span> <span class="tok-n">ContextLoaderListener</span> <span class="tok-n">registered</span><span class="tok-o">?</span>
    <span class="tok-n">at</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">springframework</span><span class="tok-o">.</span><span class="tok-na">web</span><span class="tok-o">.</span><span class="tok-na">context</span><span class="tok-o">.</span><span class="tok-na">support</span><span class="tok-o">.</span><span class="tok-na">WebApplicationContextUtils</span><span class="tok-o">.</span>
	<span class="tok-nf">getRequiredWebApplicationContext</span><span class="tok-o">(</span><span class="tok-n">WebApplicationContextUtils</span><span class="tok-o">.</span><span class="tok-na">java</span><span class="tok-o">:</span><span class="tok-mi">84</span><span class="tok-o">)</span>
    <span class="tok-n">at</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">apache</span><span class="tok-o">.</span><span class="tok-na">wicket</span><span class="tok-o">.</span><span class="tok-na">spring</span><span class="tok-o">.</span><span class="tok-na">injection</span><span class="tok-o">.</span><span class="tok-na">annot</span><span class="tok-o">.</span>
	<span class="tok-n">SpringComponentInjector</span><span class="tok-o">.&lt;</span><span class="tok-n">init</span><span class="tok-o">&gt;(</span><span class="tok-n">SpringComponentInjector</span><span class="tok-o">.</span><span class="tok-na">java</span><span class="tok-o">:</span><span class="tok-mi">72</span><span class="tok-o">)</span>
    <span class="tok-n">at</span> <span class="tok-n">com</span><span class="tok-o">.</span><span class="tok-na">comsysto</span><span class="tok-o">.</span><span class="tok-na">serviceplatform</span><span class="tok-o">.</span><span class="tok-na">uiwebapp</span><span class="tok-o">.</span><span class="tok-na">MyWebApplication</span><span class="tok-o">.</span>
	<span class="tok-nf">initializeSpringComponentInjector</span><span class="tok-o">(</span><span class="tok-n">MyWebApplication</span><span class="tok-o">.</span><span class="tok-na">java</span><span class="tok-o">:</span><span class="tok-mi">59</span><span class="tok-o">)</span>
    <span class="tok-n">at</span> <span class="tok-n">com</span><span class="tok-o">.</span><span class="tok-na">comsysto</span><span class="tok-o">.</span><span class="tok-na">serviceplatform</span><span class="tok-o">.</span><span class="tok-na">uiwebapp</span><span class="tok-o">.</span><span class="tok-na">MyWebApplication</span><span class="tok-o">.</span>
	<span class="tok-nf">init</span><span class="tok-o">(</span><span class="tok-n">MyWebApplication</span><span class="tok-o">.</span><span class="tok-na">java</span><span class="tok-o">:</span><span class="tok-mi">49</span><span class="tok-o">)</span>
    <span class="tok-n">at</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">apache</span><span class="tok-o">.</span><span class="tok-na">wicket</span><span class="tok-o">.</span><span class="tok-na">protocol</span><span class="tok-o">.</span><span class="tok-na">http</span><span class="tok-o">.</span><span class="tok-na">WicketFilter</span><span class="tok-o">.</span>
	<span class="tok-nf">init</span><span class="tok-o">(</span><span class="tok-n">WicketFilter</span><span class="tok-o">.</span><span class="tok-na">java</span><span class="tok-o">:</span><span class="tok-mi">719</span><span class="tok-o">)</span>
    <span class="tok-n">at</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">apache</span><span class="tok-o">.</span><span class="tok-na">wicket</span><span class="tok-o">.</span><span class="tok-na">protocol</span><span class="tok-o">.</span><span class="tok-na">http</span><span class="tok-o">.</span><span class="tok-na">MockWebApplication</span><span class="tok-o">.</span>
	<span class="tok-o">&lt;</span><span class="tok-n">init</span><span class="tok-o">&gt;(</span><span class="tok-n">MockWebApplication</span><span class="tok-o">.</span><span class="tok-na">java</span><span class="tok-o">:</span><span class="tok-mi">168</span><span class="tok-o">)</span>
    <span class="tok-n">at</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">apache</span><span class="tok-o">.</span><span class="tok-na">wicket</span><span class="tok-o">.</span><span class="tok-na">util</span><span class="tok-o">.</span><span class="tok-na">tester</span><span class="tok-o">.</span><span class="tok-na">BaseWicketTester</span><span class="tok-o">.</span>
	<span class="tok-o">&lt;</span><span class="tok-n">init</span><span class="tok-o">&gt;(</span><span class="tok-n">BaseWicketTester</span><span class="tok-o">.</span><span class="tok-na">java</span><span class="tok-o">:</span><span class="tok-mi">219</span><span class="tok-o">)</span>
    <span class="tok-n">at</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">apache</span><span class="tok-o">.</span><span class="tok-na">wicket</span><span class="tok-o">.</span><span class="tok-na">util</span><span class="tok-o">.</span><span class="tok-na">tester</span><span class="tok-o">.</span><span class="tok-na">WicketTester</span><span class="tok-o">.</span>
	<span class="tok-o">&lt;</span><span class="tok-n">init</span><span class="tok-o">&gt;(</span><span class="tok-n">WicketTester</span><span class="tok-o">.</span><span class="tok-na">java</span><span class="tok-o">:</span><span class="tok-mi">325</span><span class="tok-o">)</span>
    <span class="tok-n">at</span> <span class="tok-n">org</span><span class="tok-o">.</span><span class="tok-na">apache</span><span class="tok-o">.</span><span class="tok-na">wicket</span><span class="tok-o">.</span><span class="tok-na">util</span><span class="tok-o">.</span><span class="tok-na">tester</span><span class="tok-o">.</span><span class="tok-na">WicketTester</span><span class="tok-o">.</span>
	<span class="tok-o">&lt;</span><span class="tok-n">init</span><span class="tok-o">&gt;(</span><span class="tok-n">WicketTester</span><span class="tok-o">.</span><span class="tok-na">java</span><span class="tok-o">:</span><span class="tok-mi">308</span><span class="tok-o">)</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As you can see above, the Exception gets raised during the initialization of the <em>WicketTester</em> instance even before the actual test method gets executed. Even though we have applied rather cool and simple annotation based test configuration already described and passed in perfectly well prepared ApplicationContext instance to the WicketTester instance in the constructor, somewhere down the rabbit hole someone complained that no WebApplicationContext instance could have been found which seems to be required in order to initialize the WicketTester properly.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="description-of-illegalstate.jpg" alt="description of illegalstate">
</div>
</div>
<div class="paragraph">
<p>The problem that we run against here is due to the fact that SpringComponentInjector during its own initialization is trying to get hold of an according Spring&#8217;s ApplicationContext instance that would normally be there in a runtime environment but does not find any since we are running in a test environment currently. SpringComponentInjector delegates to Spring&#8217;s own WebApplicationContextUtils class to retrieve the instance of ApplicationContext out of the ServletContext which is perfectly fine for a runtime environment but is unfortunately failing in a test environment:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">static</span> <span class="tok-n">WebApplicationContext</span> <span class="tok-nf">getRequiredWebApplicationContext</span><span class="tok-o">(</span><span class="tok-n">ServletContext</span> <span class="tok-n">sc</span><span class="tok-o">)</span>
		<span class="tok-kd">throws</span> <span class="tok-n">IllegalStateException</span> <span class="tok-o">{</span>

	<span class="tok-n">WebApplicationContext</span> <span class="tok-n">wac</span> <span class="tok-o">=</span> <span class="tok-n">getWebApplicationContext</span><span class="tok-o">(</span><span class="tok-n">sc</span><span class="tok-o">);</span>
	<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">wac</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span> <span class="tok-o">{</span>
		<span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">IllegalStateException</span><span class="tok-o">(</span><span class="tok-s">&quot;No WebApplicationContext found: no ContextLoaderListener registered?&quot;</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>
	<span class="tok-k">return</span> <span class="tok-n">wac</span><span class="tok-o">;</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you still remember we defined a ContextLoaderListener in our web.xml file as part of the configuration of our runtime environment that makes sure an according WebApplicationContext instance gets initialized and registered against the ServletContext properly. Luckily, this problem can easily be solved if we slightly change the way we initialize SpringComponentInjector in our main MyWebApplication class. Apart from the constructor that we have used so far, there is another constructor in the SpringComponentInjector class that expects the caller to provide it with an according ApplicationContext instance rather than trying to resolve one on its own:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-nf">SpringComponentInjector</span><span class="tok-o">(</span><span class="tok-n">WebApplication</span> <span class="tok-n">webapp</span><span class="tok-o">,</span> <span class="tok-n">ApplicationContext</span> <span class="tok-n">ctx</span><span class="tok-o">,</span>
		<span class="tok-kt">boolean</span> <span class="tok-n">wrapInProxies</span><span class="tok-o">)</span>
<span class="tok-o">{</span>
	<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">webapp</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span>
	<span class="tok-o">{</span>
		<span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">(</span><span class="tok-s">&quot;Argument [[webapp]] cannot be null&quot;</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">ctx</span> <span class="tok-o">==</span> <span class="tok-kc">null</span><span class="tok-o">)</span>
	<span class="tok-o">{</span>
		<span class="tok-k">throw</span> <span class="tok-k">new</span> <span class="tok-n">IllegalArgumentException</span><span class="tok-o">(</span><span class="tok-s">&quot;Argument [[ctx]] cannot be null&quot;</span><span class="tok-o">);</span>
	<span class="tok-o">}</span>

	<span class="tok-c1">// store context in application&#39;s metadata ...</span>
	<span class="tok-n">webapp</span><span class="tok-o">.</span><span class="tok-na">setMetaData</span><span class="tok-o">(</span><span class="tok-n">CONTEXT_KEY</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">ApplicationContextHolder</span><span class="tok-o">(</span><span class="tok-n">ctx</span><span class="tok-o">));</span>

	<span class="tok-c1">// ... and create and register the annotation aware injector</span>
	<span class="tok-n">InjectorHolder</span><span class="tok-o">.</span><span class="tok-na">setInjector</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">AnnotSpringInjector</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">ContextLocator</span><span class="tok-o">(),</span> <span class="tok-n">wrapInProxies</span><span class="tok-o">));</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to use this constructor instead of the one we used previously, we now obviously need to get hold of the <em>ApplicationContext</em> instance on our own in our <em>MyWebApplication</em> implementation. The easiest way to do this is to use Spring&#8217;s own concept of  fecycle[] allbacks ttp://docs.spring.io/spring/docs/3.0.x/spring-framework-reference/html/beans.html#beans-factory-aware[] rovided to the beans managed by the Spring container. Since our <em>MyWebApplication</em> is also a bean managed by the Spring container at runtime (enabled by the classpath scanning and <em>\'Component</em> annotation on a type level), we can declare it to implement <em>ApplicationContextAware</em> interface which ensures that it gets provided with the <em>ApplicationContext</em> instance that it runs in by the Spring container itself during startup.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">ApplicationContextAware</span> <span class="tok-o">{</span>

	<span class="tok-kt">void</span> <span class="tok-nf">setApplicationContext</span><span class="tok-o">(</span><span class="tok-n">ApplicationContext</span> <span class="tok-n">applicationContext</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">BeansException</span><span class="tok-o">;</span>

<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>So the relevant parts of <em>MyWebApplication</em> type will now look something like the following code snippet:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Component</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyWebApplication</span> <span class="tok-kd">extends</span> <span class="tok-n">WebApplication</span> <span class="tok-kd">implements</span> <span class="tok-n">ApplicationContextAware</span> <span class="tok-o">{</span>
    <span class="tok-nd">@Override</span>
    <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">addComponentInstantiationListener</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">SpringComponentInjector</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">,</span> <span class="tok-n">ctx</span><span class="tok-o">,</span> <span class="tok-kc">true</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">setApplicationContext</span><span class="tok-o">(</span><span class="tok-n">ApplicationContext</span> <span class="tok-n">applicationContext</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">BeansException</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">ctx</span> <span class="tok-o">=</span> <span class="tok-n">applicationContext</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>For additional clarification of how <em>MyWebApplication</em> now relates to both Wicket and Spring framework here is an according class diagram:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="mywebapp-class-diagramm.jpg" alt="mywebapp class diagramm">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_20">Summary</h3>
<div class="paragraph">
<p>With the configuration outlined above, no additional modifications are required to the test itself. It&#8217;s going to turn green now. This way you can use exactly the same Spring context configuration that you&#8217;d use in your runtime environment for running your JUnit based integration tests as well.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wicket_best_practices">Wicket Best Practices</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section is addressed to developers, who have already made their first experiences with Apache Wicket. Developers who get into Wicket often have difficulties with it because they apply the typical JSF and Struts patterns and approaches. These frameworks primarily use procedural programming methods. In contrast Wicket is strongly based on object oriented patterns. So forget all Struts and JSF patterns, otherwise you won&#8217;t have fun with Wicket in the long run.</p>
</div>
<div class="sect2">
<h3 id="_encapsulate_components_correctly">Encapsulate components correctly</h3>
<div class="paragraph">
<p>A component should be self-contained. The user of a component should neither have to know nor care about its internal structure. She should just be familiar with its external interfaces and its documentation in order to be able to use it. This means in detail: Every component that extends Wicket&#8217;s own Panel type (thus is a Panel itself) must provide its own HTML template. In contrast, when a component extends the classes <em>WebMarkupContainer</em> or <em>Form</em>, there is no HTML template. This implies that you should add components through composition in <em>WebMarkupContainer</em> or <em>Form</em>.</p>
</div>
<div class="paragraph">
<p><strong>Listing 1:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">// Poor component</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RegistrationForm</span> <span class="tok-kd">extends</span> <span class="tok-n">Form</span><span class="tok-o">&lt;</span><span class="tok-n">Registration</span><span class="tok-o">&gt;</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">RegistrationForm</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Registration</span><span class="tok-o">&gt;</span> <span class="tok-n">regModel</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">CompoundPropertyModel</span><span class="tok-o">&lt;</span><span class="tok-n">Registration</span><span class="tok-o">&gt;(</span><span class="tok-n">regModel</span><span class="tok-o">))</span>
        <span class="tok-c1">// Wrong: RegistrationForm provides its own components</span>
        <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-o">));</span>
        <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;firstname&quot;</span><span class="tok-o">));</span>
        <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;lastname&quot;</span><span class="tok-o">));</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>This snippet is an example for a poor component. The user of the <em>RegistrationForm</em> must know the internal structure of the markup and component in order to use it.</p>
</div>
<div class="paragraph">
<p><strong>Listing 2:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RegistrationPage</span> <span class="tok-kd">extends</span> <span class="tok-n">Page</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">RegistrationPage</span><span class="tok-o">(</span><span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Registration</span><span class="tok-o">&gt;</span> <span class="tok-n">regModel</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Form</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">RegistrationForm</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">SubmitButton</span><span class="tok-o">(</span><span class="tok-s">&quot;register&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onSubmit</span><span class="tok-o">()</span> <span class="tok-o">{</span>
                 <span class="tok-c1">// do something</span>
            <span class="tok-o">}</span>
        <span class="tok-o">});</span>
        <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
    <span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;form&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-c">&lt;!-- These are internal structure information from RegistrationForm --&gt;</span>
        Username <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;username&quot;</span><span class="tok-nt">/&gt;</span>
        First name <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;firstname&quot;</span><span class="tok-nt">/&gt;</span>
        Last name <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;lastname&quot;</span><span class="tok-nt">/&gt;</span>
        <span class="tok-c">&lt;!-- Above new components from page which the user knows  --&gt;</span>
        <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;submit&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;register&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Register&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/form&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code above shows the usage of the poor component in the <em>RegistrationPage</em>. You can see that the input fields <em>firstname</em>, <em>lastname</em> and <em>username</em> get used, even though these components are not added explicitly to the <em>RegistrationPage</em>. Avoid this, because other developers cannot directly see that the components were added in <em>RegistrationPage</em> class.</p>
</div>
<div class="paragraph">
<p><strong>Listing 3:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">// Good component</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RegistrationInputPanel</span> <span class="tok-kd">extends</span> <span class="tok-n">Panel</span><span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">RegistrationInputPanel</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Registration</span><span class="tok-o">&gt;</span> <span class="tok-n">regModel</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">regModel</span><span class="tok-o">);</span>
        <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Registration</span><span class="tok-o">&gt;</span> <span class="tok-n">compound</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">CompoundPropertyModel</span><span class="tok-o">&lt;</span><span class="tok-n">Registration</span><span class="tok-o">(</span><span class="tok-n">regmodel</span><span class="tok-o">)</span>
        <span class="tok-n">Form</span><span class="tok-o">&lt;</span><span class="tok-n">Registration</span><span class="tok-o">&gt;</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">&lt;</span><span class="tok-n">Registration</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">,</span> <span class="tok-n">compound</span><span class="tok-o">);</span>
        <span class="tok-c1">// Correct: Add components to Form over the instance variable</span>
        <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-o">));</span>
        <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;firstname&quot;</span><span class="tok-o">));</span>
        <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TextField</span><span class="tok-o">(</span><span class="tok-s">&quot;lastname&quot;</span><span class="tok-o">));</span>
        <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
    <span class="tok-nt">&lt;wicket:panel&gt;</span>
    <span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;form&quot;</span><span class="tok-nt">&gt;</span>
        Username <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;username&quot;</span><span class="tok-nt">/&gt;</span>
        First name <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;firstname&quot;</span><span class="tok-nt">/&gt;</span>
        Last name <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&quot;text&quot;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;lastname&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/form&gt;</span>
    <span class="tok-nt">&lt;/wicket:panel&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we have a properly encapsulated input component which provides its own markup. Furthermore you can see the correct usage of a Wicket <em>Form</em>. The components get added by calling <em>form.add(Component)</em> on the instance variable. On the other hand, it is allowed to add behaviours and validators over inheritance, because those do not have markup ids which must be bound.</p>
</div>
<div class="paragraph">
<p>With that, the usage of <em>RegistrationInputPanel</em> is much more intuitive. There is no markup of other embedded components present anymore, just markup of components which get directly added. The <em>RegistrationPage</em> provides its own form that delegates the submit to all Wicket nested forms which are contained in the component tree.</p>
</div>
<div class="paragraph">
<p><strong>Listing 4:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RegistrationPage</span> <span class="tok-kd">extends</span> <span class="tok-n">Page</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">RegistrationPage</span><span class="tok-o">(</span><span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Registration</span><span class="tok-o">&gt;</span> <span class="tok-n">regModel</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Form</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">RegistrationInputPanel</span><span class="tok-o">(</span><span class="tok-s">&quot;registration&quot;</span><span class="tok-o">,</span> <span class="tok-n">regModel</span><span class="tok-o">);</span>
        <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">SubmitButton</span><span class="tok-o">(</span><span class="tok-s">&quot;register&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onSubmit</span><span class="tok-o">()</span> <span class="tok-o">{</span>
              <span class="tok-c1">// do something</span>
            <span class="tok-o">}</span>
        <span class="tok-o">});</span>
        <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;html&gt;</span>
<span class="tok-nt">&lt;body&gt;</span>
    <span class="tok-nt">&lt;form</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;form&quot;</span><span class="tok-nt">&gt;</span>
        <span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;registration&quot;</span><span class="tok-nt">&gt;</span>
           Display the RegistrationInputPanel
        <span class="tok-nt">&lt;/div&gt;</span>
        <span class="tok-nt">&lt;input</span> <span class="tok-na">type=</span><span class="tok-s">&amp;rdquo;submit&amp;rdquo;</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;register&quot;</span> <span class="tok-na">value=</span><span class="tok-s">&quot;Register&quot;</span><span class="tok-nt">/&gt;</span>
    <span class="tok-nt">&lt;/form&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
<span class="tok-nt">&lt;/html&gt;</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_put_models_and_page_data_in_fields">Put models and page data in fields</h3>
<div class="paragraph">
<p>In contrast to Struts, Wicket pages and components are no singletons, they are stateful and session-scoped. This enables us to store user-specific information within pages and components. The information should be stored in fields. This way you can access the information within a class while avoiding long method signatures only for passing the same information around. Instances of components can exist for several requests. For example, a page with a form which gets submitted and produces validation errors uses the same page instance. Furthermore the same page instance gets used when the user presses the back button of the browser and resubmits this formular again. Information which gets passed by the constructor should be assigned to fields (normally this must be models). When storing information in fields you should consider that the information is serializable, because the pages are stored in Wicket&#8217;s page map. By default the page map stores the pages on the hard disk. A non-serializable object leads to <em>NullPointerExceptions</em> and <em>NonSerializableExceptions</em>. Additionally, big data (like binary stuff) should not be stored directly in fields because this can cause performance losses and memory leaks during serialization and deserialization. In this case, you should use the <em>LoadableDetachableModel</em> which can be assigned to a field because this provides an efficient mechanism to load and detach data.</p>
</div>
</div>
<div class="sect2">
<h3 id="_correct_naming_for_wicket_ids">Correct naming for Wicket IDs</h3>
<div class="paragraph">
<p>For many developers, naming is a dispensable thing, but I think it is one of the major topics in software development. With the help of correct naming, you can easily identify the business aspects of a software component. Additionally good naming avoids unneccessary and bad comments.</p>
</div>
<div class="paragraph">
<p>Bad namings for Wicket-IDs are <em>birthdateTextField</em>, <em>firstnameField</em> and <em>addressPanel</em>. Why? The naming contains two aspects: A technical aspect (_ )[TextField] nd the business aspect (_ ).[birthdate] nly the the business aspect is relevant because both the HTML template as well as the Java code already contain the technical details ( ew[birthdate] "birthdate [)@)] dditionally, such names add a lot of effort when you do technical refactorings, e.g. if you have to replace a <em>TextField</em> by a <em>DatePicker</em> and the Wicket ID <em>birthdateTextField</em> becomes <em>birthdateDatePicker</em>. Another reason for avoiding technical aspects in Wicket IDs is the <em>CompoundPropertyModel</em>. This model delegates the properties to its child components named by Wicket IDs (see listing 3). For example the <em>TextField username</em> automatically calls <em>setUsername()</em> and <em>getUsername()</em> on the <em>Registration</em> object. A setter like <em>setUsernameTextfield()</em> would be very inconvenient here.</p>
</div>
</div>
<div class="sect2">
<h3 id="_avoid_changes_at_the_component_tree">Avoid changes at the component tree</h3>
<div class="paragraph">
<p>You should consider Wicket&#8217;s component tree a constant and fixed skeleton which gets revived when its model is filled with data like a robot without brain. Without brain the robot is not able to do anything and is just a dead and fixed skeleton. However, when you fill it with data, it becomes alive and can act. There is no need for changing hardware when filling him with data. In Wicket, you should manipulate the component tree as little as possible. Consequently, you should avoid calling methods like <em>Component.replace(Component)</em> and <em>Component.remove(Component)</em>. Calling these methods indicates missing usage or misusage of Wicket&#8217;s models. Furthermore the component trees should not be constructed using conditions (see listing 5). This reduces the possibility of reusing the same instance significantly.</p>
</div>
<div class="paragraph">
<p><strong>Listing 5:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">// typical for struts</span>
<span class="tok-k">if</span><span class="tok-o">(</span><span class="tok-n">MySession</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">isNotLoggedIn</span><span class="tok-o">())</span> <span class="tok-o">{</span>
    <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">LoginBoxPanel</span><span class="tok-o">(</span><span class="tok-s">&quot;login&quot;</span><span class="tok-o">))</span>
<span class="tok-o">}</span>
<span class="tok-k">else</span> <span class="tok-o">{</span>
    <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">EmptyPanel</span><span class="tok-o">(</span><span class="tok-s">&quot;login&quot;</span><span class="tok-o">))</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Instead of constructing <em>LoginBoxPanel</em> conditionally, it is recommended to always add the panel  and control the visibility by overriding <em>isVisible()</em>. So the component <em>LoginBoxPanel</em> is responsible for displaying itself. We move the responsibility into the same component which executes the login. Brilliant! Cleanly encapsulated business logic. There is no decision from outside, the component handles all the logic. You can see another example in  plement[] isibilities of components correctly plement[]</p>
</div>
</div>
<div class="sect2">
<h3 id="_implement_visibilities_of_components_correctly">Implement visibilities of components correctly</h3>
<div class="paragraph">
<p>Visibility of components is an important topic. In Wicket you control any component&#8217;s visibility via the methods <em>isVisible()</em> and <em>setVisible()</em>. These methods are within Wicket&#8217;s base class <em>Component</em> and therefore it is applicable for every component and page. Let&#8217;s have a look at a concrete example of <em>LoginBoxPanel</em>. The panel just gets displayed when the user is not logged in.</p>
</div>
<div class="paragraph">
<p><strong>Listing 6:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">// Poor implementation</span>
<span class="tok-n">LoginBoxPanel</span> <span class="tok-n">loginBox</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">LoginBoxPanel</span><span class="tok-o">(</span><span class="tok-s">&quot;login&quot;</span><span class="tok-o">);</span>
<span class="tok-n">loginBox</span><span class="tok-o">.</span><span class="tok-na">setVisible</span><span class="tok-o">(</span><span class="tok-n">MySession</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">isNotLoggedIn</span><span class="tok-o">());</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">loginBox</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Listing 6 shows a poor implementation, because a decision about the visibility is made while instanciating the component. Again, in Wicket instances of components exist for several requests. To reuse the same instance you have to call <em>loginBox.setVisible(false)</em>. This is very unhandy, because we always have to call <em>setVisible()</em> and manage the visibility. Furthermore you are going to duplicate the states, because visible is equal to  t[] ogged in [] o we have two saved states, one for the business aspect  t[] ogged in [] nd one for the technical aspect  [visible] oth is always equal. This approach is error-prone and fragile, because we always have to pay attention to setting the correct information every time. But this is often forgotten because the logic is widely spread over the code. The solution is the Hollywood principle:  n&#8217;t[visible]  we&#8217;ll call you. [visible] ook at the following diagram illustrating an application flow with some calls. We avoid three calls through the  <a href="http://en.wikipedia.org/wiki/Hollywood_Principle">Hollywood-Principle</a> nd we just have to instanciate the <em>LoginBoxPanel</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="login_calls_hollywood.png" alt="login calls hollywood">
</div>
</div>
<div class="paragraph">
<p><strong>Listing 7:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">LoginBoxPanel</span> <span class="tok-o">{</span>
    <span class="tok-c1">// constructor etc.</span>
    <span class="tok-nd">@Override</span>
    <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isVisible</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-k">return</span> <span class="tok-n">MySession</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">isNotLoggedIn</span><span class="tok-o">();</span>
    <span class="tok-o">}</span>
<span class="tok-o">};</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now the control over visibility has been inverted, the <em>LoginBoxPanel</em> decides on its visibility autonomously. For each call of <em>isVisible()</em> there is a refreshed interpretion of the login state. Hence, there is no additional state that might be outdated. The logic is centralized in one line code and not spread throughout the application. Furthermore, you can easily identify that the technical aspect <em>isVisible()</em> correlates to the business aspect  gged[Hollywood-Principle] can be applied to the method <em>isEnabled()</em>. If <em>isEnabled()</em> returns false the components get displayed in gray. Forms which are within an inactive or invisible component do not get executed.</p>
</div>
<div class="paragraph">
<p>Note that there are cases in which you cannot avoid to call the methods <em>setVisible()</em> and <em>setEnabled()</em>. An example: The user presses a button to display an inlined registration form. In general, you can apply the following rules: data driven components override these methods and delegates to the data model. User triggered events call the method <em>setVisible(boolean)</em>. You can also override these methods with inline implementations:</p>
</div>
<div class="paragraph">
<p><strong>Listing 8:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-s">&quot;headline&quot;</span><span class="tok-o">,</span> <span class="tok-n">headlineModel</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-nd">@Override</span>
    <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isVisible</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-c1">// Hidden headline if text starts with &quot;Berlusconi&quot;</span>
        <span class="tok-n">String</span> <span class="tok-n">headline</span> <span class="tok-o">=</span> <span class="tok-n">getModelObject</span><span class="tok-o">();</span>
        <span class="tok-k">return</span> <span class="tok-n">headline</span><span class="tok-o">.</span><span class="tok-na">startWith</span><span class="tok-o">(</span><span class="tok-s">&quot;Berlusconi&quot;</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note:</strong> Some people insist on overriding <em>isVisible()</em> being <a href="http://www.mail-archive.com/dev\@wicket.apache.org/msg07123.html">a bad thing</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_always_use_models">Always use models</h3>
<div class="paragraph">
<p>Always use models - period! Do not pass raw objects directly to components. Instances of pages and components can exist for several requests. If you use raw objects, you cannot replace them later. An example is an entity which gets loaded at each request within a <em>LoadableDetachableModel</em>. The entity manager creates a new object reference, but the page would keep the obsolete instance. Always pass <em>IModel</em> in the constructor of your components:</p>
</div>
<div class="paragraph">
<p><strong>Listing 9:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RegistrationInputPanel</span> <span class="tok-kd">extends</span> <span class="tok-n">Panel</span><span class="tok-o">{</span>
    <span class="tok-c1">// Correct: The class Registration gets wrapped by IModel</span>
    <span class="tok-kd">public</span> <span class="tok-nf">RegistrationInputPanel</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Registration</span><span class="tok-o">&gt;</span> <span class="tok-n">regModel</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-c1">// add components</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>This code can use any implementation of <em>IModel</em>, e.g. the class <em>Model</em>, a <em>PropertyModel</em> or a custom implementation of <em>LoadableDetachableModel</em> which loads and persists the values automatically. The model implementations gets very easy to replace. You - as a developer - just need to know: if I call <em>IModel.getObject()</em>, I will get an object of type <em>Registration</em>. Where the object comes from is within the responsibility of the model implementation and the calling component. For example you can pass the model while instanciating the component. If you avoid using models, you will almost certainly have to modify the component tree sooner or later which forces you to duplicate states and thus produce unmaintainable code. Additionally, you should use models due to serialization issues. Objects which get stored in fields of pages and components get serialized and deserialized on each request. This can be inefficient in some cases.</p>
</div>
</div>
<div class="sect2">
<h3 id="_do_not_unwrap_models_within_the_constructor_hierarchy">Do not unwrap models within the constructor hierarchy</h3>
<div class="paragraph">
<p>Avoid unwrapping models within the constructor hierarchy, i.e. do not call <em>IModel.getObject()</em> within any constructor. As already mentioned, a page instance can exist for several page requests, so you might store obsolete and redundant infomation. It is reasonable to unpack Wicket Models at events (user actions), that are methods like <em>onUpdate()</em>, <em>onClick() or 'onSubmit()</em>:</p>
</div>
<div class="paragraph">
<p><strong>Listing 10:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;register&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onSubmit</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-c1">// correct, unwrap model in an event call</span>
        <span class="tok-n">Registration</span> <span class="tok-n">reg</span> <span class="tok-o">=</span> <span class="tok-n">registrationModel</span><span class="tok-o">.</span><span class="tok-na">getObject</span><span class="tok-o">()</span>
        <span class="tok-n">userService</span><span class="tok-o">.</span><span class="tok-na">register</span><span class="tok-o">(</span><span class="tok-n">reg</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>An additional possibility to unwrap models is via overriding methods like <em>isVisible()</em>, <em>isEnabled()</em> or <em>onBeforeRender()</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_pass_models_extended_components">Pass models extended components</h3>
<div class="paragraph">
<p>Always try to pass models on to the parent component. By that, you ensure that at the end of every request the method <em>IModel.detach()</em> gets called. This method is responsible for a data cleanup. Another example: you have implemented your own model which persists the data in the <em>detach()</em> method. So the call of <em>detach()</em> is necessary for that your data gets persisted. You can see an exemplary passing to the super constructor here:</p>
</div>
<div class="paragraph">
<p><strong>Listing 11:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">RegistrationInputPanel</span> <span class="tok-kd">extends</span> <span class="tok-n">Panel</span><span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">RegistrationInputPanel</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Registration</span><span class="tok-o">&gt;</span> <span class="tok-n">regModel</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">regModel</span><span class="tok-o">)</span>
        <span class="tok-c1">// add components</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_validators_must_not_change_any_data_or_models">Validators must not change any data or models</h3>
<div class="paragraph">
<p>Validators should just validate. Consider a bank account form which has a <em>BankFormValidator</em>. This validator checks the bank data over a webservice and corrects the bank name. Nobody would expect that a validator modifies information. Such logic has to be located in <em>Form.onSubmit()</em> or in the event logic of a button.</p>
</div>
</div>
<div class="sect2">
<h3 id="_do_not_pass_components_to_constructors">Do not pass components to constructors</h3>
<div class="paragraph">
<p>Do not pass entire components or pages to constructors of other components.</p>
</div>
<div class="paragraph">
<p><strong>Listing 12:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">// Bad solution</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SettingsPage</span> <span class="tok-kd">extends</span> <span class="tok-n">Page</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">SettingsPage</span> <span class="tok-o">(</span><span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Settings</span><span class="tok-o">&gt;</span> <span class="tok-n">settingsModel</span><span class="tok-o">,</span> <span class="tok-kd">final</span> <span class="tok-n">Webpage</span> <span class="tok-n">backToPage</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Form</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">);</span>
        <span class="tok-c1">// add components</span>
        <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">SubmitButton</span><span class="tok-o">(</span><span class="tok-s">&quot;changeSettings&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onSubmit</span><span class="tok-o">()</span> <span class="tok-o">{</span>
               <span class="tok-c1">// do something</span>
               <span class="tok-n">setResponsePage</span><span class="tok-o">(</span><span class="tok-n">backToPage</span><span class="tok-o">);</span>
            <span class="tok-o">}</span>
        <span class="tok-o">});</span>
        <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>SettingsPage</em> expects the page which should be displayed after a successful submit to be passed to its constructor. This solution works, but is very bad practice. You need to know during the instanciation of <em>SettingsPage</em> where you want to redirect the user. This requires a predetermined order of instanciation. It is better to order the instanciation based on business logic (e.g. the order in the HTML template). Furthermore, you need an unnecessary instance of the next success page which might never be displayed. The solution is once again the Hollywood principle. For this you create an abstract method or a hook:</p>
</div>
<div class="paragraph">
<p><strong>Listing 13:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">// Good solution</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SettingsPage</span> <span class="tok-kd">extends</span> <span class="tok-n">Page</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">SettingsPage</span> <span class="tok-o">(</span><span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Settings</span><span class="tok-o">&gt;</span> <span class="tok-n">settingsModel</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-n">Form</span><span class="tok-o">&lt;?&gt;</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Form</span><span class="tok-o">(</span><span class="tok-s">&quot;form&quot;</span><span class="tok-o">);</span>
        <span class="tok-c1">// add components</span>
        <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">SubmitButton</span><span class="tok-o">(</span><span class="tok-s">&quot;changeSettings&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onSubmit</span><span class="tok-o">()</span> <span class="tok-o">{</span>
               <span class="tok-c1">// do something</span>
               <span class="tok-n">onSettingsChanged</span><span class="tok-o">();</span>
            <span class="tok-o">}</span>
         <span class="tok-o">});</span>
         <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">form</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>

    <span class="tok-c1">// hook</span>
    <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onSettingsChanged</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-o">}</span>

<span class="tok-c1">// The usage of the new component</span>
<span class="tok-n">Link</span><span class="tok-o">&lt;</span><span class="tok-n">Void</span><span class="tok-o">&gt;</span> <span class="tok-n">settings</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Link</span><span class="tok-o">&lt;</span><span class="tok-n">Void</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;settings&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">setResponsePage</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">SettingsPage</span><span class="tok-o">(</span><span class="tok-n">settingsModel</span><span class="tok-o">)</span> <span class="tok-o">{</span>
            <span class="tok-nd">@Override</span>
            <span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">onSettingsChanged</span><span class="tok-o">()</span> <span class="tok-o">{</span>
               <span class="tok-c1">// reference to the current page</span>
               <span class="tok-n">setResponsePage</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
            <span class="tok-o">}</span>
        <span class="tok-o">});</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">settings</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>This solution has more code, but it is more flexible and reuseable. We can see there is an event <em>onSettingsChanged()</em> and this event is called after a successful change. Furthermore, there is the possibility to execute additional code besides setting the next page. For example, you can display messages or persist information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_use_the_wicket_session_only_for_global_data">Use the Wicket session only for global data</h3>
<div class="paragraph">
<p>The Wicket session is your own extension of Wicket&#8217;s base session. It is fully typed. There is no map structure to store information unlike the servlet session. You just should use Wicket&#8217;s session for global data. Authentication is a good example for global data. The login and user information is required on nearly each page. For a blog application it would be good to know whether the user is an author who is allowed to compose blog entries. So you are able to hide or or show links to edit a blog entry. In general you should store the whole authorization logic in Wicket&#8217;s session, because it is a global thing and you would expect it there. Data of forms and flows which only span certain pages should not stored in the session. This data can be passed from one page to the next via the constructor (see listing 14). As a consequence of this, the models and data have a clearly defined lifecycle that reflects the corresponding the page flow.</p>
</div>
<div class="paragraph">
<p><strong>Listing 14:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyPage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
    <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">MyData</span><span class="tok-o">&gt;</span> <span class="tok-n">myDataModel</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">MyPage</span><span class="tok-o">(</span><span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">MyData</span><span class="tok-o">&gt;</span> <span class="tok-n">myDataModel</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">myDataModel</span> <span class="tok-o">=</span> <span class="tok-n">myDataModel</span><span class="tok-o">;</span>
        <span class="tok-n">Link</span><span class="tok-o">&lt;</span><span class="tok-n">Void</span><span class="tok-o">&gt;</span> <span class="tok-n">next</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Link</span><span class="tok-o">&lt;</span><span class="tok-n">Void</span><span class="tok-o">&gt;(</span><span class="tok-s">&quot;next&quot;</span><span class="tok-o">)</span> <span class="tok-o">{</span>
             <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">onClick</span><span class="tok-o">()</span> <span class="tok-o">{</span>
                  <span class="tok-c1">// do something</span>
                  <span class="tok-n">setResponsePage</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">NextPage</span><span class="tok-o">(</span><span class="tok-n">myDataModel</span><span class="tok-o">));</span>
             <span class="tok-o">}</span>
        <span class="tok-o">}</span>
        <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">next</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should pass concrete information to the page. All models can simply be stored in fields because Wicket pages are user-specific instances and no singletons in contrast to Struts. The big advantage of this approach is that the data gets automatically cleaned up when a user completes or exits the page flow. No manual cleanup anymore! This is basically an automatic garbage collector for your session.</p>
</div>
</div>
<div class="sect2">
<h3 id="_do_not_use_factories_for_components">Do not use factories for components</h3>
<div class="paragraph">
<p>The factory pattern is useful, but nevertheless not suitable for Wicket components.</p>
</div>
<div class="paragraph">
<p><strong>Listing 15:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CmsFactory</span> <span class="tok-o">{</span>
   <span class="tok-kd">public</span> <span class="tok-n">Label</span> <span class="tok-nf">getCmsLabel</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">markupId</span><span class="tok-o">,</span> <span class="tok-kd">final</span> <span class="tok-n">String</span> <span class="tok-n">url</span><span class="tok-o">)</span> <span class="tok-o">{</span>
       <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">fragment</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AbstractReadOnlyModel</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;()</span> <span class="tok-o">{</span>
          <span class="tok-nd">@Override</span>
          <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getObject</span><span class="tok-o">()</span> <span class="tok-o">{</span>
             <span class="tok-k">return</span> <span class="tok-n">loadSomeContent</span><span class="tok-o">(</span><span class="tok-n">url</span><span class="tok-o">);</span>
          <span class="tok-o">}</span>
       <span class="tok-o">};</span>
       <span class="tok-n">Label</span> <span class="tok-n">result</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">Label</span><span class="tok-o">(</span><span class="tok-n">markupId</span><span class="tok-o">,</span> <span class="tok-n">fragment</span><span class="tok-o">);</span>
       <span class="tok-n">result</span><span class="tok-o">.</span><span class="tok-na">setRenderBodyOnly</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
       <span class="tok-n">result</span><span class="tok-o">.</span><span class="tok-na">setEscapeModelStrings</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
       <span class="tok-k">return</span> <span class="tok-n">result</span><span class="tok-o">;</span>
   <span class="tok-o">}</span>

   <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">loadContent</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">url</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-c1">// load some content</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-c1">// create the component within the page:</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyPage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
   <span class="tok-nd">@SpringBean</span>
   <span class="tok-n">CmsFactory</span> <span class="tok-n">cmsFactory</span><span class="tok-o">;</span>

   <span class="tok-kd">public</span> <span class="tok-nf">MyPage</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">cmsFactory</span><span class="tok-o">.</span><span class="tok-na">getCmsLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;http://url.to.load.from&quot;</span><span class="tok-o">));</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>This approach for adding a label from the <em>CmsFactory</em> to a page seems to be okay at first glance, but it comes with some disadvantages. There is no possibility to use inheritance anymore. Furthermore, there is no possibility to override <em>isVisible()</em> and <em>isEnabled()</em>. The factory could also be a Spring service which instanciates the component. A better solution is to create a <em>CmsLabel</em>.</p>
</div>
<div class="paragraph">
<p><strong>Listing 16:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">CmsLabel</span> <span class="tok-kd">extends</span> <span class="tok-n">Label</span> <span class="tok-o">{</span>
   <span class="tok-nd">@SpringBean</span>
   <span class="tok-n">CmsResource</span> <span class="tok-n">cmsResource</span><span class="tok-o">;</span>
   <span class="tok-kd">public</span> <span class="tok-nf">CmsLabel</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">urlModel</span><span class="tok-o">)</span> <span class="tok-o">{</span>
      <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-n">id</span><span class="tok-o">,</span> <span class="tok-n">urlModel</span><span class="tok-o">);</span>
      <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;</span> <span class="tok-n">fragment</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AbstractReadOnlyModel</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-o">&gt;(){</span>
         <span class="tok-nd">@Override</span>
         <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">getObject</span><span class="tok-o">()</span> <span class="tok-o">{</span>
            <span class="tok-k">return</span> <span class="tok-n">cmsResource</span><span class="tok-o">.</span><span class="tok-na">loadSomeContent</span><span class="tok-o">(</span><span class="tok-n">urlModel</span><span class="tok-o">.</span><span class="tok-na">getObject</span><span class="tok-o">());</span>
         <span class="tok-o">}</span>
      <span class="tok-o">};</span>
      <span class="tok-n">setRenderBodyOnly</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
      <span class="tok-n">setEscapeModelStrings</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span>

<span class="tok-c1">// create the component within a page</span>
<span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">MyPage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
   <span class="tok-kd">public</span> <span class="tok-nf">MyPage</span><span class="tok-o">()</span> <span class="tok-o">{</span>
      <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">CmsLabel</span><span class="tok-o">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-o">,</span> <span class="tok-n">Model</span><span class="tok-o">.</span><span class="tok-na">of</span><span class="tok-o">(</span><span class="tok-s">&quot;http://url.to.load.from&quot;</span><span class="tok-o">)));</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The label in listing 16 is clearly encapsulated in a component without using a factory. Now you can easily create inline implementations and override <em>isVisible()</em> or other stuff. Naturally, you might claim  [] eed a factory to initialize some values in the component, e.g. a Spring service. [] or this you can create a implementation of <em>IComponentInstantiationListener</em>. This listener gets called on the super-constructor of every component. The most popular implementation of this interface is the <em>SpringComponentInjector</em> which injects Spring beans in components when the fields are annotated with <em>\'SpringBean</em>. You can easliy write and add your own implementation of <em>IComponentInstantiationListener</em>. So there is no reason for using a factory anymore. More information about the instanciation listener is located in Wicket&#8217;s JavaDoc.</p>
</div>
</div>
<div class="sect2">
<h3 id="_every_page_and_component_must_be_tested">Every page and component must be tested</h3>
<div class="paragraph">
<p>Every page and component should have a test. The simplest test just renders the component and validates its technical correctness. For example, a child component should have a matching wicket id in the markup. If the wicket id is not correctly bound - through a typo or if it was just forgotten - the test will fail. An advanced test could test a form, where a backend call gets executed and validated over a mock. So you can validate your component&#8217;s behaviour. This is a simple way to detect and fix technical and business logic bugs during the build process. Wicket is very suitable for a test driven development approach. For instance, if you run a unit test which fails and shows a message that the wicket id not bound, you will avoid an unneccessary server startup (a server startup takes longer than running a unit test). This reduces the development turnaround. A disadvantage is the difficult testing possibility of AJAX components. However, the testing features of Wicket are much more sophisticated than in other web frameworks.</p>
</div>
</div>
<div class="sect2">
<h3 id="_avoid_interactions_with_other_servlet_filters">Avoid interactions with other servlet filters</h3>
<div class="paragraph">
<p>Try to get within the Wicket world whenever possible. Avoid the usage of other servlet filters. For this you can use the <em>RequestCycle</em> and override the methods <em>onBeginRequest()</em> and <em>onEndRequest()</em>. You can apply the same to the <em>HttpSession</em>. The equivalent in Wicket is the <em>WebSession</em>. Just extend the <em>WebSession</em> and override the <em>newSession()</em>-method from the Application class. There are very few reasons to access the servlet interfaces. An example could be to read an external cookie to authenticate a user. Those parts should be properly encapsulated and avoided when possible. For this example, you could do the handling within the Wicket session because this is an authentication.</p>
</div>
</div>
<div class="sect2">
<h3 id="_cut_small_classes_and_methods">Cut small classes and methods</h3>
<div class="paragraph">
<p>Avoid monolithic classes. Often I have seen that developers put the whole stuff into constructors. These classes are getting very unclear and chaotic because you use inline implementations over serveral levels. It is recommended to group logical units and extract methods with a correct business naming. This enhances the clarity and the understandability of the business aspect. When a developer navigates to a component, he is not interested in the technical aspect at first, however he just need the business aspect. To retrieve technical information of a component you can navigate to the method implementation. In case of doubt you should consider to extract seperate components. Smaller components increase the chances of reuse and make testing easier. Listing 17 shows an example of a possible structuring.</p>
</div>
<div class="paragraph">
<p><strong>Listing 17:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">BlogEditPage</span> <span class="tok-kd">extends</span> <span class="tok-n">WebPage</span> <span class="tok-o">{</span>
    <span class="tok-kd">private</span> <span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Blog</span><span class="tok-o">&gt;</span> <span class="tok-n">blogModel</span><span class="tok-o">;</span>

    <span class="tok-kd">public</span> <span class="tok-nf">BlogEditPage</span><span class="tok-o">(</span><span class="tok-n">IModel</span><span class="tok-o">&lt;</span><span class="tok-n">Blog</span><span class="tok-o">&gt;</span> <span class="tok-n">blogModel</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-kd">super</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">PageParameters</span><span class="tok-o">());</span>
        <span class="tok-k">this</span><span class="tok-o">.</span><span class="tok-na">blogModel</span> <span class="tok-o">=</span> <span class="tok-n">blogModel</span><span class="tok-o">;</span>
        <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">createBlogEditForm</span><span class="tok-o">());</span>
    <span class="tok-o">}</span>

    <span class="tok-kd">private</span> <span class="tok-n">Form</span><span class="tok-o">&lt;</span><span class="tok-n">Blog</span><span class="tok-o">&gt;</span> <span class="tok-nf">createBlogEditForm</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-n">Form</span><span class="tok-o">&lt;</span><span class="tok-n">Blog</span><span class="tok-o">&gt;</span> <span class="tok-n">form</span> <span class="tok-o">=</span> <span class="tok-n">newBlogEditForm</span><span class="tok-o">();</span>
        <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">createHeadlineField</span><span class="tok-o">());</span>
        <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">createContentField</span><span class="tok-o">());</span>
        <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">createTagField</span><span class="tok-o">());</span>
        <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">createViewRightPanel</span><span class="tok-o">());</span>
        <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">createCommentRightPanel</span><span class="tok-o">());</span>
        <span class="tok-n">form</span><span class="tok-o">.</span><span class="tok-na">setOutputMarkupId</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
        <span class="tok-k">return</span> <span class="tok-n">form</span><span class="tok-o">;</span>
    <span class="tok-o">}</span>

    <span class="tok-c1">// more methods here</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_the_argument_bad_documentation">The argument "Bad documentation"</h3>
<div class="paragraph">
<p>It is a widespread opinion that Wicket has a bad documentation. This argument is just partly correct. There are a lot of code samples and snippets which can be used as code templates. Furthermore, there is a big community that answers complex questions very quickly. In Wicket it is very hard to document everything, because nearly everything is extensible and replaceable. If a component is not completely suitable, you will extend or replace it. Working with Wicket means permanently navigating through code. For example, just consider validators. How can I find all navigators that exist? Open the interface <em>IValidator</em> (Eclipse: Ctrl + Shift + T) and then open the type hierachy (Crtl + T). Now we can see all the validators existing in Wicket and our project.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="validator-type-hierachy.png" alt="validator type hierachy">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_summary_21">Summary</h3>
<div class="paragraph">
<p>The best practices presented in this chapter should help you to write better and more maintainable code in Wicket. All described methodologies were already proven in a few Wicket projects. If you follow these advices, your Wicket projects will get future-proof and hopefully successful.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_wicket_internals">Wicket Internals</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_page_storing">Page storing</h3>
<div class="paragraph">
<p>During request handling, Wicket manages page instances through interface <em>org.apache.wicket.request.handler.IPageProvider</em>. This interface creates a new page instance or loads a previously serialized page instance if we provide the corrisponding page id. <em>IPageProvider</em> delegates page creation and retrieval to interface <em>org.apache.wicket.request.mapper.IPageSource</em>.
When page class is provided <em>IPageSource</em> delegates page creation to interface <em>org.apache.wicket.IPageFactory</em>, while when page id is provided it uses interface <em>org.apache.wicket.page.IPageManager</em> to load the previously serialized page.</p>
</div>
<div class="paragraph">
<p>The following workflow diagram summarizes the mechanism seen so far:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="page-storage.png" alt="page storage">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ipagemanager">IPageManager</h3>
<div class="paragraph">
<p><em>org.apache.wicket.page.IPageManager</em>'s task is to manage which pages have been used in a request and store their last state in the backing stores, namely <em>IPageStore</em>.
The default implementation <em>org.apache.wicket.page.PageStoreManager</em> collects all stateful pages which have been used in the request cycle (more than one page can be used in a single request if for example <em>setResponsePage()</em> or <em>RestartResponseException</em> is used).
At the end of the request all collected page instances are being stored in the first level cache - http session. They are stored in http session attribute named ' [wicket:persistentPageManagerData-APPLICATION_NAME] nd passed to the underlying <em>IPageStore</em>.
When the next http request comes <em>IPageProvider</em> will ask for page with specific id and <em>PageStoreManager</em> will look first in the http session and if no match is found then it will delegate to the IPageStore. At the end of the second request the http session based cache is being overwritten completely with the newly used page instances.</p>
</div>
<div class="paragraph">
<p>To setup another <em>IPageManager</em> implementation use <em>org.apache.wicket.Application.setPageManagerProvider(IPageManagerProvider)</em>.
The custom <em>IPageManager</em> implementation may or may not use <em>IPageStore/IDataStore</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ipagestore">IPageStore</h3>
<div class="paragraph">
<p><em>org.apache.wicket.pageStore.IPageStore</em>'s role is to mediate the storing and loading of pages done by the underlying <em>IDataStore</em>. The default implementation <em>org.apache.wicket.pageStore.DefaultPageStore</em> pre-processes the pages before passing them to <em>IDataStore1.storeData(String, int, byte &lt;&lt;&gt;&gt;
)</em> and to post-processes them after <em>IDataStore1.getData(String, int)</em>. The processing consists of transforming the page instance to <em>org.apache.wicket.pageStore.DefaultPageStore.SerializedPage</em>. This is a struct of:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">{</span>
   <span class="tok-n">sessionId</span><span class="tok-o">:</span> <span class="tok-n">String</span><span class="tok-o">,</span>
   <span class="tok-n">pageId</span> <span class="tok-o">:</span> <span class="tok-kt">int</span><span class="tok-o">,</span>
   <span class="tok-n">data</span> <span class="tok-o">:</span> <span class="tok-kt">byte</span><span class="tok-o">[]</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>i.e. this is the serialized page instance (data) plus additional information needed to be able to easily find it later (sessionId, pageId).</p>
</div>
<div class="paragraph">
<p>When a <em>SerializedPage</em> has to be stored <em>DefaultPageStore</em> stores it in a application scoped cache ({sessionId, pageId} &#8594; SerializedPage) and additionally gives it to the underlying <em>IDataStore1.storeData(sessionId, pageId, data)</em>. The application scoped cache is used as second level cache. Getting a page from it is slower than the http session based cache in <em>PageStoreManager</em> because the page has to be deserialized, but is faster than the underlying <em>IDataStore</em> which stores the page bytes in some persistent store.</p>
</div>
<div class="paragraph">
<p>The size of the application scoped cache is configurable via <em>org.apache.wicket.settings.StoreSettings.setInmemoryCacheSize(int)</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_idatastore">IDataStore</h3>
<div class="paragraph">
<p><em>org.apache.wicket.pageStore.IDataStore</em> is used to persist Wicket pages (as bytes) to a persistent store like e.g. files or databases. The default implementation is <em>org.apache.wicket.pageStore.DiskDataStore</em> which as its name says stores the pages in files. The location of the folder where the files are stored is configurable via <em>org.apache.wicket.settings.StoreSettings.setFileStoreFolder(File)</em>, by default the web container&#8217;s work folder is used (ServletContext attribute <em>javax.servlet.context.tempdir</em>). In this folder a sub-folder is created named <em>'applicationName-filestore</em>'.
This folder contains a sub-folder for each active http session. This session folder contains a single file named <em>data</em> which contains the bytes for the pages. The size of this <em>data</em> file is configurable via <em>org.apache.wicket.settings.StoreSettings.setMaxSizePerSession(Bytes)</em>. When this size is exceeded the newly stored files overwrite the oldest ones.</p>
</div>
</div>
<div class="sect2">
<h3 id="_asynchronousdatastore">AsynchronousDataStore</h3>
<div class="paragraph">
<p>By default Wicket wraps <em>DiskDataStore</em> with <em>org.apache.wicket.pageStore.AsynchronousDataStore</em>. The role of <em>AsynchronousDataStore</em> is to detach the http worker thread from waiting for the write of the page bytes to the disk.
To disable it use: <em>org.apache.wicket.settings.StoreSettings.setAsynchronous(false)</em>. AsynchronousDataStore can delay the storage of pages' bytes for at most <em>org.apache.wicket.settings.StoreSettings.setAsynchronousQueueCapacity(int)</em> pages. If this capacity is exceeded then the page&#8217;s bytes are written synchronously to the backing <em>IDataStore</em>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_debugdiskdatastore">DebugDiskDataStore</h3>
<div class="paragraph">
<p>Wicket provides an extension of <em>DiskDataStore</em> that can be used to browse the content of the <em>data</em> files created by <em>DiskDataStore</em>. This extension can be found in wicket-devutils.jar and needs to be enabled in the <em>init</em>-method of your application via</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"> <span class="tok-n">DebugDiskDataStore</span><span class="tok-o">.</span><span class="tok-na">register</span><span class="tok-o">(</span><span class="tok-k">this</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The debug information can be seen at <a href="http://host:port/context/wicket/internal/debug/diskDataStore">http://host:port/context/wicket/internal/debug/diskDataStore</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_httpsessiondatastore">HttpSessionDataStore</h3>
<div class="paragraph">
<p>In some environments like Google AppEngine it is not allowed to write to the file system and thus <em>DiskDataStore</em> cannot be used. In this case <em>org.apache.wicket.pageStore.memory.HttpSessionDataStore</em> can be used as replacement. This implementation of <em>IDataStore</em> is not persistent and puts all the data in the http session.
Wicket comes with 2 default eviction strategies to keep the size of the http session reasonable:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>org.apache.wicket.pageStore.memory.PageNumberEvictionStrategy</strong> - specifies how many pages can be hold</p>
</li>
<li>
<p><strong>org.apache.wicket.pageStore.memory.MemorySizeEvictionStrategy</strong> - specifies the maximum amount of memory for pages per http session.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To configure it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">MyApp</span><span class="tok-err">#</span><span class="tok-n">init</span><span class="tok-o">()</span>
<span class="tok-o">{</span>
   <span class="tok-kd">super</span><span class="tok-o">.</span><span class="tok-na">init</span><span class="tok-o">();</span>

   <span class="tok-n">setPageManagerProvider</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">DefaultPageManagerProvider</span><span class="tok-o">()</span>
   <span class="tok-o">{</span>
       <span class="tok-kd">protected</span> <span class="tok-n">IDataStore</span> <span class="tok-nf">newDataStore</span><span class="tok-o">()</span>
       <span class="tok-o">{</span>
           <span class="tok-k">return</span>  <span class="tok-k">new</span> <span class="tok-n">HttpSessionDataStore</span><span class="tok-o">(</span><span class="tok-n">pageManagerContext</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">PageNumberEvictionStrategy</span><span class="tok-o">(</span><span class="tok-mi">20</span><span class="tok-o">));</span>
       <span class="tok-o">}</span>
   <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_debugbar">DebugBar</h3>
<div class="paragraph">
<p>Further insights which can be valueable during debugging can be retrieved using the <em>org.apache.wicket.devutils.debugbar.DebugBar</em> from wicket-devutils.jar. It&#8217;s a panel which you simply add:</p>
</div>
<div class="paragraph">
<p>Java:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">DebugBar</span><span class="tok-o">(</span><span class="tok-s">&quot;debug&quot;</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>HTML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">&lt;</span><span class="tok-n">span</span> <span class="tok-n">wicket</span><span class="tok-o">:</span><span class="tok-n">id</span><span class="tok-o">=</span><span class="tok-s">&quot;debug&quot;</span><span class="tok-o">/&gt;</span>
</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_working_with_maven_appendix">Working with Maven (Appendix)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_switching_wicket_to_deployment_mode">Switching Wicket to DEPLOYMENT mode</h3>
<div class="paragraph">
<p>As pointed out in the note in  <a href="#guide:helloWorld_2">paragraph 4.2</a>
, Wicket can be started in two modes, DEVELOPMENT and DEPLOYMENT. When we are in DEVELOPMENT mode Wicket warns us at application startup with the following message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-o">********************************************************************</span>
<span class="tok-o">***</span> <span class="tok-n">WARNING</span><span class="tok-o">:</span> <span class="tok-n">Wicket</span> <span class="tok-n">is</span> <span class="tok-n">running</span> <span class="tok-n">in</span> <span class="tok-n">DEVELOPMENT</span> <span class="tok-n">mode</span><span class="tok-o">.</span>              <span class="tok-o">***</span>
<span class="tok-o">***</span>                               <span class="tok-o">^^^^^^^^^^^</span>                    <span class="tok-o">***</span>
<span class="tok-o">***</span> <span class="tok-n">Do</span> <span class="tok-n">NOT</span> <span class="tok-n">deploy</span> <span class="tok-n">to</span> <span class="tok-n">your</span> <span class="tok-n">live</span> <span class="tok-nf">server</span><span class="tok-o">(</span><span class="tok-n">s</span><span class="tok-o">)</span> <span class="tok-n">without</span> <span class="tok-n">changing</span> <span class="tok-k">this</span><span class="tok-o">.</span>  <span class="tok-o">***</span>
<span class="tok-o">***</span> <span class="tok-n">See</span> <span class="tok-n">Application</span><span class="tok-err">#</span><span class="tok-n">getConfigurationType</span><span class="tok-o">()</span> <span class="tok-k">for</span> <span class="tok-n">more</span> <span class="tok-n">information</span><span class="tok-o">.</span> <span class="tok-o">***</span>
<span class="tok-o">********************************************************************</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As we can read Wicket itself discourages us from using DEVELOPMENT mode into production environment. The running mode of our application can be configured in four different ways. The first one is adding a filter parameter inside deployment descriptor web.xml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;filter&gt;</span>
	<span class="tok-nt">&lt;filter-name&gt;</span>wicket.MyApp<span class="tok-nt">&lt;/filter-name&gt;</span>
	<span class="tok-nt">&lt;filter-class&gt;</span>org.apache.wicket.protocol.http.WicketFilter<span class="tok-nt">&lt;/filter-class&gt;</span>
	<span class="tok-nt">&lt;init-param&gt;</span>
		<span class="tok-nt">&lt;param-name&gt;</span>applicationClassName<span class="tok-nt">&lt;/param-name&gt;</span>
		<span class="tok-nt">&lt;param-value&gt;</span>org.wicketTutorial.WicketApplication<span class="tok-nt">&lt;/param-value&gt;</span>
	<span class="tok-nt">&lt;/init-param&gt;</span>
	<span class="tok-nt">&lt;init-param&gt;</span>
            <span class="tok-nt">&lt;param-name&gt;</span>configuration<span class="tok-nt">&lt;/param-name&gt;</span>
            <span class="tok-nt">&lt;param-value&gt;</span>deployment<span class="tok-nt">&lt;/param-value&gt;</span>
	<span class="tok-nt">&lt;/init-param&gt;</span>
<span class="tok-nt">&lt;/filter&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The additional parameter is written in bold. The same parameter can be also expressed as context parameter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html"><span class="tok-nt">&lt;context-param&gt;</span>
    <span class="tok-nt">&lt;param-name&gt;</span>configuration<span class="tok-nt">&lt;/param-name&gt;</span>
    <span class="tok-nt">&lt;param-value&gt;</span>deployment<span class="tok-nt">&lt;/param-value&gt;</span>
<span class="tok-nt">&lt;/context-param&gt;</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The third way to set the running mode is using system property wicket.configuration. This parameter can be specified in the command line that starts up the server:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">java</span> <span class="tok-o">-</span><span class="tok-n">Dwicket</span><span class="tok-o">.</span><span class="tok-na">configuration</span><span class="tok-o">=</span><span class="tok-n">deployment</span> <span class="tok-o">...</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The last option is to set it in your Java code (e.g. in the init-method of your WebApplication):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">setConfigurationType</span><span class="tok-o">(</span><span class="tok-n">RuntimeConfigurationType</span><span class="tok-o">.</span><span class="tok-na">DEPLOYMENT</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Remember that system properties overwrite other settings, so they are ideal to ensure that on production machine the running mode will be always set to DEPLOYMENT.</p>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_wicket_project_from_scratch_and_importing_it_into_our_favourite_ide">Creating a Wicket project from scratch and importing it into our favourite IDE</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
In order to follow the instructions of this paragraph you must have Maven installed on your system. The installation of Maven is out of the scope of this guide but you can easily find an extensive documentation about it on Internet.
Another requirement is a good Internet connection (a flat ADSL is enough) because Maven needs to connect to its central repository to download the required dependencies.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_from_maven_to_our_ide">From Maven to our IDE</h3>
<div class="paragraph">
<p>Wicket project and its dependencies are managed using Maven. This tool is very useful also when we want to create a new project based on Wicket from scratch. With a couple of shell commands we can generate a new project properly configured and ready to be imported into our favourite IDE.
The main step to create such a project is to run the command which generates project&#8217;s structure and its artifacts. If we are not familiar with Maven or we simply don&#8217;t want to type this command by hand, we can use the utility form on Wicket site at  <a href="http://wicket.apache.org/start/quickstart.html">http://wicket.apache.org/start/quickstart.html</a></p>
</div>
<div class="imageblock">
<div class="content">
<img src="quickstart-webpage.png" alt="quickstart webpage">
</div>
</div>
<div class="paragraph">
<p>Here we have to specify the root package of our project (GroupId), the project name (ArtifactId) and which version of Wicket we want to use (Version).
Once we have run the resulting command in the OS shell, we will have a new folder with the same name of the project (i.e the ArtifactId). Inside this folder we can find a file called pom.xml. This is the main file used by Maven to manage our project. For example, using “org.wicketTutorial” as GroupId and “MyProject” as ArtifactId, we would obtain the following artifacts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"> <span class="tok-o">.</span><span class="tok-err">\</span><span class="tok-n">MyProject</span>
        <span class="tok-o">|</span>   <span class="tok-n">pom</span><span class="tok-o">.</span><span class="tok-na">xml</span>
        <span class="tok-o">|</span>
        <span class="tok-err">\</span><span class="tok-o">---</span><span class="tok-n">src</span>
            <span class="tok-o">+---</span><span class="tok-n">main</span>
            <span class="tok-o">|</span>   <span class="tok-o">+---</span><span class="tok-n">java</span>
            <span class="tok-o">|</span>   <span class="tok-o">|</span>   <span class="tok-err">\</span><span class="tok-o">---</span><span class="tok-n">org</span>
            <span class="tok-o">|</span>   <span class="tok-o">|</span>       <span class="tok-err">\</span><span class="tok-o">---</span><span class="tok-n">wicketTutorial</span>
            <span class="tok-o">|</span>   <span class="tok-o">|</span>               <span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">html</span>
            <span class="tok-o">|</span>   <span class="tok-o">|</span>               <span class="tok-n">HomePage</span><span class="tok-o">.</span><span class="tok-na">java</span>
            <span class="tok-o">|</span>   <span class="tok-o">|</span>               <span class="tok-n">WicketApplication</span><span class="tok-o">.</span><span class="tok-na">java</span>
            <span class="tok-o">|</span>   <span class="tok-o">|</span>
            <span class="tok-o">|</span>   <span class="tok-o">+---</span><span class="tok-n">resources</span>
            <span class="tok-o">|</span>   <span class="tok-o">|</span>       <span class="tok-n">log4j</span><span class="tok-o">.</span><span class="tok-na">properties</span>
            <span class="tok-o">|</span>   <span class="tok-o">|</span>
            <span class="tok-o">|</span>   <span class="tok-err">\</span><span class="tok-o">---</span><span class="tok-n">webapp</span>
            <span class="tok-o">|</span>       <span class="tok-err">\</span><span class="tok-o">---</span><span class="tok-n">WEB</span><span class="tok-o">-</span><span class="tok-n">INF</span>
            <span class="tok-o">|</span>               <span class="tok-n">web</span><span class="tok-o">.</span><span class="tok-na">xml</span>
            <span class="tok-o">|</span>
            <span class="tok-err">\</span><span class="tok-o">---</span><span class="tok-n">test</span>
                <span class="tok-err">\</span><span class="tok-o">---</span><span class="tok-n">java</span>
                    <span class="tok-err">\</span><span class="tok-o">---</span><span class="tok-n">org</span>
                        <span class="tok-err">\</span><span class="tok-o">---</span><span class="tok-n">wicketTutorial</span>
                                <span class="tok-n">TestHomePage</span><span class="tok-o">.</span><span class="tok-na">java</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>Amongst other things, file pom.xml contains a section delimited by tag &lt;dependencies&gt; which declares the dependencies of our project. By default the Maven archetype will add the following Wicket modules as dependencies:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="xml language-xml">...
<span class="tok-nt">&lt;dependencies&gt;</span>
	<span class="tok-c">&lt;!--  WICKET DEPENDENCIES --&gt;</span>
	<span class="tok-nt">&lt;dependency&gt;</span>
		<span class="tok-nt">&lt;groupId&gt;</span>org.apache.wicket<span class="tok-nt">&lt;/groupId&gt;</span>
		<span class="tok-nt">&lt;artifactId&gt;</span>wicket-core<span class="tok-nt">&lt;/artifactId&gt;</span>
		<span class="tok-nt">&lt;version&gt;</span>${wicket.version}<span class="tok-nt">&lt;/version&gt;</span>
	<span class="tok-nt">&lt;/dependency&gt;</span>
	<span class="tok-nt">&lt;dependency&gt;</span>
		<span class="tok-nt">&lt;groupId&gt;</span>org.apache.wicket<span class="tok-nt">&lt;/groupId&gt;</span>
		<span class="tok-nt">&lt;artifactId&gt;</span>wicket-ioc<span class="tok-nt">&lt;/artifactId&gt;</span>
		<span class="tok-nt">&lt;version&gt;</span>${wicket.version}<span class="tok-nt">&lt;/version&gt;</span>
	<span class="tok-nt">&lt;/dependency&gt;</span>
	<span class="tok-c">&lt;!-- OPTIONAL DEPENDENCY</span>
<span class="tok-c">	&lt;dependency&gt;</span>
<span class="tok-c">		&lt;groupId&gt;org.apache.wicket&lt;/groupId&gt;</span>
<span class="tok-c">		&lt;artifactId&gt;wicket-extensions&lt;/artifactId&gt;</span>
<span class="tok-c">		&lt;version&gt;${wicket.version}&lt;/version&gt;</span>
<span class="tok-c">	&lt;/dependency&gt;</span>
<span class="tok-c">	--&gt;</span>
	...
<span class="tok-nt">&lt;/dependencies&gt;</span>
...
</code></pre>
</div>
</div>
<div class="paragraph">
<p>If we need to use more Wicket modules or additional libraries, we can add the appropriate XML fragments here.</p>
</div>
</div>
<div class="sect2">
<h3 id="_importing_a_maven_project_into_our_ide">Importing a Maven project into our IDE</h3>
<div class="paragraph">
<p>Maven projects can be easily imported into the most popular Java IDEs. However, the procedure needed to do this differs from IDE to IDE. In this paragraph we can find the instructions to import Maven projects into three of the most popular IDEs among Java developers : NetBeans, JetBrains IDEA and Eclipse.</p>
</div>
<div class="paragraph">
<p><strong>NetBeans</strong>
Starting from version 6.7, NetBeans includes Maven support, hence we can start it and directly open the folder containing our project:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="netbeans-maven-import.png" alt="netbeans maven import">
</div>
</div>
<div class="paragraph">
<p><strong>Intellj IDEA</strong>
Intellj IDEA comes with a Maven importing functionality that can be started under “File/New Project/Import from external model/Maven”. Then, we just have to select the pom.xml file of our project:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="intellj-maven-import.png" alt="intellj maven import">
</div>
</div>
<div class="paragraph">
<p><strong>Eclipse</strong>
If our IDE is Eclipse the import procedure is a little more complex. Before opening the new project we must generate the Eclipse project artifacts running the following command from project root:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">mvn</span> <span class="tok-n">eclipse</span><span class="tok-o">:</span><span class="tok-n">eclipse</span>
</code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>Now to import our project into Eclipse we must create a classpath variable called M2_REPO that must point to your local Maven repository. This can be done selecting “Window/Preferences” and searching for “Classpath Variables”. The folder containing our local Maven repository is usually under our user folder and is called .m2 (for example under Unix system is /home/&lt;myUserName&gt;/.m2/repository):</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="eclipse-classpath-variables.png" alt="eclipse classpath variables">
</div>
</div>
<div class="paragraph">
<p>Once we have created the classpath variable we can go to “File/Import&#8230;/Existing Project into Workspace”, select the directory of the project and press “Finish”:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="eclipse-maven-import.png" alt="eclipse maven import">
</div>
</div>
<div class="paragraph">
<p>Once the project has been imported into Eclipse, we are free to use our favourite plug-ins to run it or debug it (like for example  [run-jetty-run] ttp://code.google.com/p/run-jetty-run/ ).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Please note the option “Copy projects into workspace” in the previous illustration. If we select it, the original project generated with Maven won&#8217;t be affected by the changes made inside Eclipse because we will work on a copy of it under the current workspace.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
If we modify the pom.xml file (for example adding further dependencies) we must regenerate project&#8217;s artifacts and refresh the project (F5 key) to reflect changes into Eclipse.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_speeding_up_development_with_plugins">Speeding up development with plugins.</h3>
<div class="paragraph">
<p>Now that we have our project loaded into our IDE we could start coding our components directly by hand. However it would be a shame to not leverage the free and good Wicket plugins available for our IDE. The following is a brief overview of the most widely used plugins for each of the three main IDEs considered so far.</p>
</div>
<div class="paragraph">
<p><strong>NetBeans</strong>
NetBeans offers Wicket support through <em>NetBeans Plugin for Wicket</em> hosted at  <a href="http://plugins.netbeans.org/plugin/3586/wicket-1-4-support">http://plugins.netbeans.org/plugin/3586/wicket-1-4-support</a>  This plugin is released under CDDL-1.0 license.
You can  find a nice introduction guide to this plugin at  <a href="http://netbeans.org/kb/docs/web/quickstart-webapps-wicket.html">http://netbeans.org/kb/docs/web/quickstart-webapps-wicket.html</a></p>
</div>
<div class="paragraph">
<p><strong>Intellj IDEA</strong>
For JetBrain IDEA we can use WicketForge plugin, hosted at Google Code  <a href="http://code.google.com/p/wicketforge/">http://code.google.com/p/wicketforge/</a>  The plugin is released under ASF 2.0 license.</p>
</div>
<div class="paragraph">
<p><strong>Eclipse</strong>
With Eclipse we can install one of the plugins that supports Wicket. As of the writing of this document, the most popular is probably Qwickie, available in the Eclipse Marketplace and hosted on Google Code at  <a href="http://code.google.com/p/qwickie/">http://code.google.com/p/qwickie/</a>
QWickie is released under ASF 2.0 license.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_project_wicketstuff_appendix">Project WicketStuff (Appendix)</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_what_is_project_wicketstuff">What is project WicketStuff</h3>
<div class="paragraph">
<p>WicketStuff is an umbrella project that gathers different Wicket-related projects developed and maintained by the community. The project is hosted on GitHub at  <a href="https://github.com/wicketstuff/core">https://github.com/wicketstuff/core</a>
Every module is structured as a parent Maven project containing the actual project that implements the new functionality and an example project that illustrates how to use it in our code. The resulting directory structure of each module is the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-err">\</span><span class="tok-o">&lt;</span><span class="tok-n">module</span> <span class="tok-n">name</span><span class="tok-o">&gt;-</span><span class="tok-n">parent</span>
        <span class="tok-o">|</span>
        <span class="tok-o">+---&lt;</span><span class="tok-n">module</span> <span class="tok-n">name</span><span class="tok-o">&gt;</span>
        <span class="tok-err">\</span><span class="tok-o">---&lt;</span><span class="tok-n">module</span> <span class="tok-n">name</span><span class="tok-o">&gt;-</span><span class="tok-n">examples</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>So far we have introduced only modules Kryo Serializer and JavaEE Inject, but WicketStuff comes with many other modules that can be used in our applications. Some of them come in handy to improve the user experience of our pages with complex components or integrating some popular web services (like  ogle[<a href="https://github.com/wicketstuff/core">https://github.com/wicketstuff/core</a>] JavaScript libraries (like  <a href="http://www.tinymce.com/">TinyMCE</a> .</p>
</div>
<div class="paragraph">
<p>This appendix provides a quick overview of what WicketStuff offers to enhance the usability and the visually-appealing of our pages.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
Every WicketStuff module can be downloaded as JAR archive at  <a href="http://mvnrepository.com">http://mvnrepository.com</a>  This site provides also the XML fragment needed to include it as a dependency into our pom.xml file.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_module_tinymce">Module tinymce</h3>
<div class="paragraph">
<p>Module tinymce offers integration with the namesake JavaScript library that turns our “humble” text-areas into a full-featured HTML WYSIWYG editor:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="tinymce.png" alt="tinymce">
</div>
</div>
<div class="paragraph">
<p>To “tinyfy” a textarea component we must use behavior TinyMceBehavior:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">TextArea</span> <span class="tok-n">textArea</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TextArea</span><span class="tok-o">(</span><span class="tok-s">&quot;textArea&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Model</span><span class="tok-o">(</span><span class="tok-s">&quot;&quot;</span><span class="tok-o">));</span>
<span class="tok-n">textArea</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TinyMceBehavior</span><span class="tok-o">());</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>By default TinyMceBehavior adds only a basic set of functionalities to our textarea:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="tinymce_basic.png" alt="tinymce basic">
</div>
</div>
<div class="paragraph">
<p>To add more functionalities we must use class TinyMCESettings to register additional TinyMCE plugins and to customize the toolbars buttons. The following code is an excerpt from example page FullFeaturedTinyMCEPage:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">TinyMCESettings</span> <span class="tok-n">settings</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TinyMCESettings</span><span class="tok-o">(</span>
                       <span class="tok-n">TinyMCESettings</span><span class="tok-o">.</span><span class="tok-na">Theme</span><span class="tok-o">.</span><span class="tok-na">advanced</span><span class="tok-o">);</span>
<span class="tok-c1">//...</span>
<span class="tok-c1">// first toolbar</span>
<span class="tok-c1">//...</span>
<span class="tok-n">settings</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Button</span><span class="tok-o">.</span><span class="tok-na">newdocument</span><span class="tok-o">,</span> <span class="tok-n">TinyMCESettings</span><span class="tok-o">.</span><span class="tok-na">Toolbar</span><span class="tok-o">.</span><span class="tok-na">first</span><span class="tok-o">,</span>
		      <span class="tok-n">TinyMCESettings</span><span class="tok-o">.</span><span class="tok-na">Position</span><span class="tok-o">.</span><span class="tok-na">before</span><span class="tok-o">);</span>
<span class="tok-n">settings</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Button</span><span class="tok-o">.</span><span class="tok-na">separator</span><span class="tok-o">,</span> <span class="tok-n">TinyMCESettings</span><span class="tok-o">.</span><span class="tok-na">Toolbar</span><span class="tok-o">.</span><span class="tok-na">first</span><span class="tok-o">,</span>
		      <span class="tok-n">TinyMCESettings</span><span class="tok-o">.</span><span class="tok-na">Position</span><span class="tok-o">.</span><span class="tok-na">before</span><span class="tok-o">);</span>
<span class="tok-n">settings</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-n">Button</span><span class="tok-o">.</span><span class="tok-na">fontselect</span><span class="tok-o">,</span> <span class="tok-n">TinyMCESettings</span><span class="tok-o">.</span><span class="tok-na">Toolbar</span><span class="tok-o">.</span><span class="tok-na">first</span><span class="tok-o">,</span>
		      <span class="tok-n">TinyMCESettings</span><span class="tok-o">.</span><span class="tok-na">Position</span><span class="tok-o">.</span><span class="tok-na">after</span><span class="tok-o">);</span>
<span class="tok-c1">//...</span>
<span class="tok-c1">// other settings</span>
<span class="tok-n">settings</span><span class="tok-o">.</span><span class="tok-na">setToolbarAlign</span><span class="tok-o">(</span>
   		<span class="tok-n">TinyMCESettings</span><span class="tok-o">.</span><span class="tok-na">Align</span><span class="tok-o">.</span><span class="tok-na">left</span><span class="tok-o">);</span>
<span class="tok-n">settings</span><span class="tok-o">.</span><span class="tok-na">setToolbarLocation</span><span class="tok-o">(</span>
   		<span class="tok-n">TinyMCESettings</span><span class="tok-o">.</span><span class="tok-na">Location</span><span class="tok-o">.</span><span class="tok-na">top</span><span class="tok-o">);</span>
<span class="tok-n">settings</span><span class="tok-o">.</span><span class="tok-na">setStatusbarLocation</span><span class="tok-o">(</span>
   		<span class="tok-n">TinyMCESettings</span><span class="tok-o">.</span><span class="tok-na">Location</span><span class="tok-o">.</span><span class="tok-na">bottom</span><span class="tok-o">);</span>
<span class="tok-n">settings</span><span class="tok-o">.</span><span class="tok-na">setResizing</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
<span class="tok-c1">//...</span>
<span class="tok-n">TextArea</span> <span class="tok-n">textArea</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">TextArea</span><span class="tok-o">(</span><span class="tok-s">&quot;ta&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">Model</span><span class="tok-o">(</span><span class="tok-n">TEXT</span><span class="tok-o">));</span>
<span class="tok-n">textArea</span><span class="tok-o">.</span><span class="tok-na">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">TinyMceBehavior</span><span class="tok-o">(</span><span class="tok-n">settings</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>For more configuration examples see pages inside package wicket.contrib.examples.tinymce in the example project of the module.</p>
</div>
</div>
<div class="sect2">
<h3 id="_module_wicketstuff_gmap3">Module wicketstuff-gmap3</h3>
<div class="paragraph">
<p>Module wicketstuff-gmap3 integrates  ogle[] aps ttp://maps.google.com[] ervice with Wicket providing component org.wicketstuff.gmap.GMap. If we want to embed Google Maps into one of our pages we just need to add component GMap inside the page. The following snippet is taken from example page SimplePage:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html">...
<span class="tok-nt">&lt;body&gt;</span>
  <span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;map&quot;</span><span class="tok-nt">&gt;</span>Map<span class="tok-nt">&lt;/div&gt;</span>
<span class="tok-nt">&lt;/body&gt;</span>
...
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">public</span> <span class="tok-kd">class</span> <span class="tok-nc">SimplePage</span> <span class="tok-kd">extends</span> <span class="tok-n">WicketExamplePage</span>
<span class="tok-o">{</span>
    <span class="tok-kd">public</span> <span class="tok-nf">SimplePage</span><span class="tok-o">()</span>
    <span class="tok-o">{</span>
        <span class="tok-n">GMap</span> <span class="tok-n">map</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">GMap</span><span class="tok-o">(</span><span class="tok-s">&quot;map&quot;</span><span class="tok-o">);</span>
        <span class="tok-n">map</span><span class="tok-o">.</span><span class="tok-na">setStreetViewControlEnabled</span><span class="tok-o">(</span><span class="tok-kc">false</span><span class="tok-o">);</span>
        <span class="tok-n">map</span><span class="tok-o">.</span><span class="tok-na">setScaleControlEnabled</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
        <span class="tok-n">map</span><span class="tok-o">.</span><span class="tok-na">setScrollWheelZoomEnabled</span><span class="tok-o">(</span><span class="tok-kc">true</span><span class="tok-o">);</span>
        <span class="tok-n">map</span><span class="tok-o">.</span><span class="tok-na">setCenter</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">GLatLng</span><span class="tok-o">(</span><span class="tok-mf">52.47649</span><span class="tok-o">,</span> <span class="tok-mf">13.228573</span><span class="tok-o">));</span>
        <span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">map</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>The component defines a number of setters to customize its behavior and appearance. More info can be found on wiki page  <a href="https://github.com/wicketstuff/core/wiki/Gmap3">https://github.com/wicketstuff/core/wiki/Gmap3</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_module_wicketstuff_googlecharts">Module wicketstuff-googlecharts</h3>
<div class="paragraph">
<p>To integrate the  ogle[] hart ttps://developers.google.com/chart/[] ool into our pages we can use module wicketstuff-googlecharts. To display a chart we must combine the following entities: component Chart, interface IChartData and class ChartProvider, all inside package org.wicketstuff.googlecharts. The following snippet is taken from example page Home:</p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html">...
  <span class="tok-nt">&lt;h2&gt;</span>Hello World<span class="tok-nt">&lt;/h2&gt;</span>
  <span class="tok-nt">&lt;img</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;helloWorld&quot;</span><span class="tok-nt">/&gt;</span>
...
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-n">IChartData</span> <span class="tok-n">data</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">AbstractChartData</span><span class="tok-o">(){</span>
    <span class="tok-kd">public</span> <span class="tok-kt">double</span><span class="tok-o">[][]</span> <span class="tok-nf">getData</span><span class="tok-o">(){</span>
       <span class="tok-k">return</span> <span class="tok-k">new</span> <span class="tok-kt">double</span><span class="tok-o">[][]</span> <span class="tok-o">{</span> <span class="tok-o">{</span> <span class="tok-mi">34</span><span class="tok-o">,</span> <span class="tok-mi">22</span> <span class="tok-o">}</span> <span class="tok-o">};</span>
    <span class="tok-o">}</span>
<span class="tok-o">};</span>

<span class="tok-n">ChartProvider</span> <span class="tok-n">provider</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ChartProvider</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Dimension</span><span class="tok-o">(</span><span class="tok-mi">250</span><span class="tok-o">,</span> <span class="tok-mi">100</span><span class="tok-o">),</span> <span class="tok-n">ChartType</span><span class="tok-o">.</span><span class="tok-na">PIE_3D</span><span class="tok-o">,</span> <span class="tok-n">data</span><span class="tok-o">);</span>
<span class="tok-n">provider</span><span class="tok-o">.</span><span class="tok-na">setPieLabels</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">String</span><span class="tok-o">[]</span> <span class="tok-o">{</span> <span class="tok-s">&quot;Hello&quot;</span><span class="tok-o">,</span> <span class="tok-s">&quot;World&quot;</span> <span class="tok-o">});</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Chart</span><span class="tok-o">(</span><span class="tok-s">&quot;helloWorld&quot;</span><span class="tok-o">,</span> <span class="tok-n">provider</span><span class="tok-o">));</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Displayed chart:</strong></p>
</div>
<div class="imageblock">
<div class="content">
<img src="googlechart.png" alt="googlechart">
</div>
</div>
<div class="paragraph">
<p>As we can see in the snippet above, component Chart must be used with &lt;img&gt; tag while the input data returned by IChartData must be a two-dimensional array of double values.</p>
</div>
</div>
<div class="sect2">
<h3 id="_module_wicketstuff_inmethod_grid">Module wicketstuff-inmethod-grid</h3>
<div class="paragraph">
<p>Module wicketstuff-inmethod-grid implements a sophisticated grid-component with class com. inmethod.grid.datagrid.DataGrid.</p>
</div>
<div class="paragraph">
<p>Just like pageable repeaters (seen in  <a href="#guide:repeaters_4">paragraph 13.4</a>
) DataGrid provides data pagination and uses interface IDataProvider as data source. In addition the component is completely ajaxified:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="inmethod-grid1.png" alt="inmethod grid1">
</div>
</div>
<div class="paragraph">
<p>DataGrid supports also editable cells and row selection:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="inmethod-grid2.png" alt="inmethod grid2">
</div>
</div>
<div class="paragraph">
<p>The following snippet illustrate how to use DataGrid and is taken from wiki page  <a href="https://github.com/wicketstuff/core/wiki/InMethodGrid">https://github.com/wicketstuff/core/wiki/InMethodGrid</a></p>
</div>
<div class="paragraph">
<p><strong>HTML:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="html language-html">...
  <span class="tok-nt">&lt;div</span> <span class="tok-na">wicket:id=</span><span class="tok-s">&quot;grid&quot;</span><span class="tok-nt">&gt;</span>Grid<span class="tok-nt">&lt;/div&gt;</span>
...
</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Java code:</strong></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-kd">final</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Person</span><span class="tok-o">&gt;</span> <span class="tok-n">personList</span> <span class="tok-o">=</span> <span class="tok-c1">//load a list of Persons</span>
<span class="tok-kd">final</span> <span class="tok-n">ListDataProvider</span> <span class="tok-n">listDataProvider</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">ListDataProvider</span><span class="tok-o">(</span><span class="tok-n">personList</span><span class="tok-o">);</span>
<span class="tok-c1">//define grid&#39;s columns</span>
<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">IGridColumn</span><span class="tok-o">&gt;</span> <span class="tok-n">cols</span> <span class="tok-o">=</span> <span class="tok-o">(</span><span class="tok-n">List</span><span class="tok-o">)</span> <span class="tok-n">Arrays</span><span class="tok-o">.</span><span class="tok-na">asList</span><span class="tok-o">(</span>
	     <span class="tok-k">new</span> <span class="tok-n">PropertyColumn</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Model</span><span class="tok-o">(</span><span class="tok-s">&quot;First Name&quot;</span><span class="tok-o">),</span> <span class="tok-s">&quot;firstName&quot;</span><span class="tok-o">),</span>
	     <span class="tok-k">new</span> <span class="tok-n">PropertyColumn</span><span class="tok-o">(</span><span class="tok-k">new</span> <span class="tok-n">Model</span><span class="tok-o">(</span><span class="tok-s">&quot;Last Name&quot;</span><span class="tok-o">),</span> <span class="tok-s">&quot;lastName&quot;</span><span class="tok-o">));</span>

<span class="tok-n">DataGrid</span> <span class="tok-n">grid</span> <span class="tok-o">=</span> <span class="tok-k">new</span> <span class="tok-n">DefaultDataGrid</span><span class="tok-o">(</span><span class="tok-s">&quot;grid&quot;</span><span class="tok-o">,</span> <span class="tok-k">new</span> <span class="tok-n">DataProviderAdapter</span><span class="tok-o">(</span><span class="tok-n">listDataProvider</span><span class="tok-o">),</span> <span class="tok-n">cols</span><span class="tok-o">);</span>
<span class="tok-n">add</span><span class="tok-o">(</span><span class="tok-n">grid</span><span class="tok-o">);</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the code above we have used convenience class DefaultDataGrid that is a subclass of DataGrid and it already comes with a navigation toolbar.</p>
</div>
<div class="paragraph">
<p>The example pages are under package com.inmethod.grid.examples.pages in the example project which is hosted at  <a href="http://www.wicket-library.com/inmethod-grid/data-grid/simple">http://www.wicket-library.com/inmethod-grid/data-grid/simple</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_module_wicketstuff_rest_annotations">Module wicketstuff-rest-annotations</h3>
<div class="paragraph">
<p>REST-based API are becoming more and more popular around the web and the number of services based on this architecture is constantly increasing.</p>
</div>
<div class="paragraph">
<p>Wicket is well-known for its capability of transparently handling the state of web applications on server side, but it can be also easily adopted to create RESTful services.
WicketStuff module for REST provides a special resource class and a set of annotations to implement REST APIs/services in much the same way as we do it with Spring MVC or with the standard JAX-RS.</p>
</div>
<div class="paragraph">
<p>The module provides class <em>AbstractRestResource</em> as generic abstract class to implement a Wicket resource that handles the request and the response using a particular data format (XML, JSON, etc&#8230;).
Subclassing <em>AbstractRestResource</em> we can create custom resources and map their pubblic methods to a given subpath with annotation <em>MethodMapping</em>. The following snippet is taken from resource <em>PersonsRestResource</em> inside module <em>'restannotations-examples</em>':</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">    <span class="tok-nd">@MethodMapping</span><span class="tok-o">(</span><span class="tok-s">&quot;/persons&quot;</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">PersonPojo</span><span class="tok-o">&gt;</span> <span class="tok-nf">getAllPersons</span><span class="tok-o">()</span> <span class="tok-o">{</span>
        <span class="tok-c1">//method mapped at subpath &quot;/persons&quot; and HTTP method GET</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@MethodMapping</span><span class="tok-o">(</span><span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-s">&quot;/persons/{personIndex}&quot;</span><span class="tok-o">,</span> <span class="tok-n">httpMethod</span> <span class="tok-o">=</span> <span class="tok-n">HttpMethod</span><span class="tok-o">.</span><span class="tok-na">DELETE</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">deletePerson</span><span class="tok-o">(</span><span class="tok-kt">int</span> <span class="tok-n">personIndex</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-c1">//method mapped at subpath &quot;/persons/{personIndex}&quot; and HTTP method DELETE.</span>
        <span class="tok-c1">//Segment {personIndex} will contain an integer value as index.</span>
    <span class="tok-o">}</span>

    <span class="tok-nd">@MethodMapping</span><span class="tok-o">(</span><span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-s">&quot;/persons&quot;</span><span class="tok-o">,</span> <span class="tok-n">httpMethod</span> <span class="tok-o">=</span> <span class="tok-n">HttpMethod</span><span class="tok-o">.</span><span class="tok-na">POST</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">createPerson</span><span class="tok-o">(</span><span class="tok-nd">@RequestBody</span> <span class="tok-n">PersonPojo</span> <span class="tok-n">personPojo</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-c1">//creates a new instance of PersonPojo reading it from request body</span>
    <span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>MethodMapping</em> requires to specify the subpath we want to map the method to. In addition we can specify also the HTTP method that must be used to invoke the method via REST (GET, POST, DELETE, PATCH, etc&#8230;). This value can be specified with enum class <em>HttpMethod</em> and is GET by default.
In the code above we can see annotation <em>RequestBody</em> which is used to extract the value of a method parameter from the request body (method createPerson).
To write/read objects to response/from request, <em>AbstractRestResource</em> uses an implementation of interface <em>IWebSerialDeserial</em> which defines the following methods:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">    <span class="tok-kd">public</span> <span class="tok-kd">interface</span> <span class="tok-nc">IWebSerialDeserial</span> <span class="tok-o">{</span>

       <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">objectToResponse</span><span class="tok-o">(</span><span class="tok-n">Object</span> <span class="tok-n">targetObject</span><span class="tok-o">,</span> <span class="tok-n">WebResponse</span> <span class="tok-n">response</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">mimeType</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span><span class="tok-o">;</span>

       <span class="tok-kd">public</span> <span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">T</span> <span class="tok-nf">requestToObject</span><span class="tok-o">(</span><span class="tok-n">WebRequest</span> <span class="tok-n">request</span><span class="tok-o">,</span> <span class="tok-n">Class</span><span class="tok-o">&lt;</span><span class="tok-n">T</span><span class="tok-o">&gt;</span> <span class="tok-n">argClass</span><span class="tok-o">,</span> <span class="tok-n">String</span> <span class="tok-n">mimeType</span><span class="tok-o">)</span> <span class="tok-kd">throws</span> <span class="tok-n">Exception</span><span class="tok-o">;</span>

       <span class="tok-kd">public</span> <span class="tok-kt">boolean</span> <span class="tok-nf">isMimeTypeSupported</span><span class="tok-o">(</span><span class="tok-n">String</span> <span class="tok-n">mimeType</span><span class="tok-o">);</span>
    <span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To convert segments value (which are strings) to parameters type, <em>AbstractRestResource</em> uses the standard Wicket mechanism based on the application converter locator:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">    <span class="tok-c1">//return the converter for type clazz</span>
    <span class="tok-n">IConverter</span> <span class="tok-n">converter</span> <span class="tok-o">=</span> <span class="tok-n">Application</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">getConverterLocator</span><span class="tok-o">().</span><span class="tok-na">getConverter</span><span class="tok-o">(</span><span class="tok-n">clazz</span><span class="tok-o">);</span>
    <span class="tok-c1">//convert string to object</span>
    <span class="tok-k">return</span> <span class="tok-n">converter</span><span class="tok-o">.</span><span class="tok-na">convertToObject</span><span class="tok-o">(</span><span class="tok-n">value</span><span class="tok-o">,</span> <span class="tok-n">Session</span><span class="tok-o">.</span><span class="tok-na">get</span><span class="tok-o">().</span><span class="tok-na">getLocale</span><span class="tok-o">());</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>In order to promote the principle of convention over configuration, we don&#8217;t need to use any annotation to map method parameters to path parameters if they are declared in the same order. If we need to manually bind method parameters to path parameters we can use annotation <em>PathParam</em>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">    <span class="tok-nd">@MethodMapping</span><span class="tok-o">(</span><span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-s">&quot;/variable/{p1}/order/{p2}&quot;</span><span class="tok-o">,</span> <span class="tok-n">produces</span> <span class="tok-o">=</span> <span class="tok-n">RestMimeTypes</span><span class="tok-o">.</span><span class="tok-na">PLAIN_TEXT</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-n">String</span> <span class="tok-nf">testParamOutOfOrder</span><span class="tok-o">(</span><span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;p2&quot;</span><span class="tok-o">)</span> <span class="tok-n">String</span> <span class="tok-n">textParam</span><span class="tok-o">,</span> <span class="tok-nd">@PathParam</span><span class="tok-o">(</span><span class="tok-s">&quot;p1&quot;</span><span class="tok-o">)</span> <span class="tok-kt">int</span> <span class="tok-n">intParam</span><span class="tok-o">)</span> <span class="tok-o">{</span>
        <span class="tok-c1">//method parameter textParam is taken from path param &#39;p2&#39;, while intParam uses &#39;p1&#39;</span>
    <span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>As JSON is de-facto standard format for REST API, the project comes also with a ready-to-use resource (<em>GsonRestResource</em>) and a serial/deserial (<em>GsonSerialDeserial</em>) that work with JSON format (both inside module <em>'restannotations-json</em>'). These classes use Gson as JSON library.</p>
</div>
<div class="paragraph">
<p><em>AbstractRestResource</em> supports role-based authorizations for mapped method with annotation <em>AuthorizeInvocation</em>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java">    <span class="tok-nd">@MethodMapping</span><span class="tok-o">(</span><span class="tok-n">value</span> <span class="tok-o">=</span> <span class="tok-s">&quot;/admin&quot;</span><span class="tok-o">,</span> <span class="tok-n">httpMethod</span> <span class="tok-o">=</span> <span class="tok-n">HttpMethod</span><span class="tok-o">.</span><span class="tok-na">GET</span><span class="tok-o">)</span>
    <span class="tok-nd">@AuthorizeInvocation</span><span class="tok-o">(</span><span class="tok-s">&quot;ROLE_ADMIN&quot;</span><span class="tok-o">)</span>
    <span class="tok-kd">public</span> <span class="tok-kt">void</span> <span class="tok-nf">testMethodAdminAuth</span><span class="tok-o">()</span> <span class="tok-o">{</span>

    <span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>To use annotation <em>AuthorizeInvocation</em> we must specify in the resource construcor an instance of Wicket interface <em>IRoleCheckingStrategy</em>.</p>
</div>
<div class="paragraph">
<p>To read the complete documentation of the module and to discover more advanced feature please refer to the  oject[] omepage oject[] github.com/wicketstuff/core/blob/master/jdk-1.7-parent/wicketstuff-restannotations-parent</p>
</div>
</div>
<div class="sect2">
<h3 id="_module_stateless">Module stateless</h3>
<div class="paragraph">
<p>Wicket makes working with AJAX easy and pleasant with its component-oriented abstraction. However as side effect, AJAX components and behaviors make their hosting page stateful. This can be quite annoying if we are working on a page that must be stateless (for example a login page).
In this case an obvious solution would be to roll out our own stateless components/behaviors, but Wicketstuff alredy offers such kind of artifacts with <em>stateless</em> module. Here you can find the stateless version of the basic AJAX componets and behaviors shiped with Wicket, like <em>StatelessAjaxSubmitLink</em>, <em>StatelessAjaxFallbackLink</em>, <em>StatelessAjaxEventBehavior</em>, <em>StatelessAjaxFormSubmitBehavior</em> etc&#8230;
A short introduction to this module can be found on its  me[] age ttps://github.com/wicketstuff/core/tree/master/jdk-1.7-parent/stateless-parent[]</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_lost_in_redirection_with_apache_wicket_appendix">Lost In Redirection With Apache Wicket (Appendix)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Quite a few teams have already got stuck into the following problem when working with wicket forms in a clustered environment while having 2 (or more) tomcat server with enabled session replication running.</p>
</div>
<div class="paragraph">
<p>In case of invalid data being submitted with a form instance for example, it seemed like according error messages wouldn’t be presented when the same form page gets displayed again. Sometimes! And sometimes they would! One of those nightmares of rather deterministic programmer’s life. This so called Lost In Redirection problem, even if it looks like a wicket bug at first, is rather a result of a default setting in wicket regarding the processing of form submissions in general. In order to prevent another wide known problem of double form submissions, Wicket uses a so called REDIRECT_TO_BUFFER strategy for dealing with rendering a page after web form’s processing ('see RequestCycleSettings1.RenderStrategy).</p>
</div>
<div class="paragraph">
<p>What does the default RenderStrategy actually do?</p>
</div>
<div class="paragraph">
<p>Both logical parts of a single HTTP request, an action and a render part get processed within the same request, but instead of streaming the render result to the browser directly, the result is cached on the server first.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="lost-in-redirection-mockup.png" alt="lost in redirection mockup">
</div>
</div>
<div class="paragraph">
<p>Wicket will create an according BufferedHttpServletResponse instance that will be used to cache the resulting HttpServletResponse within the WebApplication.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="lost-in-redirection-mockup2.png" alt="lost in redirection mockup2">
</div>
</div>
<div class="paragraph">
<p>After the buffered response is cached the HTTP status code of 302 get’s provided back to the browser resulting in an additional GET request to the redirect URL (which Wicket sets to the URL of the Form itself). There is a special handling code for this case in the WicketFilter instance that then looks up a Map of buffered responses within the WebApplication accordingly. If an appropriate already cached response for the current request is found, it get’s streamed back to the browser immediately. No additional form processing happens now. The following is a code snippet taken from WicketFilter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-c1">// Are we using REDIRECT_TO_BUFFER?</span>
<span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">webApplication</span><span class="tok-o">.</span><span class="tok-na">getRequestCycleSettings</span><span class="tok-o">().</span><span class="tok-na">getRenderStrategy</span><span class="tok-o">()</span> <span class="tok-o">==</span> <span class="tok-n">RequestCycleSettings</span><span class="tok-o">.</span><span class="tok-na">REDIRECT_TO_BUFFER</span><span class="tok-o">)</span>
<span class="tok-o">{</span>
    <span class="tok-c1">// Try to see if there is a redirect stored</span>
    <span class="tok-c1">// try get an existing session</span>
    <span class="tok-n">ISessionStore</span> <span class="tok-n">sessionStore</span> <span class="tok-o">=</span> <span class="tok-n">webApplication</span><span class="tok-o">.</span><span class="tok-na">getSessionStore</span><span class="tok-o">();</span>
    <span class="tok-n">String</span> <span class="tok-n">sessionId</span> <span class="tok-o">=</span> <span class="tok-n">sessionStore</span><span class="tok-o">.</span><span class="tok-na">getSessionId</span><span class="tok-o">(</span><span class="tok-n">request</span><span class="tok-o">,</span> <span class="tok-kc">false</span><span class="tok-o">);</span>
    <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">sessionId</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span>
    <span class="tok-o">{</span>
        <span class="tok-n">BufferedHttpServletResponse</span> <span class="tok-n">bufferedResponse</span> <span class="tok-o">=</span> <span class="tok-kc">null</span><span class="tok-o">;</span>
        <span class="tok-n">String</span> <span class="tok-n">queryString</span> <span class="tok-o">=</span> <span class="tok-n">servletRequest</span><span class="tok-o">.</span><span class="tok-na">getQueryString</span><span class="tok-o">();</span>
        <span class="tok-c1">// look for buffered response</span>
        <span class="tok-k">if</span> <span class="tok-o">(!</span><span class="tok-n">Strings</span><span class="tok-o">.</span><span class="tok-na">isEmpty</span><span class="tok-o">(</span><span class="tok-n">queryString</span><span class="tok-o">))</span>
        <span class="tok-o">{</span>
            <span class="tok-n">bufferedResponse</span> <span class="tok-o">=</span> <span class="tok-n">webApplication</span><span class="tok-o">.</span><span class="tok-na">popBufferedResponse</span><span class="tok-o">(</span><span class="tok-n">sessionId</span><span class="tok-o">,</span>
                <span class="tok-n">queryString</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
        <span class="tok-k">else</span>
        <span class="tok-o">{</span>
            <span class="tok-n">bufferedResponse</span> <span class="tok-o">=</span> <span class="tok-n">webApplication</span><span class="tok-o">.</span><span class="tok-na">popBufferedResponse</span><span class="tok-o">(</span><span class="tok-n">sessionId</span><span class="tok-o">,</span>
                <span class="tok-n">relativePath</span><span class="tok-o">);</span>
        <span class="tok-o">}</span>
        <span class="tok-c1">// if a buffered response was found</span>
        <span class="tok-k">if</span> <span class="tok-o">(</span><span class="tok-n">bufferedResponse</span> <span class="tok-o">!=</span> <span class="tok-kc">null</span><span class="tok-o">)</span>
        <span class="tok-o">{</span>
            <span class="tok-n">bufferedResponse</span><span class="tok-o">.</span><span class="tok-na">writeTo</span><span class="tok-o">(</span><span class="tok-n">servletResponse</span><span class="tok-o">);</span>
            <span class="tok-c1">// redirect responses are ignored for the request</span>
            <span class="tok-c1">// logger...</span>
            <span class="tok-k">return</span> <span class="tok-kc">true</span><span class="tok-o">;</span>
        <span class="tok-o">}</span>
    <span class="tok-o">}</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>So what happens in case you have 2 server running your application with session replication and load balancing turned on while using the default RenderStrategy described above?</p>
</div>
<div class="paragraph">
<p>Since a Map of buffered responses is cached within a WebApplication instance that does not get replicated between the nodes obviously, a redirect request that is suppose to pick up the previously cached response (having possibly form violation messages inside) potentially get’s directed to the second node in your cluster by the load balancer. The second node does not have any responses already prepared and cached for your user. The node therefore handles the request as a completely new request for the same form page and displays a fresh new form page instance to the user accordingly.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="lost-in-redirection-mockup3.png" alt="lost in redirection mockup3">
</div>
</div>
<div class="paragraph">
<p>Unfortunately, there is currently no ideal solution to the problem described above. The default RenderStrategy used by Apache Wicket simply does not work well in a fully clustered environment with load balancing and session replication turned on. One possibility is to change the default render strategy for your application to a so called ONE_PASS_RENDER RenderStrategy which is the more suitable option to use when you want to do sophisticated (non-sticky session) clustering. This is easily done in the init method of your own subclass of Wicket’s WebApplication :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code class="java language-java"><span class="tok-nd">@Override</span>
<span class="tok-kd">protected</span> <span class="tok-kt">void</span> <span class="tok-nf">init</span><span class="tok-o">()</span> <span class="tok-o">{</span>
    <span class="tok-n">getRequestCycleSettings</span><span class="tok-o">().</span><span class="tok-na">setRenderStrategy</span><span class="tok-o">(</span>
        <span class="tok-n">RequestCycleSettings</span><span class="tok-o">.</span><span class="tok-na">ONE_PASS_RENDER</span><span class="tok-o">);</span>
<span class="tok-o">}</span>
</code></pre>
</div>
</div>
<div class="paragraph">
<p>ONE_PASS_RENDER RenderStrategy does not solve the double submit problem though! So this way you’d only be trading one problem for another one actually.</p>
</div>
<div class="paragraph">
<p>You could of course turn on the session stickiness between your load balancer (apache server) and your tomcat server additionally to the session replication which would be the preferred solution in my opinion.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="lost-in-redirection-mockup4.png" alt="lost in redirection mockup4">
</div>
</div>
<div class="paragraph">
<p>Session replication would still provide you with failover in case one of the tomcat server dies for whatever reason and sticky sessions would ensure that the Lost In Redirection problem does not occur any more.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contributing_to_this_guide_appendix">Contributing to this guide (Appendix)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You can contribute to this guide by following these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The guide uses Grails GDoc to generate the final HTML/PDF so you should consult with its <a href="http://grails.org/WikiSyntax">syntax</a></p>
</li>
<li>
<p>Clone Apache Wicket&#8217;s GIT repository <a href="https://github.com/apache/wicket.git">site</a></p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>git clone https://github.com/apache/wicket.git</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Edit the <em>.gdoc</em> files in <em>wicket/wicket-user-guide/src/docs/guide</em> folder</p>
</li>
<li>
<p>To preview your changes run  n[<a href="https://github.com/apache/wicket.git">https://github.com/apache/wicket.git</a>] t/wicket-user-guide_ folder (in eclipse use a run configuration)</p>
</li>
<li>
<p>Navigate to <em>wicket/wicket-user-guide/target/guide/7.x</em> and open one of the following files a browser / pdf viewer:</p>
<div class="ulist">
<ul>
<li>
<p><em>index.html</em> (multi page version)</p>
</li>
<li>
<p><em>guide/single.html</em> (single page version)</p>
</li>
<li>
<p><em>guide/single.pdf</em> (single page pdf version)</p>
</li>
</ul>
</div>
</li>
<li>
<p>Create a ticket in Apache Wicket&#8217;s <a href="https://issues.apache.org/jira/browse/WICKET">JIRA</a></p>
</li>
<li>
<p><strong>Commit and push the changes</strong> to your forked Apacke Wicket&#8217;s GIT repository and <strong>create a pull request</strong> on github</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Thank you!</strong></p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-06-23 09:51:40 CEST
</div>
</div>
</body>
</html>